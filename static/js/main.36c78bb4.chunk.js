(this.webpackJsonpcnaviz=this.webpackJsonpcnaviz||[]).push([[0],{133:function(e,t,s){},212:function(e,t,s){},213:function(e,t,s){},214:function(e,t,s){},247:function(e,t,s){},263:function(e,t){},265:function(e,t){},275:function(e,t,s){},277:function(e,t,s){},278:function(e,t,s){},389:function(e,t,s){},391:function(e,t,s){},392:function(e,t,s){},394:function(e,t,s){"use strict";s.r(t);var r=s(1),a=s.n(r),n=s(216),i=s.n(n),o=(s(247),s(38)),l=s(21),c=s(35),h=s(12),d=s(13),u=s(7),p=s(15),f=s(16),g=s(11),b=s(155),v=s.n(b),m=s(8),y=s.n(m),S=function(e){function t(e,s){if(Object(h.a)(this,t),this.start=e,this.end=s,s<e)throw new RangeError("End cannot be less than start");this.start=e,this.end=s}return Object(d.a)(t,[{key:e,value:Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start;case 2:return e.next=4,this.end;case 4:case"end":return e.stop()}}),e,this)}))},{key:"getLength",value:function(){return this.end-this.start}},{key:"getCenter",value:function(){return.5*(this.start+this.end)}},{key:"hasOverlap",value:function(e){return Math.max(this.start,e.start)<Math.min(this.end,e.end)}},{key:"toString",value:function(){return"[".concat(this.start,", ").concat(this.end,")")}}]),t}(Symbol.iterator),C=function(){function e(t,s,r){if(Object(h.a)(this,e),this.chr=void 0,this._interval=void 0,s<0)throw new RangeError("Start cannot be negative");this.chr=t,this._interval=new S(s,r)}return Object(d.a)(e,[{key:"start",get:function(){return this._interval.start}},{key:"end",get:function(){return this._interval.end}},{key:"getLength",value:function(){return this._interval.getLength()}},{key:"hasOverlap",value:function(e){return this.chr===e.chr&&this._interval.hasOverlap(e._interval)}},{key:"toString",value:function(){return"".concat(this.chr,":").concat(this.start,"-").concat(this.end)}},{key:"endsRoundedToMultiple",value:function(t){if(t<=0)throw new RangeError("Cannot round to a multiple <= 0 (got ".concat(t,")"));return new e(this.chr,Math.floor(this.start/t)*t,Math.ceil(this.end/t)*t)}}],[{key:"parse",value:function(t){var s=t.match(/([\w:]+)\W+(\d+)\W+(\d+)/);if(s)return new e(s[1],Number.parseInt(s[2],10),Number.parseInt(s[3],10));throw new RangeError("Could not parse interval")}}]),e}(),j=s(19),A=s(23),x={toChromosomeInterval:function(e){return new C(e["#CHR"],e.START,e.END)},flattenNestedBins:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=0,r=e.length;s<r;s++){var a=e[s];Array.isArray(a)?this.flattenNestedBins(a,t):t.push(a)}return t}},_=s(63),w=s(61),O=s(3);function k(e,t){t||(t=e.currentTarget);var s=t.getBoundingClientRect();return{x:e.clientX-s.left,y:e.clientY-s.top}}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0,r=e;if(s&&(r-=s),r<0)return"";var a=Math.floor(r);return a>=75e4?"".concat((a/1e6).toFixed(t)," Mb"):a>=1e4?"".concat((a/1e3).toFixed(t)," kb"):"".concat(a," bp")}function D(e,t,s){if(e.length!==t.length)throw Error("Calculate Euclidean Distance - pointOne dim does not match pointTwo dim");for(var r=0,a=0;a<e.length;a++){var n=Number(e[a])-Number(t[a]);r+=n*n}return!0===s?Math.sqrt(r):r}var P=function(e){var t=O.e(e);if(null!==t){var s=t.rgb();return[s.r/255,s.g/255,s.b/255,s.opacity]}},B=function(e,t){var s,r=[],a=Object(g.a)(t);try{for(a.s();!(s=a.n()).done;){var n=s.value;r.push(D(e,n,!0))}}catch(i){a.e(i)}finally{a.f()}return y.a.mean(r)},R=function(e,t){var s=[];if(1===t.length)return 0;var r,a=Object(g.a)(t);try{for(a.s();!(r=a.n()).done;){var n=D(e,r.value,!0);0!==n&&s.push(n)}}catch(i){a.e(i)}finally{a.f()}return y.a.mean(s)};function N(e,t,s,r){var a=Object(j.a)(t.keys()),n=new Map;if(1===a.length)return[];for(var i=0,o=e.length>0?.01:1,l=0;l<e.length;l++){var c=e[l],h=s[l],d=new Map,u=t.get(h);if(!u)throw new Error("Key error: Cluster not found");if(1!==u.length){var p,f=L(u,o),b=R(c,f),v=1/0,m=Object(g.a)(a);try{for(m.s();!(p=m.n()).done;){var S=p.value;if(S!==h){var C=t.get(S);if(!C)throw new Error("Key error: Cluster not found");var A=L(C,o),x=B(c,A);d.set(Number(S),x),x<v&&(v=x)}}}catch(I){m.e(I)}finally{m.f()}var _=y.a.max([v,b]);if(_){var w=(v-b)/_;if(i+=w,n.has(h)){var O=n.get(h);O&&(O.push(w),n.set(h,O))}else n.set(h,[w])}r.set(h,d)}else if(n.has(h)){var k=n.get(h);k&&(k.push(0),n.set(h,k))}else n.set(h,[0])}var T,D=[],P=Object(g.a)(a);try{for(P.s();!(T=P.n()).done;){var N=T.value,M=n.get(Number(N));if(void 0!==M){var E={cluster:Number(N),avg:y.a.mean(M)};D.push(E)}}}catch(I){P.e(I)}finally{P.f()}var F=i/e.length;return console.log(F),y.a.sortBy(D,"cluster")}function L(e,t){for(var s=new Set,r=e.length,a=t*r;s.size<a;){var n=e[Math.floor(Math.random()*r)];s.add(n)}return Object(j.a)(s)}var M=function(e){return Array.isArray(e)&&e.every((function(e){return"object"===typeof e&&!(e instanceof Array)}))},E=function(e,t){var s,r=t=t||(s=e,Array.from(s.map((function(e){return Object.keys(e)})).reduce((function(e,t){return new Set([].concat(Object(j.a)(e),Object(j.a)(t)))}),[]))),a=t;M(t)&&(r=t.map((function(e){return e.label})),a=t.map((function(e){return e.key})));var n=e.map((function(e){return a.map((function(t){return F(t,e)}))}));return[r].concat(Object(j.a)(n))},F=function(e,t){var s=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce((function(e,t,s,r){return void 0===e[t]?(r.splice(1),null):e[t]}),t);return void 0===s?e in t?t[e]:"":s},I=function(e){return"undefined"===typeof e||null===e?"":e},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e.filter((function(e){return e})).map((function(e){return e.map((function(e){return I(e)})).map((function(e){return"".concat(e)})).join(t)})).join("\n")},z=function(e,t,s,r){if(M(e))return function(e,t,s,r){return U(E(e,t),s,r)}(e,t,s,r);if(a=e,Array.isArray(a)&&a.every((function(e){return Array.isArray(e)})))return function(e,t,s,r){return U(t?[t].concat(Object(j.a)(e)):e,s,r)}(e,t,s,r);var a;if("string"===typeof e)return function(e,t,s,r){return t?"".concat(t.join(s),"\n").concat(e):e}(e,t,s);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},Y=.5,G=[[1,1],[1,0],[2,0],[2,1],[3,1],[4,2],[3,2]],H="-1",K="-2",X=new Set(["reverseBAF","genomicPosition","fractional_cn","logRD"]),Q=["#CHR","START","END","CLUSTER","SAMPLE","RD","BAF"],Z=["symbol","Genome Location"];function V(e,t,s){return new Promise((function(r,a){for(var n=[],i=[],o=new Map,l=t?"logRD":"RD",c=0;c<s.length;c+=e.length){for(var h=[],d=s[c].CLUSTER,u=c;u<c+e.length;u++){if(!(u<s.length))throw Error("Out of Range Error. There are bins missing in the data (bin must exist across all samples).");var p=s[u];u===c&&i.push(d),h.push(p.reverseBAF),h.push(p[l])}if(n.push(h),o.has(d)){var f=o.get(d);void 0!==f&&(f.push(h),o.set(d,f))}else o.set(d,[h])}r({multiDimData:n,clusterToData:o,labels:i})}))}var J=function(){function e(t){Object(h.a)(this,e),this._rdRanges=void 0,this._logRdRanges=void 0,this._locationGroupedData=void 0,this.brushedBins=void 0,this.brushedCrossfilter=void 0,this.brushedClusterDim=void 0,this._ndx=void 0,this._sample_dim=void 0,this._cluster_dim=void 0,this._chr_dim=void 0,this._genomic_pos_dim=void 0,this._samples=void 0,this._clusters=void 0,this._chrs=void 0,this._sampleGroupedData=void 0,this.clusterTableInfo=void 0,this.clusterTableInfo2=void 0,this.clusterTableInfo3=void 0,this.allRecords=void 0,this._cluster_filters=void 0,this._cluster_filters_to=void 0,this._cluster_filters_from=void 0,this.historyStack=void 0,this._clusterAmounts=void 0,this.logOfActions=void 0,this.centroids=void 0,this.centroidPts=void 0,this.chrToClusters=void 0,this.centroidDistances=void 0,this.shouldCalculatesilhouettes=void 0,this.currentsilhouettes=void 0,this.overallSilhouette=void 0,this.clusterDistanceMatrix=void 0,this.rdMeans=void 0,this._updateFractionalCopyNumbers=void 0,this.currentDataKey=void 0,this.sampleToPloidy=void 0,this.sampleToBafTicks=void 0,this.sampleToFractionalTicks=void 0,this.offset=void 0,this._locationGroupedData={},this.initializeLocationGroupedData(t),this._sampleGroupedData={},this._rdRanges={},this.rdMeans={},this._logRdRanges={},this._samples=[],this._chrs=[],this._clusters=[],this.brushedBins=[],this.brushedCrossfilter=Object(_.a)(this.brushedBins),this.brushedClusterDim=this.brushedCrossfilter.dimension((function(e){return e.CLUSTER})),this._cluster_filters=[],this._cluster_filters_to=[],this._cluster_filters_from=[],this.historyStack=[],this._ndx=Object(_.a)(t),this.logOfActions=[],this.centroidPts={},this.centroids=[],this.chrToClusters={},this.centroidDistances={},this.shouldCalculatesilhouettes=!0,this.currentsilhouettes=[],this.clusterDistanceMatrix=new Map,this.overallSilhouette=0,this.currentDataKey="RD",this.sampleToPloidy={},this.sampleToBafTicks={},this.sampleToFractionalTicks={},this.offset=0;var s,r=Object(g.a)(t);try{for(r.s();!(s=r.n()).done;){var a=s.value;this.chrToClusters[a["#CHR"]]?this.chrToClusters[a["#CHR"]].add(String(a.CLUSTER)):this.chrToClusters[a["#CHR"]]=new Set([String(a.CLUSTER)])}}catch(J){r.e(J)}finally{r.f()}for(var n=y.a.groupBy(t,"SAMPLE"),i=0,o=Object.entries(n);i<o.length;i++){var l=Object(A.a)(o[i],2),c=l[0],d=l[1];this._samples.push(c);var u=y.a.groupBy(d,"CLUSTER");this._clusters=y.a.union(this._clusters,Object.keys(u));for(var p=0,f=Object.values(u);p<f.length;p++){var b=f[p],v=y.a.groupBy(b,"#CHR");this._chrs=y.a.union(this._chrs,Object.keys(v))}}for(var S=y.a.groupBy(t,"CLUSTER"),C=0,j=Object.entries(S);C<j.length;C++){for(var x=Object(A.a)(j[C],2),O=x[0],k=x[1],T=y.a.groupBy(k,"SAMPLE"),D={},P=0,B=Object.entries(T);P<B.length;P++){var R=Object(A.a)(B[P],2),N=R[0],L=R[1];this.sampleToPloidy[N]=2;var M=this.calculateCentroid(L,this.currentDataKey),E={cluster:parseInt(O),point:M};if(this.centroidPts[N]&&this.centroidPts[O])this.centroidPts[N][O].push(E);else if(this.centroidPts[N])this.centroidPts[N][O]=[E];else{var F={};F[O]=[E],this.centroidPts[N]=F}var I="("+M[0].toFixed(2)+","+M[1].toFixed(2)+")";D[N]=I}var U={key:O,sample:D};this.centroids.push(U)}if(this._cluster_filters=this._clusters,this._cluster_filters_to=this._clusters,this._cluster_filters_from=this._clusters,this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this._genomic_pos_dim=this._ndx.dimension((function(e){return e.genomicPosition})),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE"),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),t.length>0){var z,G=Object(g.a)(this._samples);try{for(G.s();!(z=G.n()).done;){var H=z.value,K=this._sampleGroupedData[H],X=[y.a.minBy(K,"RD").RD,y.a.maxBy(K,"RD").RD],Q=[y.a.minBy(K,"logRD").logRD,y.a.maxBy(K,"logRD").logRD];this.rdMeans[H]=y.a.meanBy(K,"RD"),this._rdRanges[H]=X,this._logRdRanges[H]=Q}}catch(J){G.e(J)}finally{G.f()}}for(var Z in n){this.getBAFLines(Y,Z,this.offset);var V=(2*(this._rdRanges[Z][1]+1)/this.rdMeans[Z]-1)/Y;this.getFractionalCNTicks(Y,0,6,V,Z)}this.initializeCentroidDistMatrix(),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.clusterTableInfo2=this.calculateClusterTableInfo(),this.clusterTableInfo3=this.calculateClusterTableInfo(),this.filterRecordsByScales=Object(w.a)(this.filterRecordsByScales),this.getBAFLines=Object(w.a)(this.getBAFLines),this._updateFractionalCopyNumbers=Object(m.memoize)(this.updateFractionalCopyNumbers,(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t[0]+"_"+t[1]+"_"+t[2].length+"_"+t[3].join(".")}))}return Object(d.a)(e,[{key:"setShouldRecalculatesilhouettes",value:function(e){this.shouldCalculatesilhouettes=e}},{key:"getClusterDistanceMatrix",value:function(){return this.clusterDistanceMatrix}},{key:"getAvgSilhouette",value:function(){return this.overallSilhouette}},{key:"setSamplePloidy",value:function(e,t){this.sampleToPloidy[e]=t}},{key:"getSampleToPloidy",value:function(){return this.sampleToPloidy}},{key:"recalculatesilhouettes",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t){var s,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldCalculatesilhouettes){e.next=16;break}return s=null,e.prev=2,e.next=5,V(this._samples,t,this.allRecords);case 5:s=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return");case 12:r=N(s.multiDimData,s.clusterToData,s.labels,this.clusterDistanceMatrix),this.overallSilhouette=Number((a=r,y.a.meanBy(a,"avg")).toFixed(3)),this.currentsilhouettes=r,this.shouldCalculatesilhouettes=!1;case 16:return e.abrupt("return",this.currentsilhouettes);case 17:case"end":return e.stop()}var a}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeCentroidDistMatrix",value:function(){var e,t=Object(g.a)(this._samples);try{for(t.s();!(e=t.n()).done;){var s=e.value;this.centroidDistances[s]=[];var r,a=this.getCentroidPoints(s),n=Object(g.a)(a);try{for(n.s();!(r=n.n()).done;){var i,o=r.value,l=Object(g.a)(a);try{for(l.s();!(i=l.n()).done;){var c=i.value,h=D(o.point,c.point);this.centroidDistances[s].push({cluster1:o.cluster,cluster2:c.cluster,dist:h})}}catch(d){l.e(d)}finally{l.f()}}}catch(d){n.e(d)}finally{n.f()}}}catch(d){t.e(d)}finally{t.f()}}},{key:"getCentroidDistMatrix",value:function(e){return this.centroidDistances[e]}},{key:"calculateCentroid",value:function(e,t){return[y.a.meanBy(e,(function(e){return e.reverseBAF})),y.a.meanBy(e,(function(e){return e[t]}))]}},{key:"getCentroidData",value:function(){return this.centroids}},{key:"getCentroidPoints",value:function(e,t,s){var r,a=this.centroidPts[e],n=this._cluster_filters;r=t?this.chrToClusters[t]:new Set(n);var i,o=[],l=Object(g.a)(n);try{for(l.s();!(i=l.n()).done;){var c=i.value;r.has(c)&&a[c.valueOf()]&&o.push(a[c.valueOf()][0])}}catch(d){l.e(d)}finally{l.f()}if(s&&1!==s){var h=y.a.cloneDeep(o);return h.forEach((function(e){return e.point[1]=e.point[1]*s})),h}return o}},{key:"calculateClusterTableInfo",value:function(){var e,t=this._cluster_dim.group().all(),s=[],r=Object(g.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value,n=Number((Number(a.value)/this.allRecords.length*100).toFixed(2));s.push({key:Number(a.key),value:n})}}catch(i){r.e(i)}finally{r.f()}return s}},{key:"initializeLocationGroupedData",value:function(e){this._locationGroupedData={};var t,s=Object(g.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value,a=x.toChromosomeInterval(r).toString();this._locationGroupedData[a]?this._locationGroupedData[a].push(r):this._locationGroupedData[a]=[r]}}catch(n){s.e(n)}finally{s.f()}}},{key:"isEmpty",value:function(){return 0===this.getSampleList().length}},{key:"getRdRange",value:function(e,t,s){var r=t?this._logRdRanges[e]:this._rdRanges[e];return[1*r[0],1*r[1]]}},{key:"getFractionCNRange",value:function(e,t,s){return[e*t+2*(1-e),e*s+2*(1-e)]}},{key:"getFractionalCNTicks",value:function(e,t,s,r,a){for(var n=[],i=t;i<=s;i++)if(t===s){var o={fractionalTick:e*i+2*(1-e),totalCN:Number("x")};n.push(o)}else{var l={fractionalTick:e*i+2*(1-e),totalCN:i};n.push(l)}if(this.sampleToFractionalTicks[a]=n.map((function(e){return e.fractionalTick})),s===r)return n;if(s<r){for(var c=s+1;c<=r;c++)if(s===r){var h={fractionalTick:e*c+2*(1-e),totalCN:Number("x")};n.push(h)}else{var d={fractionalTick:e*c+2*(1-e),totalCN:c};n.push(d)}return n}return n.slice(0,r+1)}},{key:"getSampleList",value:function(){return this._samples}},{key:"getAllChromosomes",value:function(){return this._chrs}},{key:"getAllClusters",value:function(){return this._clusters}},{key:"setFilters",value:function(e,t,s){t&&this._chr_dim.filter((function(e){return e===t})),s&&this._cluster_dim.filter((function(e){return-1!==s.indexOf(String(e))}))}},{key:"setChrFilter",value:function(e){e?(this._chr_dim.filterAll(),this._chr_dim.filter((function(t){return String(t)===String(e)}))):this._chr_dim.filterAll(),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"setChrFilters",value:function(t){t&&1===t.length&&t[0]===e.ALL_CHRS_KEY?this._chr_dim.filterAll():t&&(this._chr_dim.filterAll(),this._chr_dim.filter((function(e){return-1!==t.indexOf(String(e))})))}},{key:"recalculateCentroids",value:function(e,t){console.log("Recalculating Centroids..."),this.centroids=[],this.centroidPts={};for(var s=t||this.allRecords,r=y.a.groupBy(s,"CLUSTER"),a=0,n=Object.entries(r);a<n.length;a++){for(var i=Object(A.a)(n[a],2),o=i[0],l=i[1],c=y.a.groupBy(l,"SAMPLE"),h={},d=0,u=Object.entries(c);d<u.length;d++){var p=Object(A.a)(u[d],2),f=p[0],g=p[1],b="fractional_cn"===e?"RD":e,v=this.calculateCentroid(g,b),m={cluster:parseInt(o),point:v};if(this.centroidPts[f]&&this.centroidPts[o])this.centroidPts[f][o].push(m);else if(this.centroidPts[f])this.centroidPts[f][o]=[m];else{var S={};S[o]=[m],this.centroidPts[f]=S}var C="("+v[0].toFixed(2)+","+v[1].toFixed(2)+")";h[f]=C}var j={key:o,sample:h};this.centroids.push(j)}}},{key:"setClusterFilters",value:function(t){t&&1===t.length&&t[0]===e.ALL_CLUSTERS_KEY?this._cluster_dim.filterAll():t&&(this._cluster_dim.filterAll(),this._cluster_dim.filter((function(e){return-1!==t.indexOf(String(e))}))),t&&(this._cluster_filters=t),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"setClusterFiltersTo",value:function(e){console.log("setClustersFiltersTo"),e&&(this._cluster_filters_to=e)}},{key:"setClusterFiltersFrom",value:function(e){console.log("setClustersFiltersFrom"),e&&(this._cluster_filters_from=e)}},{key:"setGenomicPositionFilter",value:function(e){this._genomic_pos_dim.filterAll(),this._genomic_pos_dim.filter((function(t){return t>e[0]&&t<e[1]})),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"clearAllFilters",value:function(){this._sample_dim.filterAll(),this._cluster_dim.filterAll(),this._chr_dim.filterAll(),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"getActions",value:function(){return this.logOfActions}},{key:"updateCluster",value:function(e){if(this.brushedBins&&0!==this.brushedBins.length){console.log("Updating cluster to",e),this.historyStack.push(JSON.parse(JSON.stringify(this.brushedBins)));var t=this.brushedTableData(),s="Assigned to cluster "+e+" | ";s+="Clusters selected: ";var r,a=Object(g.a)(t);try{for(a.s();!(r=a.n()).done;){var n=r.value;s+=String(n.key)+" ("+String(n.value)+"%), "}}catch(v){a.e(v)}finally{a.f()}s+=" | ";var i=[y.a.minBy(this.brushedBins,this.currentDataKey)[this.currentDataKey],y.a.maxBy(this.brushedBins,this.currentDataKey)[this.currentDataKey]],o=[y.a.minBy(this.brushedBins,"reverseBAF").reverseBAF,y.a.maxBy(this.brushedBins,"reverseBAF").reverseBAF];s+=this.currentDataKey+" Range of Selected: ["+i[0].toFixed(2)+", "+i[1].toFixed(2)+"] | ",s+="Allelic Imbalance Range of Selected: ["+o[0].toFixed(2)+", "+o[1].toFixed(2)+"]",this.logOfActions.unshift({action:s});for(var l=0;l<this.brushedBins.length;l++){var c=x.toChromosomeInterval(this.brushedBins[l]).toString();if(this._locationGroupedData[c])for(var h=0;h<this._locationGroupedData[c].length;h++)this._locationGroupedData[c][h].CLUSTER=e}var d=Object.values(this._locationGroupedData),u=x.flattenNestedBins(d);this.centroids=[],this.centroidPts={},this.chrToClusters={};var p,f=Object(g.a)(u);try{for(f.s();!(p=f.n()).done;){var b=p.value;this.chrToClusters[b["#CHR"]]?this.chrToClusters[b["#CHR"]].add(String(b.CLUSTER)):this.chrToClusters[b["#CHR"]]=new Set([String(b.CLUSTER)])}}catch(v){f.e(v)}finally{f.f()}this.recalculateCentroids(this.currentDataKey,u),this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(_.a)(u),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.clusterTableInfo2=this.calculateClusterTableInfo(),this.clusterTableInfo3=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this._cluster_filters.includes(String(e))||this._cluster_filters.push(String(e)),this.setClusterFilters(this._cluster_filters),this.shouldCalculatesilhouettes=!0,this._updateFractionalCopyNumbers.cache=new y.a.memoize.Cache}}},{key:"clearClustering",value:function(){this.brushedBins=Object(j.a)(this.allRecords),this.updateCluster(-1)}},{key:"getMeanRD",value:function(e){return this.rdMeans[e]}},{key:"setDataKeyType",value:function(e){this.currentDataKey=e}},{key:"undoClusterUpdate",value:function(){if(0!==this.historyStack.length){var e=this.historyStack[this.historyStack.length-1];this.historyStack.pop();for(var t=0;t<e.length;t++){var s=e[t],r=x.toChromosomeInterval(s).toString(),a=s.CLUSTER;if(this._cluster_filters.includes(String(a))||this._cluster_filters.push(String(a)),this._locationGroupedData[r])for(var n=0;n<this._locationGroupedData[r].length;n++)this._locationGroupedData[r][n].CLUSTER=a}var i=Object.values(this._locationGroupedData),o=x.flattenNestedBins(i);this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(_.a)(o),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this.setClusterFilters(this._cluster_filters),this.setShouldRecalculatesilhouettes(!0)}}},{key:"updateFractionalCopyNumbers",value:function(e,t,s,r){var a=e/this.rdMeans[t],n=y.a.cloneDeep(s);return n.forEach((function(e){return e.fractional_cn=e.RD*a})),n}},{key:"getBAFLines",value:function(e,t,s){var r,a=new Set,n=[],i=Object(g.a)(G);try{for(i.s();!(r=i.n()).done;){var o=r.value,l=o[0],c=o[1];if(1===l&&1===c){var h=.5-(c*e+1*(1-e))/((l+c)*e+2*(1-e))+s,d=a.size;if(a.add(h),a.size!==d){var u={tick:h,state:o};n.push(u)}}else{var p=.5-(c*e+1*(1-e))/((l+c)*e+2*(1-e)),f=a.size;if(a.add(p),a.size!==f){var b={tick:p,state:o};n.push(b)}}}}catch(m){i.e(m)}finally{i.f()}var v=y.a.sortBy(n,"tick");return this.sampleToBafTicks[t]=v,v}},{key:"brushedTableData",value:function(){var e=this._samples.length,t=this._clusterAmounts,s={};t.forEach((function(t){return s[Number(t.key)]=Number(t.value)/e}));var r,a=this.brushedBins.length,n=this.brushedClusterDim.group().all(),i=[],o=this._ndx.all().length,l=Object(g.a)(n);try{for(l.s();!(r=l.n()).done;){var c=r.value;i.push({key:Number(c.key),value:Number((Number(c.value)/Number(s[Number(c.key)])*100).toFixed(2)),selectPerc:Number((Number(c.value)/Number(a)*100).toFixed(2)),binPerc:Number((Number(c.value)/Number(o/e)*100).toFixed(2))})}}catch(h){l.e(h)}finally{l.f()}return i}},{key:"getRecords",value:function(e,t,s,r,a,n,i,o){if(e in this._sampleGroupedData){if("fractional_cn"===t){var l=this._updateFractionalCopyNumbers(o,e,this._sampleGroupedData[e],this._cluster_filters);return this.filterRecordsByScales(l,t,s,r,a,n,i,o)}return this.filterRecordsByScales(this._sampleGroupedData[e],t,s,r,a,n,i,o)}return[]}},{key:"filterRecordsByScales",value:function(e,t,s,r,a,n,i,o){return s&&r&&a&&n?e.filter((function(e){return e.genomicPosition>s&&e.genomicPosition<r&&e.reverseBAF>a[0]&&e.reverseBAF<a[1]&&e[t]>n[0]&&e[t]<n[1]})):s&&r&&a?e.filter((function(e){return e.genomicPosition>s&&e.genomicPosition<r&&e.reverseBAF>a[0]&&e.reverseBAF<a[1]})):s&&r&&n?e.filter((function(e){return e.genomicPosition>s&&e.genomicPosition<r&&e[t]>n[0]&&e[t]<n[1]})):a&&n?e.filter((function(e){return e.reverseBAF>a[0]&&e.reverseBAF<a[1]&&e[t]>n[0]&&e[t]<n[1]})):a?e.filter((function(e){return e.reverseBAF>a[0]&&e.reverseBAF<a[1]})):n?e.filter((function(e){return e[t]>n[0]&&e[t]<n[1]})):e}},{key:"getAllRecords",value:function(){return this.allRecords}},{key:"getClusterTableInfo",value:function(){return this.clusterTableInfo}},{key:"getClusterTableInfo2",value:function(){return this.clusterTableInfo2}},{key:"getClusterTableInfo3",value:function(){return this.clusterTableInfo3}},{key:"getFilteredClusters",value:function(){return this._cluster_filters}},{key:"getFilteredFromClusters",value:function(){return this._cluster_filters_from}},{key:"getFilteredToClusters",value:function(){return this._cluster_filters_to}},{key:"setbrushedBins",value:function(e){this.brushedBins=[],this.brushedBins=e,this.brushedCrossfilter.remove(),this.brushedCrossfilter=Object(_.a)(e),this.brushedClusterDim=this.brushedCrossfilter.dimension((function(e){return e.CLUSTER}))}},{key:"getBrushedBins",value:function(){return this.brushedBins}},{key:"getClusterDim",value:function(){return console.log("cluster dimensions:",this._cluster_dim),this._cluster_dim}},{key:"calculateCopyNumbers",value:function(){for(var e=0;e<this.allRecords.length;e++){var t=this.allRecords[e].SAMPLE,s=this.sampleToPloidy[t],r=this.rdMeans[t],a=this.allRecords[e].RD;this.allRecords[e].fractional_cn=a*s/r}for(var n=0;n<this.allRecords.length;n++){for(var i=this.allRecords[n],o=i.SAMPLE,l=this.sampleToFractionalTicks[o],c=this.sampleToBafTicks[o],h=i.reverseBAF,d=i.fractional_cn,u=[],p=1/0,f=[-1,-1],g=0;g<c.length;g++){var b=c[g],v=b.state,m=b.tick,y=l[v[0]+v[1]];u.push([m,y]);var S=Math.pow(h-m,2)+Math.pow(d-y,2);S<p&&(p=S,f=v)}this.allRecords[n].CN="("+f[0]+","+f[1]+")"}}},{key:"mergeBinsAll",value:function(e,t,s){console.log("inside mergeBins()... with",t,s);var r=new Map,a=this.allRecords,n=this.centroidPts[e];this.getCentroidPoints(e);for(var i=0,o=Array.from(this._clusters.values());i<o.length;i++){var l=o[i];if(String(l)in n){for(var c=n[String(l)][0],h=c.point[0],d=c.point[1],u=Number.MAX_VALUE,p=-2,f=(Number.MAX_VALUE,Number.MAX_VALUE,0),b=Array.from(this._clusters.values());f<b.length;f++){var v=b[f];if(v!=l&&String(v)in n){var m=n[String(v)][0],S=m.point[0],C=m.point[1],j=Number.MAX_VALUE,A=Number.MAX_VALUE,x=Math.sqrt(Math.pow(h-S,2)+Math.pow(d-C,2));if(x<u)for(var _=0;_<this.getSampleList().length;_++){var w=String(this.getSampleList()[_]);j=Number(t.get(w)),A=Number(s.get(w)),Math.abs(h-S)<=j&&Math.abs(d-C)<=A?(p=Number(v),u=x,Math.abs(h-S),Math.abs(d-C),console.log("Closest Centroid Updated.",String(v))):console.log("Not within threshold.")}}}-2!=p&&r.set(String(p),String(l))}}y.a.groupBy(a,"CLUSTER");console.log("Building sets of clusters",r);for(var O=new Map,k=0,T=Array.from(r.keys());k<T.length;k++){for(var D=T[k],P=D,B=r.get(D),R=0,N=0,L=Array.from(O.keys());N<L.length;N++){var M=L[N];(O.get(M).has(P)||O.get(M).has(B))&&(R=M)}if(O.has(R))O.get(R).add(P),O.get(R).add(B);else{var E=new Set;E.add(P),E.add(B),O.set(R,E)}}for(var F=new Map,I=this.getClusterTableInfo(),U=0,z=Array.from(O.keys());U<z.length;U++){var Y=z[U],G=O.get(Y),H="",K=Number.MIN_VALUE;console.log("groupID",Y);var X,Q=Object(g.a)(I);try{for(Q.s();!(X=Q.n()).done;){var Z=X.value;if(G.has(String(Z.key))){var V=Z.value;V>K&&(K=V,H=String(Z.key))}}}catch(J){Q.e(J)}finally{Q.f()}console.log("Max Cluster",H,K),F.set(H,O.get(Y)),console.log(F.get(H))}return F}},{key:"mergeBins",value:function(e,t,s){console.log("inside mergeBins()... with",t,s);var r=new Map,a=this.allRecords,n=this.centroidPts[e];this.getCentroidPoints(e);for(var i=0,o=Array.from(this._clusters.values());i<o.length;i++){var l=o[i];if(String(l)in n){for(var c=n[String(l)][0],h=c.point[0],d=c.point[1],u=Number.MAX_VALUE,p=-2,f=(Number.MAX_VALUE,Number.MAX_VALUE,0),b=Array.from(this._clusters.values());f<b.length;f++){var v=b[f];if(v!=l&&String(v)in n){var m=n[String(v)][0],S=m.point[0],C=m.point[1],j=Math.sqrt(Math.pow(h-S,2)+Math.pow(d-C,2));j<u&&(Math.abs(h-S)<=t&&Math.abs(d-C)<=s?(p=Number(v),u=j,Math.abs(h-S),Math.abs(d-C),console.log("Closest Centroid Updated.",String(v))):console.log("Not within threshold."))}}-2!=p&&r.set(String(p),String(l))}}y.a.groupBy(a,"CLUSTER");console.log("Building sets of clusters",r);for(var A=new Map,x=0,_=Array.from(r.keys());x<_.length;x++){for(var w=_[x],O=w,k=r.get(w),T=0,D=0,P=Array.from(A.keys());D<P.length;D++){var B=P[D];(A.get(B).has(O)||A.get(B).has(k))&&(T=B)}if(A.has(T))A.get(T).add(O),A.get(T).add(k);else{var R=new Set;R.add(O),R.add(k),A.set(T,R)}}for(var N=new Map,L=this.getClusterTableInfo(),M=0,E=Array.from(A.keys());M<E.length;M++){var F=E[M],I=A.get(F),U="",z=Number.MIN_VALUE;console.log("groupID",F);var Y,G=Object(g.a)(L);try{for(G.s();!(Y=G.n()).done;){var H=Y.value;if(I.has(String(H.key))){var K=H.value;K>z&&(z=K,U=String(H.key))}}}catch(X){G.e(X)}finally{G.f()}console.log("Max Cluster",U,z),N.set(U,A.get(F)),console.log(N.get(U))}return N}},{key:"assignMerge",value:function(e,t){for(var s=y.a.groupBy(this.allRecords,"CLUSTER"),r=0,a=Array.from(t.keys());r<a.length;r++)for(var n=a[r],i=0,o=Array.from(t.get(n));i<o.length;i++){var l=o[i],c=y.a.groupBy(s[String(l)],"SAMPLE")[String(e)];this.setbrushedBins(c),console.log("Reassigning",n,"to",l),this.updateCluster(Number(n)),console.log("Pushing mergeBins() operation to history stack."),this.historyStack.push(JSON.parse(JSON.stringify(c)))}}},{key:"absorbBins",value:function(e,t,s,r){var a=new Set(this._cluster_filters_from),n=new Set(this._cluster_filters_to);console.log("inside absorbBins()...");for(var i=new Map,o=0;o<this.allRecords.length;o++){var l=this.allRecords[o],c=l.CLUSTER;if(a.has(String(c))){console.log("Looking at bins",c);var h=l.SAMPLE,d=(this.sampleToPloidy[h],this.rdMeans[h],this.allRecords[o].RD,l.reverseBAF),u=l.fractional_cn,p=Number.MAX_VALUE,f=-2,g=Number.MAX_VALUE,b=Number.MAX_VALUE,v=!1;v=!(String(c)in n),n.add(String(c)),console.log("clusters_to",n);for(var m=0,y=Array.from(n.values());m<y.length;m++){var S=y[m];console.log("to_c",S);var C=this.centroidPts[h];console.log("Here is samplePts",C),console.log("samplePts[c_bin]",C[String(S)]);var j=C[String(S)][0];console.log("centroid:",j);var A=j.point[0],x=j.point[1];console.log("c_x:",A,"c_y:",x),console.log(String(S),n);var _=Math.sqrt(Math.pow(A-d,2)+Math.pow(x-u,2));_<p&&(f=Number(S),p=_,g=Math.abs(A-d),b=Math.abs(x-u),console.log("Closest Centroid.",String(S)))}if(v&&n.delete(String(c)),console.log("Min_x",g),console.log("Min_y",b),console.log("minCluster",f),console.log("xthresh:",s,"ythresh",r),g<=s&&b<=r)if(i.has(String(f))){var w=i.get(String(f));void 0!=w?(w.push(l),i.set(String(f),w)):console.log("Arr is undefined??")}else i.set(String(f),[l]);else console.log("Didn't reassign because not within threshold!")}}for(var O=0,k=Array.from(i.keys());O<k.length;O++){var T=k[O],D=i.get(T);this.setbrushedBins(D),this.updateCluster(Number(T)),console.log("Pushing to history stack."),this.historyStack.push(JSON.parse(JSON.stringify(D)))}}},{key:"_getData",value:function(e,t,s,r){return(e[t][r]||{})[s]||[]}}]),e}();J.ALL_CHRS_KEY="",J.ALL_CLUSTERS_KEY="";var W=s(73),q=(s(275),s(2)),$=70,ee=20,te=35,se=60,re="#999999",ae="rgba(232, 232, 232, 1)",ne="-1",ie="-2",oe="scatterplot-scale",le="circles",ce=0,he=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r._circleIdPrefix=void 0,r._clusters=void 0,r.brushedNodes=void 0,r.previous_brushed_nodes=void 0,r._canvas=void 0,r._currXScale=void 0,r._currYScale=void 0,r._original_XScale=void 0,r._original_YScale=void 0,r._original_transform=void 0,r._current_transform=void 0,r.scatter=void 0,r.zoom=void 0,r.onBrushedBinsUpdated=function(e){r.props.onBrushedBinsUpdated(e)},r._svg=null,r._canvas=null,r.scatter=null,r._circleIdPrefix=ce,ce++,r.computeScales=Object(w.a)(r.computeScales),r.handleMouseMove=r.handleMouseMove.bind(Object(u.a)(r)),r.onBrushedBinsUpdated=r.onBrushedBinsUpdated.bind(Object(u.a)(r)),r._clusters=r.initializeListOfClusters(),r.brushedNodes=new Set,r.previous_brushed_nodes=new Set,r.onZoom=r.onZoom.bind(Object(u.a)(r)),r.resetZoom=r.resetZoom.bind(Object(u.a)(r)),r.zoom=null;var a=r.computeScales(r.props.rdRange,e.width,e.height),n=a.bafScale,i=a.rdrScale;r._currXScale=n,r._currYScale=i,r._original_XScale=r._currXScale,r._original_YScale=r._currYScale;var o=e.data;return r._original_transform=O.o.translate(0,0).scale(1),r._current_transform=r._original_transform,r.state={selectedCluster:r._clusters.length>0?r._clusters[0]:ne,quadTree:O.g().x((function(e){return e.reverseBAF})).y((function(t){return t[e.yAxisToPlot]})).addAll(o)},r}return Object(d.a)(s,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;e.sort((function(e,t){return e.key>t.key?1:e.key<t.key?-1:0})),this._clusters=[];var t,s=Object(g.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(a){s.e(a)}finally{s.f()}for(;this._clusters.length>0&&(this._clusters[0]===ne||this._clusters[0]===ie);)this._clusters.shift();return this._clusters}},{key:"handleMouseMove",value:function(e){var t=k(e),s=t.x,r=t.y,a={rd:this._currYScale.invert(r),baf:this._currXScale.invert(s)};if(a.baf>this._currXScale.domain()[0]&&a.baf<this._currXScale.domain()[1]&&a.rd>this._currYScale.domain()[0]&&a.rd<this._currYScale.domain()[1]){var n=Math.abs(this._currXScale.invert(s)-this._currXScale.invert(s-20));this.props.onRecordsHovered(this.state.quadTree.find(a.baf,a.rd,n)||null)}else this.props.onRecordsHovered(null)}},{key:"renderTooltipAtRdBaf",value:function(e,t,s){if(!s)return null;var r=this._currYScale(e)||0,a=(this._currXScale(t)||0)+10;return Object(q.jsx)("div",{className:"Scatterplot-tooltip",style:{position:"absolute",top:r-150,left:a,width:275,height:150,pointerEvents:"none"},children:s})}},{key:"renderTooltip",value:function(){var e=this.props,t=e.data,s=e.hoveredLocation,r=e.yAxisToPlot;if(!s)return null;var n=[];if(0===(n=t.filter((function(e){var t=x.toChromosomeInterval(e);return s.chr===t.chr&&s.start===t.start&&s.end===t.end}))).length&&(n=t.filter((function(e){return x.toChromosomeInterval(e).hasOverlap(s)}))),n[0]){var i=this._currXScale(n[0].reverseBAF),o=this._currYScale(n[0][r]),l=this._currXScale.range(),c=this._currYScale.range(),h="RDR: ";if("fractional_cn"===r?h="Fractional CN: ":"logRD"===r&&(h="Log RDR: "),1===n.length&&i&&o&&i>l[0]&&i<l[1]&&o<c[0]&&o>c[1]){var d=n[0],u=x.toChromosomeInterval(d);return this.renderTooltipAtRdBaf(d[r],d.reverseBAF,Object(q.jsxs)(a.a.Fragment,{children:[Object(q.jsxs)("p",{children:[Object(q.jsx)("b",{children:u.toString()}),Object(q.jsx)("br",{}),"(",T(u.getLength()),")"]}),Object(q.jsxs)("div",{children:[" ",h+d[r].toFixed(2)]}),Object(q.jsxs)("div",{children:[" 0.5 - BAF: ",d.reverseBAF.toFixed(2)]}),Object(q.jsxs)("div",{children:[" Cluster ID: ",d.CLUSTER]})]}))}}return null}},{key:"render",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=this._clusters.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}));return a.unshift(Object(q.jsx)("option",{value:ne,children:ne},ne)),a.unshift(Object(q.jsx)("option",{value:ie,children:ie},ie)),Object(q.jsxs)("div",{ref:function(t){return e.scatter=t},className:"Scatterplot",style:{width:s,height:r},children:[Object(q.jsx)("canvas",{ref:function(t){return e._canvas=t},width:s,height:r,className:"canvas",style:{position:"absolute",top:te,zIndex:-4,left:$,width:s-$-ee,height:r-te-se}}),Object(q.jsx)("svg",{ref:function(t){return e._svg=t},style:{zIndex:100},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+s+" "+r,onMouseMove:this.handleMouseMove}),Object(q.jsx)("div",{className:"Scatterplot-tools",children:Object(q.jsx)("button",{className:"custom-button",onClick:this.resetZoom,children:"Reset View"})}),this.renderTooltip()]})}},{key:"resetZoom",value:function(){if(this._svg){this._currXScale=this._original_XScale,this._currYScale=this._original_YScale;this.props.onZoom({xScale:null,yScale:null}),this.redraw()}}},{key:"componentDidMount",value:function(){this.redraw(),this.forceHover(this.props.hoveredLocation)}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidUpdate",value:function(e){var t=this,s=this.props.scales.xScale,r=this.props.scales.yScale,a=e.scales.xScale,n=e.scales.yScale;function i(e,t){return!(!e||t)||!(!e||!t||e[0]===t[0]&&e[1]===t[1])}function o(e,t){return!(!e||t)||!!(e&&t&&(Math.abs(e[0]-t[0])>1e-4||Math.abs(e[1]-t[1])>1e-4))}if(!s&&!r&&a&&n)this.resetZoom();else if(i(s,a)||i(r,n)){s&&this._currXScale.domain(s),r&&this._currYScale.domain(r);var l=this.props.data,c=O.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(l);this.setState({quadTree:c}),this.redraw()}if(this.props.hoveredLocation!==e.hoveredLocation)this.forceUnhover(),this.forceHover(this.props.hoveredLocation);else if(this.propsDidChange(e,["purity","ploidy","offset"])){var h=this.props.data,d=this.computeScales(this.props.rdRange,this.props.width,this.props.height).rdrScale;this._currYScale=d,this._original_YScale=d;var u=O.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(h);this.setState({quadTree:u}),this.redraw()}else if(this.propsDidChange(e,["showCentroids","displayMode","colors","brushedBins","width","height","customColor","pointsize","showTetraploid"])){var p=this.props.data,f=O.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(p);this.setState({quadTree:f}),this.redraw(),this.forceHover(this.props.hoveredLocation)}else if(!y.a.isEqual(this.props.data,e.data)||this.props.yAxisToPlot!==e.yAxisToPlot){var g=this.computeScales(this.props.rdRange,this.props.width,this.props.height),b=g.bafScale,v=g.rdrScale;if(o(this._currXScale.domain(),this._original_XScale.domain())||o(this._currYScale.domain(),this._original_YScale.domain())){if(this.props.yAxisToPlot!==e.yAxisToPlot){var m=this._currYScale.domain();if("logRD"===this.props.yAxisToPlot){m[0]<=0&&(m[0]=.1),m[1]<=0&&(m[1]=.1);var S=[Math.log2(m[0]),Math.log2(m[1])];this._currYScale.domain(S).range(this._currYScale.range())}else if("fractional_cn"===this.props.yAxisToPlot){var C=[m[0]*this.props.ploidy/this.props.meanRD,m[1]*this.props.ploidy/this.props.meanRD];this._currYScale.domain(C).range(this._currYScale.range())}else if("logRD"===e.yAxisToPlot){var j=[Math.pow(2,m[0]),Math.pow(2,m[1])];this._currYScale.domain(j).range(this._currYScale.range())}else if("fractional_cn"===e.yAxisToPlot){var A=[m[0]*this.props.meanRD/this.props.ploidy,m[1]*this.props.meanRD/this.props.ploidy];this._currYScale.domain(A).range(this._currYScale.range())}}this._original_XScale=b,this._original_YScale=v}else this._currXScale=b,this._currYScale=v,this._original_XScale=this._currXScale,this._original_YScale=this._currYScale;var x=this.props.data,_=O.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(x);this.setState({quadTree:_});var w={xScale:this._currXScale.domain(),yScale:this._currYScale.domain()};this.props.onZoom(w),this.redraw(),this.forceHover(this.props.hoveredLocation)}this.props.clusterTableData!==e.clusterTableData&&this.initializeListOfClusters()}},{key:"computeScales",value:function(e,t,s,r,a){var n=[$,t-ee],i=[s-se,te],o=a?e[0]:this.props.applyLog?-2:0;this.props.showPurityPloidy&&(o=e[0]);var l=r||[-.01,.51];return{bafScale:O.i().domain(l).range(n),rdrScale:O.i().domain([o,e[1]]).range(i)}}},{key:"onZoom",value:function(e){this.props.onZoom(e)}},{key:"redraw",value:function(){var e=this;if(this._svg&&this._canvas&&this.scatter){var t=this,s=this.props,r=s.width,a=s.height,n=s.customColor,i=(s.pointsize,s.brushedBins),o=s.data,l=s.colors,c=s.yAxisToPlot,h=s.centroidPts,d=s.showPurityPloidy,u=s.showTetraploid,p=this.props.displayMode,f=this._currXScale,b=this._currYScale,v="RD"===c?"RDR":"fractional_cn"===c?"Copy Number":"log RDR",m=O.j(this._svg);m.selectAll(".scatterplot-scale").remove(),m.append("text").classed(oe,!0).attr("text-anchor","middle").attr("x",y.a.mean(this._currXScale.range())).attr("y",a-se+40).style("text-anchor","middle").text("Allelic Imbalance (0.5 - BAF)"),m.append("text").classed(oe,!0).attr("y",20).attr("x",0-y.a.mean(this._currYScale.range())).attr("transform","rotate(-90)").style("text-anchor","middle").text(v);var S=function(e,t){return e.classed(oe,!0).attr("transform","translate(0, ".concat(a-se,")")).call(O.a(t)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-30)")},C=[];if(d){var A=this._currXScale.domain();if(u)C=this.props.BAF_lines;else{var _,w=[],k=Object(g.a)(this.props.BAF_lines);try{for(k.s();!(_=k.n()).done;){var T=_.value;T.state[0]+T.state[1]<4&&w.push(T)}}catch(ve){k.e(ve)}finally{k.f()}C=w}var D=C.filter((function(e){return e.tick>A[0]&&e.tick<A[1]})),B=D.map((function(e){return e.tick}));S=function(e,t){return e.classed(oe,!0).attr("id","Grid").attr("transform","translate(0, ".concat(a-se,")")).call(O.a(t).tickValues(B).tickSizeInner(-a+te+se).tickFormat((function(e,t){return D[t].state[0]!=D[t].state[1]?B[t].toFixed(2)+" ("+D[t].state[0]+","+D[t].state[1]+")":B[t].toFixed(2)+"(x,x)"}))).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-30)")}}var R=function(e,t){return e.classed(oe,!0).attr("id","Grid").attr("transform","translate(".concat($,", 0)")).call(O.b(t))};if(d){var N=this.props.fractionalCNTicks,L=this._currYScale.domain(),M=this.props.max_cn,E=M>L[1]?M:L[1],F=N.filter((function(e){return e.fractionalTick>L[0]&&e.fractionalTick<E&&e.fractionalTick<L[1]})),I=F.map((function(e){return e.fractionalTick}));R=function(e,t){return e.classed(oe,!0).attr("id","Grid").attr("transform","translate(".concat($,", 0)")).call(O.b(t).tickValues(I).tickSizeInner(80-r).tickFormat((function(e,t){return F[t].totalCN+" ("+Number(e.valueOf()).toFixed(2)+")"})))}}var U=[];i.forEach((function(e){return U.push(x.toChromosomeInterval(e).toString())})),this.previous_brushed_nodes=new Set(U);var z=this.previous_brushed_nodes,Y=m.append("g"),G=m.append("g"),H=O.o,K=O.n().scaleExtent([0,100]),X=O.n().scaleExtent([0,100]),Q=function(){return O.p(Y.node())},Z=function(){return O.p(G.node())};Y.call(K).attr("pointer-events","none"),G.call(X).attr("pointer-events","none");var V=O.n().on("zoom",(function(){try{var e=O.f.transform,t=e.k/H.k,s=function(e){if(e.sourceEvent)return[e.sourceEvent.layerX,e.sourceEvent.layerY];return[r/2,a/2]}(O.f),n=s[0]>f.range()[0],i=s[1]<b.range()[0];p!==St.zoom&&n&&i||(1===t?(n&&K&&t&&s&&Y&&Y.call(K.translateBy,(e.x-H.x)/Q().k,0),i&&X&&t&&s&&G&&G.call(X.translateBy,0,(e.y-H.y)/Z().k)):(n&&K&&t&&s&&Y&&Y.call(K.scaleBy,t,s),i&&X&&t&&s&&G&&G.call(X.scaleBy,t,s))),H=e,be()}catch(o){console.log("Error: ",o)}})).on("end",(function(){var e=t._currXScale.domain(),s=t._currYScale.domain(),r=t._original_XScale.domain(),a=t._original_YScale.domain();if(e[0]!==r[0]||e[1]!==r[1]||s[0]!==a[0]||s[1]!==a[1]){var n={xScale:t._currXScale.domain(),yScale:t._currYScale.domain()};t.props.onZoom(n)}})),J=this._canvas.getContext("webgl");J.clearColor(0,0,0,1);var q,ne=[],ie=Object(g.a)(o);try{for(ie.s();!(q=ie.n()).done;){var le=q.value;z.has(x.toChromosomeInterval(le).toString())||ne.push(le)}}catch(ve){ie.e(ve)}finally{ie.f()}var ce,he=Object(g.a)(o);try{for(he.s();!(ce=he.n()).done;){var de=ce.value;z.has(x.toChromosomeInterval(de).toString())&&ne.push(de)}}catch(ve){he.e(ve)}finally{he.f()}var ue=W.webglFillColor().value((function(e){return P(function(e){if(z.has(x.toChromosomeInterval(e).toString()))return n;if(-1===e.CLUSTER)return re;if(-2===e.CLUSTER)return ae;var t=e.CLUSTER%l.length;return l[t]}(e))})).data(ne),pe=W.seriesWebglPoint().xScale(t._currXScale).yScale(t._currYScale).crossValue((function(e){return e.reverseBAF})).mainValue((function(e){return e[c]})).context(J).size(this.props.pointsize);if(pe.decorate((function(e){ue(e),J.depthFunc(J.NEVER),J.disable(J.DEPTH_TEST)})),m.append("clipPath").attr("id","clip").append("rect").attr("x",$).attr("y",te).attr("width",r-ee-$).attr("height",a-se-te),m.append("g").classed("eventrect",!0).append("rect").attr("x",$).attr("y",te).attr("width",r-ee-$).attr("height",a-se-te).style("fill","none").style("pointer-events","all").attr("clip-path","url(#clip)"),this._canvas.width=r,this._canvas.height=a,be(),p===St.select||p===St.erase){var fe=O.c().keyModifiers(!1).extent([[$-2,te-2],[this.props.width-ee+2,this.props.height-se+2]]).on("end",(function(){e.updatePoints(O.f),m.selectAll(".brush").remove(),e.onBrushedBinsUpdated(Object(j.a)(e.brushedNodes))}));m.append("g").attr("class","brush").call(fe)}else if(p===St.zoom)m.selectAll(".brush").remove();else if(p===St.boxzoom){var ge=O.c().keyModifiers(!1).extent([[$-2,te-2],[this.props.width-ee+2,this.props.height-se+2]]).on("start brush",(function(){return e.updatePoints(O.f)})).on("end",(function(){m.selectAll(".brush").remove(),function(){if(!t._svg)return;if(t.props.data){var e=O.f.selection;if(e){var s=[Number(t._currYScale.invert(e[1][1])),Number(t._currYScale.invert(e[0][1]))],n=[Number(t._currXScale.invert(e[0][0])),Number(t._currXScale.invert(e[1][0]))],i=t.computeScales(s,r,a,n,!0),o=i.bafScale,l=i.rdrScale;t._currXScale=o,t._currYScale=l,t.redraw();var c={xScale:t._currXScale.domain(),yScale:t._currYScale.domain()};t.props.onZoom(c)}}}()}));m.append("g").attr("class","brush").call(ge)}m.call(V).call(V.transform,O.o.scale(1))}function be(){J.clear(J.COLOR_BUFFER_BIT),J.clearColor(255,255,255,1);var e=Q().rescaleX(f),s=Z().rescaleY(b);Y.call(S,e),G.call(R,s),t._currXScale=e,t._currYScale=s,t._canvas&&(pe.xScale(t._currXScale).yScale(t._currYScale),pe(ne)),m.select(".Centroids").remove(),t.props.showCentroids&&m.select(".eventrect").append("g").attr("clip-path","url(#clip)").classed("Centroids",!0).selectAll("path").data(h).enter().append("path").attr("class","point").attr("d",O.k().type(O.m)).attr("fill",(function(e){return function(e){if(-1===e)return re;if(-2===e)return ae;var t=e%l.length;return l[t]}(e.cluster)})).attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black").attr("transform",(function(e){return"translate("+t._currXScale(e.point[0])+","+t._currYScale(e.point[1])+")"}))}}},{key:"updatePoints",value:function(e){var t=this;if(this._svg){var s=this.props,r=s.brushedBins,a=s.data,n=s.yAxisToPlot,i=s.displayMode;if(a){var o=O.f.selection;if(o){var l=a.filter((function(e){return s=o,r=[t._currXScale(e.reverseBAF),t._currYScale(e[n])],s[0][0]<=r[0]&&r[0]<=s[1][0]&&s[0][1]<=r[1]&&r[1]<=s[1][1];var s,r}));if(l){if(console.log(l),i===St.select)l=y.a.uniqBy(y.a.union(l,r),(function(e){return e["#CHR"]+"_"+e.START}));else if(i===St.erase){for(var c=new Set,h=0;h<l.length;h++)c.add((l[h]["#CHR"],l[h].START,l[h].END,l[h].genomicPosition));l=r.filter((function(e){return function(e,t){var s=(e["#CHR"],e.START,e.END,e.genomicPosition);return!t.has(s)}(e,c)}))}this.brushedNodes=new Set(l)}}else this.brushedNodes=new Set([])}}}},{key:"getElementsForGenomeLocation",value:function(e){var t=this;if(!this._svg||!e||!this._canvas)return[];var s=this.props,r=s.data,a=s.yAxisToPlot,n=[];n=r.filter((function(t){var s=x.toChromosomeInterval(t);return e.chr===s.chr&&e.start===s.start&&e.end===s.end}));var i=this._currXScale.range(),o=this._currYScale.range();0===n.length&&(n=(n=r.filter((function(t){return x.toChromosomeInterval(t).hasOverlap(e)}))).filter((function(e){var s=t._currXScale(e.reverseBAF),r=t._currYScale(e[a]);return s&&r&&s>i[0]&&s<i[1]&&r<o[0]&&r>o[1]})));var l=O.j(this._svg);l.select(".circles").remove(),l.select(".eventrect").append("g").classed(le,!0).selectAll("circle").data(n).enter().append("circle").attr("id",(function(e){return t._circleIdPrefix+x.toChromosomeInterval(e).toString()})).attr("cx",(function(e){return t._currXScale(e.reverseBAF)||0})).attr("cy",(function(e){return t._currYScale(e[a])||0})).attr("r",3).attr("fill",(function(e){if(t.previous_brushed_nodes.has(x.toChromosomeInterval(e).toString()))return t.props.customColor;if(-1===e.CLUSTER)return re;if(-2===e.CLUSTER)return ae;var s=e.CLUSTER%t.props.colors.length;return t.props.colors[s]})).attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black")}},{key:"forceHover",value:function(e){this.getElementsForGenomeLocation(e)}},{key:"forceUnhover",value:function(){this._svg&&O.j(this._svg).select(".circles").remove()}}]),s}(a.a.Component);he.defaultProps={width:400,height:302,onNewCurveState:y.a.noop,onRecordHovered:y.a.noop};var de=s(223),ue=(s(277),["onMouseMove","onMouseLeave","style","children"]),pe=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).state={mouseCoordinates:null},r.storeMouseCoordinates=r.storeMouseCoordinates.bind(Object(u.a)(r)),r.clearMouseCoordinates=r.clearMouseCoordinates.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"storeMouseCoordinates",value:function(e){this.setState({mouseCoordinates:k(e)}),this.props.onMouseMove&&this.props.onMouseMove(e)}},{key:"clearMouseCoordinates",value:function(e){this.setState({mouseCoordinates:null}),this.props.onMouseLeave&&this.props.onMouseLeave(e)}},{key:"render",value:function(){var e=this.props,t=(e.onMouseMove,e.onMouseLeave,e.style),s=e.children,r=Object(de.a)(e,ue),a=Object.assign({position:"relative"},t);return Object(q.jsxs)("div",Object(o.a)(Object(o.a)({onMouseMove:this.storeMouseCoordinates,onMouseLeave:this.clearMouseCoordinates,style:a},r),{},{children:[s,this.state.mouseCoordinates&&Object(q.jsx)(fe,{where:this.state.mouseCoordinates})]}))}}]),s}(a.a.Component);function fe(e){var t=e.where,s=t.x,r={top:t.y-1,willChange:"top"},n={left:s-1,willChange:"left"};return Object(q.jsxs)(a.a.Fragment,{children:[Object(q.jsx)("div",{className:"Bullseye-horizontal-line",style:r}),Object(q.jsx)("div",{className:"Bullseye-vertical-line",style:n})]})}s(133);var ge=s(107),be=s.n(ge),ve=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).handleCallBack=function(e){r.props.parentCallBack(e)},r.state={selectedSample:e.initialSelectedSample},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(u.a)(r)),r.handleRecordsHovered=r.handleRecordsHovered.bind(Object(u.a)(r)),r.handleCallBack=r.handleCallBack.bind(Object(u.a)(r)),r.handleUpdatedBrushedBins=r.handleUpdatedBrushedBins.bind(Object(u.a)(r)),r.onRemovePlot=r.onRemovePlot.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e.target.value}),this.props.onSelectedSample(e.target.value)}},{key:"handleRecordsHovered",value:function(e){var t=e?x.toChromosomeInterval(e):null;this.props.onLocationHovered(t)}},{key:"handleUpdatedBrushedBins",value:function(e){this.props.onBrushedBinsUpdated(e)}},{key:"onRemovePlot",value:function(){this.props.onRemovePlot(this.props.plotId)}},{key:"render",value:function(){var e=this.props,t=e.data,s=e.width,r=e.height,a=e.pointsize,n=e.hoveredLocation,i=e.invertAxis,o=e.customColor,l=e.brushedBins,c=e.updatedBins,h=e.dispMode,d=e.onZoom,u=e.rdRange,p=e.clusterTableData,f=e.applyLog,g=e.scales,b=e.centroidPts,v=e.showCentroids,m=e.purity,y=e.ploidy,S=e.offset,C=e.meanRD,j=e.fractionalCNTicks,A=e.showPurityPloidy,x=e.showTetraploid,_=e.BAF_lines,w=e.max_cn,O=be()({"is-pan":h===St.zoom,"is-zoom":h===St.boxzoom,"is-select":h===St.select,"is-erase":h===St.erase});return Object(q.jsx)("div",{className:"SampleViz-scatter",children:Object(q.jsx)(pe,{className:O,children:Object(q.jsx)(he,{pointsize:a,parentCallBack:this.handleCallBack,data:t,rdRange:u,width:s,height:r,hoveredLocation:n,onRecordsHovered:this.handleRecordsHovered,invertAxis:i||!1,customColor:o,colors:this.props.colors,col:this.props.colors[0],onBrushedBinsUpdated:this.handleUpdatedBrushedBins,brushedBins:l,updatedBins:c,displayMode:h,onZoom:d,clusterTableData:p,applyLog:f,yAxisToPlot:f?"logRD":A?"fractional_cn":"RD",onClusterSelected:this.props.onClusterSelected,scales:g,centroidPts:b,showCentroids:v,purity:m,ploidy:y,offset:S,meanRD:C,fractionalCNTicks:j,showPurityPloidy:A,showTetraploid:x,BAF_lines:_,max_cn:w})})})}}]),s}(a.a.Component);ve.defaultProps={onLocationHovered:y.a.noop,invertAxis:!1,customColor:"#1b9e77"};s(278);var me="linearplot-scale",ye="#999999",Se="rgba(232, 232, 232, 1)",Ce=50,je=10,Ae=10,xe=35;function _e(e){return e?Ce+20:Ce}var we=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r._canvas=void 0,r._clusters=void 0,r.brushedNodes=void 0,r._currXScale=void 0,r._currYScale=void 0,r._original_XScale=void 0,r._original_YScale=void 0,r.previewDriver=void 0,r.lockedDrivers=void 0,r._svg=null,r._canvas=null,r.getXScale=Object(w.a)(r.getXScale),r.handleMouseMove=r.handleMouseMove.bind(Object(u.a)(r)),r.handleMouseLeave=r.handleMouseLeave.bind(Object(u.a)(r)),r._clusters=r.initializeListOfClusters(),r.brushedNodes=new Set,r._currXScale=r.getXScale(e.width,e.genome,e.chr,r.props.implicitStart,r.props.implicitEnd,r.props.showPurityPloidy),r._currYScale=O.i().domain([r.props.yMin,r.props.yMax]).range([r.props.height-xe,Ae]),r._original_XScale=r._currXScale,r._original_YScale=r._currYScale,r.previewDriver=null,r.lockedDrivers=new Set,r}return Object(d.a)(s,[{key:"initializeListOfClusters",value:function(){var e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),t=Object(j.a)(new Set(this.props.data.map((function(e){return String(e.CLUSTER)})))).sort(e.compare);return"-2"===t[0]&&t.shift(),"-1"===t[0]&&t.shift(),t}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidUpdate",value:function(e){null!==this.props.driverGeneUpdate.gene&&this.props.driverGeneUpdate.destination===this.props.dataKeyToPlot&&(this.lockedDrivers.has(this.props.driverGeneUpdate.gene)?this.lockedDrivers.delete(this.props.driverGeneUpdate.gene):this.lockedDrivers.add(this.props.driverGeneUpdate.gene),this.props.handleDriverGenesChange({gene:null,destination:null})),this.propsDidChange(e,["chr"])?"RD"===this.props.dataKeyToPlot||"logRD"===this.props.dataKeyToPlot||"fractional_cn"===this.props.dataKeyToPlot?this.props.onLinearPlotZoom(null,null,!0):this.props.onLinearPlotZoom(null,null,!1):this.propsDidChange(e,["driverGenes","displayMode","implicitEnd","implicitStart","yMin","yMax","colors","brushedBins","width","height","chr","purity","ploidy","pointsize","showTetraploid"])?(0===this.props.brushedBins.length&&(this._clusters=this.initializeListOfClusters()),this.redraw()):y.a.isEqual(this.props.data,e.data)&&this.props.dataKeyToPlot===e.dataKeyToPlot||this.redraw()}},{key:"getXScale",value:function(e,t,s,r,a,n){var i=[0,0];return null!=r&&null!=a?(i[0]=r,i[1]=a):s?(i[0]=t.getChrStartMap()[s],i[1]=i[0]+t.getLength(s)):i[1]=t.getLength(),O.i().domain(i).range([_e(this.props.showPurityPloidy),e-je])}},{key:"getScaledYScale",value:function(e,t){return O.i().domain([2*(1-t),10*t+2*(1-t)]).range([e-xe,Ae])}},{key:"createNewBrush",value:function(){var e=O.j(this._svg),t=O.c().keyModifiers(!0).extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width-je,this.props.height-xe]]).on("end",(function(){e.selectAll(".brush").remove()}));e.append("g").attr("class","brush").call(t)}},{key:"filterFractionalCNTicks",value:function(e,t){return e.filter((function(e,s){return e>t[0]&&e<t[1]}))}},{key:"redraw",value:function(){var e=this;if(this._svg){var t,s=this,r=this.props,a=r.data,n=r.width,i=r.height,o=r.genome,l=r.chr,c=r.dataKeyToPlot,h=r.yMin,d=r.yMax,u=r.yLabel,p=r.customColor,f=r.brushedBins,b=r.colors,v=r.displayMode,m=r.driverGenes,S=this.getXScale(n,o,l,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),C=O.i().domain([h,d]).range([i-xe,Ae]),A=o.getChromosomeList(),_=[],w=o.getChrStartMap(),k=Object(g.a)(A);try{for(k.s();!(t=k.n()).done;){var D=t.value,B=w[D.name];B>=S.domain()[0]&&B<=S.domain()[1]&&_.push(D)}}catch(fe){k.e(fe)}finally{k.f()}var R=this.props.showPurityPloidy?10:0,N=O.j(this._svg);N.selectAll(".linearplot-scale").remove(),N.append("text").classed(me,!0).attr("text-anchor","middle").attr("font-size",11).attr("x",y.a.mean(S.range())).attr("y",i-xe+30).text(l||o.getName()),N.append("text").classed(me,!0).attr("transform","rotate(-90, ".concat(_e(this.props.showPurityPloidy),", ").concat(y.a.mean(C.range()),")")).text(u||c).attr("x",(i-xe-Ae)/2-1+R).attr("y",this.props.showPurityPloidy?10:_e(this.props.showPurityPloidy)/2+5).attr("text-anchor","middle");var L=function(e,t){return e.classed(me,!0).attr("transform","translate(0, ".concat(i-xe,")")).call(O.a(t).tickValues(o.getChromosomeStarts2(_,t.domain()[0],t.domain()[1])).tickFormat((function(e,t){return function(e){var t=String(e).match(/\d+/);return t?t[0]:e}(_[t].name)})))},M=function(e,t){return e.classed(me,!0).attr("transform","translate(0, ".concat(i-xe,")")).call(O.a(t).tickFormat((function(e){return T(Number(e.valueOf()),0,w[l])})))},E=function(t,s){return t.classed(me,!0).attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(O.b(s).ticks((s.range()[0]-s.range()[1])/15))};if("fractional_cn"===this.props.dataKeyToPlot){var F=this.props.fractionalCNTicks,I=C.domain(),U=F.filter((function(e){return e.fractionalTick>I[0]&&e.fractionalTick<I[1]})),z=U.map((function(e){return e.fractionalTick}));E=function(t,s){return t.classed(me,!0).attr("id","Grid").attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(O.b(s).tickValues(z).tickSizeInner(60-n).tickFormat((function(e,t){return U[t].totalCN+" ("+Number(e.valueOf()).toFixed(2)+")"})))}}else if(this.props.showPurityPloidy){var Y=C.domain(),G=[];this._currXScale.domain();if(this.props.showTetraploid)G=this.props.BAF_lines;else{var H,K=[],X=Object(g.a)(this.props.BAF_lines);try{for(X.s();!(H=X.n()).done;){var Q=H.value;Q.state[0]+Q.state[1]<4&&K.push(Q)}}catch(fe){X.e(fe)}finally{X.f()}G=K}var Z=G.filter((function(e){return e.tick>Y[0]&&e.tick<Y[1]})),V=Z.map((function(e){return e.tick}));E=function(t,s){return t.classed(me,!0).attr("id","Grid").attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(O.b(s).tickValues(V).tickSizeInner(-n+_e(e.props.showPurityPloidy)+je).tickFormat((function(e,t){return V[t].toFixed(2)+" ("+Z[t].state[0]+","+Z[t].state[1]+")"})))}}var J=N.append("g"),q=N.append("g"),$=O.o,ee=O.n().scaleExtent([0,100]),te=O.n().scaleExtent([0,100]),se=function(){return O.p(J.node())},re=function(){return O.p(q.node())};J.call(ee).attr("pointer-events","none"),q.call(te).attr("pointer-events","none");var ae=O.n().on("zoom",(function(){try{var e=O.f.transform,t=e.k/$.k,s=O.f.sourceEvent?[O.f.sourceEvent.layerX,O.f.sourceEvent.layerY]:[n/2,i/2],r=s[0]>S.range()[0],a=s[1]<C.range()[0];v!==St.zoom&&r&&a||(1===t?(r&&ee&&t&&s&&J&&J.call(ee.translateBy,(e.x-$.x)/se().k,0),a&&te&&t&&s&&q&&q.call(te.translateBy,0,(e.y-$.y)/re().k)):(r&&ee&&t&&s&&J&&J.call(ee.scaleBy,t,s),a&&te&&t&&s&&q&&q.call(te.scaleBy,t,s))),$=e,pe()}catch(o){console.log("Error: ",o)}})).on("end",(function(){"RD"===e.props.dataKeyToPlot||"logRD"===e.props.dataKeyToPlot||"fractional_cn"===e.props.dataKeyToPlot?s.props.onLinearPlotZoom([s._currXScale.domain()[0],s._currXScale.domain()[1]],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!0):s.props.onLinearPlotZoom([s._currXScale.domain()[0],s._currXScale.domain()[1]],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!1)}));if(this._canvas){this._canvas.width=800,this._canvas.height=150;var ne=[];f.forEach((function(e){return ne.push(x.toChromosomeInterval(e).toString())}));var ie=new Set(ne),oe=this._canvas.getContext("webgl");oe.clearColor(0,0,0,1);var le=W.webglFillColor().value((function(e){return P(function(e){if(ie.has(x.toChromosomeInterval(e).toString()))return p;if(-1===e.CLUSTER)return ye;if(-2===e.CLUSTER)return Se;var t=e.CLUSTER%b.length;return b[t]}(e))})).data(a),ce=W.seriesWebglPoint().crossValue((function(e){return o.getImplicitCoordinates(x.toChromosomeInterval(e)).getCenter()})).mainValue((function(e){return e[c]})).context(oe).size(this.props.pointsize);ce.decorate((function(e){return le(e)})),N.append("clipPath").attr("id","clip2").append("rect").attr("x",_e(this.props.showPurityPloidy)).attr("y",Ae).attr("width",n).attr("height",i).attr("fill","red"),N.append("g").classed("eventrect",!0).append("rect").attr("x",_e(this.props.showPurityPloidy)).attr("y",Ae).attr("width",n-je-_e(this.props.showPurityPloidy)).attr("height",i-xe-Ae).style("fill","none").style("pointer-events","all").attr("clip-path","url(#clip2)");var he=function(e){s.previewDriver=e},de=function(e){s.previewDriver=null};pe();var ue=null;v===St.select||v===St.erase?(ue=O.c().keyModifiers(!1).extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width,this.props.height-xe]]).on("start brush",(function(){var t=O.f.selection;if(t&&t[0][0]!==t[1][0]&&t[0][1]!==t[1][1]){var s=a.filter((function(e){var s,r,a=x.toChromosomeInterval(e),n=o.getImplicitCoordinates(a);return s=t,r=[S(n.getCenter()),C(e[c])],s[0][0]<=r[0]&&r[0]<=s[1][0]&&s[0][1]<=r[1]&&r[1]<=s[1][1]}));if(s){if(v===St.select)s=y.a.uniqBy(y.a.union(s,f),(function(e){return e["#CHR"]+"_"+e.START}));else if(v===St.erase){for(var r=new Set,n=0;n<s.length;n++)r.add((s[n]["#CHR"],s[n].START,s[n].END,s[n].genomicPosition));s=f.filter((function(e){return function(e,t){var s=(e["#CHR"],e.START,e.END,e.genomicPosition);return!t.has(s)}(e,r)}))}e.brushedNodes=new Set(s)}}else e.brushedNodes=new Set([])})).on("end",(function(){N.selectAll(".brush").remove(),e.props.onBrushedBinsUpdated(Object(j.a)(e.brushedNodes))})),N.append("g").attr("class","brush").call(ue)):v===St.boxzoom&&(ue=O.d().extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width,this.props.height-xe]]).on("end",(function(){N.selectAll(".brush").remove();var t=O.f.selection;try{var r={start:t[0],end:t[1]},a=S.invert(r.start),n=S.invert(r.end);"RD"===e.props.dataKeyToPlot||"logRD"===e.props.dataKeyToPlot||"fractional_cn"===e.props.dataKeyToPlot?e.props.onLinearPlotZoom([a,n],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!0):e.props.onLinearPlotZoom([a,n],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!1)}catch(i){}})),N.append("g").attr("class","brush").call(ue)),N.call(ae).call(ae.transform,O.o.scale(1))}}function pe(){oe.clear(oe.COLOR_BUFFER_BIT),oe.clearColor(255,255,255,1);var e=re().rescaleY(C);if(q.call(E,e),s._currYScale=e,l){var t=se().rescaleX(S);J.call(M,t),s._currXScale=t,ce.xScale(t).yScale(e)}else{var r=se().rescaleX(S);J.call(L,r),s._currXScale=r,ce.xScale(r).yScale(e)}ce(a),m&&(N.select(".Drivers").remove(),N.select(".eventrect").append("g").attr("clip-path","url(#clip2)").classed("Drivers",!0).selectAll("circle").data(m).enter().append("circle").attr("class","point").attr("d",O.k().type(O.l)).attr("fill","red").attr("fill-opacity",1).attr("stroke-width",2).attr("r",2).attr("transform",(function(t){return"translate("+s._currXScale(o.getImplicitCoordinates(t.location).getCenter())+","+((s._currYScale(e.domain()[0])||0)+3)+")"})).on("mouseover",he).on("mouseleave",de).on("click",(function(e){var t="";t="reverseBAF"===c&&s.props.applyLog?"logRD":"reverseBAF"===c&&s.props.showPurityPloidy?"fractional_cn":"reverseBAF"===c?"RD":"reverseBAF",s.lockedDrivers.has(e)?s.lockedDrivers.delete(e):s.lockedDrivers.add(e),s.props.handleDriverGenesChange({gene:e,destination:t})})))}}},{key:"renderHighlight",value:function(){var e=this.props,t=e.width,s=e.genome,r=e.chr,a=e.hoveredLocation;if(!a)return null;if(null!=this.previewDriver)return null;var n=this.getXScale(t,s,r,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),i=s.getImplicitCoordinates(a),o=n(i.start),l=Math.ceil((n(i.end)||0)-(o||0));return o&&o>0?Object(q.jsx)("div",{className:"highlight",style:{position:"absolute",left:o,width:l,height:"100%",backgroundColor:"rgba(0,0,0,1)",border:"1px solid rgba(0,0,0,1)",zIndex:1}}):void 0}},{key:"handleMouseMove",value:function(e){var t=this.props,s=t.width,r=t.genome,a=t.chr,n=t.onLocationHovered,i=this.getXScale(s,r,a,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),o=i.range(),l=k(e).x;if(l<o[0]||l>o[1])this.handleMouseLeave();else{var c=i.invert(l);n(r.getChromosomeLocation(c))}}},{key:"handleMouseLeave",value:function(){this.props.onLocationHovered(null)}},{key:"render",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=t.dataKeyToPlot;return Object(q.jsxs)("div",{className:"LinearPlot",style:{position:"relative",width:s,height:r},onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,children:[this.renderLockedDrivers(),this.renderTooltip(),this.renderHighlight(),Object(q.jsx)("canvas",{ref:function(t){return e._canvas=t},width:s,height:r,className:"canvas",style:{position:"absolute",top:Ae,zIndex:-1,left:_e(this.props.showPurityPloidy),width:s-_e(this.props.showPurityPloidy)-je,height:r-Ae-xe}}),Object(q.jsx)("svg",{ref:function(t){return e._svg=t},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+s+" "+r}),Object(q.jsx)("div",{className:"LinearPlot-tools",children:("RD"===a||"logRD"===a||"fractional_cn"===a)&&Object(q.jsx)("button",{className:"custom-button linear-plot-button",onClick:function(){e.props.onLinearPlotZoom(null,null,!0,!0)},children:"Reset View"})})]})}},{key:"renderLockedDrivers",value:function(){var e=this,t=this.props,s=t.width,r=t.genome,n=t.chr,i=t.height,o=!1;null!=this.previewDriver&&this.lockedDrivers.has(this.previewDriver)&&(this.lockedDrivers.delete(this.previewDriver),o=!0);var l=Object(j.a)(this.lockedDrivers).sort((function(e,t){return e.location.start-t.location.start}));null!=this.previewDriver&&o&&this.lockedDrivers.add(this.previewDriver);var c=[];return l.map((function(t,o){var l,h=e.getXScale(s,r,n,e.props.implicitStart,e.props.implicitEnd,e.props.showPurityPloidy),d=r.getImplicitCoordinates(t.location),u=h(d.start)||0,p=Math.ceil((h(d.end)||0)-(u||0)),f=t.symbol,b=Object(q.jsx)(a.a.Fragment,{children:Object(q.jsxs)("div",{children:[" ",f," "]})}),v=!0,m=f.length>4?40+5*(f.length-4):40,y=[u-m/2,u+m/2],S=Object(g.a)(c);try{for(S.s();!(l=S.n()).done;){var C=l.value;if(C[0]>y[0]&&C[0]<y[1]){v=!1;break}if(y[0]>C[0]&&y[0]<C[1]){v=!1;break}}}catch(j){S.e(j)}finally{S.f()}return v&&c.push(y),u>_e(e.props.showPurityPloidy)&&u<s-je?Object(q.jsxs)("div",{children:[Object(q.jsx)("div",{style:{position:"absolute",left:u-m/2,width:m,bottom:i,border:"1px solid rgba(0,0,0,0)",zIndex:o,pointerEvents:"none",display:v?"":"none"},children:b}),Object(q.jsx)("div",{className:"highlight",style:{position:"absolute",left:u,width:p,height:"75%",backgroundColor:"rgba(255,165,0,1)",border:"1px solid rgba(255,165,0,1)",zIndex:o}})]},e.props.dataKeyToPlot+f):null}))}},{key:"renderTooltip",value:function(){var e=this.props,t=e.driverGenes,s=e.hoveredLocation,r=e.width,n=e.genome,i=e.chr,o=e.height;if(!s)return null;if(!t)return null;if(!this.previewDriver)return null;var l=this.getXScale(r,n,i,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),c=n.getImplicitCoordinates(this.previewDriver.location),h=l(c.start)||0,d=Math.ceil((l(c.end)||0)-(h||0)),u=this.previewDriver.symbol,p=Object(q.jsx)(a.a.Fragment,{children:Object(q.jsxs)("div",{children:[" ",u," "]})}),f=u.length>4?40+5*(u.length-4):40;return Object(q.jsxs)("div",{children:[Object(q.jsx)("div",{style:{position:"absolute",left:h-f/2,bottom:o+1,backgroundColor:"white",border:"1px solid rgba(0,0,0,0)",zIndex:2},children:p}),Object(q.jsx)("div",{className:"highlight",style:{position:"absolute",left:h,width:d+1,height:"75%",backgroundColor:this.lockedDrivers.has(this.previewDriver)?"red":"rgba(0, 200 , 0, 1)",zIndex:0}})]})}}]),s}(a.a.PureComponent);function Oe(e){var t=e.data,s=e.chr,r=e.pointsize,a=e.rdRange,n=e.hoveredLocation,i=e.onLocationHovered,o=e.onBrushedBinsUpdated,l=e.brushedBins,c=e.customColor,h=e.colors,d=e.yScale,u=e.clusterTableData,p=e.applyLog,f=e.displayMode,g=e.width,b=e.onLinearPlotZoom,v=e.implicitStart,m=e.implicitEnd,y=e.onZoom,S=e.driverGenes,C=e.purity,j=e.ploidy,A=e.meanRD,x=e.fractionalCNTicks,_=e.showPurityPloidy,w=e.showTetraploid,O=e.BAF_lines;return Object(q.jsx)(we,{pointsize:r,data:t,dataKeyToPlot:p?"logRD":_?"fractional_cn":"RD",applyLog:p,genome:mt,chr:s,hoveredLocation:n,onLocationHovered:i,onBrushedBinsUpdated:o,yMin:d?d[0]:_?a[0]:p?-2:0,yMax:d?d[1]:a[1],yLabel:p?"log RDR":_?"Copy Number":"RDR",brushedBins:l,customColor:c,colors:h,clusterTableData:u,displayMode:f,width:g,onZoom:y,onLinearPlotZoom:b,implicitStart:v,implicitEnd:m,driverGenes:S,driverGeneUpdate:e.driverGeneUpdate,handleDriverGenesChange:e.handleDriverGenesChange,purity:C,ploidy:j,meanRD:A,fractionalCNTicks:x,showPurityPloidy:_,showTetraploid:w,BAF_lines:O})}function ke(e){var t=e.data,s=e.chr,r=e.pointsize,a=e.hoveredLocation,n=e.onLocationHovered,i=e.onBrushedBinsUpdated,o=e.brushedBins,l=e.customColor,c=e.colors,h=e.xScale,d=e.clusterTableData,u=e.displayMode,p=e.width,f=e.onLinearPlotZoom,g=e.implicitStart,b=e.implicitEnd,v=e.onZoom,m=e.driverGenes,y=e.applyLog,S=e.purity,C=e.ploidy,j=e.meanRD,A=e.showPurityPloidy,x=e.showTetraploid,_=e.fractionalCNTicks,w=e.BAF_lines;return Object(q.jsx)(we,{pointsize:r,data:t,chr:s,dataKeyToPlot:"reverseBAF",applyLog:y,genome:mt,hoveredLocation:a,onLocationHovered:n,onBrushedBinsUpdated:i,yMin:h?h[0]:-.01,yMax:h?h[1]:.51,yLabel:"0.5 - BAF",brushedBins:o,customColor:l,colors:c,clusterTableData:d,displayMode:u,width:p,onLinearPlotZoom:f,implicitStart:g,implicitEnd:b,onZoom:v,driverGenes:m,driverGeneUpdate:e.driverGeneUpdate,handleDriverGenesChange:e.handleDriverGenesChange,purity:S,ploidy:C,meanRD:j,showPurityPloidy:A,showTetraploid:x,fractionalCNTicks:_,BAF_lines:w})}we.defaultProps={width:600,height:150,onLocationHovered:y.a.noop};var Te=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).state={selectedSample:e.initialSelectedSample,sentDriver:{gene:null,destination:null}},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(u.a)(r)),r.handleDriverGenesChange=r.handleDriverGenesChange.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e.target.value})}},{key:"handleDriverGenesChange",value:function(e){this.setState({sentDriver:e})}},{key:"render",value:function(){var e,t=this.props,s=t.data,r=t.chr,a=t.hoveredLocation,n=t.pointsize,i=t.onLocationHovered,o=t.onBrushedBinsUpdated,l=t.brushedBins,c=t.customColor,h=t.yScale,d=t.xScale,u=t.rdRange,p=t.clusterTableData,f=t.applyLog,g=t.displayMode,b=t.width,v=t.onLinearPlotZoom,m=t.implicitRange,y=t.onZoom,S=t.driverGenes,C=t.purity,j=t.ploidy,A=t.meanRD,x=t.fractionalCNTicks,_=t.showPurityPloidy,w=t.showTetraploid,O=t.BAF_lines,k=be()({"is-pan":g===St.zoom,"is-zoom":g===St.boxzoom,"is-select":g===St.select,"is-erase":g===St.erase});return e=Object(q.jsxs)(pe,{className:k,children:[Object(q.jsx)(Oe,{pointsize:n,data:s,chr:r,rdRange:u,hoveredLocation:a,onLocationHovered:i,onBrushedBinsUpdated:o,brushedBins:l,customColor:c,colors:this.props.colors,yScale:h,xScale:d,clusterTableData:p,applyLog:f,displayMode:g,width:b,onLinearPlotZoom:v,implicitStart:m?m[0]:m,implicitEnd:m?m[1]:m,onZoom:y,driverGenes:S,handleDriverGenesChange:this.handleDriverGenesChange,driverGeneUpdate:this.state.sentDriver,purity:C,ploidy:j,meanRD:A,fractionalCNTicks:x,showPurityPloidy:_,BAF_lines:O}),Object(q.jsx)("div",{className:"SampleViz-separator"}),Object(q.jsx)(ke,{pointsize:n,data:s,chr:r,hoveredLocation:a,onLocationHovered:i,onBrushedBinsUpdated:o,brushedBins:l,customColor:c,colors:this.props.colors,yScale:h,xScale:d,clusterTableData:p,applyLog:f,displayMode:g,width:b,onLinearPlotZoom:v,onZoom:y,implicitStart:m?m[0]:m,implicitEnd:m?m[1]:m,driverGenes:S,handleDriverGenesChange:this.handleDriverGenesChange,driverGeneUpdate:this.state.sentDriver,purity:C,ploidy:j,meanRD:A,fractionalCNTicks:x,showPurityPloidy:_,showTetraploid:w,BAF_lines:O})]}),Object(q.jsx)("div",{className:"SampleViz-linear",children:e})}}]),s}(a.a.Component),De=s(74),Pe=s.n(De),Be=s(232),Re=(s(212),function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).table_data=void 0,r.table_data=e.data,r.handleColorChange=r.handleColorChange.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"shouldComponentUpdate",value:function(e){return this.props.data!==e.data||this.props.colors!==e.colors}},{key:"handleColorChange",value:function(e,t){this.props.colors[t]=e.hex;var s=y.a.cloneDeep(this.props.colors);this.props.onClusterColorChange(s),this.forceUpdate()}},{key:"componentDidUpdate",value:function(e){this.props.updatedClusterTable&&this.props.updatedClusterTable()}},{key:"render",value:function(){var e=this,t=this.props,s=t.colOneName,r=t.colTwoName,a=t.colThreeName,n=t.colFourName,i=t.data,o=t.expandable,l=t.selectable,c=t.colors,h=function(t){return Object(q.jsx)("div",{children:Object(q.jsx)(Be.a,{width:"100%",color:e.props.colors[t.data.key],onChangeComplete:function(s){return e.handleColorChange(s,t.data.key)}})})},d=[{when:function(e){return e},style:function(e){return{backgroundColor:-1===Number(e.key)?"#999999":c[Number(e.key)%c.length],alignItems:"center",justifyContent:"center",innerWidth:50,outerWidth:50}}}],u=[{name:s,selector:"key",sortable:!0,compact:!0,wrap:!0,innerWidth:40,outerWidth:40,width:"50",center:!0},{name:r,selector:"value",sortable:!0,right:!0,compact:!0,wrap:!0,innerWidth:40,outerWidth:40,width:"50",center:!0}],p=[{name:s,selector:"key",sortable:!0,compact:!0,wrap:!0,center:!0},{name:r,selector:"value",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0},{name:a,selector:"selectPerc",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0},{name:n,selector:"binPerc",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0}];if(t.centroidTable){var f=[];if(null!==i&&void 0!==i&&i.length>0){f.push({name:"Cluster ID",type:"key"});for(var g=0,b=Object.keys(i[0].sample);g<b.length;g++){var v=b[g];f.push({name:v,type:"sample."+v})}}for(var m=[],y=0,S=f;y<S.length;y++){var C=S[y],j={name:C.name,selector:C.type,sortable:!0,compact:!0,wrap:!0,center:!0};m.push(j)}return Object(q.jsx)(Pe.a,{columns:m,data:i,pagination:!0,dense:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0,conditionalRowStyles:d})}return o||l?Object(q.jsx)("div",{className:"scroll",children:Object(q.jsx)(Pe.a,{columns:u,data:i,selectableRows:!0,onSelectedRowsChange:this.props.onClusterRowsChange,selectableRowSelected:function(t){if(e.props.currentFilters.includes(String(t.key)))return t},expandableRows:!0,expandableRowsComponent:Object(q.jsx)(h,{}),expandableRowDisabled:function(e){return-1===e.key||-2===e.key},pagination:!0,dense:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0,conditionalRowStyles:d})}):Object(q.jsx)(Pe.a,{columns:p,data:i,pagination:!0,dense:!0,paginationPerPage:3,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[3,5,10,20],noContextMenu:!0,noHeader:!0,noDataComponent:Object(q.jsx)("div",{style:{padding:10},children:"No Records Selected"}),conditionalRowStyles:d})}}]),s}(a.a.Component)),Ne=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._clusters=void 0,r._clusters=r.initializeListOfClusters(),r.state={selectedSample:e.initialSelectedSample||e.data.getSampleList()[0],scales:{xScale:null,yScale:null},selectedCluster:r._clusters.length>0?r._clusters[0]:H,implicitRange:null,purity:Y,ploidy:2,offset:0},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(u.a)(r)),r.handleSelectedSampleChange=r.handleSelectedSampleChange.bind(Object(u.a)(r)),r.handleZoom=r.handleZoom.bind(Object(u.a)(r)),r.handleLinearPlotZoom=r.handleLinearPlotZoom.bind(Object(u.a)(r)),r.onUpdatePurity=r.onUpdatePurity.bind(Object(u.a)(r)),r.onUpdatePloidy=r.onUpdatePloidy.bind(Object(u.a)(r)),r.onUpdateOffset=r.onUpdateOffset.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;this._clusters=[];var t,s=Object(g.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(a){s.e(a)}finally{s.f()}for(;this._clusters.length>0&&(Number(this._clusters[0])===Number(H)||Number(this._clusters[0])===Number(K));)this._clusters.shift();return this._clusters}},{key:"componentDidUpdate",value:function(e){if(this.props.clusterTableData!==e.clusterTableData)this.initializeListOfClusters();else if(this.props.applyLog!==e.applyLog||this.props.showPurityPloidyInputs!==e.showPurityPloidyInputs||this.props.showTetraploid!==e.showTetraploid){var t={xScale:this.state.scales.xScale,yScale:null};this.setState({scales:t})}}},{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e})}},{key:"handleSelectedSampleChange",value:function(e){this.setState({selectedSample:e.target.value})}},{key:"handleZoom",value:function(e){this.setState({scales:e})}},{key:"handleLinearPlotZoom",value:function(e,t,s,r){if(r){this.setState({implicitRange:null});this.setState({scales:{xScale:null,yScale:null}})}else{this.setState({implicitRange:e});var a=s?{xScale:this.state.scales.xScale,yScale:t}:{xScale:t,yScale:this.state.scales.yScale};this.setState({scales:a})}}},{key:"onUpdatePurity",value:function(e){this.setState({purity:e})}},{key:"onUpdatePloidy",value:function(e){this.props.data.setSamplePloidy(this.state.selectedSample,e),this.setState({ploidy:e}),this.setState({scales:{xScale:null,yScale:null}})}},{key:"onUpdateOffset",value:function(e){this.setState({offset:e})}},{key:"getSelectedBins",value:function(e,t,s,r,a,n,i){var o=[],l=e?this.props.scales:this.state.scales,c=r?"logRD":a?"fractional_cn":"RD";if(null!==t||null!==l.xScale||null!==l.yScale){var h=t?t[0]:null,d=t?t[1]:null;o=i.getRecords(s,c,h,d,l.xScale,l.yScale,n,this.state.ploidy)}else o=i.getRecords(s,c,null,null,null,null,n,this.state.ploidy);return o}},{key:"render",value:function(){var e=this,t=this.props,s=t.data,r=t.initialSelectedSample,a=t.applyLog,n=t.showLinearPlot,i=t.showScatterPlot,l=t.dispMode,c=t.sampleAmount,h=t.syncScales,d=t.showPurityPloidyInputs,u=t.showTetraploid,p=t.samplesShown,f=this.state.implicitRange,g=this.state.selectedSample,b=s.getRdRange(g,a),v=s.getSampleList().map((function(t){return Object(q.jsxs)("option",{value:t,disabled:!(t===e.state.selectedSample)&&p.has(t),children:[t," "]},t)})),m=s.getMeanRD(g),y=this.getSelectedBins(h,f,g,a,d,m,s),S=s.getBAFLines(this.state.purity,this.state.selectedSample,this.state.offset),C=this.state.purity?(b[1]*this.state.ploidy/m-2*(1-this.state.purity))/this.state.purity:0;b[1]+=.5;var j=s.getFractionalCNTicks(this.state.purity,0,6,Math.ceil(C),this.state.selectedSample);d&&(b=[b[0]*this.state.ploidy/m,b[1]*this.state.ploidy/m]);var A=this._clusters.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)})),x=d?this.state.ploidy/m:1;A.unshift(Object(q.jsx)("option",{value:H,children:H},H)),A.unshift(Object(q.jsx)("option",{value:K,children:K},K));var _=0===s.getBrushedBins().length;return Object(q.jsxs)("div",{className:"SampleViz-wrapper",children:[Object(q.jsxs)("div",{style:{verticalAlign:"middle"},children:[(n||i)&&Object(q.jsxs)("div",{className:"SampleViz-select",title:"Selects a sample from the loaded data.",children:[Object(q.jsx)("span",{children:"Sample: "}),Object(q.jsx)("select",{value:g,onChange:function(t){e.props.onChangeSample(t.target.value,e.state.selectedSample),e.handleSelectedSampleChange(t)},children:v}),Object(q.jsx)("button",{className:"custom-button-add",title:"Add the next sequential sample in the dropdown menu.",onClick:function(){e.props.onAddSample()},disabled:c>=v.length,children:" Add "}),Object(q.jsx)("button",{className:"custom-button-remove",title:"Removes this sample.",onClick:function(){e.props.onRemovePlot(e.state.selectedSample)},disabled:c<=1,children:" Remove "})]}),(n||i)&&Object(q.jsxs)("div",{className:"SampleViz-select",title:"Selects a cluster from the loaded data.",children:[Object(q.jsx)("span",{children:"Cluster: "}),Object(q.jsx)("select",{name:"Select Cluster",className:"Sampleviz-cluster-select",value:this.state.selectedCluster,disabled:_,onChange:function(t){e.setState({selectedCluster:t.target.value})},children:A}),Object(q.jsx)("button",{className:"custom-button",title:"Assigns your selected bins to the selected cluster.",onClick:function(){e.props.parentCallBack(e.state.selectedCluster),e.props.onBrushedBinsUpdated([])},disabled:_,children:"Assign"}),Object(q.jsx)("button",{className:"custom-button",title:"Assigns your selected bins to a new cluster.",onClick:function(){e.initializeListOfClusters();var t=e._clusters;t.sort((function(e,t){return Number(e)-Number(t)}));for(var s=(t.length>0?Number(t[t.length-1]):-1)+1,r=0;r<t.length;r++)if(Number(t[r])!==r){s=r;break}e.props.parentCallBack(s),e.props.onBrushedBinsUpdated([])},disabled:_,children:"New"})]}),(n||i)&&d&&Object(q.jsxs)("div",{className:"Inputs",children:[Object(q.jsx)("label",{children:"Ploidy:"})," ",Object(q.jsx)("input",{value:this.state.ploidy,type:"number",id:"Purity-Input",name:"volume",step:"0.01",title:"Set ploidy gridlines.",onChange:function(t){var s=Number(t.target.value);e.onUpdatePloidy(s)}}),Object(q.jsx)("label",{className:"input-label",children:"Purity:"})," ",Object(q.jsx)("input",{type:"number",id:"Purity-Input",name:"volume",step:"0.01",value:this.state.purity,title:"Set purity gridlines. Max purity is 1.",onChange:function(t){var s=Number(t.target.value);s<=1&&e.onUpdatePurity(s)}}),Object(q.jsx)("label",{className:"input-label",children:"BAF Balance: Offset for (x,x):"})," ",Object(q.jsx)("input",{type:"number",id:"Purity-Input",name:"volume",step:"0.01",value:this.state.offset,title:"Set offset for first vertical gridline. Max offset is 1.",onChange:function(t){var s=Number(t.target.value);s<=1&&e.onUpdateOffset(s)}})]})]}),Object(q.jsxs)("div",{className:"SampleViz-plots",children:[i&&Object(q.jsx)(ve,Object(o.a)(Object(o.a)({},this.props),{},{data:y,onSelectedSample:this.handleSelectedSampleChanged,selectedSample:g,initialSelectedSample:r,onZoom:this.handleZoom,rdRange:b,implicitRange:this.state.implicitRange,scales:h?this.props.scales:this.state.scales,centroidPts:s.getCentroidPoints(g,this.props.chr,x),purity:this.state.purity,ploidy:this.state.ploidy,offset:this.state.offset,meanRD:m,fractionalCNTicks:j,showPurityPloidy:d,showTetraploid:u,BAF_lines:S,max_cn:Math.ceil(C)})),n&&Object(q.jsx)(Te,Object(o.a)(Object(o.a)({},this.props),{},{data:y,onLinearPlotZoom:this.handleLinearPlotZoom,onZoom:this.handleZoom,yScale:this.state.scales.yScale,xScale:this.state.scales.xScale,selectedSample:this.state.selectedSample,initialSelectedSample:r,rdRange:b,displayMode:l,width:600,implicitRange:this.state.implicitRange,purity:this.state.purity,ploidy:this.state.ploidy,meanRD:m,fractionalCNTicks:j,showPurityPloidy:d,showTetraploid:u,BAF_lines:S}))]}),(n||i)&&Object(q.jsx)("div",{className:n&&i?"SampleViz-clusters":"",children:Object(q.jsx)(Re,{data:s.brushedTableData(),onClusterRowsChange:function(){},onClusterColorChange:function(){},currentFilters:["-1"],colOneName:"Cluster ID",colTwoName:"Cluster (%)",colThreeName:"Selection (%)",colFourName:"Bin (%)",cols:"",expandable:!1,selectable:!1,colors:this.props.colors})})]})}}]),s}(a.a.Component),Le="data:image/gif;base64,R0lGODlhEAAQAPQAAP///wAAAPDw8IqKiuDg4EZGRnp6egAAAFhYWCQkJKysrL6+vhQUFJycnAQEBDY2NmhoaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Me=(s(213),function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).table_data=void 0,r.table_data=e.data,r}return Object(d.a)(s,[{key:"shouldComponentUpdate",value:function(e){return this.props.data!==e.data}},{key:"render",value:function(){var e,t=this.props,s=t.colName,r=t.data,a=[{name:s,selector:"action",compact:!0,wrap:!0}],n=[],i=Object(g.a)(r);try{for(i.s();!(e=i.n()).done;){var o=e.value;n.push(o)}}catch(l){i.e(l)}finally{i.f()}return Object(q.jsx)("div",{children:Object(q.jsx)(Pe.a,{columns:a,data:n,pagination:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0})})}}]),s}(a.a.Component)),Ee=function(){function e(t,s){Object(h.a)(this,e),this._name=void 0,this._chromosomes=void 0,this._chrStarts=void 0,this._length=void 0,this.nameToChr=void 0,this._name=s||"",this._chromosomes=t,this._chrStarts={},this._length=0;var r,a=Object(g.a)(t);try{for(a.s();!(r=a.n()).done;){var n=r.value,i=n.name;if(void 0!==this._chrStarts[i])throw new Error('Duplicate chromosome name "'.concat(i,'" in genome "').concat(s,'"'));this._chrStarts[i]=this._length,this._length+=n.length}}catch(d){a.e(d)}finally{a.f()}this.nameToChr={};var o,l=Object(g.a)(this._chromosomes);try{for(l.s();!(o=l.n()).done;){var c=o.value;this.nameToChr[c.name]=c}}catch(d){l.e(d)}finally{l.f()}}return Object(d.a)(e,[{key:"getName",value:function(){return this._name}},{key:"getChromosomeList",value:function(){return this._chromosomes}},{key:"getChromosomeStarts",value:function(){var e=this;return this._chromosomes.map((function(t){return e._chrStarts[t.name]}))}},{key:"getChrStartMap",value:function(){return this._chrStarts}},{key:"getChromosomeStarts2",value:function(e,t,s){var r=this;return e.map((function(e){return r._chrStarts[e.name]}))}},{key:"getLength",value:function(e){return e?e in this._chrStarts?this._chromosomes.find((function(t){return String(t.name)===String(e)})).length:0:this._length}},{key:"getLength2",value:function(e){var t,s=0,r=Object(g.a)(e);try{for(r.s();!(t=r.n()).done;){s+=t.value.length}}catch(a){r.e(a)}finally{r.f()}return s}},{key:"getImplicitCoordinates",value:function(e){var t=e.chr,s=e.start,r=e.end;if(!(t in this._chrStarts))throw new Error('Chromosome "'.concat(t,'" not in this genome'));var a=this._chrStarts[t];return new S(a+s,a+r)}},{key:"getChromosomeLocation",value:function(e){e<0?e=0:e>=this.getLength()&&(e=this.getLength()-1);var t=Object.values(this._chrStarts).sort((function(e,t){return e-t})),s=y.a.sortedLastIndex(t,e)-1,r=e-t[s];return new C(this._chromosomes[s].name,r,r+1)}},{key:"getChrs",value:function(e){var t,s=[],r=Object(g.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(this.nameToChr[a])}}catch(n){r.e(n)}finally{r.f()}return s}}]),e}();new Ee([{name:"chr1",length:248956422},{name:"chr2",length:242193529},{name:"chr3",length:198295559},{name:"chr4",length:190214555},{name:"chr5",length:181538259},{name:"chr6",length:170805979},{name:"chr7",length:159345973},{name:"chr8",length:145138636},{name:"chr9",length:138394717},{name:"chr10",length:133797422},{name:"chr11",length:135086622},{name:"chr12",length:133275309},{name:"chr13",length:114364328},{name:"chr14",length:107043718},{name:"chr15",length:101991189},{name:"chr16",length:90338345},{name:"chr17",length:83257441},{name:"chr18",length:80373285},{name:"chr19",length:58617616},{name:"chr20",length:64444167},{name:"chr21",length:46709983},{name:"chr22",length:50818468}],"hg38"),s(389);function Fe(e){return new Promise((function(t,s){var r=Object.keys(e[0]).filter((function(e){return!X.has(e)}));t(z(e,r,"\t"," "))}))}var Ie=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).csvLink=void 0,r.csvLink=a.a.createRef(),r.state={loading:!1},r.handleFileDownload=r.handleFileDownload.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"handleFileDownload",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t,s,r,a,n,i,o,c,h,d,u,p,f,g,b;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),t="",e.prev=2,e.next=5,Fe(this.props.data);case 5:t=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return");case 12:for((s=document.createElement("a")).href="data:text/tab-separated-values,"+encodeURIComponent(t),r=this.props.fileName,a=r.split("."),n="",i=0;i<a.length-1;i++)n+=a[i],i!==a.length-2&&(n+=".");o=n.split("_"),c=new Date,(h=String(c.getMonth()+1)).length<2&&(h="0"+h),(d=String(c.getDate())).length<2&&(d="0"+d),u=c.getFullYear()+h+d,p=String(c.getHours()),f=String(c.getMinutes()),g=String(c.getSeconds()),p.length<2&&(p="0"+p),f.length<2&&(f="0"+f),g.length<2&&(g="0"+g),b=p+f+g,s.download=o[0]+"_"+u+b+".tsv",s.click(),this.setState({loading:!1});case 35:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{children:[Object(q.jsx)("button",{type:"button",onClick:function(){e.props.onExport(),e.handleFileDownload()},style:{display:"none"},children:"Export"}),this.state.loading&&Object(q.jsxs)("div",{children:["Reading file... ",Object(q.jsx)("img",{src:Le,alt:"Loading"})]})]})}}]),s}(a.a.Component),Ue=s(30),ze=s(418),Ye=s(422),Ge="320px";var He=function(e){var t=e.chosenFile;return t.length>35&&(t=t.substring(0,34)+"..."),Object(q.jsxs)("div",{className:"sidebar",style:{width:Ge,left:e.show?0:"-320px"},children:[Object(q.jsxs)("div",{className:"closemenu",onClick:function(){e.onSidebarChange(!e.show)},title:"Close/open the sidebar.",children:[Object(q.jsx)("div",{children:" "}),e.show?Object(q.jsx)("div",{className:"arrow-container",children:Object(q.jsx)(Ue.a,{})}):Object(q.jsx)("div",{className:"arrow-container",children:Object(q.jsx)(Ue.b,{})})]}),Object(q.jsxs)("div",{className:"contents",children:[Object(q.jsxs)("div",{className:"row-contents",children:[" ",Object(q.jsx)("h1",{children:"CNAViz v2.0"})," "]}),Object(q.jsx)("div",{className:"title-bar"}),Object(q.jsxs)("div",{className:"row-contents",children:[" Chosen File: ",t]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"custom-file-upload",title:"Uploads a file.",children:[Object(q.jsx)("input",{type:"file",id:"fileUpload",onChange:function(t){return e.onFileChosen(t,!0)}}),"Import ",Object(q.jsx)(Ue.d,{})]}),Object(q.jsxs)("label",{className:"custom-file-export",title:"Exports your clustering.",children:[Object(q.jsx)(Ie,{data:e.data,fileName:e.chosenFile,onExport:e.onExport}),"Export ",Object(q.jsx)(Ue.c,{})]}),Object(q.jsxs)("label",{className:"demo",title:"Loads CNAViz with demo data.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:function(t){return e.handleDemoFileInput(!0)}}),"Demo"]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:e.processingStatus!==yt.done?"custom-file-upload-disabled":"custom-file-upload2",title:"Uploads your driver genes.",children:[Object(q.jsx)("input",{type:"file",id:"fileUpload",disabled:e.processingStatus!==yt.done,onChange:function(t){return e.onDriverFileChosen(t,!0)}}),"Import Driver Genes"]}),Object(q.jsxs)("label",{className:e.processingStatus!==yt.done?"custom-file-upload-disabled":"custom-file-upload3",title:"Uploads Cancer Gene Census driver genes.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",disabled:e.processingStatus!==yt.done,onClick:function(t){return e.handleDemoDrivers()}}),"CGC Drivers"]})]}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("div",{className:"Select-Chrom",title:"Select a chromosome to visualize in the linear and scatter plots.",children:[Object(q.jsx)("label",{htmlFor:"Select Chromosome",style:{margin:10},children:" Chromosome: "}),Object(q.jsx)("select",{name:"Select Chromosome",id:"Select Chromosome",value:e.selectedChr,onChange:e.onChrSelected,children:e.chrOptions})]})}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("div",{className:"selection-color",title:"Pick a color to represent your selected bins.",children:[Object(q.jsx)("label",{htmlFor:"Select Cluster Color",style:{margin:10},children:" Selection Color: "}),Object(q.jsx)("input",{type:"color",name:"Select Color",id:"Select Color",value:e.selectedColor,onChange:e.onColorSelected})]})}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)(Ye.a,{sx:{width:300},children:["Point Size:",Object(q.jsx)(ze.a,{"aria-label":"Point Size",defaultValue:3,onChangeCommitted:e.handleslider,valueLabelDisplay:"auto",step:1,marks:!0,min:1,max:10})]})}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"logrdr",title:"Shows read-depth ratio (RDR) in log form.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Log RDR: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleLog,disabled:e.showPurityPloidy})]}),Object(q.jsxs)("label",{className:"centroids",title:"Shows centroids for each visualized cluster on the scatterplot.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Centroids: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleShowCentroids,checked:e.showCentroids,readOnly:!0})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"scatterplot",title:"Shows the scatterplots.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Scatterplots: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleScatter,checked:e.showScatter,readOnly:!0})]}),Object(q.jsxs)("label",{className:"linearplot",title:"Shows the linear plots.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Linear Plots: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleLinear,checked:e.showLinear,readOnly:!0})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"purityploidy",title:"Shows lines for purity and ploidy on the scatterplots.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Purity/Ploidy: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onTogglePurityPloidy,checked:e.showPurityPloidy,readOnly:!0})]}),Object(q.jsxs)("label",{className:"tetraploid",title:"Shows tetraploid gridlines for purity and ploidy.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Tetraploid: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onShowTetraploid,checked:e.showTetraploid,readOnly:!0})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"analytics",title:"Shows pop-up displaying cluster analytics.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:function(){e.onTogglesilhouettes()}}),"Analytics (s)"]}),Object(q.jsxs)("label",{className:"centroidtable",title:"Shows pop-up displaying centroid table.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onToggleShowCentroidTable}),"Centroids (c)"]})]}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("label",{className:"absorbbins",title:"Shows pop-up helping user automate reallocation of bins.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onToggleShowAbsorbBins}),"Absorb Bins (a)"]})}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"showlog",title:"Shows the cluster assignment log.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onTogglePreviousActionLog}),"Log (l)"]}),Object(q.jsxs)("label",{className:"clearclustering",title:"Clears the clustering.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onClearClustering}),"Clear Clustering"]}),Object(q.jsxs)("label",{className:"undocluster",title:"Undo cluster assignment.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onUndoClick}),"Undo Cluster"]})]})]}),Object(q.jsx)("div",{className:"contents2",children:Object(q.jsx)(Re,{data:e.tableData,onClusterRowsChange:e.onClusterRowsChange,onClusterColorChange:e.onClusterColorChange,currentFilters:e.currentClusterFilters,colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:e.colors})})]})},Ke=s(231),Xe=s(0),Qe=(s(214),0),Ze=0,Ve=0,Je=0,We=0,qe=0,$e=0,et=50,tt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r.state={showTooltip:!1,tooltipX:0,tooltipY:0},r._svg=null,r}return Object(d.a)(s,[{key:"shouldComponentUpdate",value:function(e){return!0}},{key:"componentDidUpdate",value:function(e){this.propsDidChange(e,[])&&this.redraw()}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"renderTooltipContent",value:function(e){var t=this.state.showTooltip;return e&&t?Object(q.jsx)("div",{className:"Scatterplot-tooltip",style:{position:"absolute",top:"90%",left:"1%",pointerEvents:"none"},children:e}):null}},{key:"renderTooltip",value:function(){return this.renderTooltipContent(Object(q.jsx)(a.a.Fragment,{children:Object(q.jsx)("div",{children:"Note: The Silhouette coefficient ranges from -1 to 1 where the larger the number the more tightly grouped the cluster "})}))}},{key:"render",value:function(){return Object(q.jsx)("div",{id:"chart-container",children:this.renderTooltip()})}},{key:"redraw",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=t.data,n=t.colors,i=y.a.sortBy(a,"avg"),o=Je/s*100+"%",l=Qe/s*100+"%",c=Ze/s*100+"%",h=Ve/s*100+"%",d=O.j("div#chart-container").append("svg").style("padding",l+" "+c+" "+h+" "+o+" ").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(s+We+$e)+" "+(r+qe+et)),u=O.i().domain([-1,1]).range([15,s-10]);d.append("text").classed("scale",!0).attr("text-anchor","middle").attr("font-size",20).attr("x",y.a.mean([15,s-10])).attr("y",r+40).text("Approximate Average Silhouette Coefficient").on("mouseover",(function(){e.setState({showTooltip:!0}),e.setState({tooltipX:O.f.offsetX,tooltipY:O.f.offsetY})})).on("mouseleave",(function(){e.setState({showTooltip:!1})})),d.append("g").attr("transform","translate(0,"+r+")").call(O.a(u)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var p=O.h().range([0,r]).domain(i.map((function(e){return String(e.cluster)}))).padding(.1);d.selectAll("myRect").data(i).enter().append("rect").attr("class",(function(e){return"bar bar--"+(e.avg<0?"negative":"positive")})).attr("x",(function(e){return u(Math.min(0,e.avg))||0})).attr("y",(function(e){return p(String(e.cluster))||0})).attr("width",(function(e){return Math.abs((u(e.avg)||0)-(u(0)||0))})).attr("height",p.bandwidth()).attr("fill",(function(e){return-1===e.cluster?"#999999":n[e.cluster%n.length]})),d.append("g").call(O.b(p).tickSize(0).tickPadding(6)).attr("transform","translate("+u(0)+",0)")}}]),s}(a.a.Component),st=0,rt=0,at=0,nt=0,it=10,ot=0,lt=0,ct=50,ht=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r._svg=null,r}return Object(d.a)(s,[{key:"shouldComponentUpdate",value:function(e){return!0}},{key:"componentDidUpdate",value:function(e){this.propsDidChange(e,["selectedCluster"])&&this.redraw()}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=nt/s*100+"%",n=st/s*100+"%",i=rt/s*100+"%",o=at/s*100+"%";return Object(q.jsx)("div",{id:"chart-container2",children:Object(q.jsx)("svg",{ref:function(t){return e._svg=t},style:{padding:n+" "+i+" "+o+" "+a+" "},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+(s+it+lt)+" "+(r+ot+ct)})})}},{key:"redraw",value:function(){var e=this.props,t=e.width,s=e.height,r=e.data,a=e.colors;if(this._svg){var n=[];void 0!==r&&(n=Array.from(r,(function(e){return{key:e[0],value:e[1]}}))),n=y.a.sortBy(n,"value");var i=O.j(this._svg);i.selectAll(".scales").remove();var o=y.a.maxBy(n,"value"),l=O.i().domain([0,o?o.value:1]).range([30,t-10]);i.append("text").classed("scales",!0).attr("text-anchor","middle").attr("font-size",20).attr("x",y.a.mean([0,t])).attr("y",s+40).text("Approximate Average Euclidean Distance"),i.append("g").classed("scales",!0).attr("transform","translate(0,"+s+")").call(O.a(l)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var c=O.h().range([0,s]).domain(n.map((function(e){return String(e.key)}))).padding(.1);i.selectAll(".bar").remove(),i.selectAll("myRect").classed("bars",!0).data(n).enter().append("rect").attr("class",(function(e){return"bar bar--"+(e.value<0?"negative":"positive")})).attr("x",(function(e){return l(Math.min(0,e.value))||0})).attr("y",(function(e){return c(String(e.key))||0})).attr("width",(function(e){return Math.abs((l(e.value)||0)-(l(0)||0))})).attr("height",c.bandwidth()).attr("fill",(function(e){return-1===e.key?"#999999":a[e.key%a.length]})),i.append("g").classed("scales",!0).call(O.b(c).tickSize(0).tickPadding(6)).attr("transform","translate("+l.range()[0]+",0)")}}}]),s}(a.a.Component),dt=(s(391),function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._clusters=void 0,r._clusters=r.initializeListOfClusters(),r.state={selectedCluster:r._clusters[0]},r}return Object(d.a)(s,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;this._clusters=[];var t,s=Object(g.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(a){s.e(a)}finally{s.f()}for(;this._clusters.length>0&&(Number(this._clusters[0])===Number("-1")||Number(this._clusters[0])===Number("-2"));)this._clusters.shift();return this._clusters}},{key:"componentDidUpdate",value:function(e){this.props.clusterTableData!==e.clusterTableData&&this.initializeListOfClusters()}},{key:"render",value:function(){var e=this,t=this.props,s=t.silhouetteData,r=t.clusterDistances,a=t.colors,n=this._clusters.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}));return Object(q.jsxs)("div",{className:"Directions2",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:" Cluster Analytics "}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:this.props.onToggleSilhoutteBarPlot,children:Object(q.jsx)(Ue.e,{})}),Object(q.jsxs)("div",{className:"scroll",children:[Object(q.jsxs)("div",{className:"ClusterDistances-Select",children:[Object(q.jsxs)("div",{className:"Overall-Average",children:[" Average Cluster Silhouette Score: ",Object(q.jsx)("b",{children:this.props.avgClusterSilhouette||0})," "]}),Object(q.jsxs)("label",{className:"cluster-select",children:[" Cluster:",Object(q.jsx)("select",{name:"Select Cluster",title:"Cluster",value:this.state.selectedCluster,onChange:function(t){e.setState({selectedCluster:t.target.value})},children:n})]})]}),Object(q.jsxs)("div",{className:"BarPlots",children:[Object(q.jsx)(tt,{width:700,height:700,data:s,avgClusterSilhouette:this.props.avgClusterSilhouette,colors:a}),Object(q.jsx)(ht,{data:r.get(Number(this.state.selectedCluster)),selectedCluster:Number(this.state.selectedCluster),width:700,height:700,colors:a})]})]})]})}}]),s}(a.a.Component)),ut=(s(392),s(230)),pt=s(159),ft=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{className:"Toolbox",children:[Object(q.jsx)("div",{children:"Modes:"}),Object(q.jsx)(gt,{iconElement:Object(q.jsx)(Ue.f,{color:this.props.currentDisplayMode===St.boxzoom?"red":"black"}),label:"Zoom",label2:"(z)",onClick:function(){return e.props.setDisplayMode(St.boxzoom)}}),Object(q.jsx)(gt,{iconElement:Object(q.jsx)(ut.a,{color:this.props.currentDisplayMode===St.zoom?"red":"black"}),label:"Pan",label2:"(p)",onClick:function(){return e.props.setDisplayMode(St.zoom)}}),Object(q.jsx)(gt,{iconElement:Object(q.jsx)(pt.b,{color:this.props.currentDisplayMode===St.select?"red":"black"}),label:"Select",label2:"(b)",onClick:function(){return e.props.setDisplayMode(St.select)}}),Object(q.jsx)(gt,{iconElement:Object(q.jsx)(pt.a,{color:this.props.currentDisplayMode===St.erase?"red":"black"}),label:"Erase",label2:"(e)",onClick:function(){return e.props.setDisplayMode(St.erase)}})]})}}]),s}(a.a.Component),gt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"render",value:function(){return Object(q.jsxs)("div",{className:"Toolbox-Tool",title:this.props.label,onClick:this.props.onClick,children:[this.props.iconElement,Object(q.jsx)("div",{className:"Toolbox-Tool-label",children:this.props.label}),Object(q.jsx)("div",{className:"Toolbox-Tool-label2",children:this.props.label2})]})}}]),s}(a.a.Component);var bt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).csvLink=void 0,r.csvLink=a.a.createRef(),r.state={loading:!1},r.handleFileDownload=r.handleFileDownload.bind(Object(u.a)(r)),r}return Object(d.a)(s,[{key:"handleFileDownload",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t,s,r,a,n,i,o,c,h,d,u,p,f,b,v,m,y,S,C;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.setState({loading:!0}),t=this.props.fileName,s=t.split("."),r="",a=0;a<s.length-1;a++)r+=s[a],a!==s.length-2&&(r+=".");n=r.split("_"),i=new Date,(o=String(i.getMonth()+1)).length<2&&(o="0"+o),(c=String(i.getDate())).length<2&&(c="0"+c),h=i.getFullYear()+o+c,d=String(i.getHours()),u=String(i.getMinutes()),p=String(i.getSeconds()),d.length<2&&(d="0"+d),u.length<2&&(u="0"+u),p.length<2&&(p="0"+p),f=d+u+p,b=[],v=Object(g.a)(this.props.logData);try{for(v.s();!(m=v.n()).done;)y=m.value,b.push(y.action)}catch(l){v.e(l)}finally{v.f()}"",S=b.join("\n"),(C=document.createElement("a")).href="data:text/plain,"+encodeURIComponent(S),C.download=n[0]+"-log_"+h+"_"+f,C.click(),this.setState({loading:!1});case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{children:[Object(q.jsx)("button",{type:"button",onClick:function(){e.props.onExport(),e.handleFileDownload()},style:{display:"none"},children:"Export"}),this.state.loading&&Object(q.jsxs)("div",{children:["Downloading...",Object(q.jsx)("img",{src:Le,alt:"Loading"})]})]})}}]),s}(a.a.Component);function vt(e){return new Promise((function(t,s){var r=new FileReader;r.readAsText(e),r.onload=function(){t(r.result)},r.onerror=s,r.onabort=s}))}var mt,yt,St,Ct=["#d3fe14","#c9080a","#fec7f8","#0b7b3e","#3957ff","#0bf0e9","#c203c8","#fd9b39","#906407","#98ba7f","#fe6794","#10b0ff","#ac7bff","#fee7c0","#964c63","#1da49c","#0ad811","#bbd9fd","#fe6cfe","#d1a09c","#78579e","#81ffad","#739400","#ca6949","#d9bf01","#646a58","#d5097e","#bb73a9","#ccf6e9","#9cb4b6","#b6a7d4","#9e8c62","#6e83c8","#01af64","#a71afd","#cfe589","#d4ccd1","#fd4109","#bf8f0e","#2f786e","#4ed1a5","#d8bb7d","#a54509","#6a9276","#a4777a","#fc12c9","#606f15","#3cc4d9","#f31c4e","#73616f","#f097c6","#fc8772","#92a6fe","#875b44","#699ab3","#94bc19","#7d5bf0","#d24dfe","#c85b74","#68ff57","#b62347","#994b91","#646b8c","#977ab4","#d694fd","#c4d5b5","#fdc4bd","#1cae05","#7bd972","#e9700a","#d08f5d","#8bb9e1","#fde945","#a29d98","#1682fb","#9ad9e0","#d6cafe","#8d8328","#b091a7","#647579","#1f8d11","#e7eafd","#b9660b","#a4a644","#fec24c","#b1168c","#188cc1","#7ab297","#c949a6","#d48295","#eb6dc2","#d5b0cb","#ff9ffb","#fdb082","#af4d44","#a759c4","#a9e03a","#0d906b","#9ee3bd","#5b8846","#0d8995","#f25c58","#70ae4f","#847f74","#9094bb","#ffe2f1","#a67149","#936c8e","#d04907","#c3b8a6","#cef8c4","#7a9293","#fda2ab","#2ef6c5","#807242","#cb94cc","#b6bdd0","#b5c75d","#fde189","#b7ff80","#fa2d8e","#839a5f","#28c2b5","#e5e9e1","#bc79d8","#7ed8fe","#9f20c3","#4f7a5b","#f511fd","#09c959","#bcd0ce","#8685fd","#98fcff","#afbff9","#6d69b4","#aaa87e","#b59dfb","#d9a742","#ac5c86","#9468d5","#a4a2b2","#b1376e","#d43f3d","#05a9d1","#c38375","#24b58e","#6eabaf","#66bf7f","#92cbbb","#ddb1ee","#1be895","#c7ecf9","#a6baa6","#8045cd","#a9d796","#ce62cb","#0e954d","#a97d2f","#fcb8d3","#9bfee3","#4e8d84","#fc6d3f","#7b9fd4","#8c6165","#72805e","#d53762","#f00a1b","#de5c97","#8ea28b","#fccd95","#ba9c57","#b79a82","#7c5a82","#7d7ca4","#958ad6","#cd8126","#bdb0b7","#10e0f8","#dccc69","#d6de0f","#616d3d","#985a25","#30c7fd","#0aeb65","#e3cdb4","#bd1bee","#ad665d","#d77070","#8ea5b8","#76655e","#598100","#86757e","#5ea068","#a590b8","#c1a707","#85c0cd","#e2cde9","#dcd79c","#d8a882","#b256f9","#b13323","#519b3b","#dd80de","#f1884b","#74b2fe","#a0acd2","#d199b0","#f68392","#8ccaa0","#64d6cb","#e0f86a","#75671b","#796e87","#6d8075","#9b8a8d","#f04c71","#61bd29","#bcc18f","#fecd0f","#1e7ac9","#927261","#dc27cf","#979605","#ec9c88","#8c48a3","#676769","#546e64","#8f63a2","#b35b2d","#7b8ca2","#b87188","#4a9bda","#eb7dab","#f6a602","#cab3fe","#ddb8bb","#107959","#885973","#5e858e","#b15bad","#e107a7","#2f9dad","#4b9e83","#b992dc","#6bb0cb","#bdb363","#ccd6e4","#a3ee94","#9ef718","#fbe1d9","#a428a5","#93514c","#487434","#e8f1b6","#d00938","#fb50e1","#fa85e1","#7cd40a","#f1ade1","#b1485d","#7f76d6","#d186b3","#90c25e","#b8c813","#a8c9de","#7d30fe","#815f2d","#737f3b","#c84486","#946cfe","#e55432","#a88674","#c17a47","#b98b91","#fc4bb3","#da7f5f","#df920b","#b7bbba","#99e6d9","#a36170","#c742d8","#947f9d","#a37d93","#889072","#9b924c","#23b4bc","#e6a25f","#86df9c","#a7da6c","#3fee03","#eec9d8","#aafdcb","#7b9139","#92979c","#72788a","#994cff","#c85956","#7baa1a","#de72fe","#c7bad8","#85ebfe","#6e6089","#9b4d31","#297a1d","#9052c0","#698eba","#d46222","#6da095","#b483bb","#04d183","#9bcdfe","#2ffe8c","#9d4279","#c909aa","#826cae"];function jt(e,t,s){return new Promise((function(t,r){v()(e,{cast:!0,columns:!0,delimiter:"\t",skip_empty_lines:!0},(function(e,a){if(e)r(e);else{if(a.length>0){var n,i=Object(g.a)(Q);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(!(o in a[0]))throw new Error("COLUMN: "+o+" IS MISSING FROM INPUTTED DATA")}}catch(A){i.e(A)}finally{i.f()}var l=0,c=a[0]["#CHR"],h=[],d={},u=y.a.groupBy(a,"SAMPLE");for(var p in u)d[p]=y.a.meanBy(u[p],(function(e){return e.RD}));var f,b=Object(g.a)(a);try{for(b.s();!(f=b.n()).done;){var v=f.value;s&&void 0!==v.CLUSTER||(v.CLUSTER=-1),v.fractional_cn=2*v.RD/d[v.SAMPLE],v.logRD=Math.log2(v.RD),c!==v["#CHR"]&&(h.push({name:c,length:l-0}),c=v["#CHR"]),l=Number(v.END),v.reverseBAF=.5-v.BAF}}catch(A){b.e(A)}finally{b.f()}h.push({name:c,length:l-0}),h.sort((function(e,t){return String(e.name).localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"})})),mt=new Ee(h);var m,S=Object(g.a)(a);try{for(S.s();!(m=S.n()).done;){var j=m.value;j.genomicPosition=mt.getImplicitCoordinates(new C(j["#CHR"],j.START,j.END)).start}}catch(A){S.e(A)}finally{S.f()}}t(a)}}))}))}function At(e,t){return new Promise((function(s,r){v()(e,{cast:!0,columns:!0,delimiter:"\t",skip_empty_lines:!0,skip_lines_with_error:!0},(function(e,a){if(e)r(e);else{if(a.length>0){var n,i=Object(g.a)(Z);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(!(o in a[0]))throw new Error("COLUMN: "+o+" IS MISSING FROM INPUTTED DRIVER DATA")}}catch(v){i.e(v)}finally{i.f()}}var l,c=[],h=new Set(t),d=Object(g.a)(a);try{for(d.s();!(l=d.n()).done;){var u=l.value,p=u["Genome Location"].split(":");if(h.has(p[0])){var f=p[1].split("-"),b=new C(p[0],Number(f[0]),Number(f[1]));u.location=b,c.push(u)}}}catch(v){d.e(v)}finally{d.f()}s(c)}}))}))}!function(e){e[e.none=0]="none",e[e.readingFile=1]="readingFile",e[e.processing=2]="processing",e[e.done=3]="done",e[e.error=4]="error"}(yt||(yt={})),function(e){e[e.zoom=0]="zoom",e[e.select=1]="select",e[e.boxzoom=2]="boxzoom",e[e.erase=3]="erase"}(St||(St={}));var xt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;Object(h.a)(this,s),(r=t.call(this,e)).state={processingStatus:yt.none,indexedData:new J([]),hoveredLocation:null,selectedChr:J.ALL_CHRS_KEY,pointsize:3,selectedCluster:J.ALL_CLUSTERS_KEY,selectedColor:"black",absorbThresh_rdr:new Map,absorbThresh_baf:new Map,mergeThresh_rdr:new Map,mergeThresh_baf:new Map,mergeValues:[],invertAxis:!1,sampleAmount:1,color:"blue",colors:Ct,assignCluster:!1,assigned:!1,applyLog:!1,applyClustering:!1,value:"0",updatedBins:!1,selectedSample:"",displayMode:St.zoom,sidebar:!0,chosenFile:"",showLinearPlot:!0,showScatterPlot:!0,showDirections:!1,showAbsorbBins:!1,showLog:!1,showCentroidTable:!1,showCentroids:!1,syncScales:!1,scales:{xScale:null,yScale:null},driverGenes:null,showSilhouettes:yt.none,silhouettes:[],showPurityPloidyInputs:!1,showTetraploid:!0,samplesShown:[],samplesNotShown:[]},r.handleFileChoosen=r.handleFileChoosen.bind(Object(u.a)(r)),r.handleDemoFileInput=r.handleDemoFileInput.bind(Object(u.a)(r)),r.handleDriverFileChosen=r.handleDriverFileChosen.bind(Object(u.a)(r)),r.handleDemoDrivers=r.handleDemoDrivers.bind(Object(u.a)(r)),r.handleChrSelected=r.handleChrSelected.bind(Object(u.a)(r)),r.handleslider=r.handleslider.bind(Object(u.a)(r)),r.handleColorSelection=r.handleColorSelection.bind(Object(u.a)(r)),r.handleAbsorbThresh_rdr=r.handleAbsorbThresh_rdr.bind(Object(u.a)(r)),r.handleAbsorbThresh_baf=r.handleAbsorbThresh_baf.bind(Object(u.a)(r)),r.handleClusterSelected=r.handleClusterSelected.bind(Object(u.a)(r)),r.handleLocationHovered=y.a.throttle(r.handleLocationHovered.bind(Object(u.a)(r)),50),r.handleAxisInvert=r.handleAxisInvert.bind(Object(u.a)(r)),r.handleAddSampleClick=r.handleAddSampleClick.bind(Object(u.a)(r)),r.handleColorChange=r.handleColorChange.bind(Object(u.a)(r)),r.handleAssignCluster=r.handleAssignCluster.bind(Object(u.a)(r)),r.handleCallBack=r.handleCallBack.bind(Object(u.a)(r)),r.handleClusterAssignmentInput=r.handleClusterAssignmentInput.bind(Object(u.a)(r)),r.updateBrushedBins=r.updateBrushedBins.bind(Object(u.a)(r)),r.onClusterRowsChange=r.onClusterRowsChange.bind(Object(u.a)(r)),r.onClusterColorChange=r.onClusterColorChange.bind(Object(u.a)(r)),r.onClusterRowsToChange=r.onClusterRowsToChange.bind(Object(u.a)(r)),r.onClusterColorToChange=r.onClusterColorToChange.bind(Object(u.a)(r)),r.onClusterRowsFromChange=r.onClusterRowsFromChange.bind(Object(u.a)(r)),r.onClusterColorFromChange=r.onClusterColorFromChange.bind(Object(u.a)(r)),r.onSelectedSample=r.onSelectedSample.bind(Object(u.a)(r)),r.handleRemovePlot=r.handleRemovePlot.bind(Object(u.a)(r)),r.setDisplayMode=r.setDisplayMode.bind(Object(u.a)(r)),r.onSideBarChange=r.onSideBarChange.bind(Object(u.a)(r)),r.toggleLog=r.toggleLog.bind(Object(u.a)(r)),r.onToggleLinear=r.onToggleLinear.bind(Object(u.a)(r)),r.onToggleScatter=r.onToggleScatter.bind(Object(u.a)(r)),r.onToggleSync=r.onToggleSync.bind(Object(u.a)(r)),r.goBackToPreviousCluster=r.goBackToPreviousCluster.bind(Object(u.a)(r)),r.handleZoom=r.handleZoom.bind(Object(u.a)(r)),r.onToggleShowCentroids=r.onToggleShowCentroids.bind(Object(u.a)(r)),r.onToggleSilhoutteBarPlot=r.onToggleSilhoutteBarPlot.bind(Object(u.a)(r)),r.onToggleDirections=r.onToggleDirections.bind(Object(u.a)(r)),r.absorbBins=r.absorbBins.bind(Object(u.a)(r)),r.onToggleShowAbsorbBins=r.onToggleShowAbsorbBins.bind(Object(u.a)(r)),r.onToggleShowCentroidTable=r.onToggleShowCentroidTable.bind(Object(u.a)(r)),r.onTogglePreviousActionLog=r.onTogglePreviousActionLog.bind(Object(u.a)(r)),r.onClearClustering=r.onClearClustering.bind(Object(u.a)(r)),r.setProcessingStatus=r.setProcessingStatus.bind(Object(u.a)(r)),r.onTogglePurityPloidy=r.onTogglePurityPloidy.bind(Object(u.a)(r)),r.changeDisplayedSamples=r.changeDisplayedSamples.bind(Object(u.a)(r)),r.onExport=r.onExport.bind(Object(u.a)(r)),r.onShowTetraploid=r.onShowTetraploid.bind(Object(u.a)(r));var a=Object(u.a)(r);return O.j("body").on("keypress",(function(){"p"===O.f.key?a.setState({displayMode:St.zoom}):"z"===O.f.key?a.setState({displayMode:St.boxzoom}):"b"===O.f.key?a.setState({displayMode:St.select}):"e"===O.f.key?a.setState({displayMode:St.erase}):32===O.f.keyCode?a.onSideBarChange(!a.state.sidebar):"l"===O.f.key?a.setState({showLog:!a.state.showLog}):"c"===O.f.key?a.setState({showCentroidTable:!a.state.showCentroidTable}):"s"===O.f.key?a.onToggleSilhoutteBarPlot():"a"===O.f.key&&a.onToggleShowAbsorbBins()})),O.j("body").on("keydown",(function(){a.state.displayMode===St.zoom&&"Shift"===O.f.key?a.setState({displayMode:St.boxzoom}):"/"===O.f.key||"?"===O.f.key?a.setState({showDirections:!0}):a.state.displayMode!==St.zoom&&a.state.displayMode!==St.erase||"Meta"!==O.f.key&&"Control"!==O.f.key?a.state.displayMode!==St.zoom&&a.state.displayMode!==St.select||"Alt"!==O.f.key||a.setState({displayMode:St.erase}):a.setState({displayMode:St.select})})),O.j("body").on("keyup",(function(){a.state.displayMode===St.boxzoom&&"Shift"===O.f.key?a.setState({displayMode:St.zoom}):"/"===O.f.key||"?"===O.f.key?a.setState({showDirections:!1}):a.state.displayMode!==St.select||"Meta"!==O.f.key&&"Control"!==O.f.key?a.state.displayMode===St.erase&&"Alt"===O.f.key&&a.setState({displayMode:St.zoom}):a.setState({displayMode:St.zoom})})),r}return Object(d.a)(s,[{key:"handleFileChoosen",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t,s){var r,a,n,i,o,c,h,d;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.target.files)&&r[0]){e.next=3;break}return e.abrupt("return");case 3:return this.setState({chosenFile:r[0].name}),this.setState({processingStatus:yt.readingFile}),a="",e.prev=6,e.next=9,vt(r[0]);case 9:a=e.sent,e.next=17;break;case 12:return e.prev=12,e.t0=e.catch(6),console.error(e.t0),this.setState({processingStatus:yt.error}),e.abrupt("return");case 17:return this.setState({processingStatus:yt.processing}),n=null,e.prev=19,e.next=22,jt(a,this.state.applyLog,s);case 22:i=e.sent,n=new J(i),e.next=31;break;case 26:return e.prev=26,e.t1=e.catch(19),console.error(e.t1),this.setState({processingStatus:yt.error}),e.abrupt("return");case 31:for(o=n.getSampleList(),c=[],h=[],d=0;d<o.length;d++)d<this.state.sampleAmount?c.push(o[d]):h.push(o[d]);this.setState({indexedData:n,processingStatus:yt.done,samplesShown:c,samplesNotShown:h});case 36:case"end":return e.stop()}}),e,this,[[6,12],[19,26]])})));return function(t,s){return e.apply(this,arguments)}}()},{key:"handleDemoFileInput",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t){var s=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({chosenFile:"a12.tsv"}),this.setState({processingStatus:yt.readingFile}),fetch("https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/a12.tsv").then((function(e){return e.text()})).then((function(e){s.setState({processingStatus:yt.processing}),jt(e,s.state.applyLog,t).then((function(e){for(var t=new J(e),r=t.getSampleList(),a=[],n=[],i=0;i<r.length;i++)i<s.state.sampleAmount?a.push(r[i]):n.push(r[i]);s.setState({indexedData:t,processingStatus:yt.done,samplesShown:a,samplesNotShown:n})})).catch((function(e){console.error(e),s.setState({processingStatus:yt.error})}))}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setProcessingStatus",value:function(e){this.setState({processingStatus:e})}},{key:"handleDriverFileChosen",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t){var s,r,a,n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=t.target.files)&&s[0]){e.next=3;break}return e.abrupt("return");case 3:return r="",e.prev=4,e.next=7,vt(s[0]);case 7:r=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),console.error(e.t0),e.abrupt("return");case 14:return a=null,e.prev=15,e.next=18,At(r,this.state.indexedData.getAllChromosomes());case 18:n=e.sent,a=n,e.next=26;break;case 22:return e.prev=22,e.t1=e.catch(15),console.error(e.t1),e.abrupt("return");case 26:this.setState({driverGenes:a});case 27:case"end":return e.stop()}}),e,this,[[4,10],[15,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDemoDrivers",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/drivers.tsv").then((function(e){return e.text()})).then((function(e){At(e,t.state.indexedData.getAllChromosomes()).then((function(e){t.setState({driverGenes:e})})).catch((function(e){console.error(e)}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"handleChrSelected",value:function(e){this.setState({selectedChr:e.target.value}),this.state.indexedData.setChrFilter(e.target.value)}},{key:"handleslider",value:function(e,t){console.log("Pointsize updated to",t),this.setState({pointsize:t})}},{key:"handleColorSelection",value:function(e){this.setState({selectedColor:e.target.value})}},{key:"handleAbsorbThresh_rdr",value:function(e,t){this.state.absorbThresh_rdr.set(e,Number(t.target.value))}},{key:"handleAbsorbThresh_baf",value:function(e,t){this.state.absorbThresh_baf.set(e,Number(t.target.value))}},{key:"handleMergeThresh_rdr",value:function(e,t){console.log("inside handleMergeThresh_rdr() with",e,"updated value to",Number(t.target.value)),this.state.mergeThresh_rdr.set(e,Number(t.target.value))}},{key:"handleMergeThresh_baf",value:function(e,t){console.log("inside handleMergeThresh_baf() with",e,"updated value to",Number(t.target.value)),this.state.mergeThresh_baf.set(e,Number(t.target.value))}},{key:"handleClusterSelected",value:function(e){this.setState({selectedCluster:e.target.value}),this.state.indexedData.setClusterFilters([e.target.value])}},{key:"handleLocationHovered",value:function(e){e?this.setState({hoveredLocation:e}):this.setState({hoveredLocation:null})}},{key:"handleClusterAssignmentInput",value:function(e){this.setState({value:e.target.value})}},{key:"handleCallBack",value:function(e){this.state.indexedData.updateCluster(Number(e)),this.setState({assignCluster:!1}),this.state.indexedData.setChrFilter(this.state.selectedChr)}},{key:"updateBrushedBins",value:function(e){this.state.indexedData.setbrushedBins(e),this.setState({updatedBins:!0})}},{key:"handleAxisInvert",value:function(){this.setState({invertAxis:!this.state.invertAxis})}},{key:"changeDisplayedSamples",value:function(e,t){for(var s=this.state.samplesShown,r=0;r<s.length;r++)s[r]===t&&(s[r]=e);var a=this.state.samplesNotShown;(a=a.filter((function(t){return t!==e}))).push(t),this.setState({sampleAmount:this.state.sampleAmount,samplesShown:s,samplesNotShown:a})}},{key:"handleAddSampleClick",value:function(){var e=this.state.samplesNotShown[0],t=this.state.samplesShown;t.push(e);var s=this.state.samplesNotShown;s=s.filter((function(t){return t!==e})),this.setState({sampleAmount:this.state.sampleAmount+1,samplesShown:t,samplesNotShown:s})}},{key:"handleRemovePlot",value:function(e){var t=this.state.samplesShown,s=t[t.length-1];t.pop(),this.state.samplesNotShown.push(s),this.setState({sampleAmount:this.state.sampleAmount-1})}},{key:"handleAssignCluster",value:function(){this.setState({assignCluster:!this.state.assignCluster})}},{key:"handleColorChange",value:function(e){this.setState({color:e.hex})}},{key:"getStatusCaption",value:function(){switch(this.state.processingStatus){case yt.readingFile:return Object(q.jsxs)("div",{children:["Reading file... ",Object(q.jsx)("img",{src:Le,alt:"Loading"})]});case yt.processing:return Object(q.jsxs)("div",{children:["Processing data... ",Object(q.jsx)("img",{src:Le,alt:"Loading"})]});case yt.error:return"ERROR";case yt.none:case yt.done:default:return""}}},{key:"onToggleDirections",value:function(){this.setState({showDirections:!this.state.showDirections})}},{key:"absorbBins",value:function(){console.log("Absorb bins!")}},{key:"mergeBins",value:function(e){console.log("Merge bins..."),this.setState({processingStatus:yt.processing});for(var t=0;t<this.state.indexedData.getSampleList().length;t++){var s=this.state.indexedData.getSampleList()[t];if(e===s){for(var r=this.state.mergeThresh_rdr.get(e),a=this.state.mergeThresh_baf.get(e),n=this.state.indexedData.mergeBins(s,Number(a),Number(r)),i="\n",o=0,l=Array.from(n.keys());o<l.length;o++){var c=l[o];i+=String(c)+": [";for(var h=0,d=Array.from(n.get(c));h<d.length;h++){var u=d[h];i+=String(u)+","}i+="]\n"}window.confirm("Are you sure you want to merge the following bins?"+i)?(alert("Clusters merged."),this.state.indexedData.assignMerge(s,n)):alert("Action canceled, clusters not merged.")}}this.setState({processingStatus:yt.done})}},{key:"mergeBinsAll",value:function(){console.log("Merge bins..."),this.setState({processingStatus:yt.processing});for(var e=this.state.indexedData.getSampleList()[0],t=this.state.indexedData.mergeBinsAll(e,this.state.mergeThresh_rdr,this.state.mergeThresh_baf),s="\n",r=0,a=Array.from(t.keys());r<a.length;r++){var n=a[r];s+=String(n)+": [";for(var i=0,o=Array.from(t.get(n));i<o.length;i++){var l=o[i];s+=String(l)+","}s+="]\n"}window.confirm("Are you sure you want to merge the following bins?"+s)?(alert("Clusters merged."),this.state.indexedData.assignMerge(e,t)):alert("Action canceled, clusters not merged."),this.setState({processingStatus:yt.done})}},{key:"onToggleShowAbsorbBins",value:function(){this.setState({showAbsorbBins:!this.state.showAbsorbBins})}},{key:"onShowTetraploid",value:function(){console.log("ShowTetraplod",this.state.showTetraploid),this.setState({showTetraploid:!this.state.showTetraploid})}},{key:"toggleLog",value:function(){this.state.applyLog?(this.state.indexedData.setDataKeyType("RD"),this.state.indexedData.recalculateCentroids("RD")):(this.state.indexedData.setDataKeyType("logRD"),this.state.indexedData.recalculateCentroids("logRD")),this.setState({applyLog:!this.state.applyLog}),this.state.indexedData.setShouldRecalculatesilhouettes(!0)}},{key:"toggleClustering",value:function(){this.setState({applyClustering:!this.state.applyClustering})}},{key:"onClusterRowsChange",value:function(e){this.state.indexedData.setClusterFilters(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterRowsToChange",value:function(e){this.state.indexedData.setClusterFiltersTo(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterRowsFromChange",value:function(e){this.state.indexedData.setClusterFiltersFrom(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterColorChange",value:function(e){var t,s=[],r=Object(g.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(a)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:s})}},{key:"onClusterColorToChange",value:function(e){var t,s=[],r=Object(g.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(a)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:s})}},{key:"onClusterColorFromChange",value:function(e){var t,s=[],r=Object(g.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(a)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:s})}},{key:"onSelectedSample",value:function(e){this.setState({selectedSample:e})}},{key:"setDisplayMode",value:function(e){this.setState({displayMode:e})}},{key:"onSideBarChange",value:function(e){this.setState({sidebar:e})}},{key:"onToggleScatter",value:function(){this.setState({showScatterPlot:!this.state.showScatterPlot})}},{key:"onToggleLinear",value:function(){this.setState({showLinearPlot:!this.state.showLinearPlot})}},{key:"onToggleSync",value:function(){this.setState({syncScales:!this.state.syncScales})}},{key:"onToggleShowCentroids",value:function(){this.setState({showCentroids:!this.state.showCentroids})}},{key:"onToggleShowCentroidTable",value:function(){this.setState({showCentroidTable:!this.state.showCentroidTable})}},{key:"goBackToPreviousCluster",value:function(){this.state.indexedData.undoClusterUpdate(),this.setState({indexedData:this.state.indexedData})}},{key:"handleZoom",value:function(e){this.setState({scales:e})}},{key:"onTogglePreviousActionLog",value:function(){this.setState({showLog:!this.state.showLog})}},{key:"onClearClustering",value:function(){this.state.indexedData.clearClustering(),this.setState({indexedData:this.state.indexedData})}},{key:"onExport",value:function(){this.state.indexedData.calculateCopyNumbers()}},{key:"onTogglePurityPloidy",value:function(){this.state.showPurityPloidyInputs?this.state.indexedData.setDataKeyType("RD"):this.state.indexedData.setDataKeyType("fractional_cn"),this.setState({showPurityPloidyInputs:!this.state.showPurityPloidyInputs})}},{key:"onToggleSilhoutteBarPlot",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({processingStatus:yt.processing}),this.state.showSilhouettes===yt.none?(this.setState({showSilhouettes:yt.processing}),this.state.indexedData.recalculatesilhouettes(this.state.applyLog).then((function(e){void 0!==e&&(t.setState({silhouettes:e}),t.setState({showSilhouettes:yt.done}))}))):this.setState({showSilhouettes:yt.none}),this.setState({processingStatus:yt.done});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,s=t.indexedData,r=t.selectedChr,a=t.selectedCluster,n=t.showTetraploid,i=t.hoveredLocation,l=t.invertAxis,c=t.selectedColor,h=t.assignCluster,d=t.updatedBins,u=t.value,p=t.sampleAmount,f=this.state.samplesShown,g=new Set(f),b=s.getBrushedBins(),v=s.getAllRecords(),m=null,S=null,C=null,j=s.getClusterTableInfo(),A=s.getClusterTableInfo2(),x=s.getClusterTableInfo3(),_=[Object(q.jsx)("option",{value:J.ALL_CHRS_KEY,children:"ALL"},J.ALL_CHRS_KEY)],w=s.getActions();if(this.state.processingStatus===yt.done&&!s.isEmpty()){var O=s.getClusterTableInfo(),k=(s.getClusterTableInfo2(),s.getClusterTableInfo3(),{pointsize:this.state.pointsize,data:s,hoveredLocation:i||void 0,onLocationHovered:this.handleLocationHovered,invertAxis:l,chr:r,cluster:a,customColor:c,showTetraploid:n,colors:this.state.colors,assignCluster:h,onBrushedBinsUpdated:this.updateBrushedBins,parentCallBack:this.handleCallBack,brushedBins:b,updatedBins:d,onSelectedSample:this.onSelectedSample,selectedSample:this.state.selectedSample,dispMode:this.state.displayMode,onRemovePlot:this.handleRemovePlot,onAddSample:this.handleAddSampleClick,onChangeSample:this.changeDisplayedSamples,clusterTableData:O,clusterTableData2:O,clusterTableData3:O,applyLog:this.state.applyLog,onClusterSelected:this.handleClusterSelected,onUndoClick:this.goBackToPreviousCluster,showCentroids:this.state.showCentroids,driverGenes:this.state.driverGenes});(_=s.getAllChromosomes().sort((function(e,t){return e.localeCompare(t,"en",{numeric:!0})})).map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}))).push(Object(q.jsx)("option",{value:J.ALL_CHRS_KEY,children:"ALL"},J.ALL_CHRS_KEY)),s.getAllClusters().map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)})).push(Object(q.jsx)("option",{value:J.ALL_CLUSTERS_KEY,children:"ALL"},J.ALL_CLUSTERS_KEY)),m=Object(q.jsx)("div",{id:"grid-container",children:Object(q.jsx)("div",{className:"sampleviz-wrapper-row",children:y.a.times(p,(function(t){return f.length>t&&Object(q.jsx)(Ne,Object(o.a)(Object(o.a)({},k),{},{initialSelectedSample:f[t],plotId:t,showLinearPlot:e.state.showLinearPlot,showScatterPlot:e.state.showScatterPlot,sampleAmount:p,syncScales:e.state.syncScales,handleZoom:e.handleZoom,scales:e.state.scales,showPurityPloidyInputs:e.state.showPurityPloidyInputs,samplesShown:g}),t)}))})}),S=Object(q.jsxs)("div",{className:"grid-container",children:[Object(q.jsx)("div",{className:"App-row-contents",children:"Set Merge Thresholds:"}),Object(q.jsx)("div",{className:"App-row-contents",children:this.state.indexedData.getSampleList().map((function(t){return Object(q.jsx)("div",{id:"grid-container",children:Object(q.jsxs)("div",{className:"scroll",children:[t,Object(q.jsxs)("div",{className:"App-row-contents",children:["BAF:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-BAF",min:0,max:10,step:"0.01",placeholder:e.state.mergeThresh_baf.has(t)?String(e.state.mergeThresh_baf.get(t)):"0",onChange:e.handleMergeThresh_baf.bind(e,t)},t)]}),Object(q.jsxs)("div",{className:"App-row-contents",children:["RDR:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-RDR",min:0,max:10,step:"0.01",placeholder:e.state.mergeThresh_rdr.has(t)?String(e.state.mergeThresh_rdr.get(t)):"0",onChange:e.handleMergeThresh_rdr.bind(e,t)},t)]})]})},t)}))}),Object(q.jsx)("div",{className:"App-row-contents",children:Object(q.jsxs)("label",{className:"directions_label",title:"Merges any clusters with a pairwise centroid distance below the BAF and RDR thresholds in all samples.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",disabled:this.state.processingStatus!==yt.done,onClick:this.mergeBinsAll.bind(this)}),"Merge Clusters"]})})]}),C=Object(q.jsxs)("div",{className:"grid-container",children:[Object(q.jsx)("div",{className:"App-row-contents",children:"Set Absorb Thresholds:"}),Object(q.jsx)("div",{className:"App-row-contents",children:this.state.indexedData.getSampleList().map((function(t){return Object(q.jsx)("div",{id:"grid-container",children:Object(q.jsxs)("div",{className:"scroll",children:[t,Object(q.jsxs)("div",{className:"App-row-contents",children:["BAF:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-BAF",min:0,max:10,step:"0.01",placeholder:e.state.mergeThresh_baf.has(t)?String(e.state.mergeThresh_baf.get(t)):"0",onChange:e.handleAbsorbThresh_baf.bind(e,t)},t)]}),Object(q.jsxs)("div",{className:"App-row-contents",children:["RDR:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-RDR",min:0,max:10,step:"0.01",placeholder:e.state.mergeThresh_rdr.has(t)?String(e.state.mergeThresh_rdr.get(t)):"0",onChange:e.handleAbsorbThresh_rdr.bind(e,t)},t)]})]})},t)}))}),Object(q.jsx)("div",{className:"App-row-contents",children:Object(q.jsxs)("label",{className:"directions_label",title:"Absorbs bins in the 'From' list of clusters to the closest 'To' list of centroids. Reassignment only happens if distance is below the BAF and RDR thresholds in every sample.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",disabled:this.state.processingStatus!==yt.done,onClick:this.mergeBinsAll.bind(this)}),"Absorb Bins"]})})]})}var T=this.getStatusCaption();return Object(q.jsxs)("div",{className:"container-fluid",children:[Object(q.jsx)("div",{children:Object(q.jsx)(He,{handleslider:this.handleslider,selectedChr:r,onChrSelected:this.handleChrSelected,chrOptions:_,selectedColor:c,onColorSelected:this.handleColorSelection,onAbsorbThresh_rdr:this.handleAbsorbThresh_rdr,onAbsorbThresh_baf:this.handleAbsorbThresh_baf,onMergeThresh_rdr:this.handleMergeThresh_rdr,onMergeThresh_baf:this.handleMergeThresh_baf,onAddSample:this.handleAddSampleClick,onAssignCluster:this.handleAssignCluster,tableData:j,onClusterRowsChange:this.onClusterRowsChange,onClusterColorChange:this.onClusterColorChange,currentClusterFilters:s.getFilteredClusters(),handleClusterAssignmentInput:this.handleClusterAssignmentInput,value:u,setDisplayMode:this.setDisplayMode,currentDisplayMode:this.state.displayMode,colors:this.state.colors,onSidebarChange:this.onSideBarChange,data:v,onFileChosen:this.handleFileChoosen,chosenFile:this.state.chosenFile,show:this.state.sidebar,onToggleLog:this.toggleLog,onToggleLinear:this.onToggleLinear,onToggleScatter:this.onToggleScatter,showScatter:this.state.showScatterPlot,showLinear:this.state.showLinearPlot,onToggleSync:this.onToggleSync,syncScales:this.state.syncScales,logData:w,onToggleShowCentroids:this.onToggleShowCentroids,onToggleShowAbsorbBins:this.onToggleShowAbsorbBins,onShowTetraploid:this.onShowTetraploid,showTetraploid:this.state.showTetraploid,showCentroids:this.state.showCentroids,onDriverFileChosen:this.handleDriverFileChosen,onTogglesilhouettes:this.onToggleSilhoutteBarPlot,showSilhouettes:this.state.showSilhouettes,onToggleDirections:this.onToggleDirections,onToggleShowCentroidTable:this.onToggleShowCentroidTable,onTogglePreviousActionLog:this.onTogglePreviousActionLog,onClearClustering:this.onClearClustering,handleDemoFileInput:this.handleDemoFileInput,handleDemoDrivers:this.handleDemoDrivers,setProcessingStatus:this.setProcessingStatus,onTogglePurityPloidy:this.onTogglePurityPloidy,showPurityPloidy:this.state.showPurityPloidyInputs,applyLog:this.state.applyLog,processingStatus:this.state.processingStatus,onExport:this.onExport,onUndoClick:this.goBackToPreviousCluster})}),Object(q.jsxs)("div",{style:{position:"relative",marginLeft:this.state.sidebar?Ge:0,overflowX:"hidden"},children:[Object(q.jsxs)("div",{className:"toolbar",style:{width:this.state.sidebar?"calc(100% - ".concat(Ge," - 20px)"):"calc(100% - 20px)"},children:[Object(q.jsx)(ft,{currentDisplayMode:this.state.displayMode,setDisplayMode:this.setDisplayMode}),Object(q.jsx)("div",{className:"help-box",title:"Show a modal describing instructions and shortcuts.",children:Object(q.jsxs)("label",{style:{cursor:"pointer"},children:[Object(q.jsx)("input",{style:{cursor:"pointer"},type:"button",id:"custom-button",onClick:this.onToggleDirections}),Object(q.jsx)(Xe.b.Provider,{value:{className:"shared-class",size:"40"},children:Object(q.jsx)(Ke.a,{})})]})})]}),T&&Object(q.jsx)("div",{className:"App-status-pane",children:T}),m,this.state.showDirections&&Object(q.jsx)("div",{className:"black_overlay",onClick:this.onToggleDirections}),this.state.showDirections&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:"Directions"}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:this.onToggleDirections,children:Object(q.jsx)(Ue.e,{})}),Object(q.jsx)("h5",{children:" Selection "}),Object(q.jsx)("li",{children:' Hold down "Command/Control" in Zoom mode to temporarily enter add-to-selection mode. '}),Object(q.jsx)("li",{children:' Hold down "Alt" in Zoom mode to temporarily enter remove-from-selection mode. '}),Object(q.jsx)("li",{children:" To completely clear your selection, click anywhere in the plot while in add-to-selection or remove-from-selection modes. "}),Object(q.jsx)("li",{children:" To stay in add-to-select mode, you can press (b) or click the + icon in the toolbar."}),Object(q.jsx)("li",{children:" To stay in remove-from-select mode, you can press (e) or click the eraser icon in the toolbar. "}),Object(q.jsx)("h5",{children:" Zoom/Pan Mode "}),Object(q.jsx)("li",{children:" To enter zoom mode, click the magnifying glass icon in the toolbar, or press (z) on the keyboard. If you hold down shift, it will act as a bounding box zoom. "}),Object(q.jsx)("li",{children:" To pan, click the grab icon in the toolbar, click and drag on the scatter plot or axes, or press (p) on the keyboard. "}),Object(q.jsx)("h5",{children:" Other Key Modifiers: "}),Object(q.jsx)("li",{children:' Click "l" to toggle a log of previous actions. '}),Object(q.jsx)("li",{children:" Click space to toggle the sidebar. "}),Object(q.jsx)("li",{children:' Hold down "?" or "/" button to open direction panel. '}),Object(q.jsx)("li",{children:' Click "c" to toggle a table of the centroids of each cluster for each sample. '}),Object(q.jsx)("li",{children:' Click "s" to toggle a bar plot displaying approximate average silhoutte scores for each cluster. '})]}),this.state.showAbsorbBins&&Object(q.jsx)("div",{className:"black_overlay",onClick:this.onToggleShowAbsorbBins}),this.state.showAbsorbBins&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:"Absorb Bins"}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:this.onToggleShowAbsorbBins,children:Object(q.jsx)(Ue.e,{})}),Object(q.jsxs)("div",{className:"App-row-contents",children:["From:",Object(q.jsx)(Re,{data:A,onClusterRowsChange:this.onClusterRowsFromChange,onClusterColorChange:this.onClusterColorChange,currentFilters:s.getFilteredFromClusters(),colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:Ct}),"To:",Object(q.jsx)(Re,{data:x,onClusterRowsChange:this.onClusterRowsToChange,onClusterColorChange:this.onClusterColorChange,currentFilters:s.getFilteredToClusters(),colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:Ct})]}),C]}),this.state.showLog&&Object(q.jsx)("div",{className:"black_overlay",onClick:function(){return e.setState({showLog:!e.state.showLog})}}),this.state.showLog&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:" Previous Actions "}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:function(){return e.setState({showLog:!e.state.showLog})},children:Object(q.jsx)(Ue.e,{})}),Object(q.jsx)(Me,{data:w,onClusterColorChange:this.onClusterColorChange,onClusterRowsChange:this.onClusterRowsChange,colName:"Actions (Starting from most recent)"}),Object(q.jsxs)("label",{className:"custom-file-export",title:"Exports your clustering.",children:[Object(q.jsx)(bt,{logData:w,fileName:this.state.chosenFile,onExport:this.onExport}),"Export ",Object(q.jsx)(Ue.c,{})]})]}),this.state.showCentroidTable&&Object(q.jsx)("div",{className:"black_overlay",onClick:function(){return e.setState({showCentroidTable:!e.state.showCentroidTable})}}),this.state.showCentroidTable&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:" Centroid Table "}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:function(){return e.setState({showCentroidTable:!e.state.showCentroidTable})},children:Object(q.jsx)(Ue.e,{})}),Object(q.jsx)(Re,{data:s.getCentroidData(),onClusterColorChange:this.onClusterColorChange,onClusterRowsChange:this.onClusterRowsChange,colors:Ct,currentFilters:[""],centroidTable:!0,colOneName:"Cluster",colTwoName:"Sample",colThreeName:"Centroid",cols:[{name:"Cluster",type:"key"},{name:"Sample",type:"sample"},{name:"Centroid",type:"centroid"}]}),S]}),this.state.showSilhouettes===yt.done&&Object(q.jsx)("div",{className:"black_overlay",onClick:this.onToggleSilhoutteBarPlot}),this.state.showSilhouettes===yt.done&&Object(q.jsx)(dt,{silhouetteData:this.state.silhouettes,avgClusterSilhouette:this.state.indexedData.getAvgSilhouette(),clusterDistances:this.state.indexedData.getClusterDistanceMatrix(),clusterTableData:j,colors:Ct,onToggleSilhoutteBarPlot:this.onToggleSilhoutteBarPlot}),Object(q.jsx)("div",{className:"before-loading"})]})]})}}]),s}(a.a.Component);i.a.render(Object(q.jsx)(xt,{}),document.getElementById("root"))}},[[394,1,2]]]);
//# sourceMappingURL=main.36c78bb4.chunk.js.map