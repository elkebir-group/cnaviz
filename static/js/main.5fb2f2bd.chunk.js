(this.webpackJsonpcnaviz=this.webpackJsonpcnaviz||[]).push([[0],{135:function(e,t,s){},214:function(e,t,s){},215:function(e,t,s){},216:function(e,t,s){},253:function(e,t,s){},268:function(e,t){},270:function(e,t){},280:function(e,t,s){},282:function(e,t,s){},283:function(e,t,s){},394:function(e,t,s){},396:function(e,t,s){},397:function(e,t,s){},412:function(e,t,s){"use strict";s.r(t);var r=s(1),a=s.n(r),n=s(222),i=s.n(n),o=(s(253),s(39)),l=s(23),c=s(38),h=s(12),u=s(13),d=s(8),p=s(15),f=s(16),b=s(11),g=s(157),v=s.n(g),m=s(7),y=s.n(m),S=function(e){function t(e,s){if(Object(h.a)(this,t),this.start=e,this.end=s,s<e)throw new RangeError("End cannot be less than start");this.start=e,this.end=s}return Object(u.a)(t,[{key:e,value:Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start;case 2:return e.next=4,this.end;case 4:case"end":return e.stop()}}),e,this)}))},{key:"getLength",value:function(){return this.end-this.start}},{key:"getCenter",value:function(){return.5*(this.start+this.end)}},{key:"hasOverlap",value:function(e){return Math.max(this.start,e.start)<Math.min(this.end,e.end)}},{key:"toString",value:function(){return"[".concat(this.start,", ").concat(this.end,")")}}]),t}(Symbol.iterator),C=function(){function e(t,s,r){if(Object(h.a)(this,e),this.chr=void 0,this._interval=void 0,s<0)throw new RangeError("Start cannot be negative");this.chr=t,this._interval=new S(s,r)}return Object(u.a)(e,[{key:"start",get:function(){return this._interval.start}},{key:"end",get:function(){return this._interval.end}},{key:"getLength",value:function(){return this._interval.getLength()}},{key:"hasOverlap",value:function(e){return this.chr===e.chr&&this._interval.hasOverlap(e._interval)}},{key:"toString",value:function(){return"".concat(this.chr,":").concat(this.start,"-").concat(this.end)}},{key:"endsRoundedToMultiple",value:function(t){if(t<=0)throw new RangeError("Cannot round to a multiple <= 0 (got ".concat(t,")"));return new e(this.chr,Math.floor(this.start/t)*t,Math.ceil(this.end/t)*t)}}],[{key:"parse",value:function(t){var s=t.match(/([\w:]+)\W+(\d+)\W+(\d+)/);if(s)return new e(s[1],Number.parseInt(s[2],10),Number.parseInt(s[3],10));throw new RangeError("Could not parse interval")}}]),e}(),j=s(19),A=s(21),x={toChromosomeInterval:function(e){return new C(e["#CHR"],e.START,e.END)},flattenNestedBins:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=0,r=e.length;s<r;s++){var a=e[s];Array.isArray(a)?this.flattenNestedBins(a,t):t.push(a)}return t}},_=s(56),O=s(64),w=s(3);function k(e,t){t||(t=e.currentTarget);var s=t.getBoundingClientRect();return{x:e.clientX-s.left,y:e.clientY-s.top}}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0,r=e;if(s&&(r-=s),r<0)return"";var a=Math.floor(r);return a>=75e4?"".concat((a/1e6).toFixed(t)," Mb"):a>=1e4?"".concat((a/1e3).toFixed(t)," kb"):"".concat(a," bp")}function D(e,t,s){if(e.length!==t.length)throw Error("Calculate Euclidean Distance - pointOne dim does not match pointTwo dim");for(var r=0,a=0;a<e.length;a++){var n=Number(e[a])-Number(t[a]);r+=n*n}return!0===s?Math.sqrt(r):r}var B=function(e){var t=w.e(e);if(null!==t){var s=t.rgb();return[s.r/255,s.g/255,s.b/255,s.opacity]}},R=function(e,t){var s,r=[],a=Object(b.a)(t);try{for(a.s();!(s=a.n()).done;){var n=s.value;r.push(D(e,n,!0))}}catch(i){a.e(i)}finally{a.f()}return y.a.mean(r)},P=function(e,t){var s=[];if(1===t.length)return 0;var r,a=Object(b.a)(t);try{for(a.s();!(r=a.n()).done;){var n=D(e,r.value,!0);0!==n&&s.push(n)}}catch(i){a.e(i)}finally{a.f()}return y.a.mean(s)};function N(e,t,s,r){var a=Object(j.a)(t.keys()),n=new Map;if(1===a.length)return[];for(var i=0,o=e.length>0?.01:1,l=0;l<e.length;l++){var c=e[l],h=s[l],u=new Map,d=t.get(h);if(!d)throw new Error("Key error: Cluster not found");if(1!==d.length){var p,f=L(d,o),g=P(c,f),v=1/0,m=Object(b.a)(a);try{for(m.s();!(p=m.n()).done;){var S=p.value;if(S!==h){var C=t.get(S);if(!C)throw new Error("Key error: Cluster not found");var A=L(C,o),x=R(c,A);u.set(Number(S),x),x<v&&(v=x)}}}catch(I){m.e(I)}finally{m.f()}var _=y.a.max([v,g]);if(_){var O=(v-g)/_;if(i+=O,n.has(h)){var w=n.get(h);w&&(w.push(O),n.set(h,w))}else n.set(h,[O])}r.set(h,u)}else if(n.has(h)){var k=n.get(h);k&&(k.push(0),n.set(h,k))}else n.set(h,[0])}var T,D=[],B=Object(b.a)(a);try{for(B.s();!(T=B.n()).done;){var N=T.value,M=n.get(Number(N));if(void 0!==M){var E={cluster:Number(N),avg:y.a.mean(M)};D.push(E)}}}catch(I){B.e(I)}finally{B.f()}var F=i/e.length;return console.log(F),y.a.sortBy(D,"cluster")}function L(e,t){for(var s=new Set,r=e.length,a=t*r;s.size<a;){var n=e[Math.floor(Math.random()*r)];s.add(n)}return Object(j.a)(s)}var M=function(e){return Array.isArray(e)&&e.every((function(e){return"object"===typeof e&&!(e instanceof Array)}))},E=function(e,t){var s,r=t=t||(s=e,Array.from(s.map((function(e){return Object.keys(e)})).reduce((function(e,t){return new Set([].concat(Object(j.a)(e),Object(j.a)(t)))}),[]))),a=t;M(t)&&(r=t.map((function(e){return e.label})),a=t.map((function(e){return e.key})));var n=e.map((function(e){return a.map((function(t){return F(t,e)}))}));return[r].concat(Object(j.a)(n))},F=function(e,t){var s=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce((function(e,t,s,r){return void 0===e[t]?(r.splice(1),null):e[t]}),t);return void 0===s?e in t?t[e]:"":s},I=function(e){return"undefined"===typeof e||null===e?"":e},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e.filter((function(e){return e})).map((function(e){return e.map((function(e){return I(e)})).map((function(e){return"".concat(e)})).join(t)})).join("\n")},z=function(e,t,s,r){if(M(e))return function(e,t,s,r){return U(E(e,t),s,r)}(e,t,s,r);if(a=e,Array.isArray(a)&&a.every((function(e){return Array.isArray(e)})))return function(e,t,s,r){return U(t?[t].concat(Object(j.a)(e)):e,s,r)}(e,t,s,r);var a;if("string"===typeof e)return function(e,t,s,r){return t?"".concat(t.join(s),"\n").concat(e):e}(e,t,s);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},Y=.5,G=[[1,1],[1,0],[2,0],[2,1],[3,1],[4,2],[3,2]],K="-1",H="-2",X=new Set(["reverseBAF","genomicPosition","fractional_cn","logRD"]),Q=["#CHR","START","END","CLUSTER","SAMPLE","RD","BAF"],Z=["symbol","Genome Location"];function V(e,t,s){return new Promise((function(r,a){for(var n=[],i=[],o=new Map,l=t?"logRD":"RD",c=0;c<s.length;c+=e.length){for(var h=[],u=s[c].CLUSTER,d=c;d<c+e.length;d++){if(!(d<s.length))throw Error("Out of Range Error. There are bins missing in the data (bin must exist across all samples).");var p=s[d];d===c&&i.push(u),h.push(p.reverseBAF),h.push(p[l])}if(n.push(h),o.has(u)){var f=o.get(u);void 0!==f&&(f.push(h),o.set(u,f))}else o.set(u,[h])}r({multiDimData:n,clusterToData:o,labels:i})}))}var J=function(){function e(t){Object(h.a)(this,e),this._rdRanges=void 0,this._logRdRanges=void 0,this._locationGroupedData=void 0,this.brushedBins=void 0,this.brushedCrossfilter=void 0,this.brushedClusterDim=void 0,this._ndx=void 0,this._sample_dim=void 0,this._cluster_dim=void 0,this._chr_dim=void 0,this._genomic_pos_dim=void 0,this._samples=void 0,this._clusters=void 0,this._chrs=void 0,this._sampleGroupedData=void 0,this.clusterTableInfo=void 0,this.clusterTableInfo2=void 0,this.clusterTableInfo3=void 0,this.allRecords=void 0,this._cluster_filters=void 0,this._cluster_filters_to=void 0,this._cluster_filters_from=void 0,this.historyStack=void 0,this._clusterAmounts=void 0,this.logOfActions=void 0,this.centroids=void 0,this.centroidPts=void 0,this.chrToClusters=void 0,this.centroidDistances=void 0,this.shouldCalculatesilhouettes=void 0,this.currentsilhouettes=void 0,this.overallSilhouette=void 0,this.clusterDistanceMatrix=void 0,this.rdMeans=void 0,this._updateFractionalCopyNumbers=void 0,this.currentDataKey=void 0,this.sampleToPloidy=void 0,this.sampleToBafTicks=void 0,this.sampleToFractionalTicks=void 0,this.offset=void 0,this._locationGroupedData={},this.initializeLocationGroupedData(t),this._sampleGroupedData={},this._rdRanges={},this.rdMeans={},this._logRdRanges={},this._samples=[],this._chrs=[],this._clusters=[],this.brushedBins=[],this.brushedCrossfilter=Object(_.a)(this.brushedBins),this.brushedClusterDim=this.brushedCrossfilter.dimension((function(e){return e.CLUSTER})),this._cluster_filters=[],this._cluster_filters_to=[],this._cluster_filters_from=[],this.historyStack=[],this._ndx=Object(_.a)(t),this.logOfActions=[],this.centroidPts={},this.centroids=[],this.chrToClusters={},this.centroidDistances={},this.shouldCalculatesilhouettes=!0,this.currentsilhouettes=[],this.clusterDistanceMatrix=new Map,this.overallSilhouette=0,this.currentDataKey="RD",this.sampleToPloidy={},this.sampleToBafTicks={},this.sampleToFractionalTicks={},this.offset=0;var s,r=Object(b.a)(t);try{for(r.s();!(s=r.n()).done;){var a=s.value;this.chrToClusters[a["#CHR"]]?this.chrToClusters[a["#CHR"]].add(String(a.CLUSTER)):this.chrToClusters[a["#CHR"]]=new Set([String(a.CLUSTER)])}}catch(J){r.e(J)}finally{r.f()}for(var n=y.a.groupBy(t,"SAMPLE"),i=0,o=Object.entries(n);i<o.length;i++){var l=Object(A.a)(o[i],2),c=l[0],u=l[1];this._samples.push(c);var d=y.a.groupBy(u,"CLUSTER");this._clusters=y.a.union(this._clusters,Object.keys(d));for(var p=0,f=Object.values(d);p<f.length;p++){var g=f[p],v=y.a.groupBy(g,"#CHR");this._chrs=y.a.union(this._chrs,Object.keys(v))}}for(var S=y.a.groupBy(t,"CLUSTER"),C=0,j=Object.entries(S);C<j.length;C++){for(var x=Object(A.a)(j[C],2),w=x[0],k=x[1],T=y.a.groupBy(k,"SAMPLE"),D={},B=0,R=Object.entries(T);B<R.length;B++){var P=Object(A.a)(R[B],2),N=P[0],L=P[1];this.sampleToPloidy[N]=2;var M=this.calculateCentroid(L,this.currentDataKey),E={cluster:parseInt(w),point:M};if(this.centroidPts[N]&&this.centroidPts[w])this.centroidPts[N][w].push(E);else if(this.centroidPts[N])this.centroidPts[N][w]=[E];else{var F={};F[w]=[E],this.centroidPts[N]=F}var I="("+M[0].toFixed(2)+","+M[1].toFixed(2)+")";D[N]=I}var U={key:w,sample:D};this.centroids.push(U)}if(this._cluster_filters=this._clusters,this._cluster_filters_to=this._clusters,this._cluster_filters_from=this._clusters,this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this._genomic_pos_dim=this._ndx.dimension((function(e){return e.genomicPosition})),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE"),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),t.length>0){var z,G=Object(b.a)(this._samples);try{for(G.s();!(z=G.n()).done;){var K=z.value,H=this._sampleGroupedData[K],X=[y.a.minBy(H,"RD").RD,y.a.maxBy(H,"RD").RD],Q=[y.a.minBy(H,"logRD").logRD,y.a.maxBy(H,"logRD").logRD];this.rdMeans[K]=y.a.meanBy(H,"RD"),this._rdRanges[K]=X,this._logRdRanges[K]=Q}}catch(J){G.e(J)}finally{G.f()}}for(var Z in n){this.getBAFLines(Y,Z,this.offset);var V=(2*(this._rdRanges[Z][1]+1)/this.rdMeans[Z]-1)/Y;this.getFractionalCNTicks(Y,0,6,V,Z)}this.initializeCentroidDistMatrix(),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.clusterTableInfo2=this.calculateClusterTableInfo(),this.clusterTableInfo3=this.calculateClusterTableInfo(),this.filterRecordsByScales=Object(O.a)(this.filterRecordsByScales),this.getBAFLines=Object(O.a)(this.getBAFLines),this._updateFractionalCopyNumbers=Object(m.memoize)(this.updateFractionalCopyNumbers,(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t[0]+"_"+t[1]+"_"+t[2].length+"_"+t[3].join(".")}))}return Object(u.a)(e,[{key:"setShouldRecalculatesilhouettes",value:function(e){this.shouldCalculatesilhouettes=e}},{key:"getClusterDistanceMatrix",value:function(){return this.clusterDistanceMatrix}},{key:"getAvgSilhouette",value:function(){return this.overallSilhouette}},{key:"setSamplePloidy",value:function(e,t){this.sampleToPloidy[e]=t}},{key:"getSampleToPloidy",value:function(){return this.sampleToPloidy}},{key:"recalculatesilhouettes",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t){var s,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldCalculatesilhouettes){e.next=16;break}return s=null,e.prev=2,e.next=5,V(this._samples,t,this.allRecords);case 5:s=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return");case 12:r=N(s.multiDimData,s.clusterToData,s.labels,this.clusterDistanceMatrix),this.overallSilhouette=Number((a=r,y.a.meanBy(a,"avg")).toFixed(3)),this.currentsilhouettes=r,this.shouldCalculatesilhouettes=!1;case 16:return e.abrupt("return",this.currentsilhouettes);case 17:case"end":return e.stop()}var a}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeCentroidDistMatrix",value:function(){var e,t=Object(b.a)(this._samples);try{for(t.s();!(e=t.n()).done;){var s=e.value;this.centroidDistances[s]=[];var r,a=this.getCentroidPoints(s),n=Object(b.a)(a);try{for(n.s();!(r=n.n()).done;){var i,o=r.value,l=Object(b.a)(a);try{for(l.s();!(i=l.n()).done;){var c=i.value,h=D(o.point,c.point);this.centroidDistances[s].push({cluster1:o.cluster,cluster2:c.cluster,dist:h})}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}}}catch(u){t.e(u)}finally{t.f()}}},{key:"getCentroidDistMatrix",value:function(e){return this.centroidDistances[e]}},{key:"calculateCentroid",value:function(e,t){return[y.a.meanBy(e,(function(e){return e.reverseBAF})),y.a.meanBy(e,(function(e){return e[t]}))]}},{key:"getCentroidData",value:function(){return this.centroids}},{key:"getCentroidPoints",value:function(e,t,s){var r,a=this.centroidPts[e],n=this._cluster_filters;r=t?this.chrToClusters[t]:new Set(n);var i,o=[],l=Object(b.a)(n);try{for(l.s();!(i=l.n()).done;){var c=i.value;r.has(c)&&a[c.valueOf()]&&o.push(a[c.valueOf()][0])}}catch(u){l.e(u)}finally{l.f()}if(s&&1!==s){var h=y.a.cloneDeep(o);return h.forEach((function(e){return e.point[1]=e.point[1]*s})),h}return o}},{key:"calculateClusterTableInfo",value:function(){var e,t=this._cluster_dim.group().all(),s=[],r=Object(b.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value,n=Number((Number(a.value)/this.allRecords.length*100).toFixed(2));s.push({key:Number(a.key),value:n})}}catch(i){r.e(i)}finally{r.f()}return s}},{key:"initializeLocationGroupedData",value:function(e){this._locationGroupedData={};var t,s=Object(b.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value,a=x.toChromosomeInterval(r).toString();this._locationGroupedData[a]?this._locationGroupedData[a].push(r):this._locationGroupedData[a]=[r]}}catch(n){s.e(n)}finally{s.f()}}},{key:"isEmpty",value:function(){return 0===this.getSampleList().length}},{key:"getRdRange",value:function(e,t,s){var r=t?this._logRdRanges[e]:this._rdRanges[e];return[1*r[0],1*r[1]]}},{key:"getFractionCNRange",value:function(e,t,s){return[e*t+2*(1-e),e*s+2*(1-e)]}},{key:"getFractionalCNTicks",value:function(e,t,s,r,a){for(var n=[],i=t;i<=s;i++)if(t===s){var o={fractionalTick:e*i+2*(1-e),totalCN:Number("x")};n.push(o)}else{var l={fractionalTick:e*i+2*(1-e),totalCN:i};n.push(l)}if(this.sampleToFractionalTicks[a]=n.map((function(e){return e.fractionalTick})),s===r)return n;if(s<r){for(var c=s+1;c<=r;c++)if(s===r){var h={fractionalTick:e*c+2*(1-e),totalCN:Number("x")};n.push(h)}else{var u={fractionalTick:e*c+2*(1-e),totalCN:c};n.push(u)}return n}return n.slice(0,r+1)}},{key:"getSampleList",value:function(){return this._samples}},{key:"getAllChromosomes",value:function(){return this._chrs}},{key:"getAllClusters",value:function(){return this._clusters}},{key:"setFilters",value:function(e,t,s){t&&this._chr_dim.filter((function(e){return e===t})),s&&this._cluster_dim.filter((function(e){return-1!==s.indexOf(String(e))}))}},{key:"setChrFilter",value:function(e){e?(this._chr_dim.filterAll(),this._chr_dim.filter((function(t){return String(t)===String(e)}))):this._chr_dim.filterAll(),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"setChrFilters",value:function(t){t&&1===t.length&&t[0]===e.ALL_CHRS_KEY?this._chr_dim.filterAll():t&&(this._chr_dim.filterAll(),this._chr_dim.filter((function(e){return-1!==t.indexOf(String(e))})))}},{key:"recalculateCentroids",value:function(e,t){this.centroids=[],this.centroidPts={};for(var s=t||this.allRecords,r=y.a.groupBy(s,"CLUSTER"),a=0,n=Object.entries(r);a<n.length;a++){for(var i=Object(A.a)(n[a],2),o=i[0],l=i[1],c=y.a.groupBy(l,"SAMPLE"),h={},u=0,d=Object.entries(c);u<d.length;u++){var p=Object(A.a)(d[u],2),f=p[0],b=p[1],g="fractional_cn"===e?"RD":e,v=this.calculateCentroid(b,g),m={cluster:parseInt(o),point:v};if(this.centroidPts[f]&&this.centroidPts[o])this.centroidPts[f][o].push(m);else if(this.centroidPts[f])this.centroidPts[f][o]=[m];else{var S={};S[o]=[m],this.centroidPts[f]=S}var C="("+v[0].toFixed(2)+","+v[1].toFixed(2)+")";h[f]=C}var j={key:o,sample:h};this.centroids.push(j)}}},{key:"setClusterFilters",value:function(t){t&&1===t.length&&t[0]===e.ALL_CLUSTERS_KEY?this._cluster_dim.filterAll():t&&(this._cluster_dim.filterAll(),this._cluster_dim.filter((function(e){return-1!==t.indexOf(String(e))}))),t&&(this._cluster_filters=t),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"setClusterFiltersTo",value:function(e){e&&(this._cluster_filters_to=e)}},{key:"setClusterFiltersFrom",value:function(e){e&&(this._cluster_filters_from=e)}},{key:"setGenomicPositionFilter",value:function(e){this._genomic_pos_dim.filterAll(),this._genomic_pos_dim.filter((function(t){return t>e[0]&&t<e[1]})),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"clearAllFilters",value:function(){this._sample_dim.filterAll(),this._cluster_dim.filterAll(),this._chr_dim.filterAll(),this._sampleGroupedData=y.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"getActions",value:function(){return this.logOfActions}},{key:"updateCluster",value:function(e){if(this.brushedBins&&0!==this.brushedBins.length){this.historyStack.push(JSON.parse(JSON.stringify(this.brushedBins)));var t=this.brushedTableData(),s="Assigned to cluster "+e+" | ";s+="Clusters selected: ";var r,a=Object(b.a)(t);try{for(a.s();!(r=a.n()).done;){var n=r.value;s+=String(n.key)+" ("+String(n.value)+"%), "}}catch(v){a.e(v)}finally{a.f()}s+=" | ";var i=[y.a.minBy(this.brushedBins,this.currentDataKey)[this.currentDataKey],y.a.maxBy(this.brushedBins,this.currentDataKey)[this.currentDataKey]],o=[y.a.minBy(this.brushedBins,"reverseBAF").reverseBAF,y.a.maxBy(this.brushedBins,"reverseBAF").reverseBAF];s+=this.currentDataKey+" Range of Selected: ["+i[0].toFixed(2)+", "+i[1].toFixed(2)+"] | ",s+="Allelic Imbalance Range of Selected: ["+o[0].toFixed(2)+", "+o[1].toFixed(2)+"]",this.logOfActions.unshift({action:s});for(var l=0;l<this.brushedBins.length;l++){var c=x.toChromosomeInterval(this.brushedBins[l]).toString();if(this._locationGroupedData[c])for(var h=0;h<this._locationGroupedData[c].length;h++)this._locationGroupedData[c][h].CLUSTER=e}var u=Object.values(this._locationGroupedData),d=x.flattenNestedBins(u);this.centroids=[],this.centroidPts={},this.chrToClusters={};var p,f=Object(b.a)(d);try{for(f.s();!(p=f.n()).done;){var g=p.value;this.chrToClusters[g["#CHR"]]?this.chrToClusters[g["#CHR"]].add(String(g.CLUSTER)):this.chrToClusters[g["#CHR"]]=new Set([String(g.CLUSTER)])}}catch(v){f.e(v)}finally{f.f()}this.recalculateCentroids(this.currentDataKey,d),this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(_.a)(d),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.clusterTableInfo2=this.calculateClusterTableInfo(),this.clusterTableInfo3=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this._cluster_filters.includes(String(e))||this._cluster_filters.push(String(e)),this.setClusterFilters(this._cluster_filters),this.shouldCalculatesilhouettes=!0,this._updateFractionalCopyNumbers.cache=new y.a.memoize.Cache}}},{key:"updateCluster_nolog",value:function(e){if(this.brushedBins&&0!==this.brushedBins.length){var t=this.brushedTableData(),s="Assigned to cluster "+e+" | ";s+="Clusters selected: ";var r,a=Object(b.a)(t);try{for(a.s();!(r=a.n()).done;){var n=r.value;s+=String(n.key)+" ("+String(n.value)+"%), "}}catch(v){a.e(v)}finally{a.f()}s+=" | ";var i=[y.a.minBy(this.brushedBins,this.currentDataKey)[this.currentDataKey],y.a.maxBy(this.brushedBins,this.currentDataKey)[this.currentDataKey]],o=[y.a.minBy(this.brushedBins,"reverseBAF").reverseBAF,y.a.maxBy(this.brushedBins,"reverseBAF").reverseBAF];s+=this.currentDataKey+" Range of Selected: ["+i[0].toFixed(2)+", "+i[1].toFixed(2)+"] | ",s+="Allelic Imbalance Range of Selected: ["+o[0].toFixed(2)+", "+o[1].toFixed(2)+"]",this.logOfActions.unshift({action:s});for(var l=0;l<this.brushedBins.length;l++){var c=x.toChromosomeInterval(this.brushedBins[l]).toString();if(this._locationGroupedData[c])for(var h=0;h<this._locationGroupedData[c].length;h++)this._locationGroupedData[c][h].CLUSTER=e}var u=Object.values(this._locationGroupedData),d=x.flattenNestedBins(u);this.centroids=[],this.centroidPts={},this.chrToClusters={};var p,f=Object(b.a)(d);try{for(f.s();!(p=f.n()).done;){var g=p.value;this.chrToClusters[g["#CHR"]]?this.chrToClusters[g["#CHR"]].add(String(g.CLUSTER)):this.chrToClusters[g["#CHR"]]=new Set([String(g.CLUSTER)])}}catch(v){f.e(v)}finally{f.f()}this.recalculateCentroids(this.currentDataKey,d),this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(_.a)(d),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.clusterTableInfo2=this.calculateClusterTableInfo(),this.clusterTableInfo3=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this._cluster_filters.includes(String(e))||this._cluster_filters.push(String(e)),this.setClusterFilters(this._cluster_filters),this.shouldCalculatesilhouettes=!0,this._updateFractionalCopyNumbers.cache=new y.a.memoize.Cache}}},{key:"clearClustering",value:function(){this.brushedBins=Object(j.a)(this.allRecords),this.updateCluster(-1)}},{key:"getMeanRD",value:function(e){return this.rdMeans[e]}},{key:"setDataKeyType",value:function(e){this.currentDataKey=e}},{key:"undoClusterUpdate",value:function(){if(0!==this.historyStack.length){var e=this.historyStack[this.historyStack.length-1];this.historyStack.pop();for(var t=0;t<e.length;t++){var s=e[t],r=x.toChromosomeInterval(s).toString(),a=s.CLUSTER;if(this._cluster_filters.includes(String(a))||this._cluster_filters.push(String(a)),this._locationGroupedData[r])for(var n=0;n<this._locationGroupedData[r].length;n++)this._locationGroupedData[r][n].CLUSTER=a}var i=Object.values(this._locationGroupedData),o=x.flattenNestedBins(i);this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(_.a)(o),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=y.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this.setClusterFilters(this._cluster_filters),this.setShouldRecalculatesilhouettes(!0)}}},{key:"updateFractionalCopyNumbers",value:function(e,t,s,r){var a=e/this.rdMeans[t],n=y.a.cloneDeep(s);return n.forEach((function(e){return e.fractional_cn=e.RD*a})),n}},{key:"getBAFLines",value:function(e,t,s){var r,a=new Set,n=[],i=Object(b.a)(G);try{for(i.s();!(r=i.n()).done;){var o=r.value,l=o[0],c=o[1];if(1===l&&1===c){var h=.5-(c*e+1*(1-e))/((l+c)*e+2*(1-e))+s,u=a.size;if(a.add(h),a.size!==u){var d={tick:h,state:o};n.push(d)}}else{var p=.5-(c*e+1*(1-e))/((l+c)*e+2*(1-e)),f=a.size;if(a.add(p),a.size!==f){var g={tick:p,state:o};n.push(g)}}}}catch(m){i.e(m)}finally{i.f()}var v=y.a.sortBy(n,"tick");return this.sampleToBafTicks[t]=v,v}},{key:"brushedTableData",value:function(){var e=this._samples.length,t=this._clusterAmounts,s={};t.forEach((function(t){return s[Number(t.key)]=Number(t.value)/e}));var r,a=this.brushedBins.length,n=this.brushedClusterDim.group().all(),i=[],o=this._ndx.all().length,l=Object(b.a)(n);try{for(l.s();!(r=l.n()).done;){var c=r.value;i.push({key:Number(c.key),value:Number((Number(c.value)/Number(s[Number(c.key)])*100).toFixed(2)),selectPerc:Number((Number(c.value)/Number(a)*100).toFixed(2)),binPerc:Number((Number(c.value)/Number(o/e)*100).toFixed(2))})}}catch(h){l.e(h)}finally{l.f()}return i}},{key:"getRecords",value:function(e,t,s,r,a,n,i,o){if(e in this._sampleGroupedData){if("fractional_cn"===t){var l=this._updateFractionalCopyNumbers(o,e,this._sampleGroupedData[e],this._cluster_filters);return this.filterRecordsByScales(l,t,s,r,a,n,i,o)}return this.filterRecordsByScales(this._sampleGroupedData[e],t,s,r,a,n,i,o)}return[]}},{key:"filterRecordsByScales",value:function(e,t,s,r,a,n,i,o){return s&&r&&a&&n?e.filter((function(e){return e.genomicPosition>s&&e.genomicPosition<r&&e.reverseBAF>a[0]&&e.reverseBAF<a[1]&&e[t]>n[0]&&e[t]<n[1]})):s&&r&&a?e.filter((function(e){return e.genomicPosition>s&&e.genomicPosition<r&&e.reverseBAF>a[0]&&e.reverseBAF<a[1]})):s&&r&&n?e.filter((function(e){return e.genomicPosition>s&&e.genomicPosition<r&&e[t]>n[0]&&e[t]<n[1]})):a&&n?e.filter((function(e){return e.reverseBAF>a[0]&&e.reverseBAF<a[1]&&e[t]>n[0]&&e[t]<n[1]})):a?e.filter((function(e){return e.reverseBAF>a[0]&&e.reverseBAF<a[1]})):n?e.filter((function(e){return e[t]>n[0]&&e[t]<n[1]})):e}},{key:"getAllRecords",value:function(){return this.allRecords}},{key:"getClusterTableInfo",value:function(){return this.clusterTableInfo}},{key:"getClusterTableInfo2",value:function(){return this.clusterTableInfo2}},{key:"getClusterTableInfo3",value:function(){return this.clusterTableInfo3}},{key:"getFilteredClusters",value:function(){return this._cluster_filters}},{key:"getFilteredFromClusters",value:function(){return this._cluster_filters_from}},{key:"getFilteredToClusters",value:function(){return this._cluster_filters_to}},{key:"setbrushedBins",value:function(e){this.brushedBins=[],this.brushedBins=e,this.brushedCrossfilter.remove(),this.brushedCrossfilter=Object(_.a)(e),this.brushedClusterDim=this.brushedCrossfilter.dimension((function(e){return e.CLUSTER}))}},{key:"getBrushedBins",value:function(){return this.brushedBins}},{key:"getClusterDim",value:function(){return console.log("cluster dimensions:",this._cluster_dim),this._cluster_dim}},{key:"calculateCopyNumbers",value:function(){for(var e=0;e<this.allRecords.length;e++){var t=this.allRecords[e].SAMPLE,s=this.sampleToPloidy[t],r=this.rdMeans[t],a=this.allRecords[e].RD;this.allRecords[e].fractional_cn=a*s/r}for(var n=0;n<this.allRecords.length;n++){for(var i=this.allRecords[n],o=i.SAMPLE,l=this.sampleToFractionalTicks[o],c=this.sampleToBafTicks[o],h=i.reverseBAF,u=i.fractional_cn,d=[],p=1/0,f=[-1,-1],b=Number.MAX_VALUE,g=Number.MAX_VALUE,v=0;v<c.length;v++){var m=c[v],y=m.state,S=m.tick,C=l[y[0]+y[1]];d.push([S,C]);var j=Math.pow(h-S,2)+Math.pow(u-C,2);if(j<p)p=j,f=y,g=S,b=C*this.rdMeans[i.SAMPLE]/this.sampleToPloidy[i.SAMPLE]}this.allRecords[n].CN_bin="("+f[0]+","+f[1]+")",this.allRecords[n].CN_bin_rdr=b,this.allRecords[n].CN_bin_baf=g}}},{key:"calculateCopyNumbers_Cluster",value:function(){console.log("calculateCopyNumbers_Cluster()");var e,t=this.getCentroidData(),s=Object(b.a)(this._samples);try{for(s.s();!(e=s.n()).done;){var r=e.value;console.log("sample",r);for(var a=0,n=Array.from(t);a<n.length;a++){for(var i=n[a],o=i.key,l=i.sample,c=String(l[r].substring(1).slice(0,-1)).split(","),h=c.pop(),u=c.pop(),d=this.sampleToFractionalTicks[r],p=this.sampleToBafTicks[r],f=Number(u),g=Number(h),v=[],m=1/0,y=[-1,-1],S=Number.MAX_VALUE,C=Number.MAX_VALUE,j=0;j<p.length;j++){var A=p[j],x=A.state,_=Number(A.tick),O=x[0]+x[1],w=Number(d[O]);v.push([_,w]);var k=Math.pow(f-_,2)+Math.pow(g-w,2);if(k<m)m=k,y=x,C=_,S=w*this.rdMeans[r]/this.sampleToPloidy[r]}for(var T=0;T<this.allRecords.length;T++)this.allRecords[T].SAMPLE==r&&this.allRecords[T].CLUSTER==Number(o)&&(this.allRecords[T].CN_cluster="("+y[0]+","+y[1]+")",this.allRecords[T].CN_cluster_rdr=S,this.allRecords[T].CN_cluster_baf=C);console.log("("+y[0]+","+y[1]+")",S,C)}}}catch(D){s.e(D)}finally{s.f()}}},{key:"mergeBinsAll",value:function(e,t,s){console.log("inside mergeBins()... with",t,s);var r=new Map,a=this.allRecords,n=this.centroidPts[e];this.getCentroidPoints(e);for(var i=0,o=Array.from(this._clusters.values());i<o.length;i++){var l=o[i];if(String(l)in n){for(var c=n[String(l)][0],h=c.point[0],u=c.point[1],d=Number.MAX_VALUE,p=-2,f=(Number.MAX_VALUE,Number.MAX_VALUE,0),g=Array.from(this._clusters.values());f<g.length;f++){var v=g[f];if(v!=l&&String(v)in n){var m=n[String(v)][0],S=m.point[0],C=m.point[1],j=Number.MAX_VALUE,A=Number.MAX_VALUE,x=Math.sqrt(Math.pow(h-S,2)+Math.pow(u-C,2));if(x<d)for(var _=0;_<this.getSampleList().length;_++){var O=String(this.getSampleList()[_]);j=Number(t.get(O)),A=Number(s.get(O)),Math.abs(h-S)<=j&&Math.abs(u-C)<=A?(p=Number(v),d=x,Math.abs(h-S),Math.abs(u-C),console.log("Closest Centroid Updated.",String(v))):console.log("Not within threshold.")}}}-2!=p&&r.set(String(p),String(l))}}y.a.groupBy(a,"CLUSTER");console.log("Building sets of clusters",r);for(var w=new Map,k=0,T=Array.from(r.keys());k<T.length;k++){for(var D=T[k],B=D,R=r.get(D),P=0,N=0,L=Array.from(w.keys());N<L.length;N++){var M=L[N];(w.get(M).has(B)||w.get(M).has(R))&&(P=M)}if(w.has(P))w.get(P).add(B),w.get(P).add(R);else{var E=new Set;E.add(B),E.add(R),w.set(P,E)}}for(var F=new Map,I=this.getClusterTableInfo(),U=0,z=Array.from(w.keys());U<z.length;U++){var Y=z[U],G=w.get(Y),K="",H=Number.MIN_VALUE;console.log("groupID",Y);var X,Q=Object(b.a)(I);try{for(Q.s();!(X=Q.n()).done;){var Z=X.value;if(G.has(String(Z.key))){var V=Z.value;V>H&&(H=V,K=String(Z.key))}}}catch(J){Q.e(J)}finally{Q.f()}console.log("Max Cluster",K,H),F.set(K,w.get(Y)),console.log(F.get(K))}return F}},{key:"mergeBins",value:function(e,t,s){console.log("inside mergeBins()... with",t,s);var r=new Map,a=this.allRecords,n=this.centroidPts[e];this.getCentroidPoints(e);for(var i=0,o=Array.from(this._clusters.values());i<o.length;i++){var l=o[i];if(String(l)in n){for(var c=n[String(l)][0],h=c.point[0],u=c.point[1],d=Number.MAX_VALUE,p=-2,f=(Number.MAX_VALUE,Number.MAX_VALUE,0),g=Array.from(this._clusters.values());f<g.length;f++){var v=g[f];if(v!=l&&String(v)in n){var m=n[String(v)][0],S=m.point[0],C=m.point[1],j=Math.sqrt(Math.pow(h-S,2)+Math.pow(u-C,2));j<d&&(Math.abs(h-S)<=t&&Math.abs(u-C)<=s?(p=Number(v),d=j,Math.abs(h-S),Math.abs(u-C),console.log("Closest Centroid Updated.",String(v))):console.log("Not within threshold."))}}-2!=p&&r.set(String(p),String(l))}}y.a.groupBy(a,"CLUSTER");console.log("Building sets of clusters",r);for(var A=new Map,x=0,_=Array.from(r.keys());x<_.length;x++){for(var O=_[x],w=O,k=r.get(O),T=0,D=0,B=Array.from(A.keys());D<B.length;D++){var R=B[D];(A.get(R).has(w)||A.get(R).has(k))&&(T=R)}if(A.has(T))A.get(T).add(w),A.get(T).add(k);else{var P=new Set;P.add(w),P.add(k),A.set(T,P)}}for(var N=new Map,L=this.getClusterTableInfo(),M=0,E=Array.from(A.keys());M<E.length;M++){var F=E[M],I=A.get(F),U="",z=Number.MIN_VALUE;console.log("groupID",F);var Y,G=Object(b.a)(L);try{for(G.s();!(Y=G.n()).done;){var K=Y.value;if(I.has(String(K.key))){var H=K.value;H>z&&(z=H,U=String(K.key))}}}catch(X){G.e(X)}finally{G.f()}console.log("Max Cluster",U,z),N.set(U,A.get(F)),console.log(N.get(U))}return N}},{key:"assignMerge",value:function(e,t){for(var s=y.a.groupBy(this.allRecords,"CLUSTER"),r=0,a=Array.from(t.keys());r<a.length;r++)for(var n=a[r],i=0,o=Array.from(t.get(n));i<o.length;i++){var l=o[i],c=y.a.groupBy(s[String(l)],"SAMPLE")[String(e)];this.setbrushedBins(c),console.log("Reassigning",n,"to",l),this.updateCluster(Number(n)),console.log("Pushing mergeBins() operation to history stack."),this.historyStack.push(JSON.parse(JSON.stringify(c)))}}},{key:"absorbBins",value:function(e,t,s,r){new Set(this._cluster_filters_from);var a=new Set(this._cluster_filters_to);console.log("inside absorbBins()..."),console.log("_cluster_filters_from",this._cluster_filters_from),console.log("_cluster_filters_to",this._cluster_filters_to);for(var n=new Map,i=0,o=Array.from(this._cluster_filters_from);i<o.length;i++)for(var l=o[i],c=this.allRecords,h=y.a.groupBy(c,"CLUSTER"),u=0,d=Object.entries(h);u<d.length;u++){var p=Object(A.a)(d[u],2),f=p[0],b=p[1],g=(y.a.groupBy(b,"SAMPLE"),y.a.groupBy(b,"genomicPosition"));if(f===l)for(var v=0,m=Object.entries(g);v<m.length;v++){for(var S=Object(A.a)(m[v],2),C=(S[0],S[1]),j=Number.MAX_VALUE,x=-2,_=Number.MAX_VALUE,O=Number.MAX_VALUE,w=y.a.groupBy(C,"SAMPLE"),k=0,T=Object.entries(w);k<T.length;k++)for(var D=Object(A.a)(T[k],2),B=D[0],R=D[1],P=R[0].reverseBAF,N=R[0].fractional_cn,L=this.centroidPts[B],M=0,E=Array.from(a.values());M<E.length;M++){var F=E[M],I=L[String(F)][0],U=I.point[0],z=I.point[1];!1;var Y=Math.sqrt(Math.pow(U-P,2)+Math.pow(z-N,2));Y<j&&(x=Number(F),j=Y,_=Math.abs(U-P),O=Math.abs(z-N))}for(var G=!0,K=0,H=Object.entries(w);K<H.length;K++){var X=Object(A.a)(H[K],2),Q=X[0],Z=(X[1],s[Q]),V=r[Q];(_>Z||O>V)&&(G=G&&!1)}if(-2!=x&&G)for(var J=0,W=Object.entries(w);J<W.length;J++){var q=Object(A.a)(W[J],2),$=(q[0],q[1]);if(n.has(String(x))){var ee=n.get(String(x));void 0!=ee?(ee.push($[0]),n.set(String(x),ee)):console.log("Arr is undefined??")}else{var te=[$[0]];n.set(String(x),te)}}}}return n}},{key:"assignAbsorb",value:function(e){this.allRecords;for(var t=0,s=Array.from(e.keys());t<s.length;t++){var r=s[t],a=e.get(r);this.setbrushedBins(a),this.updateCluster_nolog(Number(r))}}},{key:"_getData",value:function(e,t,s,r){return(e[t][r]||{})[s]||[]}}]),e}();J.ALL_CHRS_KEY="",J.ALL_CLUSTERS_KEY="";var W=s(75),q=(s(280),s(2)),$=70,ee=20,te=35,se=60,re="#999999",ae="rgba(232, 232, 232, 1)",ne="-1",ie="-2",oe="scatterplot-scale",le="circles",ce=0,he=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r._circleIdPrefix=void 0,r._clusters=void 0,r.brushedNodes=void 0,r.previous_brushed_nodes=void 0,r._canvas=void 0,r._currXScale=void 0,r._currYScale=void 0,r._original_XScale=void 0,r._original_YScale=void 0,r._original_transform=void 0,r._current_transform=void 0,r.scatter=void 0,r.zoom=void 0,r.onBrushedBinsUpdated=function(e){r.props.onBrushedBinsUpdated(e)},r._svg=null,r._canvas=null,r.scatter=null,r._circleIdPrefix=ce,ce++,r.computeScales=Object(O.a)(r.computeScales),r.handleMouseMove=r.handleMouseMove.bind(Object(d.a)(r)),r.onBrushedBinsUpdated=r.onBrushedBinsUpdated.bind(Object(d.a)(r)),r._clusters=r.initializeListOfClusters(),r.brushedNodes=new Set,r.previous_brushed_nodes=new Set,r.onZoom=r.onZoom.bind(Object(d.a)(r)),r.resetZoom=r.resetZoom.bind(Object(d.a)(r)),r.zoom=null;var a=r.computeScales(r.props.rdRange,e.width,e.height),n=a.bafScale,i=a.rdrScale;r._currXScale=n,r._currYScale=i,r._original_XScale=r._currXScale,r._original_YScale=r._currYScale;var o=e.data;return r._original_transform=w.o.translate(0,0).scale(1),r._current_transform=r._original_transform,r.state={selectedCluster:r._clusters.length>0?r._clusters[0]:ne,quadTree:w.g().x((function(e){return e.reverseBAF})).y((function(t){return t[e.yAxisToPlot]})).addAll(o)},r}return Object(u.a)(s,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;e.sort((function(e,t){return e.key>t.key?1:e.key<t.key?-1:0})),this._clusters=[];var t,s=Object(b.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(a){s.e(a)}finally{s.f()}for(;this._clusters.length>0&&(this._clusters[0]===ne||this._clusters[0]===ie);)this._clusters.shift();return this._clusters}},{key:"handleMouseMove",value:function(e){var t=k(e),s=t.x,r=t.y,a={rd:this._currYScale.invert(r),baf:this._currXScale.invert(s)};if(a.baf>this._currXScale.domain()[0]&&a.baf<this._currXScale.domain()[1]&&a.rd>this._currYScale.domain()[0]&&a.rd<this._currYScale.domain()[1]){var n=Math.abs(this._currXScale.invert(s)-this._currXScale.invert(s-20));this.props.onRecordsHovered(this.state.quadTree.find(a.baf,a.rd,n)||null)}else this.props.onRecordsHovered(null)}},{key:"renderTooltipAtRdBaf",value:function(e,t,s){if(!s)return null;var r=this._currYScale(e)||0,a=(this._currXScale(t)||0)+10;return Object(q.jsx)("div",{className:"Scatterplot-tooltip",style:{position:"absolute",top:r-150,left:a,width:275,height:150,pointerEvents:"none"},children:s})}},{key:"renderTooltip",value:function(){var e=this.props,t=e.data,s=e.hoveredLocation,r=e.yAxisToPlot;if(!s)return null;var n=[];if(0===(n=t.filter((function(e){var t=x.toChromosomeInterval(e);return s.chr===t.chr&&s.start===t.start&&s.end===t.end}))).length&&(n=t.filter((function(e){return x.toChromosomeInterval(e).hasOverlap(s)}))),n[0]){var i=this._currXScale(n[0].reverseBAF),o=this._currYScale(n[0][r]),l=this._currXScale.range(),c=this._currYScale.range(),h="RDR: ";if("fractional_cn"===r?h="Fractional CN: ":"logRD"===r&&(h="Log RDR: "),1===n.length&&i&&o&&i>l[0]&&i<l[1]&&o<c[0]&&o>c[1]){var u=n[0],d=x.toChromosomeInterval(u);return this.renderTooltipAtRdBaf(u[r],u.reverseBAF,Object(q.jsxs)(a.a.Fragment,{children:[Object(q.jsxs)("p",{children:[Object(q.jsx)("b",{children:d.toString()}),Object(q.jsx)("br",{}),"(",T(d.getLength()),")"]}),Object(q.jsxs)("div",{children:[" ",h+u[r].toFixed(2)]}),Object(q.jsxs)("div",{children:[" 0.5 - BAF: ",u.reverseBAF.toFixed(2)]}),Object(q.jsxs)("div",{children:[" Cluster ID: ",u.CLUSTER]})]}))}}return null}},{key:"render",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=this._clusters.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}));return a.unshift(Object(q.jsx)("option",{value:ne,children:ne},ne)),a.unshift(Object(q.jsx)("option",{value:ie,children:ie},ie)),Object(q.jsxs)("div",{ref:function(t){return e.scatter=t},className:"Scatterplot",style:{width:s,height:r},children:[Object(q.jsx)("canvas",{ref:function(t){return e._canvas=t},width:s,height:r,className:"canvas",style:{position:"absolute",top:te,zIndex:-4,left:$,width:s-$-ee,height:r-te-se}}),Object(q.jsx)("svg",{ref:function(t){return e._svg=t},style:{zIndex:100},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+s+" "+r,onMouseMove:this.handleMouseMove}),Object(q.jsx)("div",{className:"Scatterplot-tools",children:Object(q.jsx)("button",{className:"custom-button",onClick:this.resetZoom,children:"Reset View"})}),this.renderTooltip()]})}},{key:"resetZoom",value:function(){if(this._svg){this._currXScale=this._original_XScale,this._currYScale=this._original_YScale;this.props.onZoom({xScale:null,yScale:null}),this.redraw()}}},{key:"componentDidMount",value:function(){this.redraw(),this.forceHover(this.props.hoveredLocation)}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidUpdate",value:function(e){var t=this,s=this.props.scales.xScale,r=this.props.scales.yScale,a=e.scales.xScale,n=e.scales.yScale;function i(e,t){return!(!e||t)||!(!e||!t||e[0]===t[0]&&e[1]===t[1])}function o(e,t){return!(!e||t)||!!(e&&t&&(Math.abs(e[0]-t[0])>1e-4||Math.abs(e[1]-t[1])>1e-4))}if(!s&&!r&&a&&n)this.resetZoom();else if(i(s,a)||i(r,n)){s&&this._currXScale.domain(s),r&&this._currYScale.domain(r);var l=this.props.data,c=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(l);this.setState({quadTree:c}),this.redraw()}if(this.props.hoveredLocation!==e.hoveredLocation)this.forceUnhover(),this.forceHover(this.props.hoveredLocation);else if(this.propsDidChange(e,["purity","ploidy","offset"])){var h=this.props.data,u=this.computeScales(this.props.rdRange,this.props.width,this.props.height).rdrScale;this._currYScale=u,this._original_YScale=u;var d=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(h);this.setState({quadTree:d}),this.redraw()}else if(this.propsDidChange(e,["showCentroids","displayMode","colors","brushedBins","width","height","customColor","pointsize","showTetraploid"])){var p=this.props.data,f=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(p);this.setState({quadTree:f}),this.redraw(),this.forceHover(this.props.hoveredLocation)}else if(!y.a.isEqual(this.props.data,e.data)||this.props.yAxisToPlot!==e.yAxisToPlot){var b=this.computeScales(this.props.rdRange,this.props.width,this.props.height),g=b.bafScale,v=b.rdrScale;if(o(this._currXScale.domain(),this._original_XScale.domain())||o(this._currYScale.domain(),this._original_YScale.domain())){if(this.props.yAxisToPlot!==e.yAxisToPlot){var m=this._currYScale.domain();if("logRD"===this.props.yAxisToPlot){m[0]<=0&&(m[0]=.1),m[1]<=0&&(m[1]=.1);var S=[Math.log2(m[0]),Math.log2(m[1])];this._currYScale.domain(S).range(this._currYScale.range())}else if("fractional_cn"===this.props.yAxisToPlot){var C=[m[0]*this.props.ploidy/this.props.meanRD,m[1]*this.props.ploidy/this.props.meanRD];this._currYScale.domain(C).range(this._currYScale.range())}else if("logRD"===e.yAxisToPlot){var j=[Math.pow(2,m[0]),Math.pow(2,m[1])];this._currYScale.domain(j).range(this._currYScale.range())}else if("fractional_cn"===e.yAxisToPlot){var A=[m[0]*this.props.meanRD/this.props.ploidy,m[1]*this.props.meanRD/this.props.ploidy];this._currYScale.domain(A).range(this._currYScale.range())}}this._original_XScale=g,this._original_YScale=v}else this._currXScale=g,this._currYScale=v,this._original_XScale=this._currXScale,this._original_YScale=this._currYScale;var x=this.props.data,_=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(x);this.setState({quadTree:_});var O={xScale:this._currXScale.domain(),yScale:this._currYScale.domain()};this.props.onZoom(O),this.redraw(),this.forceHover(this.props.hoveredLocation)}this.props.clusterTableData!==e.clusterTableData&&this.initializeListOfClusters()}},{key:"computeScales",value:function(e,t,s,r,a){var n=[$,t-ee],i=[s-se,te],o=a?e[0]:this.props.applyLog?-2:0;this.props.showPurityPloidy&&(o=e[0]);var l=r||[-.01,.51];return{bafScale:w.i().domain(l).range(n),rdrScale:w.i().domain([o,e[1]]).range(i)}}},{key:"onZoom",value:function(e){this.props.onZoom(e)}},{key:"redraw",value:function(){var e=this;if(this._svg&&this._canvas&&this.scatter){var t=this,s=this.props,r=s.width,a=s.height,n=s.customColor,i=(s.pointsize,s.brushedBins),o=s.data,l=s.colors,c=s.yAxisToPlot,h=s.centroidPts,u=s.showPurityPloidy,d=s.showTetraploid,p=this.props.displayMode,f=this._currXScale,g=this._currYScale,v="RD"===c?"RDR":"fractional_cn"===c?"Copy Number":"log RDR",m=w.j(this._svg);m.selectAll(".scatterplot-scale").remove(),m.append("text").classed(oe,!0).attr("text-anchor","middle").attr("x",y.a.mean(this._currXScale.range())).attr("y",a-se+40).style("text-anchor","middle").text("Allelic Imbalance (0.5 - BAF)"),m.append("text").classed(oe,!0).attr("y",20).attr("x",0-y.a.mean(this._currYScale.range())).attr("transform","rotate(-90)").style("text-anchor","middle").text(v);var S=function(e,t){return e.classed(oe,!0).attr("transform","translate(0, ".concat(a-se,")")).call(w.a(t)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-30)")},C=[];if(u){var A=this._currXScale.domain();if(d)C=this.props.BAF_lines;else{var _,O=[],k=Object(b.a)(this.props.BAF_lines);try{for(k.s();!(_=k.n()).done;){var T=_.value;T.state[0]+T.state[1]<4&&O.push(T)}}catch(xe){k.e(xe)}finally{k.f()}C=O}var D=C.filter((function(e){return e.tick>A[0]&&e.tick<A[1]})),R=D.map((function(e){return e.tick})),P=[],N=[];R.length>0&&(P.push(R[0]),N.push(D[0]));for(var L=1;L<R.length;L++){var M=f(P[P.length-1])||0;(f(R[L])||0)-M>12&&(P.push(R[L]),N.push(D[L]))}S=function(e,t){return e.classed(oe,!0).attr("id","Grid").attr("transform","translate(0, ".concat(a-se,")")).call(w.a(t).tickValues(P).tickSizeInner(-a+te+se).tickFormat((function(e,t){return N[t].state[0]!=N[t].state[1]?P[t].toFixed(2)+" ("+N[t].state[0]+","+N[t].state[1]+")":P[t].toFixed(2)+" (x,x)"}))).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-30)")}}var E=function(e,t){return e.classed(oe,!0).attr("id","Grid").attr("transform","translate(".concat($,", 0)")).call(w.b(t))};if(u){var F=this.props.fractionalCNTicks,I=this._currYScale.domain(),U=this.props.max_cn,z=U>I[1]?U:I[1],Y=F.filter((function(e){return e.fractionalTick>I[0]&&e.fractionalTick<z&&e.fractionalTick<I[1]})),G=Y.map((function(e){return e.fractionalTick})),K=[],H=[];Y.length>0&&(K.push(G[0]),H.push(Y[0]));for(var X=1;X<G.length;X++){console.log(G[X]),(g(K[K.length-1])||0)-(g(G[X])||0)>10&&(K.push(G[X]),H.push(Y[X]))}E=function(e,t){return e.classed(oe,!0).attr("id","Grid").attr("transform","translate(".concat($,", 0)")).call(w.b(t).tickValues(K).tickSizeInner(80-r).tickFormat((function(e,t){return H[t].totalCN+" ("+Number(e.valueOf()).toFixed(2)+")"})))}}var Q=[];i.forEach((function(e){return Q.push(x.toChromosomeInterval(e).toString())})),this.previous_brushed_nodes=new Set(Q);var Z=this.previous_brushed_nodes,V=m.append("g"),J=m.append("g"),q=w.o,ne=w.n().scaleExtent([0,100]),ie=w.n().scaleExtent([0,100]),le=function(){return w.p(V.node())},ce=function(){return w.p(J.node())};V.call(ne).attr("pointer-events","none"),J.call(ie).attr("pointer-events","none");var he=w.n().on("zoom",(function(){try{var e=w.f.transform,t=e.k/q.k,s=function(e){if(e.sourceEvent)return[e.sourceEvent.layerX,e.sourceEvent.layerY];return[r/2,a/2]}(w.f),n=s[0]>f.range()[0],i=s[1]<g.range()[0];p!==St.zoom&&n&&i&&p!==St.boxzoom||(1===t?(n&&ne&&t&&s&&V&&V.call(ne.translateBy,(e.x-q.x)/le().k,0),i&&ie&&t&&s&&J&&J.call(ie.translateBy,0,(e.y-q.y)/ce().k)):(n&&ne&&t&&s&&V&&V.call(ne.scaleBy,t,s),i&&ie&&t&&s&&J&&J.call(ie.scaleBy,t,s))),q=e,Ae()}catch(o){console.log("Error: ",o)}})).on("end",(function(){var e=t._currXScale.domain(),s=t._currYScale.domain(),r=t._original_XScale.domain(),a=t._original_YScale.domain();if(e[0]!==r[0]||e[1]!==r[1]||s[0]!==a[0]||s[1]!==a[1]){var n={xScale:t._currXScale.domain(),yScale:t._currYScale.domain()};t.props.onZoom(n)}})),ue=this._canvas.getContext("webgl");ue.clearColor(0,0,0,1);var de,pe=[],fe=Object(b.a)(o);try{for(fe.s();!(de=fe.n()).done;){var be=de.value;Z.has(x.toChromosomeInterval(be).toString())||pe.push(be)}}catch(xe){fe.e(xe)}finally{fe.f()}var ge,ve=Object(b.a)(o);try{for(ve.s();!(ge=ve.n()).done;){var me=ge.value;Z.has(x.toChromosomeInterval(me).toString())&&pe.push(me)}}catch(xe){ve.e(xe)}finally{ve.f()}var ye=W.webglFillColor().value((function(e){return B(function(e){if(Z.has(x.toChromosomeInterval(e).toString()))return n;if(-1===e.CLUSTER)return re;if(-2===e.CLUSTER)return ae;var t=e.CLUSTER%l.length;return l[t]}(e))})).data(pe),Se=W.seriesWebglPoint().xScale(t._currXScale).yScale(t._currYScale).crossValue((function(e){return e.reverseBAF})).mainValue((function(e){return e[c]})).context(ue).size(this.props.pointsize);if(Se.decorate((function(e){ye(e),ue.depthFunc(ue.NEVER),ue.disable(ue.DEPTH_TEST)})),m.append("clipPath").attr("id","clip").append("rect").attr("x",$).attr("y",te).attr("width",r-ee-$).attr("height",a-se-te),m.append("g").classed("eventrect",!0).append("rect").attr("x",$).attr("y",te).attr("width",r-ee-$).attr("height",a-se-te).style("fill","none").style("pointer-events","all").attr("clip-path","url(#clip)"),this._canvas.width=r,this._canvas.height=a,Ae(),p===St.select||p===St.erase){var Ce=w.c().keyModifiers(!1).extent([[$-2,te-2],[this.props.width-ee+2,this.props.height-se+2]]).on("end",(function(){e.updatePoints(w.f),m.selectAll(".brush").remove(),e.onBrushedBinsUpdated(Object(j.a)(e.brushedNodes))}));m.append("g").attr("class","brush").call(Ce)}else if(p===St.zoom)m.selectAll(".brush").remove();else if(p===St.boxzoom){var je=w.c().keyModifiers(!1).extent([[$-2,te-2],[this.props.width-ee+2,this.props.height-se+2]]).on("start brush",(function(){return e.updatePoints(w.f)})).on("end",(function(){m.selectAll(".brush").remove(),function(){if(!t._svg)return;if(t.props.data){var e=w.f.selection;if(e){var s=[Number(t._currYScale.invert(e[1][1])),Number(t._currYScale.invert(e[0][1]))],n=[Number(t._currXScale.invert(e[0][0])),Number(t._currXScale.invert(e[1][0]))],i=t.computeScales(s,r,a,n,!0),o=i.bafScale,l=i.rdrScale;t._currXScale=o,t._currYScale=l,t.redraw();var c={xScale:t._currXScale.domain(),yScale:t._currYScale.domain()};t.props.onZoom(c)}}}()}));m.append("g").attr("class","brush").call(je)}m.call(he).call(he.transform,w.o.scale(1))}function Ae(){ue.clear(ue.COLOR_BUFFER_BIT),ue.clearColor(255,255,255,1);var e=le().rescaleX(f),s=ce().rescaleY(g);V.call(S,e),J.call(E,s),t._currXScale=e,t._currYScale=s,t._canvas&&(Se.xScale(t._currXScale).yScale(t._currYScale),Se(pe)),m.select(".Centroids").remove(),t.props.showCentroids&&m.select(".eventrect").append("g").attr("clip-path","url(#clip)").classed("Centroids",!0).selectAll("path").data(h).enter().append("path").attr("class","point").attr("d",w.k().type(w.m)).attr("fill",(function(e){return function(e){if(-1===e)return re;if(-2===e)return ae;var t=e%l.length;return l[t]}(e.cluster)})).attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black").attr("transform",(function(e){return"translate("+t._currXScale(e.point[0])+","+t._currYScale(e.point[1])+")"}))}}},{key:"updatePoints",value:function(e){var t=this;if(this._svg){var s=this.props,r=s.brushedBins,a=s.data,n=s.yAxisToPlot,i=s.displayMode;if(a){var o=w.f.selection;if(o){var l=a.filter((function(e){return s=o,r=[t._currXScale(e.reverseBAF),t._currYScale(e[n])],s[0][0]<=r[0]&&r[0]<=s[1][0]&&s[0][1]<=r[1]&&r[1]<=s[1][1];var s,r}));if(l){if(console.log(l),i===St.select)l=y.a.uniqBy(y.a.union(l,r),(function(e){return e["#CHR"]+"_"+e.START}));else if(i===St.erase){for(var c=new Set,h=0;h<l.length;h++)c.add((l[h]["#CHR"],l[h].START,l[h].END,l[h].genomicPosition));l=r.filter((function(e){return function(e,t){var s=(e["#CHR"],e.START,e.END,e.genomicPosition);return!t.has(s)}(e,c)}))}this.brushedNodes=new Set(l)}}else this.brushedNodes=new Set([])}}}},{key:"getElementsForGenomeLocation",value:function(e){var t=this;if(!this._svg||!e||!this._canvas)return[];var s=this.props,r=s.data,a=s.yAxisToPlot,n=[];n=r.filter((function(t){var s=x.toChromosomeInterval(t);return e.chr===s.chr&&e.start===s.start&&e.end===s.end}));var i=this._currXScale.range(),o=this._currYScale.range();0===n.length&&(n=(n=r.filter((function(t){return x.toChromosomeInterval(t).hasOverlap(e)}))).filter((function(e){var s=t._currXScale(e.reverseBAF),r=t._currYScale(e[a]);return s&&r&&s>i[0]&&s<i[1]&&r<o[0]&&r>o[1]})));var l=w.j(this._svg);l.select(".circles").remove(),l.select(".eventrect").append("g").classed(le,!0).selectAll("circle").data(n).enter().append("circle").attr("id",(function(e){return t._circleIdPrefix+x.toChromosomeInterval(e).toString()})).attr("cx",(function(e){return t._currXScale(e.reverseBAF)||0})).attr("cy",(function(e){return t._currYScale(e[a])||0})).attr("r",3).attr("fill",(function(e){if(t.previous_brushed_nodes.has(x.toChromosomeInterval(e).toString()))return t.props.customColor;if(-1===e.CLUSTER)return re;if(-2===e.CLUSTER)return ae;var s=e.CLUSTER%t.props.colors.length;return t.props.colors[s]})).attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black")}},{key:"forceHover",value:function(e){this.getElementsForGenomeLocation(e)}},{key:"forceUnhover",value:function(){this._svg&&w.j(this._svg).select(".circles").remove()}}]),s}(a.a.Component);he.defaultProps={width:400,height:302,onNewCurveState:y.a.noop,onRecordHovered:y.a.noop};var ue=s(229),de=(s(282),["onMouseMove","onMouseLeave","style","children"]),pe=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).state={mouseCoordinates:null},r.storeMouseCoordinates=r.storeMouseCoordinates.bind(Object(d.a)(r)),r.clearMouseCoordinates=r.clearMouseCoordinates.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"storeMouseCoordinates",value:function(e){this.setState({mouseCoordinates:k(e)}),this.props.onMouseMove&&this.props.onMouseMove(e)}},{key:"clearMouseCoordinates",value:function(e){this.setState({mouseCoordinates:null}),this.props.onMouseLeave&&this.props.onMouseLeave(e)}},{key:"render",value:function(){var e=this.props,t=(e.onMouseMove,e.onMouseLeave,e.style),s=e.children,r=Object(ue.a)(e,de),a=Object.assign({position:"relative"},t);return Object(q.jsxs)("div",Object(o.a)(Object(o.a)({onMouseMove:this.storeMouseCoordinates,onMouseLeave:this.clearMouseCoordinates,style:a},r),{},{children:[s,this.state.mouseCoordinates&&Object(q.jsx)(fe,{where:this.state.mouseCoordinates})]}))}}]),s}(a.a.Component);function fe(e){var t=e.where,s=t.x,r={top:t.y-1,willChange:"top"},n={left:s-1,willChange:"left"};return Object(q.jsxs)(a.a.Fragment,{children:[Object(q.jsx)("div",{className:"Bullseye-horizontal-line",style:r}),Object(q.jsx)("div",{className:"Bullseye-vertical-line",style:n})]})}s(135);var be=s(108),ge=s.n(be),ve=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).handleCallBack=function(e){r.props.parentCallBack(e)},r.state={selectedSample:e.initialSelectedSample},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(d.a)(r)),r.handleRecordsHovered=r.handleRecordsHovered.bind(Object(d.a)(r)),r.handleCallBack=r.handleCallBack.bind(Object(d.a)(r)),r.handleUpdatedBrushedBins=r.handleUpdatedBrushedBins.bind(Object(d.a)(r)),r.onRemovePlot=r.onRemovePlot.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e.target.value}),this.props.onSelectedSample(e.target.value)}},{key:"handleRecordsHovered",value:function(e){var t=e?x.toChromosomeInterval(e):null;this.props.onLocationHovered(t)}},{key:"handleUpdatedBrushedBins",value:function(e){this.props.onBrushedBinsUpdated(e)}},{key:"onRemovePlot",value:function(){this.props.onRemovePlot(this.props.plotId)}},{key:"render",value:function(){var e=this.props,t=e.data,s=e.width,r=e.height,a=e.pointsize,n=e.hoveredLocation,i=e.invertAxis,o=e.customColor,l=e.brushedBins,c=e.updatedBins,h=e.dispMode,u=e.onZoom,d=e.rdRange,p=e.clusterTableData,f=e.applyLog,b=e.scales,g=e.centroidPts,v=e.showCentroids,m=e.purity,y=e.ploidy,S=e.offset,C=e.meanRD,j=e.fractionalCNTicks,A=e.showPurityPloidy,x=e.showTetraploid,_=e.BAF_lines,O=e.max_cn,w=ge()({"is-pan":h===St.zoom,"is-zoom":h===St.boxzoom,"is-select":h===St.select,"is-erase":h===St.erase});return Object(q.jsx)("div",{className:"SampleViz-scatter",children:Object(q.jsx)(pe,{className:w,children:Object(q.jsx)(he,{pointsize:a,parentCallBack:this.handleCallBack,data:t,rdRange:d,width:s,height:r,hoveredLocation:n,onRecordsHovered:this.handleRecordsHovered,invertAxis:i||!1,customColor:o,colors:this.props.colors,col:this.props.colors[0],onBrushedBinsUpdated:this.handleUpdatedBrushedBins,brushedBins:l,updatedBins:c,displayMode:h,onZoom:u,clusterTableData:p,applyLog:f,yAxisToPlot:f?"logRD":A?"fractional_cn":"RD",onClusterSelected:this.props.onClusterSelected,scales:b,centroidPts:g,showCentroids:v,purity:m,ploidy:y,offset:S,meanRD:C,fractionalCNTicks:j,showPurityPloidy:A,showTetraploid:x,BAF_lines:_,max_cn:O})})})}}]),s}(a.a.Component);ve.defaultProps={onLocationHovered:y.a.noop,invertAxis:!1,customColor:"#1b9e77"};s(283);var me="linearplot-scale",ye="#999999",Se="rgba(232, 232, 232, 1)",Ce=50,je=10,Ae=10,xe=35;function _e(e){return e?Ce+20:Ce}var Oe=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r._canvas=void 0,r._clusters=void 0,r.brushedNodes=void 0,r._currXScale=void 0,r._currYScale=void 0,r._original_XScale=void 0,r._original_YScale=void 0,r.previewDriver=void 0,r.lockedDrivers=void 0,r._svg=null,r._canvas=null,r.getXScale=Object(O.a)(r.getXScale),r.handleMouseMove=r.handleMouseMove.bind(Object(d.a)(r)),r.handleMouseLeave=r.handleMouseLeave.bind(Object(d.a)(r)),r._clusters=r.initializeListOfClusters(),r.brushedNodes=new Set,r._currXScale=r.getXScale(e.width,e.genome,e.chr,r.props.implicitStart,r.props.implicitEnd,r.props.showPurityPloidy),r._currYScale=w.i().domain([r.props.yMin,r.props.yMax]).range([r.props.height-xe,Ae]),r._original_XScale=r._currXScale,r._original_YScale=r._currYScale,r.previewDriver=null,r.lockedDrivers=new Set,r}return Object(u.a)(s,[{key:"initializeListOfClusters",value:function(){var e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),t=Object(j.a)(new Set(this.props.data.map((function(e){return String(e.CLUSTER)})))).sort(e.compare);return"-2"===t[0]&&t.shift(),"-1"===t[0]&&t.shift(),t}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidUpdate",value:function(e){null!==this.props.driverGeneUpdate.gene&&this.props.driverGeneUpdate.destination===this.props.dataKeyToPlot&&(this.lockedDrivers.has(this.props.driverGeneUpdate.gene)?this.lockedDrivers.delete(this.props.driverGeneUpdate.gene):this.lockedDrivers.add(this.props.driverGeneUpdate.gene),this.props.handleDriverGenesChange({gene:null,destination:null})),this.propsDidChange(e,["chr"])?"RD"===this.props.dataKeyToPlot||"logRD"===this.props.dataKeyToPlot||"fractional_cn"===this.props.dataKeyToPlot?this.props.onLinearPlotZoom(null,null,!0):this.props.onLinearPlotZoom(null,null,!1):this.propsDidChange(e,["driverGenes","displayMode","implicitEnd","implicitStart","yMin","yMax","colors","brushedBins","width","height","chr","purity","ploidy","pointsize","showTetraploid"])?(0===this.props.brushedBins.length&&(this._clusters=this.initializeListOfClusters()),this.redraw()):y.a.isEqual(this.props.data,e.data)&&this.props.dataKeyToPlot===e.dataKeyToPlot||this.redraw()}},{key:"getXScale",value:function(e,t,s,r,a,n){var i=[0,0];return null!=r&&null!=a?(i[0]=r,i[1]=a):s?(i[0]=t.getChrStartMap()[s],i[1]=i[0]+t.getLength(s)):i[1]=t.getLength(),w.i().domain(i).range([_e(this.props.showPurityPloidy),e-je])}},{key:"getScaledYScale",value:function(e,t){return w.i().domain([2*(1-t),10*t+2*(1-t)]).range([e-xe,Ae])}},{key:"createNewBrush",value:function(){var e=w.j(this._svg),t=w.c().keyModifiers(!0).extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width-je,this.props.height-xe]]).on("end",(function(){e.selectAll(".brush").remove()}));e.append("g").attr("class","brush").call(t)}},{key:"filterFractionalCNTicks",value:function(e,t){return e.filter((function(e,s){return e>t[0]&&e<t[1]}))}},{key:"redraw",value:function(){var e=this;if(this._svg){var t,s=this,r=this.props,a=r.data,n=r.width,i=r.height,o=r.genome,l=r.chr,c=r.dataKeyToPlot,h=r.yMin,u=r.yMax,d=r.yLabel,p=r.customColor,f=r.brushedBins,g=r.colors,v=r.displayMode,m=r.driverGenes,S=this.getXScale(n,o,l,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),C=w.i().domain([h,u]).range([i-xe,Ae]),A=o.getChromosomeList(),_=[],O=o.getChrStartMap(),k=Object(b.a)(A);try{for(k.s();!(t=k.n()).done;){var D=t.value,R=O[D.name];R>=S.domain()[0]&&R<=S.domain()[1]&&_.push(D)}}catch(Re){k.e(Re)}finally{k.f()}var P=this.props.showPurityPloidy?10:0,N=w.j(this._svg);N.selectAll(".linearplot-scale").remove(),N.append("text").classed(me,!0).attr("text-anchor","middle").attr("font-size",11).attr("x",y.a.mean(S.range())).attr("y",i-xe+30).text(l||o.getName()),N.append("text").classed(me,!0).attr("transform","rotate(-90, ".concat(_e(this.props.showPurityPloidy),", ").concat(y.a.mean(C.range()),")")).text(d||c).attr("x",(i-xe-Ae)/2-1+P).attr("y",this.props.showPurityPloidy?10:_e(this.props.showPurityPloidy)/2+5).attr("text-anchor","middle");var L=o.getChromosomeStarts2(_),M=[],E=[];M.push(L[0]),E.push(_[0]);for(var F=1;F<L.length;F++){var I=S(M[M.length-1])||0;(S(L[F])||0)-I>8&&(M.push(L[F]),E.push(_[F]))}var U=function(e,t){return e.classed(me,!0).attr("transform","translate(0, ".concat(i-xe,")")).call(w.a(t).tickValues(M).tickFormat((function(e,t){return function(e){var t=String(e).match(/\d+/);return t?t[0]:e}(E[t].name)})))},z=function(e,t){return e.classed(me,!0).attr("transform","translate(0, ".concat(i-xe,")")).call(w.a(t).tickFormat((function(e){return T(Number(e.valueOf()),0,O[l])})))},Y=function(t,s){return t.classed(me,!0).attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(w.b(s).ticks((s.range()[0]-s.range()[1])/15))};if("fractional_cn"===this.props.dataKeyToPlot){var G=this.props.fractionalCNTicks,K=C.domain(),H=G.filter((function(e){return e.fractionalTick>K[0]&&e.fractionalTick<K[1]})),X=H.map((function(e){return e.fractionalTick})),Q=[],Z=[];H.length>0&&(Q.push(X[0]),Z.push(H[0]));for(var V=1;V<H.length;V++){(C(Q[Q.length-1])||0)-(C(X[V])||0)>8&&(Q.push(X[V]),Z.push(H[V]))}Y=function(t,s){return t.classed(me,!0).attr("id","Grid").attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(w.b(s).tickValues(Q).tickSizeInner(60-n).tickFormat((function(e,t){return Z[t].totalCN+" ("+Number(e.valueOf()).toFixed(2)+")"})))}}else if(this.props.showPurityPloidy){var J=C.domain(),q=[];this._currXScale.domain();if(this.props.showTetraploid)q=this.props.BAF_lines;else{var $,ee=[],te=Object(b.a)(this.props.BAF_lines);try{for(te.s();!($=te.n()).done;){var se=$.value;se.state[0]+se.state[1]<4&&ee.push(se)}}catch(Re){te.e(Re)}finally{te.f()}q=ee}var re=q.filter((function(e){return e.tick>J[0]&&e.tick<J[1]})),ae=re.map((function(e){return e.tick})),ne=[],ie=[];ae.length>0&&(ne.push(ae[0]),ie.push(re[0]));for(var oe=1;oe<ae.length;oe++){(C(ne[ne.length-1])||0)-(C(ae[oe])||0)>8&&(ne.push(ae[oe]),ie.push(re[oe]))}Y=function(t,s){return t.classed(me,!0).attr("id","Grid").attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(w.b(s).tickValues(ne).tickSizeInner(-n+_e(e.props.showPurityPloidy)+je).tickFormat((function(e,t){return ie[t].state[0]==ie[t].state[1]?ne[t].toFixed(2)+" (x,x)":ne[t].toFixed(2)+" ("+ie[t].state[0]+","+ie[t].state[1]+")"})))}}var le=N.append("g"),ce=N.append("g"),he=w.o,ue=w.n().scaleExtent([0,100]),de=w.n().scaleExtent([0,100]),pe=function(){return w.p(le.node())},fe=function(){return w.p(ce.node())};le.call(ue).attr("pointer-events","none"),ce.call(de).attr("pointer-events","none");var be=w.n().on("zoom",(function(){try{var e=w.f.transform,t=e.k/he.k,s=w.f.sourceEvent?[w.f.sourceEvent.layerX,w.f.sourceEvent.layerY]:[n/2,i/2],r=s[0]>S.range()[0],a=s[1]<C.range()[0];v!==St.zoom&&r&&a||(1===t?(r&&ue&&t&&s&&le&&le.call(ue.translateBy,(e.x-he.x)/pe().k,0),a&&de&&t&&s&&ce&&ce.call(de.translateBy,0,(e.y-he.y)/fe().k)):(r&&ue&&t&&s&&le&&le.call(ue.scaleBy,t,s),a&&de&&t&&s&&ce&&ce.call(de.scaleBy,t,s))),he=e,Be()}catch(o){console.log("Error: ",o)}})).on("end",(function(){"RD"===e.props.dataKeyToPlot||"logRD"===e.props.dataKeyToPlot||"fractional_cn"===e.props.dataKeyToPlot?s.props.onLinearPlotZoom([s._currXScale.domain()[0],s._currXScale.domain()[1]],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!0):s.props.onLinearPlotZoom([s._currXScale.domain()[0],s._currXScale.domain()[1]],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!1)}));if(this._canvas){this._canvas.width=800,this._canvas.height=150;var ge=[];f.forEach((function(e){return ge.push(x.toChromosomeInterval(e).toString())}));var ve=new Set(ge),Ce=this._canvas.getContext("webgl");Ce.clearColor(0,0,0,1);var Oe=W.webglFillColor().value((function(e){return B(function(e){if(ve.has(x.toChromosomeInterval(e).toString()))return p;if(-1===e.CLUSTER)return ye;if(-2===e.CLUSTER)return Se;var t=e.CLUSTER%g.length;return g[t]}(e))})).data(a),we=W.seriesWebglPoint().crossValue((function(e){return o.getImplicitCoordinates(x.toChromosomeInterval(e)).getCenter()})).mainValue((function(e){return e[c]})).context(Ce).size(this.props.pointsize);we.decorate((function(e){return Oe(e)})),N.append("clipPath").attr("id","clip2").append("rect").attr("x",_e(this.props.showPurityPloidy)).attr("y",Ae).attr("width",n).attr("height",i).attr("fill","red"),N.append("g").classed("eventrect",!0).append("rect").attr("x",_e(this.props.showPurityPloidy)).attr("y",Ae).attr("width",n-je-_e(this.props.showPurityPloidy)).attr("height",i-xe-Ae).style("fill","none").style("pointer-events","all").attr("clip-path","url(#clip2)");var ke=function(e){s.previewDriver=e},Te=function(e){s.previewDriver=null};Be();var De=null;v===St.select||v===St.erase?(De=w.c().keyModifiers(!1).extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width,this.props.height-xe]]).on("start brush",(function(){var t=w.f.selection;if(t&&t[0][0]!==t[1][0]&&t[0][1]!==t[1][1]){var s=a.filter((function(e){var s,r,a=x.toChromosomeInterval(e),n=o.getImplicitCoordinates(a);return s=t,r=[S(n.getCenter()),C(e[c])],s[0][0]<=r[0]&&r[0]<=s[1][0]&&s[0][1]<=r[1]&&r[1]<=s[1][1]}));if(s){if(v===St.select)s=y.a.uniqBy(y.a.union(s,f),(function(e){return e["#CHR"]+"_"+e.START}));else if(v===St.erase){for(var r=new Set,n=0;n<s.length;n++)r.add((s[n]["#CHR"],s[n].START,s[n].END,s[n].genomicPosition));s=f.filter((function(e){return function(e,t){var s=(e["#CHR"],e.START,e.END,e.genomicPosition);return!t.has(s)}(e,r)}))}e.brushedNodes=new Set(s)}}else e.brushedNodes=new Set([])})).on("end",(function(){N.selectAll(".brush").remove(),e.props.onBrushedBinsUpdated(Object(j.a)(e.brushedNodes))})),N.append("g").attr("class","brush").call(De)):v===St.boxzoom&&(De=w.d().extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width,this.props.height-xe]]).on("end",(function(){N.selectAll(".brush").remove();var t=w.f.selection;try{var r={start:t[0],end:t[1]},a=S.invert(r.start),n=S.invert(r.end);"RD"===e.props.dataKeyToPlot||"logRD"===e.props.dataKeyToPlot||"fractional_cn"===e.props.dataKeyToPlot?e.props.onLinearPlotZoom([a,n],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!0):e.props.onLinearPlotZoom([a,n],[s._currYScale.domain()[0],s._currYScale.domain()[1]],!1)}catch(i){}})),N.append("g").attr("class","brush").call(De)),N.call(be).call(be.transform,w.o.scale(1))}}function Be(){Ce.clear(Ce.COLOR_BUFFER_BIT),Ce.clearColor(255,255,255,1);var e=fe().rescaleY(C);if(ce.call(Y,e),s._currYScale=e,l){var t=pe().rescaleX(S);le.call(z,t),s._currXScale=t,we.xScale(t).yScale(e)}else{var r=pe().rescaleX(S);le.call(U,r),s._currXScale=r,we.xScale(r).yScale(e)}we(a),m&&(N.select(".Drivers").remove(),N.select(".eventrect").append("g").attr("clip-path","url(#clip2)").classed("Drivers",!0).selectAll("circle").data(m).enter().append("circle").attr("class","point").attr("d",w.k().type(w.l)).attr("fill","red").attr("fill-opacity",1).attr("stroke-width",2).attr("r",2).attr("transform",(function(t){return"translate("+s._currXScale(o.getImplicitCoordinates(t.location).getCenter())+","+((s._currYScale(e.domain()[0])||0)+3)+")"})).on("mouseover",ke).on("mouseleave",Te).on("click",(function(e){var t="";t="reverseBAF"===c&&s.props.applyLog?"logRD":"reverseBAF"===c&&s.props.showPurityPloidy?"fractional_cn":"reverseBAF"===c?"RD":"reverseBAF",s.lockedDrivers.has(e)?s.lockedDrivers.delete(e):s.lockedDrivers.add(e),s.props.handleDriverGenesChange({gene:e,destination:t})})))}}},{key:"renderHighlight",value:function(){var e=this.props,t=e.width,s=e.genome,r=e.chr,a=e.hoveredLocation;if(!a)return null;if(null!=this.previewDriver)return null;var n=this.getXScale(t,s,r,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),i=s.getImplicitCoordinates(a),o=n(i.start),l=Math.ceil((n(i.end)||0)-(o||0));return o&&o>0?Object(q.jsx)("div",{className:"highlight",style:{position:"absolute",left:o,width:l,height:"100%",backgroundColor:"rgba(0,0,0,1)",border:"1px solid rgba(0,0,0,1)",zIndex:1}}):void 0}},{key:"handleMouseMove",value:function(e){var t=this.props,s=t.width,r=t.genome,a=t.chr,n=t.onLocationHovered,i=this.getXScale(s,r,a,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),o=i.range(),l=k(e).x;if(l<o[0]||l>o[1])this.handleMouseLeave();else{var c=i.invert(l);n(r.getChromosomeLocation(c))}}},{key:"handleMouseLeave",value:function(){this.props.onLocationHovered(null)}},{key:"render",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=t.dataKeyToPlot;return Object(q.jsxs)("div",{className:"LinearPlot",style:{position:"relative",width:s,height:r},onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,children:[this.renderLockedDrivers(),this.renderTooltip(),this.renderHighlight(),Object(q.jsx)("canvas",{ref:function(t){return e._canvas=t},width:s,height:r,className:"canvas",style:{position:"absolute",top:Ae,zIndex:-1,left:_e(this.props.showPurityPloidy),width:s-_e(this.props.showPurityPloidy)-je,height:r-Ae-xe}}),Object(q.jsx)("svg",{ref:function(t){return e._svg=t},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+s+" "+r}),Object(q.jsx)("div",{className:"LinearPlot-tools",children:("RD"===a||"logRD"===a||"fractional_cn"===a)&&Object(q.jsx)("button",{className:"custom-button linear-plot-button",onClick:function(){e.props.onLinearPlotZoom(null,null,!0,!0)},children:"Reset View"})})]})}},{key:"renderLockedDrivers",value:function(){var e=this,t=this.props,s=t.width,r=t.genome,n=t.chr,i=t.height,o=!1;null!=this.previewDriver&&this.lockedDrivers.has(this.previewDriver)&&(this.lockedDrivers.delete(this.previewDriver),o=!0);var l=Object(j.a)(this.lockedDrivers).sort((function(e,t){return e.location.start-t.location.start}));null!=this.previewDriver&&o&&this.lockedDrivers.add(this.previewDriver);var c=[];return l.map((function(t,o){var l,h=e.getXScale(s,r,n,e.props.implicitStart,e.props.implicitEnd,e.props.showPurityPloidy),u=r.getImplicitCoordinates(t.location),d=h(u.start)||0,p=Math.ceil((h(u.end)||0)-(d||0)),f=t.symbol,g=Object(q.jsx)(a.a.Fragment,{children:Object(q.jsxs)("div",{children:[" ",f," "]})}),v=!0,m=f.length>4?40+5*(f.length-4):40,y=[d-m/2,d+m/2],S=Object(b.a)(c);try{for(S.s();!(l=S.n()).done;){var C=l.value;if(C[0]>y[0]&&C[0]<y[1]){v=!1;break}if(y[0]>C[0]&&y[0]<C[1]){v=!1;break}}}catch(j){S.e(j)}finally{S.f()}return v&&c.push(y),d>_e(e.props.showPurityPloidy)&&d<s-je?Object(q.jsxs)("div",{children:[Object(q.jsx)("div",{style:{position:"absolute",left:d-m/2,width:m,bottom:i,border:"1px solid rgba(0,0,0,0)",zIndex:o,pointerEvents:"none",display:v?"":"none"},children:g}),Object(q.jsx)("div",{className:"highlight",style:{position:"absolute",left:d,width:p,height:"75%",backgroundColor:"rgba(255,165,0,1)",border:"1px solid rgba(255,165,0,1)",zIndex:o}})]},e.props.dataKeyToPlot+f):null}))}},{key:"renderTooltip",value:function(){var e=this.props,t=e.driverGenes,s=e.hoveredLocation,r=e.width,n=e.genome,i=e.chr,o=e.height;if(!s)return null;if(!t)return null;if(!this.previewDriver)return null;var l=this.getXScale(r,n,i,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),c=n.getImplicitCoordinates(this.previewDriver.location),h=l(c.start)||0,u=Math.ceil((l(c.end)||0)-(h||0)),d=this.previewDriver.symbol,p=Object(q.jsx)(a.a.Fragment,{children:Object(q.jsxs)("div",{children:[" ",d," "]})}),f=d.length>4?40+5*(d.length-4):40;return Object(q.jsxs)("div",{children:[Object(q.jsx)("div",{style:{position:"absolute",left:h-f/2,bottom:o+1,backgroundColor:"white",border:"1px solid rgba(0,0,0,0)",zIndex:2},children:p}),Object(q.jsx)("div",{className:"highlight",style:{position:"absolute",left:h,width:u+1,height:"75%",backgroundColor:this.lockedDrivers.has(this.previewDriver)?"red":"rgba(0, 200 , 0, 1)",zIndex:0}})]})}}]),s}(a.a.PureComponent);function we(e){var t=e.data,s=e.chr,r=e.pointsize,a=e.rdRange,n=e.hoveredLocation,i=e.onLocationHovered,o=e.onBrushedBinsUpdated,l=e.brushedBins,c=e.customColor,h=e.colors,u=e.yScale,d=e.clusterTableData,p=e.applyLog,f=e.displayMode,b=e.width,g=e.onLinearPlotZoom,v=e.implicitStart,m=e.implicitEnd,y=e.onZoom,S=e.driverGenes,C=e.purity,j=e.ploidy,A=e.meanRD,x=e.fractionalCNTicks,_=e.showPurityPloidy,O=e.showTetraploid,w=e.BAF_lines;return Object(q.jsx)(Oe,{pointsize:r,data:t,dataKeyToPlot:p?"logRD":_?"fractional_cn":"RD",applyLog:p,genome:mt,chr:s,hoveredLocation:n,onLocationHovered:i,onBrushedBinsUpdated:o,yMin:u?u[0]:_?a[0]:p?-2:0,yMax:u?u[1]:a[1],yLabel:p?"log RDR":_?"Copy Number":"RDR",brushedBins:l,customColor:c,colors:h,clusterTableData:d,displayMode:f,width:b,onZoom:y,onLinearPlotZoom:g,implicitStart:v,implicitEnd:m,driverGenes:S,driverGeneUpdate:e.driverGeneUpdate,handleDriverGenesChange:e.handleDriverGenesChange,purity:C,ploidy:j,meanRD:A,fractionalCNTicks:x,showPurityPloidy:_,showTetraploid:O,BAF_lines:w})}function ke(e){var t=e.data,s=e.chr,r=e.pointsize,a=e.hoveredLocation,n=e.onLocationHovered,i=e.onBrushedBinsUpdated,o=e.brushedBins,l=e.customColor,c=e.colors,h=e.xScale,u=e.clusterTableData,d=e.displayMode,p=e.width,f=e.onLinearPlotZoom,b=e.implicitStart,g=e.implicitEnd,v=e.onZoom,m=e.driverGenes,y=e.applyLog,S=e.purity,C=e.ploidy,j=e.meanRD,A=e.showPurityPloidy,x=e.showTetraploid,_=e.fractionalCNTicks,O=e.BAF_lines;return Object(q.jsx)(Oe,{pointsize:r,data:t,chr:s,dataKeyToPlot:"reverseBAF",applyLog:y,genome:mt,hoveredLocation:a,onLocationHovered:n,onBrushedBinsUpdated:i,yMin:h?h[0]:-.01,yMax:h?h[1]:.51,yLabel:"0.5 - BAF",brushedBins:o,customColor:l,colors:c,clusterTableData:u,displayMode:d,width:p,onLinearPlotZoom:f,implicitStart:b,implicitEnd:g,onZoom:v,driverGenes:m,driverGeneUpdate:e.driverGeneUpdate,handleDriverGenesChange:e.handleDriverGenesChange,purity:S,ploidy:C,meanRD:j,showPurityPloidy:A,showTetraploid:x,fractionalCNTicks:_,BAF_lines:O})}Oe.defaultProps={width:600,height:150,onLocationHovered:y.a.noop};var Te=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).state={selectedSample:e.initialSelectedSample,sentDriver:{gene:null,destination:null}},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(d.a)(r)),r.handleDriverGenesChange=r.handleDriverGenesChange.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e.target.value})}},{key:"handleDriverGenesChange",value:function(e){this.setState({sentDriver:e})}},{key:"render",value:function(){var e,t=this.props,s=t.data,r=t.chr,a=t.hoveredLocation,n=t.pointsize,i=t.onLocationHovered,o=t.onBrushedBinsUpdated,l=t.brushedBins,c=t.customColor,h=t.yScale,u=t.xScale,d=t.rdRange,p=t.clusterTableData,f=t.applyLog,b=t.displayMode,g=t.width,v=t.onLinearPlotZoom,m=t.implicitRange,y=t.onZoom,S=t.driverGenes,C=t.purity,j=t.ploidy,A=t.meanRD,x=t.fractionalCNTicks,_=t.showPurityPloidy,O=t.showTetraploid,w=t.BAF_lines,k=ge()({"is-pan":b===St.zoom,"is-zoom":b===St.boxzoom,"is-select":b===St.select,"is-erase":b===St.erase});return e=Object(q.jsxs)(pe,{className:k,children:[Object(q.jsx)(we,{pointsize:n,data:s,chr:r,rdRange:d,hoveredLocation:a,onLocationHovered:i,onBrushedBinsUpdated:o,brushedBins:l,customColor:c,colors:this.props.colors,yScale:h,xScale:u,clusterTableData:p,applyLog:f,displayMode:b,width:g,onLinearPlotZoom:v,implicitStart:m?m[0]:m,implicitEnd:m?m[1]:m,onZoom:y,driverGenes:S,handleDriverGenesChange:this.handleDriverGenesChange,driverGeneUpdate:this.state.sentDriver,purity:C,ploidy:j,meanRD:A,fractionalCNTicks:x,showPurityPloidy:_,BAF_lines:w}),Object(q.jsx)("div",{className:"SampleViz-separator"}),Object(q.jsx)(ke,{pointsize:n,data:s,chr:r,hoveredLocation:a,onLocationHovered:i,onBrushedBinsUpdated:o,brushedBins:l,customColor:c,colors:this.props.colors,yScale:h,xScale:u,clusterTableData:p,applyLog:f,displayMode:b,width:g,onLinearPlotZoom:v,onZoom:y,implicitStart:m?m[0]:m,implicitEnd:m?m[1]:m,driverGenes:S,handleDriverGenesChange:this.handleDriverGenesChange,driverGeneUpdate:this.state.sentDriver,purity:C,ploidy:j,meanRD:A,fractionalCNTicks:x,showPurityPloidy:_,showTetraploid:O,BAF_lines:w})]}),Object(q.jsx)("div",{className:"SampleViz-linear",children:e})}}]),s}(a.a.Component),De=s(76),Be=s.n(De),Re=s(238),Pe=(s(214),function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).table_data=void 0,r.table_data=e.data,r.handleColorChange=r.handleColorChange.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"shouldComponentUpdate",value:function(e){return this.props.data!==e.data||this.props.colors!==e.colors}},{key:"handleColorChange",value:function(e,t){this.props.colors[t]=e.hex;var s=y.a.cloneDeep(this.props.colors);this.props.onClusterColorChange(s),this.forceUpdate()}},{key:"componentDidUpdate",value:function(e){this.props.updatedClusterTable&&this.props.updatedClusterTable()}},{key:"render",value:function(){var e=this,t=this.props,s=t.colOneName,r=t.colTwoName,a=t.colThreeName,n=t.colFourName,i=t.data,o=t.expandable,l=t.selectable,c=t.colors,h=function(t){return Object(q.jsx)("div",{children:Object(q.jsx)(Re.a,{width:"100%",color:e.props.colors[t.data.key],onChangeComplete:function(s){return e.handleColorChange(s,t.data.key)}})})},u=[{when:function(e){return e},style:function(e){return{backgroundColor:-1===Number(e.key)?"#999999":c[Number(e.key)%c.length],alignItems:"center",justifyContent:"center",innerWidth:50,outerWidth:50}}}],d=[{name:s,selector:"key",sortable:!0,compact:!0,wrap:!0,innerWidth:40,outerWidth:40,width:"50",center:!0},{name:r,selector:"value",sortable:!0,right:!0,compact:!0,wrap:!0,innerWidth:40,outerWidth:40,width:"50",center:!0}],p=[{name:s,selector:"key",sortable:!0,compact:!0,wrap:!0,center:!0},{name:r,selector:"value",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0},{name:a,selector:"selectPerc",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0},{name:n,selector:"binPerc",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0}];if(t.centroidTable){var f=[];if(null!==i&&void 0!==i&&i.length>0){f.push({name:"Cluster ID",type:"key"});for(var b=0,g=Object.keys(i[0].sample);b<g.length;b++){var v=g[b];f.push({name:v,type:"sample."+v})}}for(var m=[],y=0,S=f;y<S.length;y++){var C=S[y],j={name:C.name,selector:C.type,sortable:!0,compact:!0,wrap:!0,center:!0};m.push(j)}return Object(q.jsx)(Be.a,{columns:m,data:i,pagination:!0,dense:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0,conditionalRowStyles:u})}return o||l?Object(q.jsx)("div",{className:"scroll",children:Object(q.jsx)(Be.a,{columns:d,data:i,selectableRows:!0,onSelectedRowsChange:this.props.onClusterRowsChange,selectableRowSelected:function(t){if(e.props.currentFilters.includes(String(t.key)))return t},expandableRows:!0,expandableRowsComponent:Object(q.jsx)(h,{}),expandableRowDisabled:function(e){return-1===e.key||-2===e.key},pagination:!0,dense:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0,conditionalRowStyles:u})}):Object(q.jsx)(Be.a,{columns:p,data:i,pagination:!0,dense:!0,paginationPerPage:3,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[3,5,10,20],noContextMenu:!0,noHeader:!0,noDataComponent:Object(q.jsx)("div",{style:{padding:10},children:"No Records Selected"}),conditionalRowStyles:u})}}]),s}(a.a.Component)),Ne=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._clusters=void 0,r._clusters=r.initializeListOfClusters(),r.state={selectedSample:e.initialSelectedSample||e.data.getSampleList()[0],scales:{xScale:null,yScale:null},selectedCluster:r._clusters.length>0?r._clusters[0]:K,implicitRange:null,purity:Y,ploidy:2,offset:0},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(d.a)(r)),r.handleSelectedSampleChange=r.handleSelectedSampleChange.bind(Object(d.a)(r)),r.handleZoom=r.handleZoom.bind(Object(d.a)(r)),r.handleLinearPlotZoom=r.handleLinearPlotZoom.bind(Object(d.a)(r)),r.onUpdatePurity=r.onUpdatePurity.bind(Object(d.a)(r)),r.onUpdatePloidy=r.onUpdatePloidy.bind(Object(d.a)(r)),r.onUpdateOffset=r.onUpdateOffset.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;this._clusters=[];var t,s=Object(b.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(a){s.e(a)}finally{s.f()}for(;this._clusters.length>0&&(Number(this._clusters[0])===Number(K)||Number(this._clusters[0])===Number(H));)this._clusters.shift();return this._clusters}},{key:"componentDidUpdate",value:function(e){if(this.props.clusterTableData!==e.clusterTableData)this.initializeListOfClusters();else if(this.props.applyLog!==e.applyLog||this.props.showPurityPloidyInputs!==e.showPurityPloidyInputs||this.props.showTetraploid!==e.showTetraploid){var t={xScale:this.state.scales.xScale,yScale:null};this.setState({scales:t})}}},{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e})}},{key:"handleSelectedSampleChange",value:function(e){this.setState({selectedSample:e.target.value})}},{key:"handleZoom",value:function(e){this.setState({scales:e})}},{key:"handleLinearPlotZoom",value:function(e,t,s,r){if(r){this.setState({implicitRange:null});this.setState({scales:{xScale:null,yScale:null}})}else{this.setState({implicitRange:e});var a=s?{xScale:this.state.scales.xScale,yScale:t}:{xScale:t,yScale:this.state.scales.yScale};this.setState({scales:a})}}},{key:"onUpdatePurity",value:function(e){this.setState({purity:e})}},{key:"onUpdatePloidy",value:function(e){this.props.data.setSamplePloidy(this.state.selectedSample,e),this.setState({ploidy:e})}},{key:"onUpdateOffset",value:function(e){this.setState({offset:e})}},{key:"getSelectedBins",value:function(e,t,s,r,a,n,i){var o=[],l=e?this.props.scales:this.state.scales,c=r?"logRD":a?"fractional_cn":"RD";if(null!==t||null!==l.xScale||null!==l.yScale){var h=t?t[0]:null,u=t?t[1]:null;o=i.getRecords(s,c,h,u,l.xScale,l.yScale,n,this.state.ploidy)}else o=i.getRecords(s,c,null,null,null,null,n,this.state.ploidy);return o}},{key:"render",value:function(){var e=this,t=this.props,s=t.data,r=t.initialSelectedSample,a=t.applyLog,n=t.showLinearPlot,i=t.showScatterPlot,l=t.dispMode,c=t.sampleAmount,h=t.syncScales,u=t.showPurityPloidyInputs,d=t.showTetraploid,p=t.samplesShown,f=this.state.implicitRange,b=this.state.selectedSample,g=s.getRdRange(b,a),v=s.getSampleList().map((function(t){return Object(q.jsxs)("option",{value:t,disabled:!(t===e.state.selectedSample)&&p.has(t),children:[t," "]},t)})),m=s.getMeanRD(b),y=this.getSelectedBins(h,f,b,a,u,m,s),S=s.getBAFLines(this.state.purity,this.state.selectedSample,this.state.offset),C=this.state.purity?(g[1]*this.state.ploidy/m-2*(1-this.state.purity))/this.state.purity:0;g[1]+=.5;var j=s.getFractionalCNTicks(this.state.purity,0,6,Math.ceil(C),this.state.selectedSample);u&&(g=[g[0]*this.state.ploidy/m,g[1]*this.state.ploidy/m]);var A=this._clusters.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)})),x=u?this.state.ploidy/m:1;A.unshift(Object(q.jsx)("option",{value:K,children:K},K)),A.unshift(Object(q.jsx)("option",{value:H,children:H},H));var _=0===s.getBrushedBins().length;return Object(q.jsxs)("div",{className:"SampleViz-wrapper",children:[Object(q.jsxs)("div",{style:{verticalAlign:"middle"},children:[(n||i)&&Object(q.jsxs)("div",{className:"SampleViz-select",title:"Selects a sample from the loaded data.",children:[Object(q.jsx)("span",{children:"Sample: "}),Object(q.jsx)("select",{value:b,onChange:function(t){e.props.onChangeSample(t.target.value,e.state.selectedSample),e.handleSelectedSampleChange(t)},children:v}),Object(q.jsx)("button",{className:"custom-button-add",title:"Add the next sequential sample in the dropdown menu.",onClick:function(){e.props.onAddSample()},disabled:c>=v.length,children:" Add "}),Object(q.jsx)("button",{className:"custom-button-remove",title:"Removes this sample.",onClick:function(){e.props.onRemovePlot(e.state.selectedSample)},disabled:c<=1,children:" Remove "})]}),(n||i)&&Object(q.jsxs)("div",{className:"SampleViz-select",title:"Selects a cluster from the loaded data.",children:[Object(q.jsx)("span",{children:"Cluster: "}),Object(q.jsx)("select",{name:"Select Cluster",className:"Sampleviz-cluster-select",value:this.state.selectedCluster,disabled:_,onChange:function(t){e.setState({selectedCluster:t.target.value})},children:A}),Object(q.jsx)("button",{className:"custom-button",title:"Assigns your selected bins to the selected cluster.",onClick:function(){e.props.parentCallBack(e.state.selectedCluster),e.props.onBrushedBinsUpdated([])},disabled:_,children:"Assign"}),Object(q.jsx)("button",{className:"custom-button",title:"Assigns your selected bins to a new cluster.",onClick:function(){e.initializeListOfClusters();var t=e._clusters;t.sort((function(e,t){return Number(e)-Number(t)}));for(var s=(t.length>0?Number(t[t.length-1]):-1)+1,r=0;r<t.length;r++)if(Number(t[r])!==r){s=r;break}e.props.parentCallBack(s),e.props.onBrushedBinsUpdated([])},disabled:_,children:"New"})]}),(n||i)&&u&&Object(q.jsxs)("div",{className:"Inputs",children:[Object(q.jsx)("label",{children:"Ploidy:"})," ",Object(q.jsx)("input",{value:this.state.ploidy,type:"number",id:"Purity-Input",name:"volume",step:"0.01",title:"Set ploidy gridlines.",onChange:function(t){var s=Number(t.target.value);e.onUpdatePloidy(s)}}),Object(q.jsx)("label",{className:"input-label",children:"Purity:"})," ",Object(q.jsx)("input",{type:"number",id:"Purity-Input",name:"volume",step:"0.01",value:this.state.purity,title:"Set purity gridlines. Max purity is 1.",onChange:function(t){var s=Number(t.target.value);s<=1&&e.onUpdatePurity(s)}}),Object(q.jsx)("label",{className:"input-label",children:"BAF Balance: Offset for (x,x):"})," ",Object(q.jsx)("input",{type:"number",id:"Purity-Input",name:"volume",step:"0.01",value:this.state.offset,title:"Set offset for first vertical gridline. Max offset is 1.",onChange:function(t){var s=Number(t.target.value);s<=1&&e.onUpdateOffset(s)}})]})]}),Object(q.jsxs)("div",{className:"SampleViz-plots",children:[i&&Object(q.jsx)(ve,Object(o.a)(Object(o.a)({},this.props),{},{data:y,onSelectedSample:this.handleSelectedSampleChanged,selectedSample:b,initialSelectedSample:r,onZoom:this.handleZoom,rdRange:g,implicitRange:this.state.implicitRange,scales:h?this.props.scales:this.state.scales,centroidPts:s.getCentroidPoints(b,this.props.chr,x),purity:this.state.purity,ploidy:this.state.ploidy,offset:this.state.offset,meanRD:m,fractionalCNTicks:j,showPurityPloidy:u,showTetraploid:d,BAF_lines:S,max_cn:Math.ceil(C)})),n&&Object(q.jsx)(Te,Object(o.a)(Object(o.a)({},this.props),{},{data:y,onLinearPlotZoom:this.handleLinearPlotZoom,onZoom:this.handleZoom,yScale:this.state.scales.yScale,xScale:this.state.scales.xScale,selectedSample:this.state.selectedSample,initialSelectedSample:r,rdRange:g,displayMode:l,width:600,implicitRange:this.state.implicitRange,purity:this.state.purity,ploidy:this.state.ploidy,meanRD:m,fractionalCNTicks:j,showPurityPloidy:u,showTetraploid:d,BAF_lines:S}))]}),(n||i)&&Object(q.jsx)("div",{className:n&&i?"SampleViz-clusters":"",children:Object(q.jsx)(Pe,{data:s.brushedTableData(),onClusterRowsChange:function(){},onClusterColorChange:function(){},currentFilters:["-1"],colOneName:"Cluster ID",colTwoName:"Cluster (%)",colThreeName:"Selection (%)",colFourName:"Bin (%)",cols:"",expandable:!1,selectable:!1,colors:this.props.colors})})]})}}]),s}(a.a.Component),Le="data:image/gif;base64,R0lGODlhEAAQAPQAAP///wAAAPDw8IqKiuDg4EZGRnp6egAAAFhYWCQkJKysrL6+vhQUFJycnAQEBDY2NmhoaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Me=(s(215),function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).table_data=void 0,r.table_data=e.data,r}return Object(u.a)(s,[{key:"shouldComponentUpdate",value:function(e){return this.props.data!==e.data}},{key:"render",value:function(){var e,t=this.props,s=t.colName,r=t.data,a=[{name:s,selector:"action",compact:!0,wrap:!0}],n=[],i=Object(b.a)(r);try{for(i.s();!(e=i.n()).done;){var o=e.value;n.push(o)}}catch(l){i.e(l)}finally{i.f()}return Object(q.jsx)("div",{children:Object(q.jsx)(Be.a,{columns:a,data:n,pagination:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0})})}}]),s}(a.a.Component)),Ee=function(){function e(t,s){Object(h.a)(this,e),this._name=void 0,this._chromosomes=void 0,this._chrStarts=void 0,this._length=void 0,this.nameToChr=void 0,this._name=s||"",this._chromosomes=t,this._chrStarts={},this._length=0;var r,a=Object(b.a)(t);try{for(a.s();!(r=a.n()).done;){var n=r.value,i=n.name;if(void 0!==this._chrStarts[i])throw new Error('Duplicate chromosome name "'.concat(i,'" in genome "').concat(s,'"'));this._chrStarts[i]=this._length,this._length+=n.length}}catch(u){a.e(u)}finally{a.f()}this.nameToChr={};var o,l=Object(b.a)(this._chromosomes);try{for(l.s();!(o=l.n()).done;){var c=o.value;this.nameToChr[c.name]=c}}catch(u){l.e(u)}finally{l.f()}}return Object(u.a)(e,[{key:"getName",value:function(){return this._name}},{key:"getChromosomeList",value:function(){return this._chromosomes}},{key:"getChromosomeStarts",value:function(){var e=this;return this._chromosomes.map((function(t){return e._chrStarts[t.name]}))}},{key:"getChrStartMap",value:function(){return this._chrStarts}},{key:"getChromosomeStarts2",value:function(e){var t=this;return e.map((function(e){return t._chrStarts[e.name]}))}},{key:"getLength",value:function(e){return e?e in this._chrStarts?this._chromosomes.find((function(t){return String(t.name)===String(e)})).length:0:this._length}},{key:"getLength2",value:function(e){var t,s=0,r=Object(b.a)(e);try{for(r.s();!(t=r.n()).done;){s+=t.value.length}}catch(a){r.e(a)}finally{r.f()}return s}},{key:"getImplicitCoordinates",value:function(e){var t=e.chr,s=e.start,r=e.end;if(!(t in this._chrStarts))throw new Error('Chromosome "'.concat(t,'" not in this genome'));var a=this._chrStarts[t];return new S(a+s,a+r)}},{key:"getChromosomeLocation",value:function(e){e<0?e=0:e>=this.getLength()&&(e=this.getLength()-1);var t=Object.values(this._chrStarts).sort((function(e,t){return e-t})),s=y.a.sortedLastIndex(t,e)-1,r=e-t[s];return new C(this._chromosomes[s].name,r,r+1)}},{key:"getChrs",value:function(e){var t,s=[],r=Object(b.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(this.nameToChr[a])}}catch(n){r.e(n)}finally{r.f()}return s}}]),e}();new Ee([{name:"chr1",length:248956422},{name:"chr2",length:242193529},{name:"chr3",length:198295559},{name:"chr4",length:190214555},{name:"chr5",length:181538259},{name:"chr6",length:170805979},{name:"chr7",length:159345973},{name:"chr8",length:145138636},{name:"chr9",length:138394717},{name:"chr10",length:133797422},{name:"chr11",length:135086622},{name:"chr12",length:133275309},{name:"chr13",length:114364328},{name:"chr14",length:107043718},{name:"chr15",length:101991189},{name:"chr16",length:90338345},{name:"chr17",length:83257441},{name:"chr18",length:80373285},{name:"chr19",length:58617616},{name:"chr20",length:64444167},{name:"chr21",length:46709983},{name:"chr22",length:50818468}],"hg38"),s(394);function Fe(e){return new Promise((function(t,s){var r=Object.keys(e[0]).filter((function(e){return!X.has(e)}));t(z(e,r,"\t"," "))}))}var Ie=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).csvLink=void 0,r.csvLink=a.a.createRef(),r.state={loading:!1},r.handleFileDownload=r.handleFileDownload.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"handleFileDownload",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t,s,r,a,n,i,o,c,h,u,d,p,f,b,g;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),t="",e.prev=2,e.next=5,Fe(this.props.data);case 5:t=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return");case 12:for((s=document.createElement("a")).href="data:text/tab-separated-values,"+encodeURIComponent(t),r=this.props.fileName,a=r.split("."),n="",i=0;i<a.length-1;i++)n+=a[i],i!==a.length-2&&(n+=".");o=n.split("_"),c=new Date,(h=String(c.getMonth()+1)).length<2&&(h="0"+h),(u=String(c.getDate())).length<2&&(u="0"+u),d=c.getFullYear()+h+u,p=String(c.getHours()),f=String(c.getMinutes()),b=String(c.getSeconds()),p.length<2&&(p="0"+p),f.length<2&&(f="0"+f),b.length<2&&(b="0"+b),g=p+f+b,s.download=o[0]+"_"+d+g+".tsv",s.click(),this.setState({loading:!1});case 35:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{children:[Object(q.jsx)("button",{type:"button",onClick:function(){e.props.onExport(),e.handleFileDownload()},style:{display:"none"},children:"Export"}),this.state.loading&&Object(q.jsxs)("div",{children:["Reading file... ",Object(q.jsx)("img",{src:Le,alt:"Loading"})]})]})}}]),s}(a.a.Component),Ue=s(30),ze=s(436),Ye=s(440),Ge="320px";var Ke=function(e){var t=e.chosenFile;return t.length>35&&(t=t.substring(0,34)+"..."),Object(q.jsxs)("div",{className:"sidebar",style:{width:Ge,left:e.show?0:"-320px"},children:[Object(q.jsxs)("div",{className:"closemenu",onClick:function(){e.onSidebarChange(!e.show)},title:"Close/open the sidebar.",children:[Object(q.jsx)("div",{children:" "}),e.show?Object(q.jsx)("div",{className:"arrow-container",children:Object(q.jsx)(Ue.a,{})}):Object(q.jsx)("div",{className:"arrow-container",children:Object(q.jsx)(Ue.b,{})})]}),Object(q.jsxs)("div",{className:"contents",children:[Object(q.jsxs)("div",{className:"row-contents",children:[" ",Object(q.jsx)("h1",{children:"CNAViz v2.1"})," "]}),Object(q.jsx)("div",{className:"title-bar"}),Object(q.jsxs)("div",{className:"row-contents",children:[" Chosen File: ",t]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"custom-file-upload",title:"Uploads a file.",children:[Object(q.jsx)("input",{type:"file",id:"fileUpload",onChange:function(t){return e.onFileChosen(t,!0)}}),"Import ",Object(q.jsx)(Ue.d,{})]}),Object(q.jsxs)("label",{className:"custom-file-export",title:"Exports your clustering.",children:[Object(q.jsx)(Ie,{data:e.data,fileName:e.chosenFile,onExport:e.onExport}),"Export ",Object(q.jsx)(Ue.c,{})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:e.processingStatus!==yt.done?"custom-file-upload-disabled":"custom-file-upload2",title:"Uploads your driver genes.",children:[Object(q.jsx)("input",{type:"file",id:"fileUpload",disabled:e.processingStatus!==yt.done,onChange:function(t){return e.onDriverFileChosen(t,!0)}}),"Import Driver Genes"]}),Object(q.jsxs)("label",{className:e.processingStatus!==yt.done?"custom-file-upload-disabled":"custom-file-upload3",title:"Uploads Cancer Gene Census driver genes.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",disabled:e.processingStatus!==yt.done,onClick:function(t){return e.handleDemoDrivers()}}),"CGC Drivers"]})]}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("div",{className:"Select-Chrom",title:"Select a chromosome to visualize in the linear and scatter plots.",children:[Object(q.jsx)("label",{htmlFor:"Select Demo",style:{margin:10},children:" Demo: "}),Object(q.jsx)("select",{name:"Select Demo",id:"Select Demo",value:e.selectedDemo,onChange:e.onDemoSelected,children:e.demoOptions})]})}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("div",{className:"Select-Chrom",title:"Select a chromosome to visualize in the linear and scatter plots.",children:[Object(q.jsx)("label",{htmlFor:"Select Chromosome",style:{margin:10},children:" Chromosome: "}),Object(q.jsx)("select",{name:"Select Chromosome",id:"Select Chromosome",value:e.selectedChr,onChange:e.onChrSelected,children:e.chrOptions})]})}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("div",{className:"selection-color",title:"Pick a color to represent your selected bins.",children:[Object(q.jsx)("label",{htmlFor:"Select Cluster Color",style:{margin:10},children:" Selection Color: "}),Object(q.jsx)("input",{type:"color",name:"Select Color",id:"Select Color",value:e.selectedColor,onChange:e.onColorSelected})]})}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)(Ye.a,{sx:{width:300},children:["Point Size:",Object(q.jsx)(ze.a,{"aria-label":"Point Size",defaultValue:3,onChangeCommitted:e.handleslider,valueLabelDisplay:"auto",step:1,marks:!0,min:1,max:20})]})}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"logrdr",title:"Shows read-depth ratio (RDR) in log form.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Log RDR: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleLog,disabled:e.showPurityPloidy})]}),Object(q.jsxs)("label",{className:"centroids",title:"Shows centroids for each visualized cluster on the scatterplot.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Centroids: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleShowCentroids,checked:e.showCentroids,readOnly:!0})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"scatterplot",title:"Shows the scatterplots.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Scatterplots: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleScatter,checked:e.showScatter,readOnly:!0})]}),Object(q.jsxs)("label",{className:"linearplot",title:"Shows the linear plots.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Linear Plots: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onToggleLinear,checked:e.showLinear,readOnly:!0})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"purityploidy",title:"Shows lines for purity and ploidy on the scatterplots.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Purity/Ploidy: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onTogglePurityPloidy,checked:e.showPurityPloidy,readOnly:!0})]}),Object(q.jsxs)("label",{className:"tetraploid",title:"Shows tetraploid gridlines for purity and ploidy.",children:[Object(q.jsx)("span",{className:"App-CheckBox-explanation",children:"Tetraploid: "}),Object(q.jsx)("input",{type:"checkbox",onClick:e.onShowTetraploid,checked:e.showTetraploid,readOnly:!0})]})]}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"analytics",title:"Shows pop-up displaying cluster analytics.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:function(){e.onTogglesilhouettes()}}),"Analytics (s)"]}),Object(q.jsxs)("label",{className:"centroidtable",title:"Shows pop-up displaying centroid table.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onToggleShowCentroidTable}),"Centroids (c)"]})]}),Object(q.jsx)("div",{className:"row-contents",children:Object(q.jsxs)("label",{className:"absorbbins",title:"Shows pop-up helping user automate reallocation of bins.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onToggleShowAbsorbBins}),"Absorb Bins (a)"]})}),Object(q.jsxs)("div",{className:"row-contents",children:[Object(q.jsxs)("label",{className:"showlog",title:"Shows the cluster assignment log.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onTogglePreviousActionLog}),"Log (l)"]}),Object(q.jsxs)("label",{className:"clearclustering",title:"Clears the clustering.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onClearClustering}),"Clear Clustering"]}),Object(q.jsxs)("label",{className:"undocluster",title:"Undo the last cluster assignment action, including the ''Clear Clustering'' action.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",onClick:e.onUndoClick}),"Undo Cluster"]})]})]}),Object(q.jsx)("div",{className:"contents2",children:Object(q.jsx)(Pe,{data:e.tableData,onClusterRowsChange:e.onClusterRowsChange,onClusterColorChange:e.onClusterColorChange,currentFilters:e.currentClusterFilters,colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:e.colors})})]})},He=s(237),Xe=s(0),Qe=(s(216),0),Ze=0,Ve=0,Je=0,We=0,qe=0,$e=0,et=50,tt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r.state={showTooltip:!1,tooltipX:0,tooltipY:0},r._svg=null,r}return Object(u.a)(s,[{key:"shouldComponentUpdate",value:function(e){return!0}},{key:"componentDidUpdate",value:function(e){this.propsDidChange(e,[])&&this.redraw()}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"renderTooltipContent",value:function(e){var t=this.state.showTooltip;return e&&t?Object(q.jsx)("div",{className:"Scatterplot-tooltip",style:{position:"absolute",top:"90%",left:"1%",pointerEvents:"none"},children:e}):null}},{key:"renderTooltip",value:function(){return this.renderTooltipContent(Object(q.jsx)(a.a.Fragment,{children:Object(q.jsx)("div",{children:"Note: The Silhouette coefficient ranges from -1 to 1 where the larger the number the more tightly grouped the cluster "})}))}},{key:"render",value:function(){return Object(q.jsx)("div",{id:"chart-container",children:this.renderTooltip()})}},{key:"redraw",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=t.data,n=t.colors,i=y.a.sortBy(a,"avg"),o=Je/s*100+"%",l=Qe/s*100+"%",c=Ze/s*100+"%",h=Ve/s*100+"%",u=w.j("div#chart-container").append("svg").style("padding",l+" "+c+" "+h+" "+o+" ").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(s+We+$e)+" "+(r+qe+et)),d=w.i().domain([-1,1]).range([15,s-10]);u.append("text").classed("scale",!0).attr("text-anchor","middle").attr("font-size",20).attr("x",y.a.mean([15,s-10])).attr("y",r+40).text("Approximate Average Silhouette Coefficient").on("mouseover",(function(){e.setState({showTooltip:!0}),e.setState({tooltipX:w.f.offsetX,tooltipY:w.f.offsetY})})).on("mouseleave",(function(){e.setState({showTooltip:!1})})),u.append("g").attr("transform","translate(0,"+r+")").call(w.a(d)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var p=w.h().range([0,r]).domain(i.map((function(e){return String(e.cluster)}))).padding(.1);u.selectAll("myRect").data(i).enter().append("rect").attr("class",(function(e){return"bar bar--"+(e.avg<0?"negative":"positive")})).attr("x",(function(e){return d(Math.min(0,e.avg))||0})).attr("y",(function(e){return p(String(e.cluster))||0})).attr("width",(function(e){return Math.abs((d(e.avg)||0)-(d(0)||0))})).attr("height",p.bandwidth()).attr("fill",(function(e){return-1===e.cluster?"#999999":n[e.cluster%n.length]})),u.append("g").call(w.b(p).tickSize(0).tickPadding(6)).attr("transform","translate("+d(0)+",0)")}}]),s}(a.a.Component),st=0,rt=0,at=0,nt=0,it=10,ot=0,lt=0,ct=50,ht=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._svg=void 0,r._svg=null,r}return Object(u.a)(s,[{key:"shouldComponentUpdate",value:function(e){return!0}},{key:"componentDidUpdate",value:function(e){this.propsDidChange(e,["selectedCluster"])&&this.redraw()}},{key:"propsDidChange",value:function(e,t){var s=this;return t.some((function(t){return s.props[t]!==e[t]}))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=this,t=this.props,s=t.width,r=t.height,a=nt/s*100+"%",n=st/s*100+"%",i=rt/s*100+"%",o=at/s*100+"%";return Object(q.jsx)("div",{id:"chart-container2",children:Object(q.jsx)("svg",{ref:function(t){return e._svg=t},style:{padding:n+" "+i+" "+o+" "+a+" "},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+(s+it+lt)+" "+(r+ot+ct)})})}},{key:"redraw",value:function(){var e=this.props,t=e.width,s=e.height,r=e.data,a=e.colors;if(this._svg){var n=[];void 0!==r&&(n=Array.from(r,(function(e){return{key:e[0],value:e[1]}}))),n=y.a.sortBy(n,"value");var i=w.j(this._svg);i.selectAll(".scales").remove();var o=y.a.maxBy(n,"value"),l=w.i().domain([0,o?o.value:1]).range([30,t-10]);i.append("text").classed("scales",!0).attr("text-anchor","middle").attr("font-size",20).attr("x",y.a.mean([0,t])).attr("y",s+40).text("Approximate Average Euclidean Distance"),i.append("g").classed("scales",!0).attr("transform","translate(0,"+s+")").call(w.a(l)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var c=w.h().range([0,s]).domain(n.map((function(e){return String(e.key)}))).padding(.1);i.selectAll(".bar").remove(),i.selectAll("myRect").classed("bars",!0).data(n).enter().append("rect").attr("class",(function(e){return"bar bar--"+(e.value<0?"negative":"positive")})).attr("x",(function(e){return l(Math.min(0,e.value))||0})).attr("y",(function(e){return c(String(e.key))||0})).attr("width",(function(e){return Math.abs((l(e.value)||0)-(l(0)||0))})).attr("height",c.bandwidth()).attr("fill",(function(e){return-1===e.key?"#999999":a[e.key%a.length]})),i.append("g").classed("scales",!0).call(w.b(c).tickSize(0).tickPadding(6)).attr("transform","translate("+l.range()[0]+",0)")}}}]),s}(a.a.Component),ut=(s(396),function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e))._clusters=void 0,r._clusters=r.initializeListOfClusters(),r.state={selectedCluster:r._clusters[0]},r}return Object(u.a)(s,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;this._clusters=[];var t,s=Object(b.a)(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(a){s.e(a)}finally{s.f()}for(;this._clusters.length>0&&(Number(this._clusters[0])===Number("-1")||Number(this._clusters[0])===Number("-2"));)this._clusters.shift();return this._clusters}},{key:"componentDidUpdate",value:function(e){this.props.clusterTableData!==e.clusterTableData&&this.initializeListOfClusters()}},{key:"render",value:function(){var e=this,t=this.props,s=t.silhouetteData,r=t.clusterDistances,a=t.colors,n=this._clusters.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}));return Object(q.jsxs)("div",{className:"Directions2",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:" Cluster Analytics "}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:this.props.onToggleSilhoutteBarPlot,children:Object(q.jsx)(Ue.e,{})}),Object(q.jsxs)("div",{className:"scroll",children:[Object(q.jsxs)("div",{className:"ClusterDistances-Select",children:[Object(q.jsxs)("div",{className:"Overall-Average",children:[" Average Cluster Silhouette Score: ",Object(q.jsx)("b",{children:this.props.avgClusterSilhouette||0})," "]}),Object(q.jsxs)("label",{className:"cluster-select",children:[" Cluster:",Object(q.jsx)("select",{name:"Select Cluster",title:"Cluster",value:this.state.selectedCluster,onChange:function(t){e.setState({selectedCluster:t.target.value})},children:n})]})]}),Object(q.jsxs)("div",{className:"BarPlots",children:[Object(q.jsx)(tt,{width:700,height:700,data:s,avgClusterSilhouette:this.props.avgClusterSilhouette,colors:a}),Object(q.jsx)(ht,{data:r.get(Number(this.state.selectedCluster)),selectedCluster:Number(this.state.selectedCluster),width:700,height:700,colors:a})]})]})]})}}]),s}(a.a.Component)),dt=(s(397),s(236)),pt=s(161),ft=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{className:"Toolbox",children:[Object(q.jsx)("div",{children:"Modes:"}),Object(q.jsx)(bt,{iconElement:Object(q.jsx)(Ue.f,{color:this.props.currentDisplayMode===St.boxzoom?"red":"black"}),label:"Zoom",label2:"(z)",onClick:function(){return e.props.setDisplayMode(St.boxzoom)}}),Object(q.jsx)(bt,{iconElement:Object(q.jsx)(dt.a,{color:this.props.currentDisplayMode===St.zoom?"red":"black"}),label:"Pan",label2:"(p)",onClick:function(){return e.props.setDisplayMode(St.zoom)}}),Object(q.jsx)(bt,{iconElement:Object(q.jsx)(pt.a,{color:this.props.currentDisplayMode===St.select?"red":"black"}),label:"Select",label2:"(b)",onClick:function(){return e.props.setDisplayMode(St.select)}}),Object(q.jsx)(bt,{iconElement:Object(q.jsx)(pt.b,{color:this.props.currentDisplayMode===St.erase?"red":"black"}),label:"Deselect",label2:"(d)",onClick:function(){return e.props.setDisplayMode(St.erase)}})]})}}]),s}(a.a.Component),bt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"render",value:function(){return Object(q.jsxs)("div",{className:"Toolbox-Tool",title:this.props.label,onClick:this.props.onClick,children:[this.props.iconElement,Object(q.jsx)("div",{className:"Toolbox-Tool-label",children:this.props.label}),Object(q.jsx)("div",{className:"Toolbox-Tool-label2",children:this.props.label2})]})}}]),s}(a.a.Component);var gt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;return Object(h.a)(this,s),(r=t.call(this,e)).csvLink=void 0,r.csvLink=a.a.createRef(),r.state={loading:!1},r.handleFileDownload=r.handleFileDownload.bind(Object(d.a)(r)),r}return Object(u.a)(s,[{key:"handleFileDownload",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t,s,r,a,n,i,o,c,h,u,d,p,f,g,v,m,y,S,C;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.setState({loading:!0}),t=this.props.fileName,s=t.split("."),r="",a=0;a<s.length-1;a++)r+=s[a],a!==s.length-2&&(r+=".");n=r.split("_"),i=new Date,(o=String(i.getMonth()+1)).length<2&&(o="0"+o),(c=String(i.getDate())).length<2&&(c="0"+c),h=i.getFullYear()+o+c,u=String(i.getHours()),d=String(i.getMinutes()),p=String(i.getSeconds()),u.length<2&&(u="0"+u),d.length<2&&(d="0"+d),p.length<2&&(p="0"+p),f=u+d+p,g=[],v=Object(b.a)(this.props.logData);try{for(v.s();!(m=v.n()).done;)y=m.value,g.push(y.action)}catch(l){v.e(l)}finally{v.f()}"",S=g.join("\n"),(C=document.createElement("a")).href="data:text/plain,"+encodeURIComponent(S),C.download=n[0]+"-log_"+h+"_"+f,C.click(),this.setState({loading:!1});case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{children:[Object(q.jsx)("button",{type:"button",onClick:function(){e.props.onExport(),e.handleFileDownload()},style:{display:"none"},children:"Export"}),this.state.loading&&Object(q.jsxs)("div",{children:["Downloading...",Object(q.jsx)("img",{src:Le,alt:"Loading"})]})]})}}]),s}(a.a.Component);s(398),s(399);function vt(e){return new Promise((function(t,s){var r=new FileReader;r.readAsText(e),r.onload=function(){t(r.result)},r.onerror=s,r.onabort=s}))}var mt,yt,St,Ct=["#d3fe14","#c9080a","#fec7f8","#0b7b3e","#3957ff","#0bf0e9","#c203c8","#fd9b39","#906407","#98ba7f","#fe6794","#10b0ff","#ac7bff","#fee7c0","#964c63","#1da49c","#0ad811","#bbd9fd","#fe6cfe","#d1a09c","#78579e","#81ffad","#739400","#ca6949","#d9bf01","#646a58","#d5097e","#bb73a9","#ccf6e9","#9cb4b6","#b6a7d4","#9e8c62","#6e83c8","#01af64","#a71afd","#cfe589","#d4ccd1","#fd4109","#bf8f0e","#2f786e","#4ed1a5","#d8bb7d","#a54509","#6a9276","#a4777a","#fc12c9","#606f15","#3cc4d9","#f31c4e","#73616f","#f097c6","#fc8772","#92a6fe","#875b44","#699ab3","#94bc19","#7d5bf0","#d24dfe","#c85b74","#68ff57","#b62347","#994b91","#646b8c","#977ab4","#d694fd","#c4d5b5","#fdc4bd","#1cae05","#7bd972","#e9700a","#d08f5d","#8bb9e1","#fde945","#a29d98","#1682fb","#9ad9e0","#d6cafe","#8d8328","#b091a7","#647579","#1f8d11","#e7eafd","#b9660b","#a4a644","#fec24c","#b1168c","#188cc1","#7ab297","#c949a6","#d48295","#eb6dc2","#d5b0cb","#ff9ffb","#fdb082","#af4d44","#a759c4","#a9e03a","#0d906b","#9ee3bd","#5b8846","#0d8995","#f25c58","#70ae4f","#847f74","#9094bb","#ffe2f1","#a67149","#936c8e","#d04907","#c3b8a6","#cef8c4","#7a9293","#fda2ab","#2ef6c5","#807242","#cb94cc","#b6bdd0","#b5c75d","#fde189","#b7ff80","#fa2d8e","#839a5f","#28c2b5","#e5e9e1","#bc79d8","#7ed8fe","#9f20c3","#4f7a5b","#f511fd","#09c959","#bcd0ce","#8685fd","#98fcff","#afbff9","#6d69b4","#aaa87e","#b59dfb","#d9a742","#ac5c86","#9468d5","#a4a2b2","#b1376e","#d43f3d","#05a9d1","#c38375","#24b58e","#6eabaf","#66bf7f","#92cbbb","#ddb1ee","#1be895","#c7ecf9","#a6baa6","#8045cd","#a9d796","#ce62cb","#0e954d","#a97d2f","#fcb8d3","#9bfee3","#4e8d84","#fc6d3f","#7b9fd4","#8c6165","#72805e","#d53762","#f00a1b","#de5c97","#8ea28b","#fccd95","#ba9c57","#b79a82","#7c5a82","#7d7ca4","#958ad6","#cd8126","#bdb0b7","#10e0f8","#dccc69","#d6de0f","#616d3d","#985a25","#30c7fd","#0aeb65","#e3cdb4","#bd1bee","#ad665d","#d77070","#8ea5b8","#76655e","#598100","#86757e","#5ea068","#a590b8","#c1a707","#85c0cd","#e2cde9","#dcd79c","#d8a882","#b256f9","#b13323","#519b3b","#dd80de","#f1884b","#74b2fe","#a0acd2","#d199b0","#f68392","#8ccaa0","#64d6cb","#e0f86a","#75671b","#796e87","#6d8075","#9b8a8d","#f04c71","#61bd29","#bcc18f","#fecd0f","#1e7ac9","#927261","#dc27cf","#979605","#ec9c88","#8c48a3","#676769","#546e64","#8f63a2","#b35b2d","#7b8ca2","#b87188","#4a9bda","#eb7dab","#f6a602","#cab3fe","#ddb8bb","#107959","#885973","#5e858e","#b15bad","#e107a7","#2f9dad","#4b9e83","#b992dc","#6bb0cb","#bdb363","#ccd6e4","#a3ee94","#9ef718","#fbe1d9","#a428a5","#93514c","#487434","#e8f1b6","#d00938","#fb50e1","#fa85e1","#7cd40a","#f1ade1","#b1485d","#7f76d6","#d186b3","#90c25e","#b8c813","#a8c9de","#7d30fe","#815f2d","#737f3b","#c84486","#946cfe","#e55432","#a88674","#c17a47","#b98b91","#fc4bb3","#da7f5f","#df920b","#b7bbba","#99e6d9","#a36170","#c742d8","#947f9d","#a37d93","#889072","#9b924c","#23b4bc","#e6a25f","#86df9c","#a7da6c","#3fee03","#eec9d8","#aafdcb","#7b9139","#92979c","#72788a","#994cff","#c85956","#7baa1a","#de72fe","#c7bad8","#85ebfe","#6e6089","#9b4d31","#297a1d","#9052c0","#698eba","#d46222","#6da095","#b483bb","#04d183","#9bcdfe","#2ffe8c","#9d4279","#c909aa","#826cae"];function jt(e,t,s){return new Promise((function(t,r){v()(e,{cast:!0,columns:!0,delimiter:"\t",skip_empty_lines:!0},(function(e,a){if(e)r(e);else{if(a.length>0){var n,i=Object(b.a)(Q);try{for(i.s();!(n=i.n()).done;){var o=n.value;if("CLUSTER"in a[0]){if(!(o in a[0]))throw new Error("COLUMN: "+o+" IS MISSING FROM INPUTTED DATA")}else console.log("Missing CLUSTER, but continuing with -1..."),s=!1}}catch(A){i.e(A)}finally{i.f()}var l=0,c=a[0]["#CHR"],h=[],u={},d=y.a.groupBy(a,"SAMPLE");for(var p in d)u[p]=y.a.meanBy(d[p],(function(e){return e.RD}));var f,g=Object(b.a)(a);try{for(g.s();!(f=g.n()).done;){var v=f.value;s&&void 0!==v.CLUSTER||(v.CLUSTER=-1),v.fractional_cn=2*v.RD/u[v.SAMPLE],v.logRD=Math.log2(v.RD),c!==v["#CHR"]&&(h.push({name:c,length:l-0}),c=v["#CHR"]),l=Number(v.END),v.reverseBAF=.5-v.BAF}}catch(A){g.e(A)}finally{g.f()}h.push({name:c,length:l-0}),h.sort((function(e,t){return String(e.name).localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"})})),mt=new Ee(h);var m,S=Object(b.a)(a);try{for(S.s();!(m=S.n()).done;){var j=m.value;j.genomicPosition=mt.getImplicitCoordinates(new C(j["#CHR"],j.START,j.END)).start}}catch(A){S.e(A)}finally{S.f()}}t(a)}}))}))}function At(e,t){return new Promise((function(s,r){v()(e,{cast:!0,columns:!0,delimiter:"\t",skip_empty_lines:!0,skip_lines_with_error:!0},(function(e,a){if(e)r(e);else{if(a.length>0){var n,i=Object(b.a)(Z);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(!(o in a[0]))throw new Error("COLUMN: "+o+" IS MISSING FROM INPUTTED DRIVER DATA")}}catch(v){i.e(v)}finally{i.f()}}var l,c=[],h=new Set(t),u=Object(b.a)(a);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=d["Genome Location"].split(":");if(h.has(p[0])){var f=p[1].split("-"),g=new C(p[0],Number(f[0]),Number(f[1]));d.location=g,c.push(d)}}}catch(v){u.e(v)}finally{u.f()}s(c)}}))}))}!function(e){e[e.none=0]="none",e[e.readingFile=1]="readingFile",e[e.processing=2]="processing",e[e.done=3]="done",e[e.error=4]="error"}(yt||(yt={})),function(e){e[e.zoom=0]="zoom",e[e.select=1]="select",e[e.boxzoom=2]="boxzoom",e[e.erase=3]="erase"}(St||(St={}));var xt=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var r;Object(h.a)(this,s),(r=t.call(this,e)).state={processingStatus:yt.none,indexedData:new J([]),hoveredLocation:null,selectedChr:J.ALL_CHRS_KEY,selectedDemo:"none",pointsize:3,selectedCluster:J.ALL_CLUSTERS_KEY,selectedColor:"black",absorbThresh_rdr:new Map,absorbThresh_baf:new Map,mergeThresh_rdr:new Map,mergeThresh_baf:new Map,mergeValues:[],invertAxis:!1,sampleAmount:1,color:"blue",colors:Ct,assignCluster:!1,assigned:!1,applyLog:!1,applyClustering:!1,value:"0",updatedBins:!1,selectedSample:"",displayMode:St.zoom,sidebar:!0,chosenFile:"",showLinearPlot:!0,showScatterPlot:!0,showDirections:!1,showAbsorbBins:!1,showLog:!1,showCentroidTable:!1,showCentroids:!1,syncScales:!1,scales:{xScale:null,yScale:null},driverGenes:null,showSilhouettes:yt.none,silhouettes:[],showPurityPloidyInputs:!1,showTetraploid:!0,samplesShown:[],samplesNotShown:[]},r.handleFileChoosen=r.handleFileChoosen.bind(Object(d.a)(r)),r.handleDemoFileInput=r.handleDemoFileInput.bind(Object(d.a)(r)),r.handleDriverFileChosen=r.handleDriverFileChosen.bind(Object(d.a)(r)),r.handleDemoDrivers=r.handleDemoDrivers.bind(Object(d.a)(r)),r.handleChrSelected=r.handleChrSelected.bind(Object(d.a)(r)),r.handleDemoSelected=r.handleDemoSelected.bind(Object(d.a)(r)),r.handleslider=r.handleslider.bind(Object(d.a)(r)),r.handleColorSelection=r.handleColorSelection.bind(Object(d.a)(r)),r.handleAbsorbThresh_rdr=r.handleAbsorbThresh_rdr.bind(Object(d.a)(r)),r.handleAbsorbThresh_baf=r.handleAbsorbThresh_baf.bind(Object(d.a)(r)),r.handleClusterSelected=r.handleClusterSelected.bind(Object(d.a)(r)),r.handleLocationHovered=y.a.throttle(r.handleLocationHovered.bind(Object(d.a)(r)),50),r.handleAxisInvert=r.handleAxisInvert.bind(Object(d.a)(r)),r.handleAddSampleClick=r.handleAddSampleClick.bind(Object(d.a)(r)),r.handleColorChange=r.handleColorChange.bind(Object(d.a)(r)),r.handleAssignCluster=r.handleAssignCluster.bind(Object(d.a)(r)),r.handleCallBack=r.handleCallBack.bind(Object(d.a)(r)),r.handleClusterAssignmentInput=r.handleClusterAssignmentInput.bind(Object(d.a)(r)),r.updateBrushedBins=r.updateBrushedBins.bind(Object(d.a)(r)),r.onClusterRowsChange=r.onClusterRowsChange.bind(Object(d.a)(r)),r.onClusterColorChange=r.onClusterColorChange.bind(Object(d.a)(r)),r.onClusterRowsToChange=r.onClusterRowsToChange.bind(Object(d.a)(r)),r.onClusterColorToChange=r.onClusterColorToChange.bind(Object(d.a)(r)),r.onClusterRowsFromChange=r.onClusterRowsFromChange.bind(Object(d.a)(r)),r.onClusterColorFromChange=r.onClusterColorFromChange.bind(Object(d.a)(r)),r.onSelectedSample=r.onSelectedSample.bind(Object(d.a)(r)),r.handleRemovePlot=r.handleRemovePlot.bind(Object(d.a)(r)),r.setDisplayMode=r.setDisplayMode.bind(Object(d.a)(r)),r.onSideBarChange=r.onSideBarChange.bind(Object(d.a)(r)),r.toggleLog=r.toggleLog.bind(Object(d.a)(r)),r.onToggleLinear=r.onToggleLinear.bind(Object(d.a)(r)),r.onToggleScatter=r.onToggleScatter.bind(Object(d.a)(r)),r.onToggleSync=r.onToggleSync.bind(Object(d.a)(r)),r.goBackToPreviousCluster=r.goBackToPreviousCluster.bind(Object(d.a)(r)),r.handleZoom=r.handleZoom.bind(Object(d.a)(r)),r.onToggleShowCentroids=r.onToggleShowCentroids.bind(Object(d.a)(r)),r.onToggleSilhoutteBarPlot=r.onToggleSilhoutteBarPlot.bind(Object(d.a)(r)),r.onToggleDirections=r.onToggleDirections.bind(Object(d.a)(r)),r.onToggleShowAbsorbBins=r.onToggleShowAbsorbBins.bind(Object(d.a)(r)),r.onToggleShowCentroidTable=r.onToggleShowCentroidTable.bind(Object(d.a)(r)),r.onTogglePreviousActionLog=r.onTogglePreviousActionLog.bind(Object(d.a)(r)),r.onClearClustering=r.onClearClustering.bind(Object(d.a)(r)),r.setProcessingStatus=r.setProcessingStatus.bind(Object(d.a)(r)),r.onTogglePurityPloidy=r.onTogglePurityPloidy.bind(Object(d.a)(r)),r.changeDisplayedSamples=r.changeDisplayedSamples.bind(Object(d.a)(r)),r.onExport=r.onExport.bind(Object(d.a)(r)),r.onShowTetraploid=r.onShowTetraploid.bind(Object(d.a)(r));var a=Object(d.a)(r);return w.j("body").on("keypress",(function(){"p"===w.f.key?a.setState({displayMode:St.zoom}):"z"===w.f.key?a.setState({displayMode:St.boxzoom}):"b"===w.f.key?a.setState({displayMode:St.select}):"d"===w.f.key?a.setState({displayMode:St.erase}):32===w.f.keyCode?a.onSideBarChange(!a.state.sidebar):"l"===w.f.key?a.setState({showLog:!a.state.showLog}):"c"===w.f.key?a.setState({showCentroidTable:!a.state.showCentroidTable}):"s"===w.f.key?a.onToggleSilhoutteBarPlot():"a"===w.f.key&&a.onToggleShowAbsorbBins()})),w.j("body").on("keydown",(function(){a.state.displayMode===St.zoom&&"Shift"===w.f.key?a.setState({displayMode:St.boxzoom}):"/"===w.f.key||"?"===w.f.key?a.setState({showDirections:!0}):a.state.displayMode!==St.zoom&&a.state.displayMode!==St.erase||"Meta"!==w.f.key&&"Control"!==w.f.key?a.state.displayMode!==St.zoom&&a.state.displayMode!==St.select||"Alt"!==w.f.key||a.setState({displayMode:St.erase}):a.setState({displayMode:St.select})})),w.j("body").on("keyup",(function(){a.state.displayMode===St.boxzoom&&"Shift"===w.f.key?a.setState({displayMode:St.zoom}):"/"===w.f.key||"?"===w.f.key?a.setState({showDirections:!1}):a.state.displayMode!==St.select||"Meta"!==w.f.key&&"Control"!==w.f.key?a.state.displayMode===St.erase&&"Alt"===w.f.key&&a.setState({displayMode:St.zoom}):a.setState({displayMode:St.zoom})})),r}return Object(u.a)(s,[{key:"handleFileChoosen",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t,s){var r,a,n,i,o,c,h,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.target.files)&&r[0]){e.next=3;break}return e.abrupt("return");case 3:return this.setState({chosenFile:r[0].name}),this.setState({processingStatus:yt.readingFile}),a="",e.prev=6,e.next=9,vt(r[0]);case 9:a=e.sent,e.next=17;break;case 12:return e.prev=12,e.t0=e.catch(6),console.error(e.t0),this.setState({processingStatus:yt.error}),e.abrupt("return");case 17:return this.setState({processingStatus:yt.processing}),n=null,e.prev=19,e.next=22,jt(a,this.state.applyLog,s);case 22:i=e.sent,n=new J(i),e.next=31;break;case 26:return e.prev=26,e.t1=e.catch(19),console.error(e.t1),this.setState({processingStatus:yt.error}),e.abrupt("return");case 31:for(o=n.getSampleList(),c=[],h=[],u=0;u<o.length;u++)u<this.state.sampleAmount?c.push(o[u]):h.push(o[u]);this.setState({indexedData:n,processingStatus:yt.done,samplesShown:c,samplesNotShown:h});case 36:case"end":return e.stop()}}),e,this,[[6,12],[19,26]])})));return function(t,s){return e.apply(this,arguments)}}()},{key:"handleDemoFileInput",value:function(e,t){var s=this;this.setState({processingStatus:yt.readingFile});var r="";if("a12"===t)r="https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/a12.tsv",this.setState({chosenFile:"a12.tsv"});else if("kim"===t)r="https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/cnaviz_kim.tsv",this.setState({chosenFile:"cnaviz_kim.tsv"});else{if("10x"!==t)return this.setState({samplesNotShown:[],processingStatus:yt.done}),void window.location.reload(!1);r="https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/cnaviz_10x.tsv",this.setState({chosenFile:"cnaviz_10x.tsv"})}fetch(r).then((function(e){return e.text()})).then((function(t){s.setState({processingStatus:yt.processing}),jt(t,s.state.applyLog,e).then((function(e){for(var t=new J(e),r=t.getSampleList(),a=[],n=[],i=0;i<r.length;i++)i<s.state.sampleAmount?a.push(r[i]):n.push(r[i]);s.setState({indexedData:t,processingStatus:yt.done,samplesShown:a,samplesNotShown:n})})).catch((function(e){console.error(e),s.setState({processingStatus:yt.error})}))}))}},{key:"setProcessingStatus",value:function(e){this.setState({processingStatus:e})}},{key:"handleDriverFileChosen",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(t){var s,r,a,n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=t.target.files)&&s[0]){e.next=3;break}return e.abrupt("return");case 3:return r="",e.prev=4,e.next=7,vt(s[0]);case 7:r=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),console.error(e.t0),e.abrupt("return");case 14:return a=null,e.prev=15,e.next=18,At(r,this.state.indexedData.getAllChromosomes());case 18:n=e.sent,a=n,e.next=26;break;case 22:return e.prev=22,e.t1=e.catch(15),console.error(e.t1),e.abrupt("return");case 26:this.setState({driverGenes:a});case 27:case"end":return e.stop()}}),e,this,[[4,10],[15,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDemoDrivers",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/drivers.tsv").then((function(e){return e.text()})).then((function(e){At(e,t.state.indexedData.getAllChromosomes()).then((function(e){t.setState({driverGenes:e})})).catch((function(e){console.error(e)}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"handleDemoSelected",value:function(e){console.log("inside handleDemoSelected..."),this.setState({selectedDemo:e.target.value}),console.log(e.target.value),this.handleDemoFileInput(!0,e.target.value),console.log("Done w handleDemoSelected.")}},{key:"handleChrSelected",value:function(e){this.setState({selectedChr:e.target.value}),this.state.indexedData.setChrFilter(e.target.value)}},{key:"handleslider",value:function(e,t){console.log("Pointsize updated to",t),this.setState({pointsize:t})}},{key:"handleColorSelection",value:function(e){this.setState({selectedColor:e.target.value})}},{key:"handleAbsorbThresh_rdr",value:function(e,t){console.log("inside handleMergeThresh_rdr() with",e,"updated value to",Number(t.target.value)),this.state.absorbThresh_rdr.set(e,Number(t.target.value))}},{key:"handleAbsorbThresh_baf",value:function(e,t){console.log("inside handleMergeThresh_baf() with",e,"updated value to",Number(t.target.value)),this.state.absorbThresh_baf.set(e,Number(t.target.value))}},{key:"handleMergeThresh_rdr",value:function(e,t){console.log("inside handleMergeThresh_rdr() with",e,"updated value to",Number(t.target.value)),this.state.mergeThresh_rdr.set(e,Number(t.target.value))}},{key:"handleMergeThresh_baf",value:function(e,t){console.log("inside handleMergeThresh_baf() with",e,"updated value to",Number(t.target.value)),this.state.mergeThresh_baf.set(e,Number(t.target.value))}},{key:"handleClusterSelected",value:function(e){this.setState({selectedCluster:e.target.value}),this.state.indexedData.setClusterFilters([e.target.value])}},{key:"handleLocationHovered",value:function(e){e?this.setState({hoveredLocation:e}):this.setState({hoveredLocation:null})}},{key:"handleClusterAssignmentInput",value:function(e){this.setState({value:e.target.value})}},{key:"handleCallBack",value:function(e){this.state.indexedData.updateCluster(Number(e)),this.setState({assignCluster:!1}),this.state.indexedData.setChrFilter(this.state.selectedChr)}},{key:"updateBrushedBins",value:function(e){this.state.indexedData.setbrushedBins(e),this.setState({updatedBins:!0})}},{key:"handleAxisInvert",value:function(){this.setState({invertAxis:!this.state.invertAxis})}},{key:"changeDisplayedSamples",value:function(e,t){for(var s=this.state.samplesShown,r=0;r<s.length;r++)s[r]===t&&(s[r]=e);var a=this.state.samplesNotShown;(a=a.filter((function(t){return t!==e}))).push(t),this.setState({sampleAmount:this.state.sampleAmount,samplesShown:s,samplesNotShown:a})}},{key:"handleAddSampleClick",value:function(){var e=this.state.samplesNotShown[0],t=this.state.samplesShown;t.push(e);var s=this.state.samplesNotShown;s=s.filter((function(t){return t!==e})),this.setState({sampleAmount:this.state.sampleAmount+1,samplesShown:t,samplesNotShown:s})}},{key:"handleRemovePlot",value:function(e){var t=this.state.samplesShown,s=t[t.length-1];t.pop(),this.state.samplesNotShown.push(s),this.setState({sampleAmount:this.state.sampleAmount-1})}},{key:"handleAssignCluster",value:function(){this.setState({assignCluster:!this.state.assignCluster})}},{key:"handleColorChange",value:function(e){this.setState({color:e.hex})}},{key:"getStatusCaption",value:function(){switch(this.state.processingStatus){case yt.readingFile:return Object(q.jsxs)("div",{children:["Reading file... ",Object(q.jsx)("img",{src:Le,alt:"Loading"})]});case yt.processing:return Object(q.jsxs)("div",{children:["Processing data... ",Object(q.jsx)("img",{src:Le,alt:"Loading"})]});case yt.error:return"ERROR";case yt.none:case yt.done:default:return""}}},{key:"onToggleDirections",value:function(){this.setState({showDirections:!this.state.showDirections})}},{key:"absorbBinsAll",value:function(){console.log("Absorb bins!"),console.log("Merge bins..."),this.setState({processingStatus:yt.processing}),this.setState({processingStatus:yt.processing});var e=this.state.indexedData.getFilteredFromClusters(),t=this.state.indexedData.getFilteredToClusters(),s=this.state.absorbThresh_rdr,r=this.state.absorbThresh_baf;console.log(s),console.log(r);for(var a=!0,n=0;n<this.state.indexedData.getSampleList().length;n++){var i=this.state.indexedData.getSampleList()[n],o=r.get(i),l=s.get(i);console.log("sample",i,"x_thr",o,"y_thr",l),(Number(o)<=0||void 0===o||Number(l)<=0||void 0===l)&&(a=!1)}if(a){for(var c=this.state.indexedData.absorbBins(e,t,r,s),h="",u=0,d=Array.from(c.keys());u<d.length;u++){var p=d[u];h+=String(p),h+=","}window.confirm("Are you sure you want to absorb bins into: "+h)?(alert("Bins absorbed."),this.state.indexedData.assignAbsorb(c)):alert("Action canceled, bins not absorbed.")}else window.confirm("Please use a threshold > 0 for all samples.");this.setState({processingStatus:yt.done})}},{key:"mergeBinsAll",value:function(){console.log("Merge bins..."),this.setState({processingStatus:yt.processing});for(var e=this.state.indexedData.getSampleList()[0],t=this.state.indexedData.mergeBinsAll(e,this.state.mergeThresh_rdr,this.state.mergeThresh_baf),s="\n",r=0,a=Array.from(t.keys());r<a.length;r++){var n=a[r];s+=String(n)+": [";for(var i=0,o=Array.from(t.get(n));i<o.length;i++){var l=o[i];s+=String(l)+","}s+="]\n"}window.confirm("Are you sure you want to merge the following bins?"+s)?(alert("Clusters merged."),this.state.indexedData.assignMerge(e,t)):alert("Action canceled, clusters not merged."),this.setState({processingStatus:yt.done})}},{key:"onToggleShowAbsorbBins",value:function(){this.setState({showAbsorbBins:!this.state.showAbsorbBins})}},{key:"onShowTetraploid",value:function(){console.log("ShowTetraplod",this.state.showTetraploid),this.setState({showTetraploid:!this.state.showTetraploid})}},{key:"toggleLog",value:function(){this.state.applyLog?(this.state.indexedData.setDataKeyType("RD"),this.state.indexedData.recalculateCentroids("RD")):(this.state.indexedData.setDataKeyType("logRD"),this.state.indexedData.recalculateCentroids("logRD")),this.setState({applyLog:!this.state.applyLog}),this.state.indexedData.setShouldRecalculatesilhouettes(!0)}},{key:"toggleClustering",value:function(){this.setState({applyClustering:!this.state.applyClustering})}},{key:"onClusterRowsChange",value:function(e){this.state.indexedData.setClusterFilters(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterRowsToChange",value:function(e){this.state.indexedData.setClusterFiltersTo(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterRowsFromChange",value:function(e){this.state.indexedData.setClusterFiltersFrom(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterColorChange",value:function(e){var t,s=[],r=Object(b.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(a)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:s})}},{key:"onClusterColorToChange",value:function(e){var t,s=[],r=Object(b.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(a)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:s})}},{key:"onClusterColorFromChange",value:function(e){var t,s=[],r=Object(b.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;s.push(a)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:s})}},{key:"onSelectedSample",value:function(e){this.setState({selectedSample:e})}},{key:"setDisplayMode",value:function(e){this.setState({displayMode:e})}},{key:"onSideBarChange",value:function(e){this.setState({sidebar:e})}},{key:"onToggleScatter",value:function(){this.setState({showScatterPlot:!this.state.showScatterPlot})}},{key:"onToggleLinear",value:function(){this.setState({showLinearPlot:!this.state.showLinearPlot})}},{key:"onToggleSync",value:function(){this.setState({syncScales:!this.state.syncScales})}},{key:"onToggleShowCentroids",value:function(){this.setState({showCentroids:!this.state.showCentroids})}},{key:"onToggleShowCentroidTable",value:function(){this.setState({showCentroidTable:!this.state.showCentroidTable})}},{key:"goBackToPreviousCluster",value:function(){this.state.indexedData.undoClusterUpdate(),this.setState({indexedData:this.state.indexedData})}},{key:"handleZoom",value:function(e){this.setState({scales:e})}},{key:"onTogglePreviousActionLog",value:function(){this.setState({showLog:!this.state.showLog})}},{key:"onClearClustering",value:function(){window.confirm("Are you sure you want to clear all clusters?")?(alert("All clusters cleared."),this.state.indexedData.clearClustering(),this.setState({indexedData:this.state.indexedData})):alert("Action canceled, clustering not cleared.")}},{key:"onExport",value:function(){this.state.showPurityPloidyInputs?(this.state.indexedData.calculateCopyNumbers(),this.state.indexedData.calculateCopyNumbers_Cluster()):console.log("onExport does nothing because purity ploidy is not toggled on.")}},{key:"onTogglePurityPloidy",value:function(){this.state.showPurityPloidyInputs?this.state.indexedData.setDataKeyType("RD"):this.state.indexedData.setDataKeyType("fractional_cn"),this.setState({showPurityPloidyInputs:!this.state.showPurityPloidyInputs})}},{key:"onToggleSilhoutteBarPlot",value:function(){var e=Object(c.a)(Object(l.a)().mark((function e(){var t=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({processingStatus:yt.processing}),this.state.showSilhouettes===yt.none?(this.setState({showSilhouettes:yt.processing}),this.state.indexedData.recalculatesilhouettes(this.state.applyLog).then((function(e){void 0!==e&&(t.setState({silhouettes:e}),t.setState({showSilhouettes:yt.done}))}))):this.setState({showSilhouettes:yt.none}),this.setState({processingStatus:yt.done});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,s=t.indexedData,r=t.selectedChr,a=t.selectedDemo,n=t.selectedCluster,i=t.showTetraploid,l=t.hoveredLocation,c=t.invertAxis,h=t.selectedColor,u=t.assignCluster,d=t.updatedBins,p=t.value,f=t.sampleAmount,b=this.state.samplesShown,g=new Set(b),v=s.getBrushedBins(),m=s.getAllRecords(),S=null,C=null,j=null,A=s.getClusterTableInfo(),x=s.getClusterTableInfo2(),_=s.getClusterTableInfo3(),O=[Object(q.jsx)("option",{value:"None",children:"None"},"None"),Object(q.jsx)("option",{value:"a12",children:"A12"},"A12"),Object(q.jsx)("option",{value:"kim",children:"Kim"},"Kim"),Object(q.jsx)("option",{value:"10x",children:"10x"},"10x")],w=[Object(q.jsx)("option",{value:J.ALL_CHRS_KEY,children:"ALL"},J.ALL_CHRS_KEY)],k=s.getActions();if(this.state.processingStatus===yt.done&&!s.isEmpty()){var T=s.getClusterTableInfo(),D=(s.getClusterTableInfo2(),s.getClusterTableInfo3(),{pointsize:this.state.pointsize,data:s,hoveredLocation:l||void 0,onLocationHovered:this.handleLocationHovered,invertAxis:c,chr:r,cluster:n,customColor:h,showTetraploid:i,colors:this.state.colors,assignCluster:u,onBrushedBinsUpdated:this.updateBrushedBins,parentCallBack:this.handleCallBack,brushedBins:v,updatedBins:d,onSelectedSample:this.onSelectedSample,selectedSample:this.state.selectedSample,dispMode:this.state.displayMode,onRemovePlot:this.handleRemovePlot,onAddSample:this.handleAddSampleClick,onChangeSample:this.changeDisplayedSamples,clusterTableData:T,clusterTableData2:T,clusterTableData3:T,applyLog:this.state.applyLog,onClusterSelected:this.handleClusterSelected,onUndoClick:this.goBackToPreviousCluster,showCentroids:this.state.showCentroids,driverGenes:this.state.driverGenes});(w=s.getAllChromosomes().sort((function(e,t){return e.localeCompare(t,"en",{numeric:!0})})).map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}))).push(Object(q.jsx)("option",{value:J.ALL_CHRS_KEY,children:"ALL"},J.ALL_CHRS_KEY)),s.getAllClusters().map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)})).push(Object(q.jsx)("option",{value:J.ALL_CLUSTERS_KEY,children:"ALL"},J.ALL_CLUSTERS_KEY)),O=[Object(q.jsx)("option",{value:"None",children:"None"},"None"),Object(q.jsx)("option",{value:"a12",children:"A12"},"A12"),Object(q.jsx)("option",{value:"kim",children:"Kim"},"Kim"),Object(q.jsx)("option",{value:"10x",children:"10x"},"10x")],S=Object(q.jsx)("div",{id:"grid-container",children:Object(q.jsx)("div",{className:"sampleviz-wrapper-row",children:y.a.times(f,(function(t){return b.length>t&&Object(q.jsx)(Ne,Object(o.a)(Object(o.a)({},D),{},{initialSelectedSample:b[t],plotId:t,showLinearPlot:e.state.showLinearPlot,showScatterPlot:e.state.showScatterPlot,sampleAmount:f,syncScales:e.state.syncScales,handleZoom:e.handleZoom,scales:e.state.scales,showPurityPloidyInputs:e.state.showPurityPloidyInputs,samplesShown:g}),t)}))})}),C=Object(q.jsxs)("div",{className:"grid-container",children:[Object(q.jsx)("div",{className:"App-row-contents",children:"Set Merge Thresholds:"}),Object(q.jsx)("div",{className:"App-row-contents",children:this.state.indexedData.getSampleList().map((function(t){return Object(q.jsx)("div",{id:"grid-container",children:Object(q.jsxs)("div",{className:"scroll",children:[t,Object(q.jsxs)("div",{className:"App-row-contents",children:["BAF:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-BAF",min:0,max:10,step:"0.001",placeholder:e.state.mergeThresh_baf.has(t)?String(e.state.mergeThresh_baf.get(t)):"0",onChange:e.handleMergeThresh_baf.bind(e,t)},t)]}),Object(q.jsxs)("div",{className:"App-row-contents",children:["RDR:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-RDR",min:0,max:10,step:"0.001",placeholder:e.state.mergeThresh_rdr.has(t)?String(e.state.mergeThresh_rdr.get(t)):"0",onChange:e.handleMergeThresh_rdr.bind(e,t)},t)]})]})},t)}))}),Object(q.jsx)("div",{className:"App-row-contents",children:Object(q.jsxs)("label",{className:"directions_label",title:"Merges any clusters with a pairwise centroid distance below the BAF and RDR thresholds in all samples.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",disabled:this.state.processingStatus!==yt.done,onClick:this.mergeBinsAll.bind(this)}),"Merge Clusters"]})})]}),j=Object(q.jsxs)("div",{className:"grid-container",children:[Object(q.jsx)("div",{className:"App-row-contents",children:"Set Absorb Thresholds:"}),Object(q.jsx)("div",{className:"App-row-contents",children:this.state.indexedData.getSampleList().map((function(t){return Object(q.jsx)("div",{id:"grid-container",children:Object(q.jsxs)("div",{className:"scroll",children:[t,Object(q.jsxs)("div",{className:"App-row-contents",children:["BAF:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-BAF",min:0,max:10,step:"0.001",placeholder:e.state.mergeThresh_baf.has(t)?String(e.state.mergeThresh_baf.get(t)):"0",onChange:e.handleAbsorbThresh_baf.bind(e,t)},t)]}),Object(q.jsxs)("div",{className:"App-row-contents",children:["RDR:",Object(q.jsx)("input",{type:"number",name:"Merge Threshold",id:"Merge-Thresh-RDR",min:0,max:10,step:"0.001",placeholder:e.state.mergeThresh_rdr.has(t)?String(e.state.mergeThresh_rdr.get(t)):"0",onChange:e.handleAbsorbThresh_rdr.bind(e,t)},t)]})]})},t)}))}),Object(q.jsx)("div",{className:"App-row-contents",children:Object(q.jsxs)("label",{className:"directions_label",title:"Absorbs bins in the 'From' list of clusters to the closest 'To' list of centroids. Reassignment only happens if distance is below the BAF and RDR thresholds in every sample.",children:[Object(q.jsx)("input",{type:"button",id:"custom-button",disabled:this.state.processingStatus!==yt.done,onClick:this.absorbBinsAll.bind(this)}),"Absorb Bins"]})})]})}var B=this.getStatusCaption();return Object(q.jsxs)("div",{className:"container-fluid",children:[Object(q.jsx)("div",{children:Object(q.jsx)(Ke,{handleslider:this.handleslider,selectedChr:r,selectedDemo:a,onDemoSelected:this.handleDemoSelected,demoOptions:O,onChrSelected:this.handleChrSelected,chrOptions:w,selectedColor:h,onColorSelected:this.handleColorSelection,onAbsorbThresh_rdr:this.handleAbsorbThresh_rdr,onAbsorbThresh_baf:this.handleAbsorbThresh_baf,onMergeThresh_rdr:this.handleMergeThresh_rdr,onMergeThresh_baf:this.handleMergeThresh_baf,onAddSample:this.handleAddSampleClick,onAssignCluster:this.handleAssignCluster,tableData:A,onClusterRowsChange:this.onClusterRowsChange,onClusterColorChange:this.onClusterColorChange,currentClusterFilters:s.getFilteredClusters(),handleClusterAssignmentInput:this.handleClusterAssignmentInput,value:p,setDisplayMode:this.setDisplayMode,currentDisplayMode:this.state.displayMode,colors:this.state.colors,onSidebarChange:this.onSideBarChange,data:m,onFileChosen:this.handleFileChoosen,chosenFile:this.state.chosenFile,show:this.state.sidebar,onToggleLog:this.toggleLog,onToggleLinear:this.onToggleLinear,onToggleScatter:this.onToggleScatter,showScatter:this.state.showScatterPlot,showLinear:this.state.showLinearPlot,onToggleSync:this.onToggleSync,syncScales:this.state.syncScales,logData:k,onToggleShowCentroids:this.onToggleShowCentroids,onToggleShowAbsorbBins:this.onToggleShowAbsorbBins,onShowTetraploid:this.onShowTetraploid,showTetraploid:this.state.showTetraploid,showCentroids:this.state.showCentroids,onDriverFileChosen:this.handleDriverFileChosen,onTogglesilhouettes:this.onToggleSilhoutteBarPlot,showSilhouettes:this.state.showSilhouettes,onToggleDirections:this.onToggleDirections,onToggleShowCentroidTable:this.onToggleShowCentroidTable,onTogglePreviousActionLog:this.onTogglePreviousActionLog,onClearClustering:this.onClearClustering,handleDemoDrivers:this.handleDemoDrivers,setProcessingStatus:this.setProcessingStatus,onTogglePurityPloidy:this.onTogglePurityPloidy,showPurityPloidy:this.state.showPurityPloidyInputs,applyLog:this.state.applyLog,processingStatus:this.state.processingStatus,onExport:this.onExport,onUndoClick:this.goBackToPreviousCluster})}),Object(q.jsxs)("div",{style:{position:"relative",marginLeft:this.state.sidebar?Ge:0,overflowX:"hidden"},children:[Object(q.jsxs)("div",{className:"toolbar",style:{width:this.state.sidebar?"calc(100% - ".concat(Ge," - 20px)"):"calc(100% - 20px)"},children:[Object(q.jsx)(ft,{currentDisplayMode:this.state.displayMode,setDisplayMode:this.setDisplayMode}),Object(q.jsx)("div",{className:"help-box",title:"Show a modal describing instructions and shortcuts.",children:Object(q.jsxs)("label",{style:{cursor:"pointer"},children:[Object(q.jsx)("input",{style:{cursor:"pointer"},type:"button",id:"custom-button",onClick:this.onToggleDirections}),Object(q.jsx)(Xe.b.Provider,{value:{className:"shared-class",size:"40"},children:Object(q.jsx)(He.a,{})})]})})]}),B&&Object(q.jsx)("div",{className:"App-status-pane",children:B}),S,this.state.showDirections&&Object(q.jsx)("div",{className:"black_overlay",onClick:this.onToggleDirections}),this.state.showDirections&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:"Directions"}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:this.onToggleDirections,children:Object(q.jsx)(Ue.e,{})}),Object(q.jsx)("h5",{children:" Selection "}),Object(q.jsx)("li",{children:' Hold down "Command/Control" in Zoom mode to temporarily enter add-to-selection mode. '}),Object(q.jsx)("li",{children:' Hold down "Alt" in Zoom mode to temporarily enter remove-from-selection mode. '}),Object(q.jsx)("li",{children:" To completely clear your selection, click anywhere in the plot while in add-to-selection or remove-from-selection modes. "}),Object(q.jsx)("li",{children:" To stay in add-to-select mode, you can press (b) or click the + icon in the toolbar."}),Object(q.jsx)("li",{children:" To stay in remove-from-select mode, you can press (d) or click the - icon in the toolbar. "}),Object(q.jsx)("h5",{children:" Zoom/Pan Mode "}),Object(q.jsx)("li",{children:" To enter zoom mode, click the magnifying glass icon in the toolbar, or press (z) on the keyboard. If you hold down shift, it will act as a bounding box zoom. "}),Object(q.jsx)("li",{children:" To pan, click the grab icon in the toolbar, click and drag on the scatter plot or axes, or press (p) on the keyboard. "}),Object(q.jsx)("h5",{children:" Other Key Modifiers: "}),Object(q.jsx)("li",{children:' Click "l" to toggle a log of previous actions. '}),Object(q.jsx)("li",{children:" Click space to toggle the sidebar. "}),Object(q.jsx)("li",{children:' Hold down "?" or "/" button to open direction panel. '}),Object(q.jsx)("li",{children:' Click "c" to toggle a table of the centroids of each cluster for each sample. '}),Object(q.jsx)("li",{children:' Click "s" to toggle a bar plot displaying approximate average silhoutte scores for each cluster. '})]}),this.state.showAbsorbBins&&Object(q.jsx)("div",{className:"black_overlay",onClick:this.onToggleShowAbsorbBins}),this.state.showAbsorbBins&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:"Absorb Bins"}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:this.onToggleShowAbsorbBins,children:Object(q.jsx)(Ue.e,{})}),Object(q.jsxs)("div",{className:"App-row-contents",children:["From:",Object(q.jsx)(Pe,{data:x,onClusterRowsChange:this.onClusterRowsFromChange,onClusterColorChange:this.onClusterColorChange,currentFilters:s.getFilteredFromClusters(),colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:Ct}),"To:",Object(q.jsx)(Pe,{data:_,onClusterRowsChange:this.onClusterRowsToChange,onClusterColorChange:this.onClusterColorChange,currentFilters:s.getFilteredToClusters(),colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:Ct})]}),j]}),this.state.showLog&&Object(q.jsx)("div",{className:"black_overlay",onClick:function(){return e.setState({showLog:!e.state.showLog})}}),this.state.showLog&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:" Previous Actions "}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:function(){return e.setState({showLog:!e.state.showLog})},children:Object(q.jsx)(Ue.e,{})}),Object(q.jsx)(Me,{data:k,onClusterColorChange:this.onClusterColorChange,onClusterRowsChange:this.onClusterRowsChange,colName:"Actions (Starting from most recent)"}),Object(q.jsxs)("label",{className:"custom-file-export",title:"Exports your clustering. Includes columns for copy number estimates if purity/ploidy is toggled on at export time.",children:[Object(q.jsx)(gt,{logData:k,fileName:this.state.chosenFile,onExport:this.onExport}),"Export ",Object(q.jsx)(Ue.c,{})]})]}),this.state.showCentroidTable&&Object(q.jsx)("div",{className:"black_overlay",onClick:function(){return e.setState({showCentroidTable:!e.state.showCentroidTable})}}),this.state.showCentroidTable&&Object(q.jsxs)("div",{className:"Directions",children:[Object(q.jsx)("h2",{className:"pop-up-window-header",children:" Centroid Table "}),Object(q.jsx)("div",{className:"Exit-Popup",onClick:function(){return e.setState({showCentroidTable:!e.state.showCentroidTable})},children:Object(q.jsx)(Ue.e,{})}),Object(q.jsx)(Pe,{data:s.getCentroidData(),onClusterColorChange:this.onClusterColorChange,onClusterRowsChange:this.onClusterRowsChange,colors:Ct,currentFilters:[""],centroidTable:!0,colOneName:"Cluster",colTwoName:"Sample",colThreeName:"Centroid",cols:[{name:"Cluster",type:"key"},{name:"Sample",type:"sample"},{name:"Centroid",type:"centroid"}]}),C]}),this.state.showSilhouettes===yt.done&&Object(q.jsx)("div",{className:"black_overlay",onClick:this.onToggleSilhoutteBarPlot}),this.state.showSilhouettes===yt.done&&Object(q.jsx)(ut,{silhouetteData:this.state.silhouettes,avgClusterSilhouette:this.state.indexedData.getAvgSilhouette(),clusterDistances:this.state.indexedData.getClusterDistanceMatrix(),clusterTableData:A,colors:Ct,onToggleSilhoutteBarPlot:this.onToggleSilhoutteBarPlot}),Object(q.jsx)("div",{className:"before-loading"})]})]})}}]),s}(a.a.Component);i.a.render(Object(q.jsx)(xt,{}),document.getElementById("root"))}},[[412,1,2]]]);
//# sourceMappingURL=main.5fb2f2bd.chunk.js.map