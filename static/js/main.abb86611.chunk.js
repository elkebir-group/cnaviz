(this.webpackJsonpcnaviz=this.webpackJsonpcnaviz||[]).push([[0],{112:function(e,t,a){},192:function(e,t,a){},193:function(e,t,a){},194:function(e,t,a){},217:function(e,t,a){},231:function(e,t){},233:function(e,t){},244:function(e,t,a){},246:function(e,t,a){},247:function(e,t,a){},358:function(e,t,a){},359:function(e,t,a){},361:function(e,t,a){"use strict";a.r(t);var r=a(1),s=a.n(r),n=a(196),i=a.n(n),o=(a(217),a(28)),l=a(33),c=a(10),h=a(11),u=a(7),d=a(15),p=a(14),v=a(9),f=a(17),m=a.n(f),g=a(135),b=a.n(g),y=a(6),S=a.n(y),C=function(e){function t(e,a){if(Object(c.a)(this,t),this.start=e,this.end=a,a<e)throw new RangeError("End cannot be less than start");this.start=e,this.end=a}return Object(h.a)(t,[{key:e,value:m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start;case 2:return e.next=4,this.end;case 4:case"end":return e.stop()}}),e,this)}))},{key:"getLength",value:function(){return this.end-this.start}},{key:"getCenter",value:function(){return.5*(this.start+this.end)}},{key:"hasOverlap",value:function(e){return Math.max(this.start,e.start)<Math.min(this.end,e.end)}},{key:"toString",value:function(){return"[".concat(this.start,", ").concat(this.end,")")}}]),t}(Symbol.iterator),j=function(){function e(t,a,r){if(Object(c.a)(this,e),this.chr=void 0,this._interval=void 0,a<0)throw new RangeError("Start cannot be negative");this.chr=t,this._interval=new C(a,r)}return Object(h.a)(e,[{key:"start",get:function(){return this._interval.start}},{key:"end",get:function(){return this._interval.end}},{key:"getLength",value:function(){return this._interval.getLength()}},{key:"hasOverlap",value:function(e){return this.chr===e.chr&&this._interval.hasOverlap(e._interval)}},{key:"toString",value:function(){return"".concat(this.chr,":").concat(this.start,"-").concat(this.end)}},{key:"endsRoundedToMultiple",value:function(t){if(t<=0)throw new RangeError("Cannot round to a multiple <= 0 (got ".concat(t,")"));return new e(this.chr,Math.floor(this.start/t)*t,Math.ceil(this.end/t)*t)}}],[{key:"parse",value:function(t){var a=t.match(/([\w:]+)\W+(\d+)\W+(\d+)/);if(a)return new e(a[1],Number.parseInt(a[2],10),Number.parseInt(a[3],10));throw new RangeError("Could not parse interval")}}]),e}(),A=a(21),x=a(40),_={toChromosomeInterval:function(e){return new j(e["#CHR"],e.START,e.END)},flattenNestedBins:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=0,r=e.length;a<r;a++){var s=e[a];Array.isArray(s)?this.flattenNestedBins(s,t):t.push(s)}return t}},O=a(53),k=a(51),w=a(3);function D(e,t){t||(t=e.currentTarget);var a=t.getBoundingClientRect();return{x:e.clientX-a.left,y:e.clientY-a.top}}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,r=e;if(a&&(r-=a),r<0)return"";var s=Math.floor(r);return s>=75e4?"".concat((s/1e6).toFixed(t)," Mb"):s>=1e4?"".concat((s/1e3).toFixed(t)," kb"):"".concat(s," bp")}function R(e,t,a){if(e.length!==t.length)throw Error("Calculate Euclidean Distance - pointOne dim does not match pointTwo dim");for(var r=0,s=0;s<e.length;s++){var n=Number(e[s])-Number(t[s]);r+=n*n}return!0===a?Math.sqrt(r):r}var T=function(e){var t=w.e(e);if(null!==t){var a=t.rgb();return[a.r/255,a.g/255,a.b/255,a.opacity]}},B=function(e){var t,a=[],r=Object(v.a)(e);try{for(r.s();!(t=r.n()).done;){var s=Object(x.a)(t.value,2),n=s[0],i=s[1];a.push(n),a.push(i)}}catch(o){r.e(o)}finally{r.f()}return a},L=function(e,t){var a,r=[],s=Object(v.a)(t);try{for(s.s();!(a=s.n()).done;){var n=a.value;r.push(R(e,n,!0))}}catch(i){s.e(i)}finally{s.f()}return S.a.mean(r)},N=function(e,t){var a=[];if(1===t.length)return 0;var r,s=Object(v.a)(t);try{for(s.s();!(r=s.n()).done;){var n=R(e,r.value,!0);0!==n&&a.push(n)}}catch(i){s.e(i)}finally{s.f()}return S.a.mean(a)};function M(e,t,a,r){var s=Object(A.a)(t.keys()),n=new Map;if(1===s.length)return[];for(var i=0,o=e.length>0?.01:1,l=0;l<e.length;l++){var c=e[l],h=a[l],u=new Map,d=t.get(h);if(!d)throw new Error("Key error: Cluster not found");if(1!==d.length){var p,f=E(d,o),m=N(c,f),g=1/0,b=Object(v.a)(s);try{for(b.s();!(p=b.n()).done;){var y=p.value;if(y!==h){var C=t.get(y);if(!C)throw new Error("Key error: Cluster not found");var j=E(C,o),x=L(c,j);u.set(Number(y),x),x<g&&(g=x)}}}catch(I){b.e(I)}finally{b.f()}var _=S.a.max([g,m]);if(_){var O=(g-m)/_;if(i+=O,n.has(h)){var k=n.get(h);k&&(k.push(O),n.set(h,k))}else n.set(h,[O])}r.set(h,u)}else if(n.has(h)){var w=n.get(h);w&&(w.push(0),n.set(h,w))}else n.set(h,[0])}var D,P=[],R=Object(v.a)(s);try{for(R.s();!(D=R.n()).done;){var T=D.value,B=n.get(Number(T));if(void 0!==B){var M={cluster:Number(T),avg:S.a.mean(B)};P.push(M)}}}catch(I){R.e(I)}finally{R.f()}var F=i/e.length;return console.log(F),S.a.sortBy(P,"cluster")}function E(e,t){for(var a=new Set,r=e.length,s=t*r;a.size<s;){var n=e[Math.floor(Math.random()*r)];a.add(n)}return Object(A.a)(a)}var F=function(e){return Array.isArray(e)&&e.every((function(e){return"object"===typeof e&&!(e instanceof Array)}))},I=function(e,t){var a,r=t=t||(a=e,Array.from(a.map((function(e){return Object.keys(e)})).reduce((function(e,t){return new Set([].concat(Object(A.a)(e),Object(A.a)(t)))}),[]))),s=t;F(t)&&(r=t.map((function(e){return e.label})),s=t.map((function(e){return e.key})));var n=e.map((function(e){return s.map((function(t){return U(t,e)}))}));return[r].concat(Object(A.a)(n))},U=function(e,t){var a=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce((function(e,t,a,r){return void 0===e[t]?(r.splice(1),null):e[t]}),t);return void 0===a?e in t?t[e]:"":a},Y=function(e){return"undefined"===typeof e||null===e?"":e},G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e.filter((function(e){return e})).map((function(e){return e.map((function(e){return Y(e)})).map((function(e){return"".concat(e)})).join(t)})).join("\n")},z=function(e,t,a,r){if(F(e))return function(e,t,a,r){return G(I(e,t),a,r)}(e,t,a,r);if(s=e,Array.isArray(s)&&s.every((function(e){return Array.isArray(e)})))return function(e,t,a,r){return G(t?[t].concat(Object(A.a)(e)):e,a,r)}(e,t,a,r);var s;if("string"===typeof e)return function(e,t,a,r){return t?"".concat(t.join(a),"\n").concat(e):e}(e,t,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},K=.5,H=[[1,1],[1,0],[2,0],[2,1],[3,1],[4,2],[3,2]],X="-1",Q="-2",Z=new Set(["reverseBAF","genomicPosition","fractional_cn","logRD"]),V=["#CHR","START","END","CLUSTER","SAMPLE","RD","BAF"],J=["symbol","Genome Location"];function W(e,t,a){return new Promise((function(r,s){for(var n=[],i=[],o=new Map,l=t?"logRD":"RD",c=0;c<a.length;c+=e.length){for(var h=[],u=a[c].CLUSTER,d=c;d<c+e.length;d++){if(!(d<a.length))throw Error("Out of Range Error. There are bins missing in the data (bin must exist across all samples).");var p=a[d];d===c&&i.push(u),h.push(p.reverseBAF),h.push(p[l])}if(n.push(h),o.has(u)){var v=o.get(u);void 0!==v&&(v.push(h),o.set(u,v))}else o.set(u,[h])}r({multiDimData:n,clusterToData:o,labels:i})}))}var q=function(){function e(t){Object(c.a)(this,e),this._rdRanges=void 0,this._logRdRanges=void 0,this._locationGroupedData=void 0,this.brushedBins=void 0,this.brushedCrossfilter=void 0,this.brushedClusterDim=void 0,this._ndx=void 0,this._sample_dim=void 0,this._cluster_dim=void 0,this._chr_dim=void 0,this._genomic_pos_dim=void 0,this._samples=void 0,this._clusters=void 0,this._chrs=void 0,this._sampleGroupedData=void 0,this.clusterTableInfo=void 0,this.allRecords=void 0,this._cluster_filters=void 0,this.historyStack=void 0,this._clusterAmounts=void 0,this.logOfActions=void 0,this.centroids=void 0,this.centroidPts=void 0,this.chrToClusters=void 0,this.centroidDistances=void 0,this.shouldCalculatesilhouettes=void 0,this.currentsilhouettes=void 0,this.overallSilhouette=void 0,this.clusterDistanceMatrix=void 0,this.rdMeans=void 0,this._updateFractionalCopyNumbers=void 0,this.currentDataKey=void 0,this.sampleToPloidy=void 0,this.sampleToBafTicks=void 0,this.sampleToFractionalTicks=void 0,this._locationGroupedData={},this.initializeLocationGroupedData(t),this._sampleGroupedData={},this._rdRanges={},this.rdMeans={},this._logRdRanges={},this._samples=[],this._chrs=[],this._clusters=[],this.brushedBins=[],this.brushedCrossfilter=Object(O.a)(this.brushedBins),this.brushedClusterDim=this.brushedCrossfilter.dimension((function(e){return e.CLUSTER})),this._cluster_filters=[],this.historyStack=[],this._ndx=Object(O.a)(t),this.logOfActions=[],this.centroidPts={},this.centroids=[],this.chrToClusters={},this.centroidDistances={},this.shouldCalculatesilhouettes=!0,this.currentsilhouettes=[],this.clusterDistanceMatrix=new Map,this.overallSilhouette=0,this.currentDataKey="RD",this.sampleToPloidy={},this.sampleToBafTicks={},this.sampleToFractionalTicks={};var a,r=Object(v.a)(t);try{for(r.s();!(a=r.n()).done;){var s=a.value;this.chrToClusters[s["#CHR"]]?this.chrToClusters[s["#CHR"]].add(String(s.CLUSTER)):this.chrToClusters[s["#CHR"]]=new Set([String(s.CLUSTER)])}}catch(J){r.e(J)}finally{r.f()}for(var n=S.a.groupBy(t,"SAMPLE"),i=0,o=Object.entries(n);i<o.length;i++){var l=Object(x.a)(o[i],2),h=l[0],u=l[1];this._samples.push(h);var d=S.a.groupBy(u,"CLUSTER");this._clusters=S.a.union(this._clusters,Object.keys(d));for(var p=0,f=Object.values(d);p<f.length;p++){var m=f[p],g=S.a.groupBy(m,"#CHR");this._chrs=S.a.union(this._chrs,Object.keys(g))}}for(var b=S.a.groupBy(t,"CLUSTER"),C=0,j=Object.entries(b);C<j.length;C++){for(var A=Object(x.a)(j[C],2),_=A[0],w=A[1],D=S.a.groupBy(w,"SAMPLE"),P={},R=0,T=Object.entries(D);R<T.length;R++){var B=Object(x.a)(T[R],2),L=B[0],N=B[1];this.sampleToPloidy[L]=2;var M=this.calculateCentroid(N,this.currentDataKey),E={cluster:parseInt(_),point:M};if(this.centroidPts[L]&&this.centroidPts[_])this.centroidPts[L][_].push(E);else if(this.centroidPts[L])this.centroidPts[L][_]=[E];else{var F={};F[_]=[E],this.centroidPts[L]=F}var I="("+M[0].toFixed(2)+","+M[1].toFixed(2)+")";P[L]=I}var U={key:_,sample:P};this.centroids.push(U)}if(this._cluster_filters=this._clusters,this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this._genomic_pos_dim=this._ndx.dimension((function(e){return e.genomicPosition})),this._sampleGroupedData=S.a.groupBy(this._ndx.allFiltered(),"SAMPLE"),this._clusterAmounts=S.a.cloneDeep(this._cluster_dim.group().all()),t.length>0){var Y,G=Object(v.a)(this._samples);try{for(G.s();!(Y=G.n()).done;){var z=Y.value,H=this._sampleGroupedData[z],X=[S.a.minBy(H,"RD").RD,S.a.maxBy(H,"RD").RD],Q=[S.a.minBy(H,"logRD").logRD,S.a.maxBy(H,"logRD").logRD];this.rdMeans[z]=S.a.meanBy(H,"RD"),this._rdRanges[z]=X,this._logRdRanges[z]=Q}}catch(J){G.e(J)}finally{G.f()}}for(var Z in n){this.getBAFLines(K,Z);var V=(2*(this._rdRanges[Z][1]+1)/this.rdMeans[Z]-1)/K;this.getFractionalCNTicks(K,0,6,V,Z)}this.initializeCentroidDistMatrix(),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.filterRecordsByScales=Object(k.a)(this.filterRecordsByScales),this.getBAFLines=Object(k.a)(this.getBAFLines),this._updateFractionalCopyNumbers=Object(y.memoize)(this.updateFractionalCopyNumbers,(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t[0]+"_"+t[1]+"_"+t[2].length+"_"+t[3].join(".")}))}return Object(h.a)(e,[{key:"setShouldRecalculatesilhouettes",value:function(e){this.shouldCalculatesilhouettes=e}},{key:"getClusterDistanceMatrix",value:function(){return this.clusterDistanceMatrix}},{key:"getAvgSilhouette",value:function(){return this.overallSilhouette}},{key:"setSamplePloidy",value:function(e,t){this.sampleToPloidy[e]=t}},{key:"getSampleToPloidy",value:function(){return this.sampleToPloidy}},{key:"recalculatesilhouettes",value:function(){var e=Object(l.a)(m.a.mark((function e(t){var a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldCalculatesilhouettes){e.next=16;break}return a=null,e.prev=2,e.next=5,W(this._samples,t,this.allRecords);case 5:a=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return");case 12:r=M(a.multiDimData,a.clusterToData,a.labels,this.clusterDistanceMatrix),this.overallSilhouette=Number((s=r,S.a.meanBy(s,"avg")).toFixed(3)),this.currentsilhouettes=r,this.shouldCalculatesilhouettes=!1;case 16:return e.abrupt("return",this.currentsilhouettes);case 17:case"end":return e.stop()}var s}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeCentroidDistMatrix",value:function(){var e,t=Object(v.a)(this._samples);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.centroidDistances[a]=[];var r,s=this.getCentroidPoints(a),n=Object(v.a)(s);try{for(n.s();!(r=n.n()).done;){var i,o=r.value,l=Object(v.a)(s);try{for(l.s();!(i=l.n()).done;){var c=i.value,h=R(o.point,c.point);this.centroidDistances[a].push({cluster1:o.cluster,cluster2:c.cluster,dist:h})}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}}}catch(u){t.e(u)}finally{t.f()}}},{key:"getCentroidDistMatrix",value:function(e){return this.centroidDistances[e]}},{key:"calculateCentroid",value:function(e,t){return[S.a.meanBy(e,(function(e){return e.reverseBAF})),S.a.meanBy(e,(function(e){return e[t]}))]}},{key:"getCentroidData",value:function(){return this.centroids}},{key:"getCentroidPoints",value:function(e,t,a){var r,s=this.centroidPts[e],n=this._cluster_filters;r=t?this.chrToClusters[t]:new Set(n);var i,o=[],l=Object(v.a)(n);try{for(l.s();!(i=l.n()).done;){var c=i.value;r.has(c)&&s[c.valueOf()]&&o.push(s[c.valueOf()][0])}}catch(u){l.e(u)}finally{l.f()}if(a&&1!==a){var h=S.a.cloneDeep(o);return h.forEach((function(e){return e.point[1]=e.point[1]*a})),h}return o}},{key:"calculateClusterTableInfo",value:function(){var e,t=this._cluster_dim.group().all(),a=[],r=Object(v.a)(t);try{for(r.s();!(e=r.n()).done;){var s=e.value,n=Number((Number(s.value)/this.allRecords.length*100).toFixed(2));a.push({key:Number(s.key),value:n})}}catch(i){r.e(i)}finally{r.f()}return a}},{key:"initializeLocationGroupedData",value:function(e){this._locationGroupedData={};var t,a=Object(v.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value,s=_.toChromosomeInterval(r).toString();this._locationGroupedData[s]?this._locationGroupedData[s].push(r):this._locationGroupedData[s]=[r]}}catch(n){a.e(n)}finally{a.f()}}},{key:"isEmpty",value:function(){return 0===this.getSampleList().length}},{key:"getRdRange",value:function(e,t,a){var r=t?this._logRdRanges[e]:this._rdRanges[e];return[1*r[0],1*r[1]]}},{key:"getFractionCNRange",value:function(e,t,a){return[e*t+2*(1-e),e*a+2*(1-e)]}},{key:"getFractionalCNTicks",value:function(e,t,a,r,s){for(var n=[],i=t;i<=a;i++){var o={fractionalTick:e*i+2*(1-e),totalCN:i};n.push(o)}if(this.sampleToFractionalTicks[s]=n.map((function(e){return e.fractionalTick})),a===r)return n;if(a<r){for(var l=a+1;l<=r;l++){var c={fractionalTick:e*l+2*(1-e),totalCN:l};n.push(c)}return n}return n.slice(0,r+1)}},{key:"getSampleList",value:function(){return this._samples}},{key:"getAllChromosomes",value:function(){return this._chrs}},{key:"getAllClusters",value:function(){return this._clusters}},{key:"setFilters",value:function(e,t,a){t&&this._chr_dim.filter((function(e){return e===t})),a&&this._cluster_dim.filter((function(e){return-1!==a.indexOf(String(e))}))}},{key:"setChrFilter",value:function(e){e?(this._chr_dim.filterAll(),this._chr_dim.filter((function(t){return String(t)===String(e)}))):this._chr_dim.filterAll(),this._sampleGroupedData=S.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"setChrFilters",value:function(t){t&&1===t.length&&t[0]===e.ALL_CHRS_KEY?this._chr_dim.filterAll():t&&(this._chr_dim.filterAll(),this._chr_dim.filter((function(e){return-1!==t.indexOf(String(e))})))}},{key:"recalculateCentroids",value:function(e,t){console.log("Recalculating Centroids...."),this.centroids=[],this.centroidPts={};for(var a=t||this.allRecords,r=S.a.groupBy(a,"CLUSTER"),s=0,n=Object.entries(r);s<n.length;s++){for(var i=Object(x.a)(n[s],2),o=i[0],l=i[1],c=S.a.groupBy(l,"SAMPLE"),h={},u=0,d=Object.entries(c);u<d.length;u++){var p=Object(x.a)(d[u],2),v=p[0],f=p[1],m="fractional_cn"===e?"RD":e,g=this.calculateCentroid(f,m),b={cluster:parseInt(o),point:g};if(this.centroidPts[v]&&this.centroidPts[o])this.centroidPts[v][o].push(b);else if(this.centroidPts[v])this.centroidPts[v][o]=[b];else{var y={};y[o]=[b],this.centroidPts[v]=y}var C="("+g[0].toFixed(2)+","+g[1].toFixed(2)+")";h[v]=C}var j={key:o,sample:h};this.centroids.push(j)}}},{key:"setClusterFilters",value:function(t){t&&1===t.length&&t[0]===e.ALL_CLUSTERS_KEY?this._cluster_dim.filterAll():t&&(this._cluster_dim.filterAll(),this._cluster_dim.filter((function(e){return-1!==t.indexOf(String(e))}))),t&&(this._cluster_filters=t),this._sampleGroupedData=S.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"setGenomicPositionFilter",value:function(e){this._genomic_pos_dim.filterAll(),this._genomic_pos_dim.filter((function(t){return t>e[0]&&t<e[1]})),this._sampleGroupedData=S.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"clearAllFilters",value:function(){this._sample_dim.filterAll(),this._cluster_dim.filterAll(),this._chr_dim.filterAll(),this._sampleGroupedData=S.a.groupBy(this._ndx.allFiltered(),"SAMPLE")}},{key:"getActions",value:function(){return this.logOfActions}},{key:"updateCluster",value:function(e){if(this.brushedBins&&0!==this.brushedBins.length){this.historyStack.push(JSON.parse(JSON.stringify(this.brushedBins)));var t=this.brushedTableData(),a="Assigned to cluster "+e+" | ";a+="Clusters selected: ";var r,s=Object(v.a)(t);try{for(s.s();!(r=s.n()).done;){var n=r.value;a+=String(n.key)+" ("+String(n.value)+"%), "}}catch(g){s.e(g)}finally{s.f()}a+=" | ";var i=[S.a.minBy(this.brushedBins,this.currentDataKey)[this.currentDataKey],S.a.maxBy(this.brushedBins,this.currentDataKey)[this.currentDataKey]],o=[S.a.minBy(this.brushedBins,"reverseBAF").reverseBAF,S.a.maxBy(this.brushedBins,"reverseBAF").reverseBAF];a+=this.currentDataKey+" Range of Selected: ["+i[0].toFixed(2)+", "+i[1].toFixed(2)+"] | ",a+="Allelic Imbalance Range of Selected: ["+o[0].toFixed(2)+", "+o[1].toFixed(2)+"]",this.logOfActions.unshift({action:a});for(var l=0;l<this.brushedBins.length;l++){var c=_.toChromosomeInterval(this.brushedBins[l]).toString();if(this._locationGroupedData[c])for(var h=0;h<this._locationGroupedData[c].length;h++)this._locationGroupedData[c][h].CLUSTER=e}var u=Object.values(this._locationGroupedData),d=_.flattenNestedBins(u);this.centroids=[],this.centroidPts={},this.chrToClusters={};var p,f=Object(v.a)(d);try{for(f.s();!(p=f.n()).done;){var m=p.value;this.chrToClusters[m["#CHR"]]?this.chrToClusters[m["#CHR"]].add(String(m.CLUSTER)):this.chrToClusters[m["#CHR"]]=new Set([String(m.CLUSTER)])}}catch(g){f.e(g)}finally{f.f()}this.recalculateCentroids(this.currentDataKey,d),this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(O.a)(d),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=S.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this._cluster_filters.includes(String(e))||this._cluster_filters.push(String(e)),this.setClusterFilters(this._cluster_filters),this.shouldCalculatesilhouettes=!0,this._updateFractionalCopyNumbers.cache=new S.a.memoize.Cache}}},{key:"clearClustering",value:function(){this.brushedBins=Object(A.a)(this.allRecords),this.updateCluster(-1)}},{key:"getMeanRD",value:function(e){return this.rdMeans[e]}},{key:"setDataKeyType",value:function(e){this.currentDataKey=e}},{key:"undoClusterUpdate",value:function(){if(0!==this.historyStack.length){var e=this.historyStack[this.historyStack.length-1];this.historyStack.pop();for(var t=0;t<e.length;t++){var a=e[t],r=_.toChromosomeInterval(a).toString(),s=a.CLUSTER;if(this._cluster_filters.includes(String(s))||this._cluster_filters.push(String(s)),this._locationGroupedData[r])for(var n=0;n<this._locationGroupedData[r].length;n++)this._locationGroupedData[r][n].CLUSTER=s}var i=Object.values(this._locationGroupedData),o=_.flattenNestedBins(i);this.initializeCentroidDistMatrix(),this._ndx.remove(),this._ndx=Object(O.a)(o),this._sample_dim=this._ndx.dimension((function(e){return e.SAMPLE})),this._cluster_dim=this._ndx.dimension((function(e){return e.CLUSTER})),this._chr_dim=this._ndx.dimension((function(e){return e["#CHR"]})),this.brushedBins=[],this.brushedCrossfilter.remove(),this._clusterAmounts=S.a.cloneDeep(this._cluster_dim.group().all()),this.allRecords=this._ndx.all(),this.clusterTableInfo=this.calculateClusterTableInfo(),this.allRecords=this.allRecords.filter((function(e){return-2!==e.CLUSTER})),this.setClusterFilters(this._cluster_filters),this.setShouldRecalculatesilhouettes(!0)}}},{key:"updateFractionalCopyNumbers",value:function(e,t,a,r){var s=e/this.rdMeans[t],n=S.a.cloneDeep(a);return n.forEach((function(e){return e.fractional_cn=e.RD*s})),n}},{key:"getBAFLines",value:function(e,t){var a,r=new Set,s=[],n=Object(v.a)(H);try{for(n.s();!(a=n.n()).done;){var i=a.value,o=i[0],l=i[1],c=.5-(l*e+1*(1-e))/((o+l)*e+2*(1-e)),h=r.size;if(r.add(c),r.size!==h){var u={tick:c,state:i};s.push(u)}}}catch(p){n.e(p)}finally{n.f()}var d=S.a.sortBy(s,"tick");return this.sampleToBafTicks[t]=d,d}},{key:"brushedTableData",value:function(){var e=this._samples.length,t=this._clusterAmounts,a={};t.forEach((function(t){return a[Number(t.key)]=Number(t.value)/e}));var r,s=this.brushedBins.length,n=this.brushedClusterDim.group().all(),i=[],o=this._ndx.all().length,l=Object(v.a)(n);try{for(l.s();!(r=l.n()).done;){var c=r.value;i.push({key:Number(c.key),value:Number((Number(c.value)/Number(a[Number(c.key)])*100).toFixed(2)),selectPerc:Number((Number(c.value)/Number(s)*100).toFixed(2)),binPerc:Number((Number(c.value)/Number(o/e)*100).toFixed(2))})}}catch(h){l.e(h)}finally{l.f()}return i}},{key:"getRecords",value:function(e,t,a,r,s,n,i,o){if(e in this._sampleGroupedData){if("fractional_cn"===t){var l=this._updateFractionalCopyNumbers(o,e,this._sampleGroupedData[e],this._cluster_filters);return this.filterRecordsByScales(l,t,a,r,s,n,i,o)}return this.filterRecordsByScales(this._sampleGroupedData[e],t,a,r,s,n,i,o)}return[]}},{key:"filterRecordsByScales",value:function(e,t,a,r,s,n,i,o){return a&&r&&s&&n?e.filter((function(e){return e.genomicPosition>a&&e.genomicPosition<r&&e.reverseBAF>s[0]&&e.reverseBAF<s[1]&&e[t]>n[0]&&e[t]<n[1]})):a&&r&&s?e.filter((function(e){return e.genomicPosition>a&&e.genomicPosition<r&&e.reverseBAF>s[0]&&e.reverseBAF<s[1]})):a&&r&&n?e.filter((function(e){return e.genomicPosition>a&&e.genomicPosition<r&&e[t]>n[0]&&e[t]<n[1]})):s&&n?e.filter((function(e){return e.reverseBAF>s[0]&&e.reverseBAF<s[1]&&e[t]>n[0]&&e[t]<n[1]})):s?e.filter((function(e){return e.reverseBAF>s[0]&&e.reverseBAF<s[1]})):n?e.filter((function(e){return e[t]>n[0]&&e[t]<n[1]})):e}},{key:"getAllRecords",value:function(){return this.allRecords}},{key:"getClusterTableInfo",value:function(){return this.clusterTableInfo}},{key:"getFilteredClusters",value:function(){return this._cluster_filters}},{key:"setbrushedBins",value:function(e){this.brushedBins=[],this.brushedBins=e,this.brushedCrossfilter.remove(),this.brushedCrossfilter=Object(O.a)(e),this.brushedClusterDim=this.brushedCrossfilter.dimension((function(e){return e.CLUSTER}))}},{key:"getBrushedBins",value:function(){return this.brushedBins}},{key:"getClusterDim",value:function(){return this._cluster_dim}},{key:"calculateCopyNumbers",value:function(){for(var e=0;e<this.allRecords.length;e++){var t=this.allRecords[e].SAMPLE,a=this.sampleToPloidy[t],r=this.rdMeans[t],s=this.allRecords[e].RD;this.allRecords[e].fractional_cn=s*a/r}for(var n=0;n<this.allRecords.length;n++){for(var i=this.allRecords[n],o=i.SAMPLE,l=this.sampleToFractionalTicks[o],c=this.sampleToBafTicks[o],h=i.reverseBAF,u=i.fractional_cn,d=[],p=1/0,v=[-1,-1],f=0;f<c.length;f++){var m=c[f],g=m.state,b=m.tick,y=l[g[0]+g[1]];d.push([b,y]);var S=Math.pow(h-b,2)+Math.pow(u-y,2);S<p&&(p=S,v=g)}this.allRecords[n].CN="("+v[0]+","+v[1]+")"}}},{key:"calculateCopyNumbers2",value:function(){var e=this;if(0!==this._samples.length){for(var t=0;t<this.allRecords.length;t++){var a=this.allRecords[t].SAMPLE,r=this.sampleToPloidy[a],s=this.rdMeans[a],n=this.allRecords[t].RD;this.allRecords[t].fractional_cn=n*r/s}var i,o={},l=this._samples[0],c=this._sampleGroupedData[l],h=Object(v.a)(c);try{for(h.s();!(i=h.n()).done;){var u,d=i.value,p=_.toChromosomeInterval(d).toString(),f=this._locationGroupedData[p],m=[],g=Object(v.a)(f);try{for(g.s();!(u=g.n()).done;){var b=u.value,y=b.SAMPLE,S=this.sampleToPloidy[y],C=this.rdMeans[y],j=[b.reverseBAF,b.RD*S/C];m.push(j)}}catch(Y){g.e(Y)}finally{g.f()}o[p]=B(m)}}catch(Y){h.e(Y)}finally{h.f()}var A,O=this.sampleToBafTicks[l].map((function(e){return e.state})),k=[],w=Object(v.a)(O);try{var D=function(){var t,a=Object(x.a)(A.value,2),r=a[0],s=a[1],n={},i=Object(v.a)(e._samples);try{for(i.s();!(t=i.n()).done;){var o=t.value,l=e.sampleToBafTicks[o].find((function(e){return e.state[0]===r&&e.state[1]===s}));l?n[o]=l.tick:console.log("Error: Didn't find AB BAF for A-",r," B-",s)}}catch(Y){i.e(Y)}finally{i.f()}var c,h=r+s,u={},d=Object(v.a)(e._samples);try{for(d.s();!(c=d.n()).done;){var p=c.value,f=e.sampleToFractionalTicks[p][h];u[p]=f}}catch(Y){d.e(Y)}finally{d.f()}var m,g=[],b=Object(v.a)(e._samples);try{for(b.s();!(m=b.n()).done;){var y=m.value,S=n[y],C=u[y];g.push(S),g.push(C)}}catch(Y){b.e(Y)}finally{b.f()}k.push({state:[r,s],coord:g})};for(w.s();!(A=w.n()).done;)D()}catch(Y){w.e(Y)}finally{w.f()}for(var P=0;P<this.allRecords.length;P++){var T,L=this.allRecords[P],N=o[_.toChromosomeInterval(L).toString()],M=1/0,E=[-1,-1],F=Object(v.a)(k);try{for(F.s();!(T=F.n()).done;){var I=T.value,U=R(N,I.coord);U<M&&(M=U,E=I.state)}}catch(Y){F.e(Y)}finally{F.f()}this.allRecords[P].CN="("+E[0]+","+E[1]+")"}}}},{key:"_getData",value:function(e,t,a,r){return(e[t][r]||{})[a]||[]}}]),e}();q.ALL_CHRS_KEY="",q.ALL_CLUSTERS_KEY="";var $=a(62),ee=(a(244),a(2)),te=70,ae=20,re=35,se=60,ne="#999999",ie="rgba(232, 232, 232, 1)",oe="-1",le="-2",ce="scatterplot-scale",he="circles",ue=0,de=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;Object(c.a)(this,a),(r=t.call(this,e))._svg=void 0,r._circleIdPrefix=void 0,r._clusters=void 0,r.brushedNodes=void 0,r.previous_brushed_nodes=void 0,r._canvas=void 0,r._currXScale=void 0,r._currYScale=void 0,r._original_XScale=void 0,r._original_YScale=void 0,r._original_transform=void 0,r._current_transform=void 0,r.scatter=void 0,r.zoom=void 0,r.onBrushedBinsUpdated=function(e){r.props.onBrushedBinsUpdated(e)},r._svg=null,r._canvas=null,r.scatter=null,r._circleIdPrefix=ue,ue++,r.computeScales=Object(k.a)(r.computeScales),r.handleMouseMove=r.handleMouseMove.bind(Object(u.a)(r)),r.onBrushedBinsUpdated=r.onBrushedBinsUpdated.bind(Object(u.a)(r)),r._clusters=r.initializeListOfClusters(),r.brushedNodes=new Set,r.previous_brushed_nodes=new Set,r.onZoom=r.onZoom.bind(Object(u.a)(r)),r.resetZoom=r.resetZoom.bind(Object(u.a)(r)),r.zoom=null;var s=r.computeScales(r.props.rdRange,e.width,e.height),n=s.bafScale,i=s.rdrScale;r._currXScale=n,r._currYScale=i,r._original_XScale=r._currXScale,r._original_YScale=r._currYScale;var o=e.data;return r._original_transform=w.o.translate(0,0).scale(1),r._current_transform=r._original_transform,r.state={selectedCluster:r._clusters.length>0?r._clusters[0]:oe,quadTree:w.g().x((function(e){return e.reverseBAF})).y((function(t){return t[e.yAxisToPlot]})).addAll(o)},r}return Object(h.a)(a,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;e.sort((function(e,t){return e.key>t.key?1:e.key<t.key?-1:0})),this._clusters=[];var t,a=Object(v.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(s){a.e(s)}finally{a.f()}for(;this._clusters.length>0&&(this._clusters[0]===oe||this._clusters[0]===le);)this._clusters.shift();return this._clusters}},{key:"handleMouseMove",value:function(e){var t=D(e),a=t.x,r=t.y,s={rd:this._currYScale.invert(r),baf:this._currXScale.invert(a)};if(s.baf>this._currXScale.domain()[0]&&s.baf<this._currXScale.domain()[1]&&s.rd>this._currYScale.domain()[0]&&s.rd<this._currYScale.domain()[1]){var n=Math.abs(this._currXScale.invert(a)-this._currXScale.invert(a-20));this.props.onRecordsHovered(this.state.quadTree.find(s.baf,s.rd,n)||null)}else this.props.onRecordsHovered(null)}},{key:"renderTooltipAtRdBaf",value:function(e,t,a){if(!a)return null;var r=this._currYScale(e)||0,s=(this._currXScale(t)||0)+10;return Object(ee.jsx)("div",{className:"Scatterplot-tooltip",style:{position:"absolute",top:r-150,left:s,width:275,height:150,pointerEvents:"none"},children:a})}},{key:"renderTooltip",value:function(){var e=this.props,t=e.data,a=e.hoveredLocation,r=e.yAxisToPlot;if(!a)return null;var n=[];if(0===(n=t.filter((function(e){var t=_.toChromosomeInterval(e);return a.chr===t.chr&&a.start===t.start&&a.end===t.end}))).length&&(n=t.filter((function(e){return _.toChromosomeInterval(e).hasOverlap(a)}))),n[0]){var i=this._currXScale(n[0].reverseBAF),o=this._currYScale(n[0][r]),l=this._currXScale.range(),c=this._currYScale.range(),h="RDR: ";if("fractional_cn"===r?h="Fractional CN: ":"logRD"===r&&(h="Log RDR: "),1===n.length&&i&&o&&i>l[0]&&i<l[1]&&o<c[0]&&o>c[1]){var u=n[0],d=_.toChromosomeInterval(u);return this.renderTooltipAtRdBaf(u[r],u.reverseBAF,Object(ee.jsxs)(s.a.Fragment,{children:[Object(ee.jsxs)("p",{children:[Object(ee.jsx)("b",{children:d.toString()}),Object(ee.jsx)("br",{}),"(",P(d.getLength()),")"]}),Object(ee.jsxs)("div",{children:[" ",h+u[r].toFixed(2)]}),Object(ee.jsxs)("div",{children:[" 0.5 - BAF: ",u.reverseBAF.toFixed(2)]}),Object(ee.jsxs)("div",{children:[" Cluster ID: ",u.CLUSTER]})]}))}}return null}},{key:"render",value:function(){var e=this,t=this.props,a=t.width,r=t.height,s=this._clusters.map((function(e){return Object(ee.jsx)("option",{value:e,children:e},e)}));return s.unshift(Object(ee.jsx)("option",{value:oe,children:oe},oe)),s.unshift(Object(ee.jsx)("option",{value:le,children:le},le)),Object(ee.jsxs)("div",{ref:function(t){return e.scatter=t},className:"Scatterplot",style:{width:a,height:r},children:[Object(ee.jsx)("canvas",{ref:function(t){return e._canvas=t},width:a,height:r,className:"canvas",style:{position:"absolute",top:re,zIndex:-4,left:te,width:a-te-ae,height:r-re-se}}),Object(ee.jsx)("svg",{ref:function(t){return e._svg=t},style:{zIndex:100},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+a+" "+r,onMouseMove:this.handleMouseMove}),Object(ee.jsx)("div",{className:"Scatterplot-tools",children:Object(ee.jsx)("button",{className:"custom-button",onClick:this.resetZoom,children:"Reset View"})}),this.renderTooltip()]})}},{key:"resetZoom",value:function(){if(this._svg){this._currXScale=this._original_XScale,this._currYScale=this._original_YScale;this.props.onZoom({xScale:null,yScale:null}),this.redraw()}}},{key:"componentDidMount",value:function(){this.redraw(),this.forceHover(this.props.hoveredLocation)}},{key:"propsDidChange",value:function(e,t){var a=this;return t.some((function(t){return a.props[t]!==e[t]}))}},{key:"componentDidUpdate",value:function(e){var t=this,a=this.props.scales.xScale,r=this.props.scales.yScale,s=e.scales.xScale,n=e.scales.yScale;function i(e,t){return!(!e||t)||!(!e||!t||e[0]===t[0]&&e[1]===t[1])}function o(e,t){return!(!e||t)||!!(e&&t&&(Math.abs(e[0]-t[0])>1e-4||Math.abs(e[1]-t[1])>1e-4))}if(!a&&!r&&s&&n)this.resetZoom();else if(i(a,s)||i(r,n)){a&&this._currXScale.domain(a),r&&this._currYScale.domain(r);var l=this.props.data,c=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(l);this.setState({quadTree:c}),this.redraw()}if(this.props.hoveredLocation!==e.hoveredLocation)this.forceUnhover(),this.forceHover(this.props.hoveredLocation);else if(this.propsDidChange(e,["purity","ploidy"])){var h=this.props.data,u=this.computeScales(this.props.rdRange,this.props.width,this.props.height).rdrScale;this._currYScale=u,this._original_YScale=u;var d=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(h);this.setState({quadTree:d}),this.redraw()}else if(this.propsDidChange(e,["showCentroids","displayMode","colors","brushedBins","width","height"])){var p=this.props.data,v=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(p);this.setState({quadTree:v}),this.redraw(),this.forceHover(this.props.hoveredLocation)}else if(!S.a.isEqual(this.props.data,e.data)||this.props.yAxisToPlot!==e.yAxisToPlot){var f=this.computeScales(this.props.rdRange,this.props.width,this.props.height),m=f.bafScale,g=f.rdrScale;if(o(this._currXScale.domain(),this._original_XScale.domain())||o(this._currYScale.domain(),this._original_YScale.domain())){if(this.props.yAxisToPlot!==e.yAxisToPlot){var b=this._currYScale.domain();if("logRD"===this.props.yAxisToPlot){b[0]<=0&&(b[0]=.1),b[1]<=0&&(b[1]=.1);var y=[Math.log2(b[0]),Math.log2(b[1])];this._currYScale.domain(y).range(this._currYScale.range())}else if("fractional_cn"===this.props.yAxisToPlot){var C=[b[0]*this.props.ploidy/this.props.meanRD,b[1]*this.props.ploidy/this.props.meanRD];this._currYScale.domain(C).range(this._currYScale.range())}else if("logRD"===e.yAxisToPlot){var j=[Math.pow(2,b[0]),Math.pow(2,b[1])];this._currYScale.domain(j).range(this._currYScale.range())}else if("fractional_cn"===e.yAxisToPlot){var A=[b[0]*this.props.meanRD/this.props.ploidy,b[1]*this.props.meanRD/this.props.ploidy];this._currYScale.domain(A).range(this._currYScale.range())}}this._original_XScale=m,this._original_YScale=g}else this._currXScale=m,this._currYScale=g,this._original_XScale=this._currXScale,this._original_YScale=this._currYScale;var x=this.props.data,_=w.g().x((function(e){return e.reverseBAF})).y((function(e){return e[t.props.yAxisToPlot]})).addAll(x);this.setState({quadTree:_});var O={xScale:this._currXScale.domain(),yScale:this._currYScale.domain()};this.props.onZoom(O),this.redraw(),this.forceHover(this.props.hoveredLocation)}this.props.clusterTableData!==e.clusterTableData&&this.initializeListOfClusters()}},{key:"computeScales",value:function(e,t,a,r,s){var n=[te,t-ae],i=[a-se,re],o=s?e[0]:this.props.applyLog?-2:0;this.props.showPurityPloidy&&(o=e[0]);var l=r||[-.01,.51];return{bafScale:w.i().domain(l).range(n),rdrScale:w.i().domain([o,e[1]]).range(i)}}},{key:"onZoom",value:function(e){this.props.onZoom(e)}},{key:"redraw",value:function(){var e=this;if(this._svg&&this._canvas&&this.scatter){var t=this,a=this.props,r=a.width,s=a.height,n=a.customColor,i=a.brushedBins,o=a.data,l=a.colors,c=a.yAxisToPlot,h=a.centroidPts,u=a.showPurityPloidy,d=this.props.displayMode,p=this._currXScale,f=this._currYScale,m="RD"===c?"RDR":"fractional_cn"===c?"Copy Number":"log RDR",g=w.j(this._svg);g.selectAll(".scatterplot-scale").remove(),g.append("text").classed(ce,!0).attr("text-anchor","middle").attr("x",S.a.mean(this._currXScale.range())).attr("y",s-se+40).style("text-anchor","middle").text("Allelic Imbalance (0.5 - BAF)"),g.append("text").classed(ce,!0).attr("y",20).attr("x",0-S.a.mean(this._currYScale.range())).attr("transform","rotate(-90)").style("text-anchor","middle").text(m);var b=function(e,t){return e.classed(ce,!0).attr("transform","translate(0, ".concat(s-se,")")).call(w.a(t)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-30)")};if(u){var y=this._currXScale.domain(),C=this.props.BAF_lines.filter((function(e){return e.tick>y[0]&&e.tick<y[1]})),j=C.map((function(e){return e.tick}));b=function(e,t){return e.classed(ce,!0).attr("id","Grid").attr("transform","translate(0, ".concat(s-se,")")).call(w.a(t).tickValues(j).tickSizeInner(-s+re+se).tickFormat((function(e,t){return j[t].toFixed(2)+" ("+C[t].state[0]+","+C[t].state[1]+")"}))).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-30)")}}var x=function(e,t){return e.classed(ce,!0).attr("id","Grid").attr("transform","translate(".concat(te,", 0)")).call(w.b(t))};if(u){var O=this.props.fractionalCNTicks,k=this._currYScale.domain(),D=this.props.max_cn,P=D>k[1]?D:k[1],R=O.filter((function(e){return e.fractionalTick>k[0]&&e.fractionalTick<P&&e.fractionalTick<k[1]})),B=R.map((function(e){return e.fractionalTick}));x=function(e,t){return e.classed(ce,!0).attr("id","Grid").attr("transform","translate(".concat(te,", 0)")).call(w.b(t).tickValues(B).tickSizeInner(80-r).tickFormat((function(e,t){return R[t].totalCN+" ("+Number(e.valueOf()).toFixed(2)+")"})))}}var L=[];i.forEach((function(e){return L.push(_.toChromosomeInterval(e).toString())})),this.previous_brushed_nodes=new Set(L);var N=this.previous_brushed_nodes,M=g.append("g"),E=g.append("g"),F=w.o,I=w.n().scaleExtent([0,100]),U=w.n().scaleExtent([0,100]),Y=function(){return w.p(M.node())},G=function(){return w.p(E.node())};M.call(I).attr("pointer-events","none"),E.call(U).attr("pointer-events","none");var z=w.n().on("zoom",(function(){try{var e=w.f.transform,t=e.k/F.k,a=function(e){if(e.sourceEvent)return[e.sourceEvent.layerX,e.sourceEvent.layerY];return[r/2,s/2]}(w.f),n=a[0]>p.range()[0],i=a[1]<f.range()[0];d!==ut.zoom&&n&&i||(1===t?(n&&I&&t&&a&&M&&M.call(I.translateBy,(e.x-F.x)/Y().k,0),i&&U&&t&&a&&E&&E.call(U.translateBy,0,(e.y-F.y)/G().k)):(n&&I&&t&&a&&M&&M.call(I.scaleBy,t,a),i&&U&&t&&a&&E&&E.call(U.scaleBy,t,a))),F=e,he()}catch(o){console.log("Error: ",o)}})).on("end",(function(){var e=t._currXScale.domain(),a=t._currYScale.domain(),r=t._original_XScale.domain(),s=t._original_YScale.domain();if(e[0]!==r[0]||e[1]!==r[1]||a[0]!==s[0]||a[1]!==s[1]){var n={xScale:t._currXScale.domain(),yScale:t._currYScale.domain()};t.props.onZoom(n)}})),K=this._canvas.getContext("webgl");K.clearColor(0,0,0,1);var H,X=[],Q=Object(v.a)(o);try{for(Q.s();!(H=Q.n()).done;){var Z=H.value;N.has(_.toChromosomeInterval(Z).toString())||X.push(Z)}}catch(ue){Q.e(ue)}finally{Q.f()}var V,J=Object(v.a)(o);try{for(J.s();!(V=J.n()).done;){var W=V.value;N.has(_.toChromosomeInterval(W).toString())&&X.push(W)}}catch(ue){J.e(ue)}finally{J.f()}var q=$.webglFillColor().value((function(e){return T(function(e){if(N.has(_.toChromosomeInterval(e).toString()))return n;if(-1===e.CLUSTER)return ne;if(-2===e.CLUSTER)return ie;var t=e.CLUSTER%l.length;return l[t]}(e))})).data(X),ee=$.seriesWebglPoint().xScale(t._currXScale).yScale(t._currYScale).size(3).crossValue((function(e){return e.reverseBAF})).mainValue((function(e){return e[c]})).context(K);if(ee.decorate((function(e){q(e),K.depthFunc(K.NEVER),K.disable(K.DEPTH_TEST)})),g.append("clipPath").attr("id","clip").append("rect").attr("x",te).attr("y",re).attr("width",r-ae-te).attr("height",s-se-re),g.append("g").classed("eventrect",!0).append("rect").attr("x",te).attr("y",re).attr("width",r-ae-te).attr("height",s-se-re).style("fill","none").style("pointer-events","all").attr("clip-path","url(#clip)"),this._canvas.width=r,this._canvas.height=s,he(),d===ut.select||d===ut.erase){var oe=w.c().keyModifiers(!1).extent([[te-2,re-2],[this.props.width-ae+2,this.props.height-se+2]]).on("end",(function(){e.updatePoints(w.f),g.selectAll(".brush").remove(),e.onBrushedBinsUpdated(Object(A.a)(e.brushedNodes))}));g.append("g").attr("class","brush").call(oe)}else if(d===ut.zoom)g.selectAll(".brush").remove();else if(d===ut.boxzoom){var le=w.c().keyModifiers(!1).extent([[te-2,re-2],[this.props.width-ae+2,this.props.height-se+2]]).on("start brush",(function(){return e.updatePoints(w.f)})).on("end",(function(){g.selectAll(".brush").remove(),function(){if(!t._svg)return;if(t.props.data){var e=w.f.selection;if(e){var a=[Number(t._currYScale.invert(e[1][1])),Number(t._currYScale.invert(e[0][1]))],n=[Number(t._currXScale.invert(e[0][0])),Number(t._currXScale.invert(e[1][0]))],i=t.computeScales(a,r,s,n,!0),o=i.bafScale,l=i.rdrScale;t._currXScale=o,t._currYScale=l,t.redraw();var c={xScale:t._currXScale.domain(),yScale:t._currYScale.domain()};t.props.onZoom(c)}}}()}));g.append("g").attr("class","brush").call(le)}g.call(z).call(z.transform,w.o.scale(1))}function he(){K.clear(K.COLOR_BUFFER_BIT),K.clearColor(255,255,255,1);var e=Y().rescaleX(p),a=G().rescaleY(f);M.call(b,e),E.call(x,a),t._currXScale=e,t._currYScale=a,t._canvas&&(ee.xScale(t._currXScale).yScale(t._currYScale),ee(X)),g.select(".Centroids").remove(),t.props.showCentroids&&g.select(".eventrect").append("g").attr("clip-path","url(#clip)").classed("Centroids",!0).selectAll("path").data(h).enter().append("path").attr("class","point").attr("d",w.k().type(w.m)).attr("fill",(function(e){return function(e){if(-1===e)return ne;if(-2===e)return ie;var t=e%l.length;return l[t]}(e.cluster)})).attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black").attr("transform",(function(e){return"translate("+t._currXScale(e.point[0])+","+t._currYScale(e.point[1])+")"}))}}},{key:"updatePoints",value:function(e){var t=this;if(this._svg){var a=this.props,r=a.brushedBins,s=a.data,n=a.yAxisToPlot,i=a.displayMode;if(s){var o=w.f.selection;if(o){var l=s.filter((function(e){return a=o,r=[t._currXScale(e.reverseBAF),t._currYScale(e[n])],a[0][0]<=r[0]&&r[0]<=a[1][0]&&a[0][1]<=r[1]&&r[1]<=a[1][1];var a,r}));l&&(i===ut.select?l=S.a.uniqBy(S.a.union(l,r),(function(e){return e["#CHR"]+"_"+e.START})):i===ut.erase&&(l=S.a.difference(r,l)),this.brushedNodes=new Set(l))}else this.brushedNodes=new Set([])}}}},{key:"getElementsForGenomeLocation",value:function(e){var t=this;if(!this._svg||!e||!this._canvas)return[];var a=this.props,r=a.data,s=a.yAxisToPlot,n=[];n=r.filter((function(t){var a=_.toChromosomeInterval(t);return e.chr===a.chr&&e.start===a.start&&e.end===a.end}));var i=this._currXScale.range(),o=this._currYScale.range();0===n.length&&(n=(n=r.filter((function(t){return _.toChromosomeInterval(t).hasOverlap(e)}))).filter((function(e){var a=t._currXScale(e.reverseBAF),r=t._currYScale(e[s]);return a&&r&&a>i[0]&&a<i[1]&&r<o[0]&&r>o[1]})));var l=w.j(this._svg);l.select(".circles").remove(),l.select(".eventrect").append("g").classed(he,!0).selectAll("circle").data(n).enter().append("circle").attr("id",(function(e){return t._circleIdPrefix+_.toChromosomeInterval(e).toString()})).attr("cx",(function(e){return t._currXScale(e.reverseBAF)||0})).attr("cy",(function(e){return t._currYScale(e[s])||0})).attr("r",3).attr("fill",(function(e){if(t.previous_brushed_nodes.has(_.toChromosomeInterval(e).toString()))return t.props.customColor;if(-1===e.CLUSTER)return ne;if(-2===e.CLUSTER)return ie;var a=e.CLUSTER%t.props.colors.length;return t.props.colors[a]})).attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black")}},{key:"forceHover",value:function(e){this.getElementsForGenomeLocation(e)}},{key:"forceUnhover",value:function(){this._svg&&w.j(this._svg).select(".circles").remove()}}]),a}(s.a.Component);de.defaultProps={width:400,height:302,onNewCurveState:S.a.noop,onRecordHovered:S.a.noop};var pe=a(208),ve=(a(246),["onMouseMove","onMouseLeave","style","children"]),fe=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).state={mouseCoordinates:null},r.storeMouseCoordinates=r.storeMouseCoordinates.bind(Object(u.a)(r)),r.clearMouseCoordinates=r.clearMouseCoordinates.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"storeMouseCoordinates",value:function(e){this.setState({mouseCoordinates:D(e)}),this.props.onMouseMove&&this.props.onMouseMove(e)}},{key:"clearMouseCoordinates",value:function(e){this.setState({mouseCoordinates:null}),this.props.onMouseLeave&&this.props.onMouseLeave(e)}},{key:"render",value:function(){var e=this.props,t=(e.onMouseMove,e.onMouseLeave,e.style),a=e.children,r=Object(pe.a)(e,ve),s=Object.assign({position:"relative"},t);return Object(ee.jsxs)("div",Object(o.a)(Object(o.a)({onMouseMove:this.storeMouseCoordinates,onMouseLeave:this.clearMouseCoordinates,style:s},r),{},{children:[a,this.state.mouseCoordinates&&Object(ee.jsx)(me,{where:this.state.mouseCoordinates})]}))}}]),a}(s.a.Component);function me(e){var t=e.where,a=t.x,r={top:t.y-1,willChange:"top"},n={left:a-1,willChange:"left"};return Object(ee.jsxs)(s.a.Fragment,{children:[Object(ee.jsx)("div",{className:"Bullseye-horizontal-line",style:r}),Object(ee.jsx)("div",{className:"Bullseye-vertical-line",style:n})]})}a(112);var ge=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).handleCallBack=function(e){r.props.parentCallBack(e)},r.state={selectedSample:e.initialSelectedSample},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(u.a)(r)),r.handleRecordsHovered=r.handleRecordsHovered.bind(Object(u.a)(r)),r.handleCallBack=r.handleCallBack.bind(Object(u.a)(r)),r.handleUpdatedBrushedBins=r.handleUpdatedBrushedBins.bind(Object(u.a)(r)),r.onRemovePlot=r.onRemovePlot.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e.target.value}),this.props.onSelectedSample(e.target.value)}},{key:"handleRecordsHovered",value:function(e){var t=e?_.toChromosomeInterval(e):null;this.props.onLocationHovered(t)}},{key:"handleUpdatedBrushedBins",value:function(e){this.props.onBrushedBinsUpdated(e)}},{key:"onRemovePlot",value:function(){this.props.onRemovePlot(this.props.plotId)}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.width,r=e.height,s=e.hoveredLocation,n=e.invertAxis,i=e.customColor,o=e.brushedBins,l=e.updatedBins,c=e.dispMode,h=e.onZoom,u=e.rdRange,d=e.clusterTableData,p=e.applyLog,v=e.scales,f=e.centroidPts,m=e.showCentroids,g=e.purity,b=e.ploidy,y=e.meanRD,S=e.fractionalCNTicks,C=e.showPurityPloidy,j=e.BAF_lines,A=e.max_cn;return Object(ee.jsx)("div",{className:"SampleViz-scatter",children:Object(ee.jsx)(fe,{className:"SampleViz-pane",children:Object(ee.jsx)(de,{parentCallBack:this.handleCallBack,data:t,rdRange:u,width:a,height:r,hoveredLocation:s,onRecordsHovered:this.handleRecordsHovered,invertAxis:n||!1,customColor:i,colors:this.props.colors,col:this.props.colors[0],onBrushedBinsUpdated:this.handleUpdatedBrushedBins,brushedBins:o,updatedBins:l,displayMode:c,onZoom:h,clusterTableData:d,applyLog:p,yAxisToPlot:p?"logRD":C?"fractional_cn":"RD",onClusterSelected:this.props.onClusterSelected,scales:v,centroidPts:f,showCentroids:m,purity:g,ploidy:b,meanRD:y,fractionalCNTicks:S,showPurityPloidy:C,BAF_lines:j,max_cn:A})})})}}]),a}(s.a.Component);ge.defaultProps={onLocationHovered:S.a.noop,invertAxis:!1,customColor:"#1b9e77"};a(247);var be="linearplot-scale",ye="#999999",Se="rgba(232, 232, 232, 1)",Ce=50,je=10,Ae=10,xe=35;function _e(e){return e?Ce+20:Ce}var Oe=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e))._svg=void 0,r._canvas=void 0,r._clusters=void 0,r.brushedNodes=void 0,r._currXScale=void 0,r._currYScale=void 0,r._original_XScale=void 0,r._original_YScale=void 0,r.previewDriver=void 0,r.lockedDrivers=void 0,r._svg=null,r._canvas=null,r.getXScale=Object(k.a)(r.getXScale),r.handleMouseMove=r.handleMouseMove.bind(Object(u.a)(r)),r.handleMouseLeave=r.handleMouseLeave.bind(Object(u.a)(r)),r._clusters=r.initializeListOfClusters(),r.brushedNodes=new Set,r._currXScale=r.getXScale(e.width,e.genome,e.chr,r.props.implicitStart,r.props.implicitEnd,r.props.showPurityPloidy),r._currYScale=w.i().domain([r.props.yMin,r.props.yMax]).range([r.props.height-xe,Ae]),r._original_XScale=r._currXScale,r._original_YScale=r._currYScale,r.previewDriver=null,r.lockedDrivers=new Set,r}return Object(h.a)(a,[{key:"initializeListOfClusters",value:function(){var e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),t=Object(A.a)(new Set(this.props.data.map((function(e){return String(e.CLUSTER)})))).sort(e.compare);return"-2"===t[0]&&t.shift(),"-1"===t[0]&&t.shift(),t}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"propsDidChange",value:function(e,t){var a=this;return t.some((function(t){return a.props[t]!==e[t]}))}},{key:"componentDidUpdate",value:function(e){null!==this.props.driverGeneUpdate.gene&&this.props.driverGeneUpdate.destination===this.props.dataKeyToPlot&&(this.lockedDrivers.has(this.props.driverGeneUpdate.gene)?this.lockedDrivers.delete(this.props.driverGeneUpdate.gene):this.lockedDrivers.add(this.props.driverGeneUpdate.gene),this.props.handleDriverGenesChange({gene:null,destination:null})),this.propsDidChange(e,["chr"])?"RD"===this.props.dataKeyToPlot||"logRD"===this.props.dataKeyToPlot||"fractional_cn"===this.props.dataKeyToPlot?this.props.onLinearPlotZoom(null,null,!0):this.props.onLinearPlotZoom(null,null,!1):this.propsDidChange(e,["driverGenes","displayMode","implicitEnd","implicitStart","yMin","yMax","colors","brushedBins","width","height","chr","purity","ploidy"])?(0===this.props.brushedBins.length&&(this._clusters=this.initializeListOfClusters()),this.redraw()):S.a.isEqual(this.props.data,e.data)&&this.props.dataKeyToPlot===e.dataKeyToPlot||this.redraw()}},{key:"getXScale",value:function(e,t,a,r,s,n){var i=[0,0];return null!=r&&null!=s?(i[0]=r,i[1]=s):a?(i[0]=t.getChrStartMap()[a],i[1]=i[0]+t.getLength(a)):i[1]=t.getLength(),w.i().domain(i).range([_e(this.props.showPurityPloidy),e-je])}},{key:"getScaledYScale",value:function(e,t){return w.i().domain([2*(1-t),10*t+2*(1-t)]).range([e-xe,Ae])}},{key:"createNewBrush",value:function(){var e=w.j(this._svg),t=w.c().keyModifiers(!0).extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width-je,this.props.height-xe]]).on("end",(function(){e.selectAll(".brush").remove()}));e.append("g").attr("class","brush").call(t)}},{key:"filterFractionalCNTicks",value:function(e,t){return e.filter((function(e,a){return e>t[0]&&e<t[1]}))}},{key:"redraw",value:function(){var e=this;if(this._svg){var t,a=this,r=this.props,s=r.data,n=r.width,i=r.height,o=r.genome,l=r.chr,c=r.dataKeyToPlot,h=r.yMin,u=r.yMax,d=r.yLabel,p=r.customColor,f=r.brushedBins,m=r.colors,g=r.displayMode,b=r.driverGenes,y=this.getXScale(n,o,l,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),C=w.i().domain([h,u]).range([i-xe,Ae]),j=o.getChromosomeList(),x=[],O=o.getChrStartMap(),k=Object(v.a)(j);try{for(k.s();!(t=k.n()).done;){var D=t.value,R=O[D.name];R>=y.domain()[0]&&R<=y.domain()[1]&&x.push(D)}}catch(ce){k.e(ce)}finally{k.f()}var B=this.props.showPurityPloidy?10:0,L=w.j(this._svg);L.selectAll(".linearplot-scale").remove(),L.append("text").classed(be,!0).attr("text-anchor","middle").attr("font-size",11).attr("x",S.a.mean(y.range())).attr("y",i-xe+30).text(l||o.getName()),L.append("text").classed(be,!0).attr("transform","rotate(-90, ".concat(_e(this.props.showPurityPloidy),", ").concat(S.a.mean(C.range()),")")).text(d||c).attr("x",(i-xe-Ae)/2-1+B).attr("y",this.props.showPurityPloidy?10:_e(this.props.showPurityPloidy)/2+5).attr("text-anchor","middle");var N=function(e,t){return e.classed(be,!0).attr("transform","translate(0, ".concat(i-xe,")")).call(w.a(t).tickValues(o.getChromosomeStarts2(x,t.domain()[0],t.domain()[1])).tickFormat((function(e,t){return function(e){var t=String(e).match(/\d+/);return t?t[0]:e}(x[t].name)})))},M=function(e,t){return e.classed(be,!0).attr("transform","translate(0, ".concat(i-xe,")")).call(w.a(t).tickFormat((function(e){return P(Number(e.valueOf()),0,O[l])})))},E=function(t,a){return t.classed(be,!0).attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(w.b(a).ticks((a.range()[0]-a.range()[1])/15))};if("fractional_cn"===this.props.dataKeyToPlot){var F=this.props.fractionalCNTicks,I=C.domain(),U=F.filter((function(e){return e.fractionalTick>I[0]&&e.fractionalTick<I[1]})),Y=U.map((function(e){return e.fractionalTick}));E=function(t,a){return t.classed(be,!0).attr("id","Grid").attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(w.b(a).tickValues(Y).tickSizeInner(60-n).tickFormat((function(e,t){return U[t].totalCN+" ("+Number(e.valueOf()).toFixed(2)+")"})))}}else if(this.props.showPurityPloidy){var G=C.domain(),z=this.props.BAF_lines.filter((function(e){return e.tick>G[0]&&e.tick<G[1]})),K=z.map((function(e){return e.tick}));E=function(t,a){return t.classed(be,!0).attr("id","Grid").attr("transform","translate(".concat(_e(e.props.showPurityPloidy),", 0)")).call(w.b(a).tickValues(K).tickSizeInner(-n+_e(e.props.showPurityPloidy)+je).tickFormat((function(e,t){return K[t].toFixed(2)+" ("+z[t].state[0]+","+z[t].state[1]+")"})))}}var H=L.append("g"),X=L.append("g"),Q=w.o,Z=w.n().scaleExtent([0,100]),V=w.n().scaleExtent([0,100]),J=function(){return w.p(H.node())},W=function(){return w.p(X.node())};H.call(Z).attr("pointer-events","none"),X.call(V).attr("pointer-events","none");var q=w.n().on("zoom",(function(){try{var e=w.f.transform,t=e.k/Q.k,a=w.f.sourceEvent?[w.f.sourceEvent.layerX,w.f.sourceEvent.layerY]:[n/2,i/2],r=a[0]>y.range()[0],s=a[1]<C.range()[0];g!==ut.zoom&&r&&s||(1===t?(r&&Z&&t&&a&&H&&H.call(Z.translateBy,(e.x-Q.x)/J().k,0),s&&V&&t&&a&&X&&X.call(V.translateBy,0,(e.y-Q.y)/W().k)):(r&&Z&&t&&a&&H&&H.call(Z.scaleBy,t,a),s&&V&&t&&a&&X&&X.call(V.scaleBy,t,a))),Q=e,le()}catch(o){console.log("Error: ",o)}})).on("end",(function(){"RD"===e.props.dataKeyToPlot||"logRD"===e.props.dataKeyToPlot||"fractional_cn"===e.props.dataKeyToPlot?a.props.onLinearPlotZoom([a._currXScale.domain()[0],a._currXScale.domain()[1]],[a._currYScale.domain()[0],a._currYScale.domain()[1]],!0):a.props.onLinearPlotZoom([a._currXScale.domain()[0],a._currXScale.domain()[1]],[a._currYScale.domain()[0],a._currYScale.domain()[1]],!1)}));if(this._canvas){this._canvas.width=800,this._canvas.height=150;var ee=[];f.forEach((function(e){return ee.push(_.toChromosomeInterval(e).toString())}));var te=new Set(ee),ae=this._canvas.getContext("webgl");ae.clearColor(0,0,0,1);var re=$.webglFillColor().value((function(e){return T(function(e){if(te.has(_.toChromosomeInterval(e).toString()))return p;if(-1===e.CLUSTER)return ye;if(-2===e.CLUSTER)return Se;var t=e.CLUSTER%m.length;return m[t]}(e))})).data(s),se=$.seriesWebglPoint().size(3).crossValue((function(e){return o.getImplicitCoordinates(_.toChromosomeInterval(e)).getCenter()})).mainValue((function(e){return e[c]})).context(ae);se.decorate((function(e){return re(e)})),L.append("clipPath").attr("id","clip2").append("rect").attr("x",_e(this.props.showPurityPloidy)).attr("y",Ae).attr("width",n).attr("height",i).attr("fill","red"),L.append("g").classed("eventrect",!0).append("rect").attr("x",_e(this.props.showPurityPloidy)).attr("y",Ae).attr("width",n-je-_e(this.props.showPurityPloidy)).attr("height",i-xe-Ae).style("fill","none").style("pointer-events","all").attr("clip-path","url(#clip2)");var ne=function(e){a.previewDriver=e},ie=function(e){a.previewDriver=null};le();var oe=null;g===ut.select||g===ut.erase?(oe=w.c().keyModifiers(!1).extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width,this.props.height-xe]]).on("start brush",(function(){var t=w.f.selection;if(t&&t[0][0]!==t[1][0]&&t[0][1]!==t[1][1]){var a=s.filter((function(e){var a,r,s=_.toChromosomeInterval(e),n=o.getImplicitCoordinates(s);return a=t,r=[y(n.getCenter()),C(e[c])],a[0][0]<=r[0]&&r[0]<=a[1][0]&&a[0][1]<=r[1]&&r[1]<=a[1][1]}));a&&(g===ut.select?a=S.a.uniqBy(S.a.union(a,f),(function(e){return e["#CHR"]+"_"+e.START})):g===ut.erase&&(a=S.a.difference(f,a)),e.brushedNodes=new Set(a))}else e.brushedNodes=new Set([])})).on("end",(function(){L.selectAll(".brush").remove(),e.props.onBrushedBinsUpdated(Object(A.a)(e.brushedNodes))})),L.append("g").attr("class","brush").call(oe)):g!==ut.boxzoom&&g!==ut.zoom||(oe=w.d().extent([[_e(this.props.showPurityPloidy),Ae],[this.props.width,this.props.height-xe]]).on("end",(function(){L.selectAll(".brush").remove();var t=w.f.selection;try{var r={start:t[0],end:t[1]},s=y.invert(r.start),n=y.invert(r.end);"RD"===e.props.dataKeyToPlot||"logRD"===e.props.dataKeyToPlot||"fractional_cn"===e.props.dataKeyToPlot?e.props.onLinearPlotZoom([s,n],[a._currYScale.domain()[0],a._currYScale.domain()[1]],!0):e.props.onLinearPlotZoom([s,n],[a._currYScale.domain()[0],a._currYScale.domain()[1]],!1)}catch(i){}})),L.append("g").attr("class","brush").call(oe)),L.call(q).call(q.transform,w.o.scale(1))}}function le(){ae.clear(ae.COLOR_BUFFER_BIT),ae.clearColor(255,255,255,1);var e=W().rescaleY(C);if(X.call(E,e),a._currYScale=e,l){var t=J().rescaleX(y);H.call(M,t),a._currXScale=t,se.xScale(t).yScale(e)}else{var r=J().rescaleX(y);H.call(N,r),a._currXScale=r,se.xScale(r).yScale(e)}se(s),b&&(L.select(".Drivers").remove(),L.select(".eventrect").append("g").attr("clip-path","url(#clip2)").classed("Drivers",!0).selectAll("circle").data(b).enter().append("circle").attr("class","point").attr("d",w.k().type(w.l)).attr("fill","red").attr("fill-opacity",1).attr("stroke-width",2).attr("r",2).attr("transform",(function(t){return"translate("+a._currXScale(o.getImplicitCoordinates(t.location).getCenter())+","+((a._currYScale(e.domain()[0])||0)+3)+")"})).on("mouseover",ne).on("mouseleave",ie).on("click",(function(e){var t="";t="reverseBAF"===c&&a.props.applyLog?"logRD":"reverseBAF"===c&&a.props.showPurityPloidy?"fractional_cn":"reverseBAF"===c?"RD":"reverseBAF",a.lockedDrivers.has(e)?a.lockedDrivers.delete(e):a.lockedDrivers.add(e),a.props.handleDriverGenesChange({gene:e,destination:t})})))}}},{key:"renderHighlight",value:function(){var e=this.props,t=e.width,a=e.genome,r=e.chr,s=e.hoveredLocation;if(!s)return null;if(null!=this.previewDriver)return null;var n=this.getXScale(t,a,r,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),i=a.getImplicitCoordinates(s),o=n(i.start),l=Math.ceil((n(i.end)||0)-(o||0));return o&&o>0?Object(ee.jsx)("div",{className:"highlight",style:{position:"absolute",left:o,width:l,height:"100%",backgroundColor:"rgba(0,0,0,1)",border:"1px solid rgba(0,0,0,1)",zIndex:1}}):void 0}},{key:"handleMouseMove",value:function(e){var t=this.props,a=t.width,r=t.genome,s=t.chr,n=t.onLocationHovered,i=this.getXScale(a,r,s,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),o=i.range(),l=D(e).x;if(l<o[0]||l>o[1])this.handleMouseLeave();else{var c=i.invert(l);n(r.getChromosomeLocation(c))}}},{key:"handleMouseLeave",value:function(){this.props.onLocationHovered(null)}},{key:"render",value:function(){var e=this,t=this.props,a=t.width,r=t.height,s=t.dataKeyToPlot;return Object(ee.jsxs)("div",{className:"LinearPlot",style:{position:"relative",width:a,height:r},onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,children:[this.renderLockedDrivers(),this.renderTooltip(),this.renderHighlight(),Object(ee.jsx)("canvas",{ref:function(t){return e._canvas=t},width:a,height:r,className:"canvas",style:{position:"absolute",top:Ae,zIndex:-1,left:_e(this.props.showPurityPloidy),width:a-_e(this.props.showPurityPloidy)-je,height:r-Ae-xe}}),Object(ee.jsx)("svg",{ref:function(t){return e._svg=t},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+a+" "+r}),Object(ee.jsx)("div",{className:"LinearPlot-tools",children:("RD"===s||"logRD"===s||"fractional_cn"===s)&&Object(ee.jsx)("button",{className:"custom-button linear-plot-button",onClick:function(){e.props.onLinearPlotZoom(null,null,!0,!0)},children:"Reset View"})})]})}},{key:"renderLockedDrivers",value:function(){var e=this,t=this.props,a=t.width,r=t.genome,n=t.chr,i=t.height,o=!1;null!=this.previewDriver&&this.lockedDrivers.has(this.previewDriver)&&(this.lockedDrivers.delete(this.previewDriver),o=!0);var l=Object(A.a)(this.lockedDrivers).sort((function(e,t){return e.location.start-t.location.start}));null!=this.previewDriver&&o&&this.lockedDrivers.add(this.previewDriver);var c=[];return l.map((function(t,o){var l,h=e.getXScale(a,r,n,e.props.implicitStart,e.props.implicitEnd,e.props.showPurityPloidy),u=r.getImplicitCoordinates(t.location),d=h(u.start)||0,p=Math.ceil((h(u.end)||0)-(d||0)),f=t.symbol,m=Object(ee.jsx)(s.a.Fragment,{children:Object(ee.jsxs)("div",{children:[" ",f," "]})}),g=!0,b=f.length>4?40+5*(f.length-4):40,y=[d-b/2,d+b/2],S=Object(v.a)(c);try{for(S.s();!(l=S.n()).done;){var C=l.value;if(C[0]>y[0]&&C[0]<y[1]){g=!1;break}if(y[0]>C[0]&&y[0]<C[1]){g=!1;break}}}catch(j){S.e(j)}finally{S.f()}return g&&c.push(y),d>_e(e.props.showPurityPloidy)&&d<a-je?Object(ee.jsxs)("div",{children:[Object(ee.jsx)("div",{style:{position:"absolute",left:d-b/2,width:b,bottom:i,border:"1px solid rgba(0,0,0,0)",zIndex:o,pointerEvents:"none",display:g?"":"none"},children:m}),Object(ee.jsx)("div",{className:"highlight",style:{position:"absolute",left:d,width:p,height:"75%",backgroundColor:"rgba(255,165,0,1)",border:"1px solid rgba(255,165,0,1)",zIndex:o}})]},e.props.dataKeyToPlot+f):null}))}},{key:"renderTooltip",value:function(){var e=this.props,t=e.driverGenes,a=e.hoveredLocation,r=e.width,n=e.genome,i=e.chr,o=e.height;if(!a)return null;if(!t)return null;if(!this.previewDriver)return null;var l=this.getXScale(r,n,i,this.props.implicitStart,this.props.implicitEnd,this.props.showPurityPloidy),c=n.getImplicitCoordinates(this.previewDriver.location),h=l(c.start)||0,u=Math.ceil((l(c.end)||0)-(h||0)),d=this.previewDriver.symbol,p=Object(ee.jsx)(s.a.Fragment,{children:Object(ee.jsxs)("div",{children:[" ",d," "]})}),v=d.length>4?40+5*(d.length-4):40;return Object(ee.jsxs)("div",{children:[Object(ee.jsx)("div",{style:{position:"absolute",left:h-v/2,bottom:o+1,backgroundColor:"white",border:"1px solid rgba(0,0,0,0)",zIndex:2},children:p}),Object(ee.jsx)("div",{className:"highlight",style:{position:"absolute",left:h,width:u+1,height:"75%",backgroundColor:this.lockedDrivers.has(this.previewDriver)?"red":"rgba(0, 200 , 0, 1)",zIndex:0}})]})}}]),a}(s.a.PureComponent);function ke(e){var t=e.data,a=e.chr,r=e.rdRange,s=e.hoveredLocation,n=e.onLocationHovered,i=e.onBrushedBinsUpdated,o=e.brushedBins,l=e.customColor,c=e.colors,h=e.yScale,u=e.clusterTableData,d=e.applyLog,p=e.displayMode,v=e.width,f=e.onLinearPlotZoom,m=e.implicitStart,g=e.implicitEnd,b=e.onZoom,y=e.driverGenes,S=e.purity,C=e.ploidy,j=e.meanRD,A=e.fractionalCNTicks,x=e.showPurityPloidy,_=e.BAF_lines;return Object(ee.jsx)(Oe,{data:t,dataKeyToPlot:d?"logRD":x?"fractional_cn":"RD",applyLog:d,genome:ct,chr:a,hoveredLocation:s,onLocationHovered:n,onBrushedBinsUpdated:i,yMin:h?h[0]:x?r[0]:d?-2:0,yMax:h?h[1]:r[1],yLabel:d?"log RDR":x?"Copy Number":"RDR",brushedBins:o,customColor:l,colors:c,clusterTableData:u,displayMode:p,width:v,onZoom:b,onLinearPlotZoom:f,implicitStart:m,implicitEnd:g,driverGenes:y,driverGeneUpdate:e.driverGeneUpdate,handleDriverGenesChange:e.handleDriverGenesChange,purity:S,ploidy:C,meanRD:j,fractionalCNTicks:A,showPurityPloidy:x,BAF_lines:_})}function we(e){var t=e.data,a=e.chr,r=e.hoveredLocation,s=e.onLocationHovered,n=e.onBrushedBinsUpdated,i=e.brushedBins,o=e.customColor,l=e.colors,c=e.xScale,h=e.clusterTableData,u=e.displayMode,d=e.width,p=e.onLinearPlotZoom,v=e.implicitStart,f=e.implicitEnd,m=e.onZoom,g=e.driverGenes,b=e.applyLog,y=e.purity,S=e.ploidy,C=e.meanRD,j=e.showPurityPloidy,A=e.fractionalCNTicks,x=e.BAF_lines;return Object(ee.jsx)(Oe,{data:t,chr:a,dataKeyToPlot:"reverseBAF",applyLog:b,genome:ct,hoveredLocation:r,onLocationHovered:s,onBrushedBinsUpdated:n,yMin:c?c[0]:-.01,yMax:c?c[1]:.51,yLabel:"0.5 - BAF",brushedBins:i,customColor:o,colors:l,clusterTableData:h,displayMode:u,width:d,onLinearPlotZoom:p,implicitStart:v,implicitEnd:f,onZoom:m,driverGenes:g,driverGeneUpdate:e.driverGeneUpdate,handleDriverGenesChange:e.handleDriverGenesChange,purity:y,ploidy:S,meanRD:C,showPurityPloidy:j,fractionalCNTicks:A,BAF_lines:x})}Oe.defaultProps={width:600,height:150,onLocationHovered:S.a.noop};var De=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).state={selectedSample:e.initialSelectedSample,sentDriver:{gene:null,destination:null}},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(u.a)(r)),r.handleDriverGenesChange=r.handleDriverGenesChange.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e.target.value})}},{key:"handleDriverGenesChange",value:function(e){this.setState({sentDriver:e})}},{key:"render",value:function(){var e,t=this.props,a=t.data,r=t.chr,s=t.hoveredLocation,n=t.onLocationHovered,i=t.onBrushedBinsUpdated,o=t.brushedBins,l=t.customColor,c=t.yScale,h=t.xScale,u=t.rdRange,d=t.clusterTableData,p=t.applyLog,v=t.displayMode,f=t.width,m=t.onLinearPlotZoom,g=t.implicitRange,b=t.onZoom,y=t.driverGenes,S=t.purity,C=t.ploidy,j=t.meanRD,A=t.fractionalCNTicks,x=t.showPurityPloidy,_=t.BAF_lines;return e=Object(ee.jsxs)(fe,{className:"SampleViz-pane",children:[Object(ee.jsx)(ke,{data:a,chr:r,rdRange:u,hoveredLocation:s,onLocationHovered:n,onBrushedBinsUpdated:i,brushedBins:o,customColor:l,colors:this.props.colors,yScale:c,xScale:h,clusterTableData:d,applyLog:p,displayMode:v,width:f,onLinearPlotZoom:m,implicitStart:g?g[0]:g,implicitEnd:g?g[1]:g,onZoom:b,driverGenes:y,handleDriverGenesChange:this.handleDriverGenesChange,driverGeneUpdate:this.state.sentDriver,purity:S,ploidy:C,meanRD:j,fractionalCNTicks:A,showPurityPloidy:x,BAF_lines:_}),Object(ee.jsx)("div",{className:"SampleViz-separator"}),Object(ee.jsx)(we,{data:a,chr:r,hoveredLocation:s,onLocationHovered:n,onBrushedBinsUpdated:i,brushedBins:o,customColor:l,colors:this.props.colors,yScale:c,xScale:h,clusterTableData:d,applyLog:p,displayMode:v,width:f,onLinearPlotZoom:m,onZoom:b,implicitStart:g?g[0]:g,implicitEnd:g?g[1]:g,driverGenes:y,handleDriverGenesChange:this.handleDriverGenesChange,driverGeneUpdate:this.state.sentDriver,purity:S,ploidy:C,meanRD:j,fractionalCNTicks:A,showPurityPloidy:x,BAF_lines:_})]}),Object(ee.jsx)("div",{className:"SampleViz-linear",children:e})}}]),a}(s.a.Component),Pe=a(63),Re=a.n(Pe),Te=a(207),Be=(a(192),function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).table_data=void 0,r.table_data=e.data,r.handleColorChange=r.handleColorChange.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"shouldComponentUpdate",value:function(e){return this.props.data!==e.data||this.props.colors!==e.colors}},{key:"handleColorChange",value:function(e,t){this.props.colors[t]=e.hex;var a=S.a.cloneDeep(this.props.colors);this.props.onClusterColorChange(a),this.forceUpdate()}},{key:"componentDidUpdate",value:function(e){this.props.updatedClusterTable&&this.props.updatedClusterTable()}},{key:"render",value:function(){var e=this,t=this.props,a=t.colOneName,r=t.colTwoName,s=t.colThreeName,n=t.colFourName,i=t.data,o=t.expandable,l=t.selectable,c=t.colors,h=function(t){return Object(ee.jsx)("div",{children:Object(ee.jsx)(Te.a,{width:"100%",color:e.props.colors[t.data.key],onChangeComplete:function(a){return e.handleColorChange(a,t.data.key)}})})},u=[{when:function(e){return e},style:function(e){return{backgroundColor:-1===Number(e.key)?"#999999":c[Number(e.key)%c.length],alignItems:"center",justifyContent:"center",innerWidth:50,outerWidth:50}}}],d=[{name:a,selector:"key",sortable:!0,compact:!0,wrap:!0,innerWidth:40,outerWidth:40,width:"50",center:!0},{name:r,selector:"value",sortable:!0,right:!0,compact:!0,wrap:!0,innerWidth:40,outerWidth:40,width:"50",center:!0}],p=[{name:a,selector:"key",sortable:!0,compact:!0,wrap:!0,center:!0},{name:r,selector:"value",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0},{name:s,selector:"selectPerc",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0},{name:n,selector:"binPerc",sortable:!0,right:!0,compact:!0,wrap:!0,center:!0}];if(t.centroidTable){var v=[];if(null!==i&&void 0!==i&&i.length>0){v.push({name:"Cluster ID",type:"key"});for(var f=0,m=Object.keys(i[0].sample);f<m.length;f++){var g=m[f];v.push({name:g,type:"sample."+g})}}for(var b=[],y=0,S=v;y<S.length;y++){var C=S[y],j={name:C.name,selector:C.type,sortable:!0,compact:!0,wrap:!0,center:!0};b.push(j)}return Object(ee.jsx)(Re.a,{columns:b,data:i,pagination:!0,dense:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0,conditionalRowStyles:u})}return o||l?Object(ee.jsx)("div",{className:"scroll",children:Object(ee.jsx)(Re.a,{columns:d,data:i,selectableRows:!0,onSelectedRowsChange:this.props.onClusterRowsChange,selectableRowSelected:function(t){if(e.props.currentFilters.includes(String(t.key)))return t},expandableRows:!0,expandableRowsComponent:Object(ee.jsx)(h,{}),expandableRowDisabled:function(e){return-1===e.key||-2===e.key},pagination:!0,dense:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0,conditionalRowStyles:u})}):Object(ee.jsx)(Re.a,{columns:p,data:i,pagination:!0,dense:!0,paginationPerPage:3,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[3,5,10,20],noContextMenu:!0,noHeader:!0,noDataComponent:Object(ee.jsx)("div",{style:{padding:10},children:"No Records Selected"}),conditionalRowStyles:u})}}]),a}(s.a.Component)),Le=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e))._clusters=void 0,r._clusters=r.initializeListOfClusters(),r.state={selectedSample:e.initialSelectedSample||e.data.getSampleList()[0],scales:{xScale:null,yScale:null},selectedCluster:r._clusters.length>0?r._clusters[0]:X,implicitRange:null,purity:K,ploidy:2},r.handleSelectedSampleChanged=r.handleSelectedSampleChanged.bind(Object(u.a)(r)),r.handleSelectedSampleChange=r.handleSelectedSampleChange.bind(Object(u.a)(r)),r.handleZoom=r.handleZoom.bind(Object(u.a)(r)),r.handleLinearPlotZoom=r.handleLinearPlotZoom.bind(Object(u.a)(r)),r.onUpdatePurity=r.onUpdatePurity.bind(Object(u.a)(r)),r.onUpdatePloidy=r.onUpdatePloidy.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;this._clusters=[];var t,a=Object(v.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(s){a.e(s)}finally{a.f()}for(;this._clusters.length>0&&(Number(this._clusters[0])===Number(X)||Number(this._clusters[0])===Number(Q));)this._clusters.shift();return this._clusters}},{key:"componentDidUpdate",value:function(e){if(this.props.clusterTableData!==e.clusterTableData)this.initializeListOfClusters();else if(this.props.applyLog!==e.applyLog||this.props.showPurityPloidyInputs!==e.showPurityPloidyInputs){var t={xScale:this.state.scales.xScale,yScale:null};this.setState({scales:t})}}},{key:"handleSelectedSampleChanged",value:function(e){this.setState({selectedSample:e})}},{key:"handleSelectedSampleChange",value:function(e){this.setState({selectedSample:e.target.value})}},{key:"handleZoom",value:function(e){this.setState({scales:e})}},{key:"handleLinearPlotZoom",value:function(e,t,a,r){if(r){this.setState({implicitRange:null});this.setState({scales:{xScale:null,yScale:null}})}else{this.setState({implicitRange:e});var s=a?{xScale:this.state.scales.xScale,yScale:t}:{xScale:t,yScale:this.state.scales.yScale};this.setState({scales:s})}}},{key:"onUpdatePurity",value:function(e){this.setState({purity:e})}},{key:"onUpdatePloidy",value:function(e){this.props.data.setSamplePloidy(this.state.selectedSample,e),this.setState({ploidy:e}),this.setState({scales:{xScale:null,yScale:null}})}},{key:"getSelectedBins",value:function(e,t,a,r,s,n,i){var o=[],l=e?this.props.scales:this.state.scales,c=r?"logRD":s?"fractional_cn":"RD";if(null!==t||null!==l.xScale||null!==l.yScale){var h=t?t[0]:null,u=t?t[1]:null;o=i.getRecords(a,c,h,u,l.xScale,l.yScale,n,this.state.ploidy)}else o=i.getRecords(a,c,null,null,null,null,n,this.state.ploidy);return o}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,r=t.initialSelectedSample,s=t.applyLog,n=t.showLinearPlot,i=t.showScatterPlot,l=t.dispMode,c=t.sampleAmount,h=t.syncScales,u=t.showPurityPloidyInputs,d=t.samplesShown,p=this.state.implicitRange,v=this.state.selectedSample,f=a.getRdRange(v,s),m=a.getSampleList().map((function(t){return Object(ee.jsxs)("option",{value:t,disabled:!(t===e.state.selectedSample)&&d.has(t),children:[t," "]},t)})),g=a.getMeanRD(v),b=this.getSelectedBins(h,p,v,s,u,g,a),y=a.getBAFLines(this.state.purity,this.state.selectedSample),S=this.state.purity?(f[1]*this.state.ploidy/g-2*(1-this.state.purity))/this.state.purity:0;f[1]+=.5;var C=a.getFractionalCNTicks(this.state.purity,0,6,Math.ceil(S),this.state.selectedSample);u&&(f=[f[0]*this.state.ploidy/g,f[1]*this.state.ploidy/g]);var j=this._clusters.map((function(e){return Object(ee.jsx)("option",{value:e,children:e},e)})),A=u?this.state.ploidy/g:1;j.unshift(Object(ee.jsx)("option",{value:X,children:X},X)),j.unshift(Object(ee.jsx)("option",{value:Q,children:Q},Q));var x=0===a.getBrushedBins().length;return Object(ee.jsxs)("div",{className:"SampleViz-wrapper",children:[Object(ee.jsxs)("div",{style:{verticalAlign:"middle"},children:[(n||i)&&Object(ee.jsxs)("div",{className:"SampleViz-select",children:[Object(ee.jsx)("span",{children:"Sample: "}),Object(ee.jsx)("select",{value:v,onChange:function(t){e.props.onChangeSample(t.target.value,e.state.selectedSample),e.handleSelectedSampleChange(t)},children:m}),Object(ee.jsx)("button",{className:"custom-button",onClick:function(){e.props.onAddSample()},disabled:c>=m.length,children:" Add Sample "}),Object(ee.jsx)("button",{className:"custom-button",onClick:function(){e.props.onRemovePlot(e.state.selectedSample)},disabled:c<=1,children:" Remove Sample "})]}),(n||i)&&Object(ee.jsxs)("div",{className:"SampleViz-select",children:[Object(ee.jsx)("span",{children:"Cluster: "}),Object(ee.jsx)("select",{name:"Select Cluster",title:"Cluster",className:"Sampleviz-cluster-select",value:this.state.selectedCluster,disabled:x,onChange:function(t){e.setState({selectedCluster:t.target.value})},children:j}),Object(ee.jsx)("button",{className:"custom-button",onClick:function(){e.props.parentCallBack(e.state.selectedCluster),e.props.onBrushedBinsUpdated([])},disabled:x,children:"Assign Cluster"}),Object(ee.jsx)("button",{className:"custom-button",onClick:function(){e.initializeListOfClusters();var t=e._clusters;t.sort((function(e,t){return Number(e)-Number(t)}));for(var a=(t.length>0?Number(t[t.length-1]):-1)+1,r=0;r<t.length;r++)if(Number(t[r])!==r){a=r;break}e.props.parentCallBack(a),e.props.onBrushedBinsUpdated([])},disabled:x,children:"New Cluster"}),Object(ee.jsx)("button",{className:"custom-button",onClick:this.props.onUndoClick,children:" Undo"})]}),(n||i)&&u&&Object(ee.jsxs)("div",{className:"Inputs",children:[Object(ee.jsx)("label",{children:"Ploidy:"})," ",Object(ee.jsx)("input",{placeholder:this.state.ploidy.toString(),type:"number",id:"Purity-Input",name:"volume",min:1,max:12,step:"any",onChange:function(t){var a=Number(t.target.value);a<=12&&a>=1&&e.onUpdatePloidy(a)}}),Object(ee.jsx)("label",{className:"input-label",children:"Purity:"})," ",Object(ee.jsx)("input",{type:"number",id:"Purity-Input",name:"volume",min:0,max:1,step:"any",placeholder:this.state.purity.toString(),onChange:function(t){var a=Number(t.target.value);a<=1&&a>=0&&e.onUpdatePurity(a)}})]})]}),Object(ee.jsxs)("div",{className:"SampleViz-plots",children:[i&&Object(ee.jsx)(ge,Object(o.a)(Object(o.a)({},this.props),{},{data:b,onSelectedSample:this.handleSelectedSampleChanged,selectedSample:v,initialSelectedSample:r,onZoom:this.handleZoom,rdRange:f,implicitRange:this.state.implicitRange,scales:h?this.props.scales:this.state.scales,centroidPts:a.getCentroidPoints(v,this.props.chr,A),purity:this.state.purity,ploidy:this.state.ploidy,meanRD:g,fractionalCNTicks:C,showPurityPloidy:u,BAF_lines:y,max_cn:Math.ceil(S)})),n&&Object(ee.jsx)(De,Object(o.a)(Object(o.a)({},this.props),{},{data:b,onLinearPlotZoom:this.handleLinearPlotZoom,onZoom:this.handleZoom,yScale:this.state.scales.yScale,xScale:this.state.scales.xScale,selectedSample:this.state.selectedSample,initialSelectedSample:r,rdRange:f,displayMode:l,width:600,implicitRange:this.state.implicitRange,purity:this.state.purity,ploidy:this.state.ploidy,meanRD:g,fractionalCNTicks:C,showPurityPloidy:u,BAF_lines:y}))]}),(n||i)&&Object(ee.jsx)("div",{className:n&&i?"SampleViz-clusters":"",children:Object(ee.jsx)(Be,{data:a.brushedTableData(),onClusterRowsChange:function(){},onClusterColorChange:function(){},currentFilters:["-1"],colOneName:"Cluster ID",colTwoName:"Cluster (%)",colThreeName:"Selection (%)",colFourName:"Bin (%)",cols:"",expandable:!1,selectable:!1,colors:this.props.colors})})]})}}]),a}(s.a.Component),Ne="data:image/gif;base64,R0lGODlhEAAQAPQAAP///wAAAPDw8IqKiuDg4EZGRnp6egAAAFhYWCQkJKysrL6+vhQUFJycnAQEBDY2NmhoaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Me=(a(193),function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).table_data=void 0,r.table_data=e.data,r}return Object(h.a)(a,[{key:"shouldComponentUpdate",value:function(e){return this.props.data!==e.data}},{key:"render",value:function(){var e,t=this.props,a=t.colName,r=t.data,s=[{name:a,selector:"action",compact:!0,wrap:!0}],n=[],i=Object(v.a)(r);try{for(i.s();!(e=i.n()).done;){var o=e.value;n.push(o)}}catch(l){i.e(l)}finally{i.f()}return Object(ee.jsx)("div",{children:Object(ee.jsx)(Re.a,{columns:s,data:n,pagination:!0,paginationPerPage:5,paginationComponentOptions:{rowsPerPageText:"",selectAllRowsItem:!0},paginationRowsPerPageOptions:[5,10,15,20],noContextMenu:!0,noHeader:!0})})}}]),a}(s.a.Component)),Ee=function(){function e(t,a){Object(c.a)(this,e),this._name=void 0,this._chromosomes=void 0,this._chrStarts=void 0,this._length=void 0,this.nameToChr=void 0,this._name=a||"",this._chromosomes=t,this._chrStarts={},this._length=0;var r,s=Object(v.a)(t);try{for(s.s();!(r=s.n()).done;){var n=r.value,i=n.name;if(void 0!==this._chrStarts[i])throw new Error('Duplicate chromosome name "'.concat(i,'" in genome "').concat(a,'"'));this._chrStarts[i]=this._length,this._length+=n.length}}catch(u){s.e(u)}finally{s.f()}this.nameToChr={};var o,l=Object(v.a)(this._chromosomes);try{for(l.s();!(o=l.n()).done;){var h=o.value;this.nameToChr[h.name]=h}}catch(u){l.e(u)}finally{l.f()}}return Object(h.a)(e,[{key:"getName",value:function(){return this._name}},{key:"getChromosomeList",value:function(){return this._chromosomes}},{key:"getChromosomeStarts",value:function(){var e=this;return this._chromosomes.map((function(t){return e._chrStarts[t.name]}))}},{key:"getChrStartMap",value:function(){return this._chrStarts}},{key:"getChromosomeStarts2",value:function(e,t,a){var r=this;return e.map((function(e){return r._chrStarts[e.name]}))}},{key:"getLength",value:function(e){return e?e in this._chrStarts?this._chromosomes.find((function(t){return String(t.name)===String(e)})).length:0:this._length}},{key:"getLength2",value:function(e){var t,a=0,r=Object(v.a)(e);try{for(r.s();!(t=r.n()).done;){a+=t.value.length}}catch(s){r.e(s)}finally{r.f()}return a}},{key:"getImplicitCoordinates",value:function(e){var t=e.chr,a=e.start,r=e.end;if(!(t in this._chrStarts))throw new Error('Chromosome "'.concat(t,'" not in this genome'));var s=this._chrStarts[t];return new C(s+a,s+r)}},{key:"getChromosomeLocation",value:function(e){e<0?e=0:e>=this.getLength()&&(e=this.getLength()-1);var t=Object.values(this._chrStarts).sort((function(e,t){return e-t})),a=S.a.sortedLastIndex(t,e)-1,r=e-t[a];return new j(this._chromosomes[a].name,r,r+1)}},{key:"getChrs",value:function(e){var t,a=[],r=Object(v.a)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;a.push(this.nameToChr[s])}}catch(n){r.e(n)}finally{r.f()}return a}}]),e}();new Ee([{name:"chr1",length:248956422},{name:"chr2",length:242193529},{name:"chr3",length:198295559},{name:"chr4",length:190214555},{name:"chr5",length:181538259},{name:"chr6",length:170805979},{name:"chr7",length:159345973},{name:"chr8",length:145138636},{name:"chr9",length:138394717},{name:"chr10",length:133797422},{name:"chr11",length:135086622},{name:"chr12",length:133275309},{name:"chr13",length:114364328},{name:"chr14",length:107043718},{name:"chr15",length:101991189},{name:"chr16",length:90338345},{name:"chr17",length:83257441},{name:"chr18",length:80373285},{name:"chr19",length:58617616},{name:"chr20",length:64444167},{name:"chr21",length:46709983},{name:"chr22",length:50818468}],"hg38"),a(358);function Fe(e){return new Promise((function(t,a){var r=Object.keys(e[0]).filter((function(e){return!Z.has(e)}));t(z(e,r,"\t"," "))}))}var Ie=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).csvLink=void 0,r.csvLink=s.a.createRef(),r.state={loading:!1},r.handleFileDownload=r.handleFileDownload.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"handleFileDownload",value:function(){var e=Object(l.a)(m.a.mark((function e(){var t,a,r,s,n,i,o,l,c,h,u,d,p,f,g,b,y,S,C,j,A;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),t="",e.prev=2,e.next=5,Fe(this.props.data);case 5:t=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return");case 12:for((a=document.createElement("a")).href="data:text/tab-separated-values,"+encodeURIComponent(t),r=this.props.fileName,s=r.split("."),n="",i=0;i<s.length-1;i++)n+=s[i],i!==s.length-2&&(n+=".");o=n.split("_"),l=new Date,(c=String(l.getMonth()+1)).length<2&&(c="0"+c),(h=String(l.getDate())).length<2&&(h="0"+h),u=l.getFullYear()+c+h,d=String(l.getHours()),p=String(l.getMinutes()),f=String(l.getSeconds()),d.length<2&&(d="0"+d),p.length<2&&(p="0"+p),f.length<2&&(f="0"+f),g=d+p+f,b=[],y=Object(v.a)(this.props.logData);try{for(y.s();!(S=y.n()).done;)C=S.value,b.push(C.action)}catch(m){y.e(m)}finally{y.f()}"",j=b.join("\n"),(A=document.createElement("a")).href="data:text/plain,"+encodeURIComponent(j),A.download=o[0]+"-log_"+u+"_"+g,A.click(),a.download=o[0]+"_"+u+g+".tsv",a.click(),this.setState({loading:!1});case 44:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(ee.jsxs)("div",{children:[Object(ee.jsx)("button",{type:"button",onClick:function(){e.props.onExport(),e.handleFileDownload()},style:{display:"none"},children:"Export"}),this.state.loading&&Object(ee.jsxs)("div",{children:["Reading file... ",Object(ee.jsx)("img",{src:Ne,alt:"Loading"})]})]})}}]),a}(s.a.Component),Ue=a(27),Ye=a(206);var Ge=function(e){var t=e.chosenFile;return t.length>35&&(t=t.substring(0,34)+"..."),Object(ee.jsxs)("div",{className:e.show?"sidebar active":"sidebar",children:[Object(ee.jsxs)("div",{className:"closemenu",onClick:function(){e.onSidebarChange(!e.show)},children:[Object(ee.jsx)("div",{children:" "}),e.show?Object(ee.jsx)("div",{className:"arrow-container",children:Object(ee.jsx)(Ue.a,{})}):Object(ee.jsx)("div",{className:"arrow-container",children:Object(ee.jsx)(Ue.b,{})})]}),Object(ee.jsx)("div",{className:"closemenu2",onClick:function(){return e.setDisplayMode(ut.select)},children:Object(ee.jsx)("div",{className:"arrow-container",children:Object(ee.jsx)(Ue.c,{color:e.currentDisplayMode===ut.select?"red":"black"})})}),Object(ee.jsx)("div",{className:"closemenu3",onClick:function(){return e.setDisplayMode(ut.zoom)},children:Object(ee.jsx)("div",{className:"arrow-container",children:Object(ee.jsx)(Ue.e,{color:e.currentDisplayMode===ut.zoom||e.currentDisplayMode===ut.boxzoom?"red":"black"})})}),Object(ee.jsx)("div",{className:"closemenu4",onClick:function(){return e.setDisplayMode(ut.erase)},children:Object(ee.jsx)("div",{className:"arrow-container",children:Object(ee.jsx)(Ye.a,{color:e.currentDisplayMode===ut.erase?"red":"black"})})}),Object(ee.jsxs)("div",{className:"contents",children:[Object(ee.jsxs)("div",{className:"row-contents",children:[" ",Object(ee.jsx)("h1",{children:"CNAViz"})," "]}),Object(ee.jsx)("div",{className:"title-bar"}),Object(ee.jsxs)("div",{className:"row-contents",children:[" Chosen File: ",t]}),Object(ee.jsxs)("div",{className:"row-contents",children:[Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"file",id:"fileUpload",onChange:function(t){return e.onFileChosen(t,!0)}}),"Import"]}),Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)(Ie,{data:e.data,logData:e.logData,fileName:e.chosenFile,onExport:e.onExport}),"Export"]}),Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",onClick:function(t){return e.handleDemoFileInput(!0)}}),"Demo"]})]}),Object(ee.jsxs)("div",{className:"row-contents",children:[Object(ee.jsxs)("label",{className:e.processingStatus!==ht.done?"custom-file-upload-disabled":"custom-file-upload",children:[Object(ee.jsx)("input",{type:"file",id:"fileUpload",disabled:e.processingStatus!==ht.done,onChange:function(t){return e.onDriverFileChosen(t,!0)}}),"Import Driver Genes"]}),Object(ee.jsxs)("label",{className:e.processingStatus!==ht.done?"custom-file-upload-disabled":"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",disabled:e.processingStatus!==ht.done,onClick:function(t){return e.handleDemoDrivers()}}),"CGC Drivers"]})]}),Object(ee.jsx)("div",{className:"row-contents",children:Object(ee.jsxs)("div",{children:[Object(ee.jsx)("label",{htmlFor:"Select Chromosome",style:{margin:10},children:" Chromosome: "}),Object(ee.jsx)("select",{name:"Select Chromosome",id:"Select Chromosome",value:e.selectedChr,onChange:e.onChrSelected,children:e.chrOptions})]})}),Object(ee.jsxs)("div",{className:"row-contents",children:[Object(ee.jsxs)("label",{children:[Object(ee.jsx)("span",{className:"App-CheckBox-explanation",children:"Log RDR: "}),Object(ee.jsx)("input",{type:"checkbox",onClick:e.onToggleLog,disabled:e.showPurityPloidy})]}),Object(ee.jsxs)("label",{children:[Object(ee.jsx)("span",{className:"App-CheckBox-explanation",children:"Centroids: "}),Object(ee.jsx)("input",{type:"checkbox",onClick:e.onToggleShowCentroids,checked:e.showCentroids,readOnly:!0})]})]}),Object(ee.jsxs)("div",{className:"row-contents",children:[Object(ee.jsxs)("label",{children:[Object(ee.jsx)("span",{className:"App-CheckBox-explanation",children:"Scatterplots: "}),Object(ee.jsx)("input",{type:"checkbox",onClick:e.onToggleScatter,checked:e.showScatter,readOnly:!0})]}),Object(ee.jsxs)("label",{children:[Object(ee.jsx)("span",{className:"App-CheckBox-explanation",children:"Linear Plots: "}),Object(ee.jsx)("input",{type:"checkbox",onClick:e.onToggleLinear,checked:e.showLinear,readOnly:!0})]})]}),Object(ee.jsx)("div",{className:"row-contents",children:Object(ee.jsxs)("label",{children:[Object(ee.jsx)("span",{className:"App-CheckBox-explanation",children:"Purity/Ploidy: "}),Object(ee.jsx)("input",{type:"checkbox",onClick:e.onTogglePurityPloidy,checked:e.showPurityPloidy,disabled:e.applyLog,readOnly:!0})]})}),Object(ee.jsxs)("div",{className:"row-contents",children:[Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",onClick:function(){e.onTogglesilhouettes()}}),"Analytics (s)"]}),Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",onClick:e.onToggleShowCentroidTable}),"Centroids (c)"]}),Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",onClick:e.onToggleDirections}),"Usage (?)"]})]}),Object(ee.jsxs)("div",{className:"row-contents",children:[Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",onClick:e.onClearClustering}),"Clear Clustering"]}),Object(ee.jsxs)("label",{className:"custom-file-upload",children:[Object(ee.jsx)("input",{type:"button",id:"custom-button",onClick:e.onTogglePreviousActionLog}),"Previous Actions (l)"]})]})]}),Object(ee.jsx)("div",{className:"contents2",children:Object(ee.jsx)(Be,{data:e.tableData,onClusterRowsChange:e.onClusterRowsChange,onClusterColorChange:e.onClusterColorChange,currentFilters:e.currentClusterFilters,colOneName:"Cluster ID",colTwoName:"Bin (%)",cols:"",expandable:!0,selectable:!0,colors:e.colors})})]})},ze=(a(194),0),Ke=0,He=0,Xe=0,Qe=0,Ze=0,Ve=0,Je=50,We=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e))._svg=void 0,r.state={showTooltip:!1,tooltipX:0,tooltipY:0},r._svg=null,r}return Object(h.a)(a,[{key:"shouldComponentUpdate",value:function(e){return!0}},{key:"componentDidUpdate",value:function(e){this.propsDidChange(e,[])&&this.redraw()}},{key:"propsDidChange",value:function(e,t){var a=this;return t.some((function(t){return a.props[t]!==e[t]}))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"renderTooltipContent",value:function(e){var t=this.state.showTooltip;return e&&t?Object(ee.jsx)("div",{className:"Scatterplot-tooltip",style:{position:"absolute",top:"90%",left:"1%",pointerEvents:"none"},children:e}):null}},{key:"renderTooltip",value:function(){return this.renderTooltipContent(Object(ee.jsx)(s.a.Fragment,{children:Object(ee.jsx)("div",{children:"Note: The Silhouette coefficient ranges from -1 to 1 where the larger the number the more tightly grouped the cluster "})}))}},{key:"render",value:function(){return Object(ee.jsx)("div",{id:"chart-container",children:this.renderTooltip()})}},{key:"redraw",value:function(){var e=this,t=this.props,a=t.width,r=t.height,s=t.data,n=t.colors,i=S.a.sortBy(s,"avg"),o=Xe/a*100+"%",l=ze/a*100+"%",c=Ke/a*100+"%",h=He/a*100+"%",u=w.j("div#chart-container").append("svg").style("padding",l+" "+c+" "+h+" "+o+" ").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(a+Qe+Ve)+" "+(r+Ze+Je)),d=w.i().domain([-1,1]).range([15,a-10]);u.append("text").classed("scale",!0).attr("text-anchor","middle").attr("font-size",20).attr("x",S.a.mean([15,a-10])).attr("y",r+40).text("Approximate Average Silhouette Coefficient").on("mouseover",(function(){e.setState({showTooltip:!0}),e.setState({tooltipX:w.f.offsetX,tooltipY:w.f.offsetY})})).on("mouseleave",(function(){e.setState({showTooltip:!1})})),u.append("g").attr("transform","translate(0,"+r+")").call(w.a(d)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var p=w.h().range([0,r]).domain(i.map((function(e){return String(e.cluster)}))).padding(.1);u.selectAll("myRect").data(i).enter().append("rect").attr("class",(function(e){return"bar bar--"+(e.avg<0?"negative":"positive")})).attr("x",(function(e){return d(Math.min(0,e.avg))||0})).attr("y",(function(e){return p(String(e.cluster))||0})).attr("width",(function(e){return Math.abs((d(e.avg)||0)-(d(0)||0))})).attr("height",p.bandwidth()).attr("fill",(function(e){return-1===e.cluster?"#999999":n[e.cluster%n.length]})),u.append("g").call(w.b(p).tickSize(0).tickPadding(6)).attr("transform","translate("+d(0)+",0)")}}]),a}(s.a.Component),qe=0,$e=0,et=0,tt=0,at=10,rt=0,st=0,nt=50,it=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e))._svg=void 0,r._svg=null,r}return Object(h.a)(a,[{key:"shouldComponentUpdate",value:function(e){return!0}},{key:"componentDidUpdate",value:function(e){this.propsDidChange(e,["selectedCluster"])&&this.redraw()}},{key:"propsDidChange",value:function(e,t){var a=this;return t.some((function(t){return a.props[t]!==e[t]}))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=this,t=this.props,a=t.width,r=t.height,s=tt/a*100+"%",n=qe/a*100+"%",i=$e/a*100+"%",o=et/a*100+"%";return Object(ee.jsx)("div",{id:"chart-container2",children:Object(ee.jsx)("svg",{ref:function(t){return e._svg=t},style:{padding:n+" "+i+" "+o+" "+s+" "},preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+(a+at+st)+" "+(r+rt+nt)})})}},{key:"redraw",value:function(){var e=this.props,t=e.width,a=e.height,r=e.data,s=e.colors;if(this._svg){var n=[];void 0!==r&&(n=Array.from(r,(function(e){return{key:e[0],value:e[1]}}))),n=S.a.sortBy(n,"value");var i=w.j(this._svg);i.selectAll(".scales").remove();var o=S.a.maxBy(n,"value"),l=w.i().domain([0,o?o.value:1]).range([30,t-10]);i.append("text").classed("scales",!0).attr("text-anchor","middle").attr("font-size",20).attr("x",S.a.mean([0,t])).attr("y",a+40).text("Approximate Average Euclidean Distance"),i.append("g").classed("scales",!0).attr("transform","translate(0,"+a+")").call(w.a(l)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end");var c=w.h().range([0,a]).domain(n.map((function(e){return String(e.key)}))).padding(.1);i.selectAll(".bar").remove(),i.selectAll("myRect").classed("bars",!0).data(n).enter().append("rect").attr("class",(function(e){return"bar bar--"+(e.value<0?"negative":"positive")})).attr("x",(function(e){return l(Math.min(0,e.value))||0})).attr("y",(function(e){return c(String(e.key))||0})).attr("width",(function(e){return Math.abs((l(e.value)||0)-(l(0)||0))})).attr("height",c.bandwidth()).attr("fill",(function(e){return-1===e.key?"#999999":s[e.key%s.length]})),i.append("g").classed("scales",!0).call(w.b(c).tickSize(0).tickPadding(6)).attr("transform","translate("+l.range()[0]+",0)")}}}]),a}(s.a.Component),ot=(a(359),function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e))._clusters=void 0,r._clusters=r.initializeListOfClusters(),r.state={selectedCluster:r._clusters[0]},r}return Object(h.a)(a,[{key:"initializeListOfClusters",value:function(){var e=this.props.clusterTableData;this._clusters=[];var t,a=Object(v.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;this._clusters.push(r.key)}}catch(s){a.e(s)}finally{a.f()}for(;this._clusters.length>0&&(Number(this._clusters[0])===Number("-1")||Number(this._clusters[0])===Number("-2"));)this._clusters.shift();return this._clusters}},{key:"componentDidUpdate",value:function(e){this.props.clusterTableData!==e.clusterTableData&&this.initializeListOfClusters()}},{key:"render",value:function(){var e=this,t=this.props,a=t.silhouetteData,r=t.clusterDistances,s=t.colors,n=this._clusters.map((function(e){return Object(ee.jsx)("option",{value:e,children:e},e)}));return Object(ee.jsxs)("div",{className:"Directions2",children:[Object(ee.jsx)("h2",{className:"pop-up-window-header",children:" Cluster Analytics "}),Object(ee.jsx)("div",{className:"Exit-Popup",onClick:this.props.onToggleSilhoutteBarPlot,children:Object(ee.jsx)(Ue.d,{})}),Object(ee.jsxs)("div",{className:"Bar-Select",children:[Object(ee.jsxs)("div",{className:"ClusterDistances-Select",children:[Object(ee.jsxs)("div",{className:"Overall-Average",children:[" Average Cluster Silhouette Score: ",Object(ee.jsx)("b",{children:this.props.avgClusterSilhouette||0})," "]}),Object(ee.jsxs)("label",{className:"cluster-select",children:[" Cluster:",Object(ee.jsx)("select",{name:"Select Cluster",title:"Cluster",value:this.state.selectedCluster,onChange:function(t){e.setState({selectedCluster:t.target.value})},children:n})]})]}),Object(ee.jsxs)("div",{className:"BarPlots",children:[Object(ee.jsx)(We,{width:700,height:700,data:a,avgClusterSilhouette:this.props.avgClusterSilhouette,colors:s}),Object(ee.jsx)(it,{data:r.get(Number(this.state.selectedCluster)),selectedCluster:Number(this.state.selectedCluster),width:700,height:700,colors:s})]})]})]})}}]),a}(s.a.Component));function lt(e){return new Promise((function(t,a){var r=new FileReader;r.readAsText(e),r.onload=function(){t(r.result)},r.onerror=a,r.onabort=a}))}var ct,ht,ut,dt=["#d3fe14","#c9080a","#fec7f8","#0b7b3e","#3957ff","#0bf0e9","#c203c8","#fd9b39","#906407","#98ba7f","#fe6794","#10b0ff","#ac7bff","#fee7c0","#964c63","#1da49c","#0ad811","#bbd9fd","#fe6cfe","#d1a09c","#78579e","#81ffad","#739400","#ca6949","#d9bf01","#646a58","#d5097e","#bb73a9","#ccf6e9","#9cb4b6","#b6a7d4","#9e8c62","#6e83c8","#01af64","#a71afd","#cfe589","#d4ccd1","#fd4109","#bf8f0e","#2f786e","#4ed1a5","#d8bb7d","#a54509","#6a9276","#a4777a","#fc12c9","#606f15","#3cc4d9","#f31c4e","#73616f","#f097c6","#fc8772","#92a6fe","#875b44","#699ab3","#94bc19","#7d5bf0","#d24dfe","#c85b74","#68ff57","#b62347","#994b91","#646b8c","#977ab4","#d694fd","#c4d5b5","#fdc4bd","#1cae05","#7bd972","#e9700a","#d08f5d","#8bb9e1","#fde945","#a29d98","#1682fb","#9ad9e0","#d6cafe","#8d8328","#b091a7","#647579","#1f8d11","#e7eafd","#b9660b","#a4a644","#fec24c","#b1168c","#188cc1","#7ab297","#c949a6","#d48295","#eb6dc2","#d5b0cb","#ff9ffb","#fdb082","#af4d44","#a759c4","#a9e03a","#0d906b","#9ee3bd","#5b8846","#0d8995","#f25c58","#70ae4f","#847f74","#9094bb","#ffe2f1","#a67149","#936c8e","#d04907","#c3b8a6","#cef8c4","#7a9293","#fda2ab","#2ef6c5","#807242","#cb94cc","#b6bdd0","#b5c75d","#fde189","#b7ff80","#fa2d8e","#839a5f","#28c2b5","#e5e9e1","#bc79d8","#7ed8fe","#9f20c3","#4f7a5b","#f511fd","#09c959","#bcd0ce","#8685fd","#98fcff","#afbff9","#6d69b4","#aaa87e","#b59dfb","#d9a742","#ac5c86","#9468d5","#a4a2b2","#b1376e","#d43f3d","#05a9d1","#c38375","#24b58e","#6eabaf","#66bf7f","#92cbbb","#ddb1ee","#1be895","#c7ecf9","#a6baa6","#8045cd","#a9d796","#ce62cb","#0e954d","#a97d2f","#fcb8d3","#9bfee3","#4e8d84","#fc6d3f","#7b9fd4","#8c6165","#72805e","#d53762","#f00a1b","#de5c97","#8ea28b","#fccd95","#ba9c57","#b79a82","#7c5a82","#7d7ca4","#958ad6","#cd8126","#bdb0b7","#10e0f8","#dccc69","#d6de0f","#616d3d","#985a25","#30c7fd","#0aeb65","#e3cdb4","#bd1bee","#ad665d","#d77070","#8ea5b8","#76655e","#598100","#86757e","#5ea068","#a590b8","#c1a707","#85c0cd","#e2cde9","#dcd79c","#d8a882","#b256f9","#b13323","#519b3b","#dd80de","#f1884b","#74b2fe","#a0acd2","#d199b0","#f68392","#8ccaa0","#64d6cb","#e0f86a","#75671b","#796e87","#6d8075","#9b8a8d","#f04c71","#61bd29","#bcc18f","#fecd0f","#1e7ac9","#927261","#dc27cf","#979605","#ec9c88","#8c48a3","#676769","#546e64","#8f63a2","#b35b2d","#7b8ca2","#b87188","#4a9bda","#eb7dab","#f6a602","#cab3fe","#ddb8bb","#107959","#885973","#5e858e","#b15bad","#e107a7","#2f9dad","#4b9e83","#b992dc","#6bb0cb","#bdb363","#ccd6e4","#a3ee94","#9ef718","#fbe1d9","#a428a5","#93514c","#487434","#e8f1b6","#d00938","#fb50e1","#fa85e1","#7cd40a","#f1ade1","#b1485d","#7f76d6","#d186b3","#90c25e","#b8c813","#a8c9de","#7d30fe","#815f2d","#737f3b","#c84486","#946cfe","#e55432","#a88674","#c17a47","#b98b91","#fc4bb3","#da7f5f","#df920b","#b7bbba","#99e6d9","#a36170","#c742d8","#947f9d","#a37d93","#889072","#9b924c","#23b4bc","#e6a25f","#86df9c","#a7da6c","#3fee03","#eec9d8","#aafdcb","#7b9139","#92979c","#72788a","#994cff","#c85956","#7baa1a","#de72fe","#c7bad8","#85ebfe","#6e6089","#9b4d31","#297a1d","#9052c0","#698eba","#d46222","#6da095","#b483bb","#04d183","#9bcdfe","#2ffe8c","#9d4279","#c909aa","#826cae"];function pt(e,t,a){return new Promise((function(t,r){b()(e,{cast:!0,columns:!0,delimiter:"\t",skip_empty_lines:!0},(function(e,s){if(e)r(e);else{if(s.length>0){var n,i=Object(v.a)(V);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(!(o in s[0]))throw new Error("COLUMN: "+o+" IS MISSING FROM INPUTTED DATA")}}catch(A){i.e(A)}finally{i.f()}var l=0,c=s[0]["#CHR"],h=[],u={},d=S.a.groupBy(s,"SAMPLE");for(var p in d)u[p]=S.a.meanBy(d[p],(function(e){return e.RD}));var f,m=Object(v.a)(s);try{for(m.s();!(f=m.n()).done;){var g=f.value;a&&void 0!==g.CLUSTER||(g.CLUSTER=-1),g.fractional_cn=2*g.RD/u[g.SAMPLE],g.logRD=Math.log2(g.RD),c!==g["#CHR"]&&(h.push({name:c,length:l-0}),c=g["#CHR"]),l=Number(g.END),g.reverseBAF=.5-g.BAF}}catch(A){m.e(A)}finally{m.f()}h.push({name:c,length:l-0}),h.sort((function(e,t){return String(e.name).localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"})})),ct=new Ee(h);var b,y=Object(v.a)(s);try{for(y.s();!(b=y.n()).done;){var C=b.value;C.genomicPosition=ct.getImplicitCoordinates(new j(C["#CHR"],C.START,C.END)).start}}catch(A){y.e(A)}finally{y.f()}}t(s)}}))}))}function vt(e,t){return new Promise((function(a,r){b()(e,{cast:!0,columns:!0,delimiter:"\t",skip_empty_lines:!0,skip_lines_with_error:!0},(function(e,s){if(e)r(e);else{if(s.length>0){var n,i=Object(v.a)(J);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(!(o in s[0]))throw new Error("COLUMN: "+o+" IS MISSING FROM INPUTTED DRIVER DATA")}}catch(g){i.e(g)}finally{i.f()}}var l,c=[],h=new Set(t),u=Object(v.a)(s);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=d["Genome Location"].split(":");if(h.has(p[0])){var f=p[1].split("-"),m=new j(p[0],Number(f[0]),Number(f[1]));d.location=m,c.push(d)}}}catch(g){u.e(g)}finally{u.f()}a(c)}}))}))}!function(e){e[e.none=0]="none",e[e.readingFile=1]="readingFile",e[e.processing=2]="processing",e[e.done=3]="done",e[e.error=4]="error"}(ht||(ht={})),function(e){e[e.zoom=0]="zoom",e[e.select=1]="select",e[e.boxzoom=2]="boxzoom",e[e.erase=3]="erase"}(ut||(ut={}));var ft=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;Object(c.a)(this,a),(r=t.call(this,e)).state={processingStatus:ht.none,indexedData:new q([]),hoveredLocation:null,selectedChr:q.ALL_CHRS_KEY,selectedCluster:q.ALL_CLUSTERS_KEY,invertAxis:!1,sampleAmount:1,color:"blue",colors:dt,assignCluster:!1,assigned:!1,applyLog:!1,applyClustering:!1,value:"0",updatedBins:!1,selectedSample:"",displayMode:ut.zoom,sidebar:!0,chosenFile:"",showLinearPlot:!0,showScatterPlot:!0,showDirections:!1,showLog:!1,showCentroidTable:!1,showCentroids:!1,syncScales:!1,scales:{xScale:null,yScale:null},driverGenes:null,showSilhouettes:ht.none,silhouettes:[],showPurityPloidyInputs:!1,samplesShown:[],samplesNotShown:[]},r.handleFileChoosen=r.handleFileChoosen.bind(Object(u.a)(r)),r.handleDemoFileInput=r.handleDemoFileInput.bind(Object(u.a)(r)),r.handleDriverFileChosen=r.handleDriverFileChosen.bind(Object(u.a)(r)),r.handleDemoDrivers=r.handleDemoDrivers.bind(Object(u.a)(r)),r.handleChrSelected=r.handleChrSelected.bind(Object(u.a)(r)),r.handleClusterSelected=r.handleClusterSelected.bind(Object(u.a)(r)),r.handleLocationHovered=S.a.throttle(r.handleLocationHovered.bind(Object(u.a)(r)),50),r.handleAxisInvert=r.handleAxisInvert.bind(Object(u.a)(r)),r.handleAddSampleClick=r.handleAddSampleClick.bind(Object(u.a)(r)),r.handleColorChange=r.handleColorChange.bind(Object(u.a)(r)),r.handleAssignCluster=r.handleAssignCluster.bind(Object(u.a)(r)),r.handleCallBack=r.handleCallBack.bind(Object(u.a)(r)),r.handleClusterAssignmentInput=r.handleClusterAssignmentInput.bind(Object(u.a)(r)),r.updateBrushedBins=r.updateBrushedBins.bind(Object(u.a)(r)),r.onClusterRowsChange=r.onClusterRowsChange.bind(Object(u.a)(r)),r.onClusterColorChange=r.onClusterColorChange.bind(Object(u.a)(r)),r.onSelectedSample=r.onSelectedSample.bind(Object(u.a)(r)),r.handleRemovePlot=r.handleRemovePlot.bind(Object(u.a)(r)),r.setDisplayMode=r.setDisplayMode.bind(Object(u.a)(r)),r.onSideBarChange=r.onSideBarChange.bind(Object(u.a)(r)),r.toggleLog=r.toggleLog.bind(Object(u.a)(r)),r.onToggleLinear=r.onToggleLinear.bind(Object(u.a)(r)),r.onToggleScatter=r.onToggleScatter.bind(Object(u.a)(r)),r.onToggleSync=r.onToggleSync.bind(Object(u.a)(r)),r.goBackToPreviousCluster=r.goBackToPreviousCluster.bind(Object(u.a)(r)),r.handleZoom=r.handleZoom.bind(Object(u.a)(r)),r.onToggleShowCentroids=r.onToggleShowCentroids.bind(Object(u.a)(r)),r.onToggleSilhoutteBarPlot=r.onToggleSilhoutteBarPlot.bind(Object(u.a)(r)),r.onToggleDirections=r.onToggleDirections.bind(Object(u.a)(r)),r.onToggleShowCentroidTable=r.onToggleShowCentroidTable.bind(Object(u.a)(r)),r.onTogglePreviousActionLog=r.onTogglePreviousActionLog.bind(Object(u.a)(r)),r.onClearClustering=r.onClearClustering.bind(Object(u.a)(r)),r.setProcessingStatus=r.setProcessingStatus.bind(Object(u.a)(r)),r.onTogglePurityPloidy=r.onTogglePurityPloidy.bind(Object(u.a)(r)),r.changeDisplayedSamples=r.changeDisplayedSamples.bind(Object(u.a)(r)),r.onExport=r.onExport.bind(Object(u.a)(r));var s=Object(u.a)(r);return w.j("body").on("keypress",(function(){"z"===w.f.key?s.setState({displayMode:ut.zoom}):"b"===w.f.key?s.setState({displayMode:ut.select}):"e"===w.f.key?s.setState({displayMode:ut.erase}):32===w.f.keyCode?s.onSideBarChange(!s.state.sidebar):"l"===w.f.key?s.setState({showLog:!s.state.showLog}):"c"===w.f.key?s.setState({showCentroidTable:!s.state.showCentroidTable}):"s"===w.f.key?s.onToggleSilhoutteBarPlot():"t"===w.f.key&&s.state.indexedData.calculateCopyNumbers2()})),w.j("body").on("keydown",(function(){s.state.displayMode===ut.zoom&&"Shift"===w.f.key?s.setState({displayMode:ut.boxzoom}):"/"===w.f.key||"?"===w.f.key?s.setState({showDirections:!0}):s.state.displayMode!==ut.zoom&&s.state.displayMode!==ut.erase||"Meta"!==w.f.key&&"Control"!==w.f.key?s.state.displayMode!==ut.zoom&&s.state.displayMode!==ut.select||"Alt"!==w.f.key||s.setState({displayMode:ut.erase}):s.setState({displayMode:ut.select})})),w.j("body").on("keyup",(function(){s.state.displayMode===ut.boxzoom&&"Shift"===w.f.key?s.setState({displayMode:ut.zoom}):"/"===w.f.key||"?"===w.f.key?s.setState({showDirections:!1}):s.state.displayMode!==ut.select||"Meta"!==w.f.key&&"Control"!==w.f.key?s.state.displayMode===ut.erase&&"Alt"===w.f.key&&s.setState({displayMode:ut.zoom}):s.setState({displayMode:ut.zoom})})),r}return Object(h.a)(a,[{key:"handleFileChoosen",value:function(){var e=Object(l.a)(m.a.mark((function e(t,a){var r,s,n,i,o,l,c,h;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.target.files)&&r[0]){e.next=3;break}return e.abrupt("return");case 3:return this.setState({chosenFile:r[0].name}),this.setState({processingStatus:ht.readingFile}),s="",e.prev=6,e.next=9,lt(r[0]);case 9:s=e.sent,e.next=17;break;case 12:return e.prev=12,e.t0=e.catch(6),console.error(e.t0),this.setState({processingStatus:ht.error}),e.abrupt("return");case 17:return this.setState({processingStatus:ht.processing}),n=null,e.prev=19,e.next=22,pt(s,this.state.applyLog,a);case 22:i=e.sent,n=new q(i),e.next=31;break;case 26:return e.prev=26,e.t1=e.catch(19),console.error(e.t1),this.setState({processingStatus:ht.error}),e.abrupt("return");case 31:for(o=n.getSampleList(),l=[],c=[],h=0;h<o.length;h++)h<this.state.sampleAmount?l.push(o[h]):c.push(o[h]);this.setState({indexedData:n,processingStatus:ht.done,samplesShown:l,samplesNotShown:c});case 36:case"end":return e.stop()}}),e,this,[[6,12],[19,26]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"handleDemoFileInput",value:function(){var e=Object(l.a)(m.a.mark((function e(t){var a=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({chosenFile:"a12.tsv"}),this.setState({processingStatus:ht.readingFile}),fetch("https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/a12.tsv").then((function(e){return e.text()})).then((function(e){a.setState({processingStatus:ht.processing}),pt(e,a.state.applyLog,t).then((function(e){for(var t=new q(e),r=t.getSampleList(),s=[],n=[],i=0;i<r.length;i++)i<a.state.sampleAmount?s.push(r[i]):n.push(r[i]);a.setState({indexedData:t,processingStatus:ht.done,samplesShown:s,samplesNotShown:n})})).catch((function(e){console.error(e),a.setState({processingStatus:ht.error})}))}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setProcessingStatus",value:function(e){this.setState({processingStatus:e})}},{key:"handleDriverFileChosen",value:function(){var e=Object(l.a)(m.a.mark((function e(t){var a,r,s,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=t.target.files)&&a[0]){e.next=3;break}return e.abrupt("return");case 3:return r="",e.prev=4,e.next=7,lt(a[0]);case 7:r=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),console.error(e.t0),e.abrupt("return");case 14:return s=null,e.prev=15,e.next=18,vt(r,this.state.indexedData.getAllChromosomes());case 18:n=e.sent,s=n,e.next=26;break;case 22:return e.prev=22,e.t1=e.catch(15),console.error(e.t1),e.abrupt("return");case 26:this.setState({driverGenes:s});case 27:case"end":return e.stop()}}),e,this,[[4,10],[15,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDemoDrivers",value:function(){var e=Object(l.a)(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("https://raw.githubusercontent.com/elkebir-group/cnaviz/master/data/demo/drivers.tsv").then((function(e){return e.text()})).then((function(e){vt(e,t.state.indexedData.getAllChromosomes()).then((function(e){t.setState({driverGenes:e})})).catch((function(e){console.error(e)}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"handleChrSelected",value:function(e){this.setState({selectedChr:e.target.value}),this.state.indexedData.setChrFilter(e.target.value)}},{key:"handleClusterSelected",value:function(e){this.setState({selectedCluster:e.target.value}),this.state.indexedData.setClusterFilters([e.target.value])}},{key:"handleLocationHovered",value:function(e){e?this.setState({hoveredLocation:e}):this.setState({hoveredLocation:null})}},{key:"handleClusterAssignmentInput",value:function(e){this.setState({value:e.target.value})}},{key:"handleCallBack",value:function(e){this.state.indexedData.updateCluster(Number(e)),this.setState({assignCluster:!1}),this.state.indexedData.setChrFilter(this.state.selectedChr)}},{key:"updateBrushedBins",value:function(e){this.state.indexedData.setbrushedBins(e),this.setState({updatedBins:!0})}},{key:"handleAxisInvert",value:function(){this.setState({invertAxis:!this.state.invertAxis})}},{key:"changeDisplayedSamples",value:function(e,t){for(var a=this.state.samplesShown,r=0;r<a.length;r++)a[r]===t&&(a[r]=e);var s=this.state.samplesNotShown;(s=s.filter((function(t){return t!==e}))).push(t),this.setState({sampleAmount:this.state.sampleAmount,samplesShown:a,samplesNotShown:s})}},{key:"handleAddSampleClick",value:function(){var e=this.state.samplesNotShown[0],t=this.state.samplesShown;t.push(e);var a=this.state.samplesNotShown;a=a.filter((function(t){return t!==e})),this.setState({sampleAmount:this.state.sampleAmount+1,samplesShown:t,samplesNotShown:a})}},{key:"handleRemovePlot",value:function(e){var t=this.state.samplesShown,a=t[t.length-1];t.pop(),this.state.samplesNotShown.push(a),this.setState({sampleAmount:this.state.sampleAmount-1})}},{key:"handleAssignCluster",value:function(){this.setState({assignCluster:!this.state.assignCluster})}},{key:"handleColorChange",value:function(e){this.setState({color:e.hex})}},{key:"getStatusCaption",value:function(){switch(this.state.processingStatus){case ht.readingFile:return Object(ee.jsxs)("div",{children:["Reading file... ",Object(ee.jsx)("img",{src:Ne,alt:"Loading"})]});case ht.processing:return Object(ee.jsxs)("div",{children:["Processing data... ",Object(ee.jsx)("img",{src:Ne,alt:"Loading"})]});case ht.error:return"ERROR";case ht.none:case ht.done:default:return""}}},{key:"onToggleDirections",value:function(){this.setState({showDirections:!this.state.showDirections})}},{key:"toggleLog",value:function(){this.state.applyLog?(this.state.indexedData.setDataKeyType("RD"),this.state.indexedData.recalculateCentroids("RD")):(this.state.indexedData.setDataKeyType("logRD"),this.state.indexedData.recalculateCentroids("logRD")),this.setState({applyLog:!this.state.applyLog}),this.state.indexedData.setShouldRecalculatesilhouettes(!0)}},{key:"toggleClustering",value:function(){this.setState({applyClustering:!this.state.applyClustering})}},{key:"onClusterRowsChange",value:function(e){this.state.indexedData.setClusterFilters(e.selectedRows.map((function(e){return String(e.key)}))),this.setState({indexedData:this.state.indexedData})}},{key:"onClusterColorChange",value:function(e){var t,a=[],r=Object(v.a)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;a.push(s)}}catch(n){r.e(n)}finally{r.f()}this.setState({colors:a})}},{key:"onSelectedSample",value:function(e){this.setState({selectedSample:e})}},{key:"setDisplayMode",value:function(e){this.setState({displayMode:e})}},{key:"onSideBarChange",value:function(e){this.setState({sidebar:e})}},{key:"onToggleScatter",value:function(){this.setState({showScatterPlot:!this.state.showScatterPlot})}},{key:"onToggleLinear",value:function(){this.setState({showLinearPlot:!this.state.showLinearPlot})}},{key:"onToggleSync",value:function(){this.setState({syncScales:!this.state.syncScales})}},{key:"onToggleShowCentroids",value:function(){this.setState({showCentroids:!this.state.showCentroids})}},{key:"onToggleShowCentroidTable",value:function(){this.setState({showCentroidTable:!this.state.showCentroidTable})}},{key:"goBackToPreviousCluster",value:function(){this.state.indexedData.undoClusterUpdate(),this.setState({indexedData:this.state.indexedData})}},{key:"handleZoom",value:function(e){this.setState({scales:e})}},{key:"onTogglePreviousActionLog",value:function(){this.setState({showLog:!this.state.showLog})}},{key:"onClearClustering",value:function(){this.state.indexedData.clearClustering(),this.setState({indexedData:this.state.indexedData})}},{key:"onExport",value:function(){this.state.indexedData.calculateCopyNumbers2()}},{key:"onTogglePurityPloidy",value:function(){this.state.showPurityPloidyInputs?this.state.indexedData.setDataKeyType("RD"):this.state.indexedData.setDataKeyType("fractional_cn"),this.setState({showPurityPloidyInputs:!this.state.showPurityPloidyInputs})}},{key:"onToggleSilhoutteBarPlot",value:function(){var e=Object(l.a)(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({processingStatus:ht.processing}),this.state.showSilhouettes===ht.none?(this.setState({showSilhouettes:ht.processing}),this.state.indexedData.recalculatesilhouettes(this.state.applyLog).then((function(e){void 0!==e&&(t.setState({silhouettes:e}),t.setState({showSilhouettes:ht.done}))}))):this.setState({showSilhouettes:ht.none}),this.setState({processingStatus:ht.done});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.indexedData,r=t.selectedChr,s=t.selectedCluster,n=t.hoveredLocation,i=t.invertAxis,l=t.color,c=t.assignCluster,h=t.updatedBins,u=t.value,d=t.sampleAmount,p=this.state.samplesShown,v=new Set(p),f=a.getBrushedBins(),m=a.getAllRecords(),g=null,b=a.getClusterTableInfo(),y=[Object(ee.jsx)("option",{value:q.ALL_CHRS_KEY,children:"ALL"},q.ALL_CHRS_KEY)],C=a.getActions();if(this.state.processingStatus===ht.done&&!a.isEmpty()){var j=a.getClusterTableInfo(),A={data:a,hoveredLocation:n||void 0,onLocationHovered:this.handleLocationHovered,invertAxis:i,chr:r,cluster:s,customColor:l,colors:this.state.colors,assignCluster:c,onBrushedBinsUpdated:this.updateBrushedBins,parentCallBack:this.handleCallBack,brushedBins:f,updatedBins:h,onSelectedSample:this.onSelectedSample,selectedSample:this.state.selectedSample,dispMode:this.state.displayMode,onRemovePlot:this.handleRemovePlot,onAddSample:this.handleAddSampleClick,onChangeSample:this.changeDisplayedSamples,clusterTableData:j,applyLog:this.state.applyLog,onClusterSelected:this.handleClusterSelected,onUndoClick:this.goBackToPreviousCluster,showCentroids:this.state.showCentroids,driverGenes:this.state.driverGenes};(y=a.getAllChromosomes().sort((function(e,t){return e.localeCompare(t,"en",{numeric:!0})})).map((function(e){return Object(ee.jsx)("option",{value:e,children:e},e)}))).push(Object(ee.jsx)("option",{value:q.ALL_CHRS_KEY,children:"ALL"},q.ALL_CHRS_KEY)),a.getAllClusters().map((function(e){return Object(ee.jsx)("option",{value:e,children:e},e)})).push(Object(ee.jsx)("option",{value:q.ALL_CLUSTERS_KEY,children:"ALL"},q.ALL_CLUSTERS_KEY)),g=Object(ee.jsx)("div",{id:"grid-container",children:Object(ee.jsx)("div",{className:"sampleviz-wrapper-row",children:S.a.times(d,(function(t){return p.length>t&&Object(ee.jsx)(Le,Object(o.a)(Object(o.a)({},A),{},{initialSelectedSample:p[t],plotId:t,showLinearPlot:e.state.showLinearPlot,showScatterPlot:e.state.showScatterPlot,sampleAmount:d,syncScales:e.state.syncScales,handleZoom:e.handleZoom,scales:e.state.scales,showPurityPloidyInputs:e.state.showPurityPloidyInputs,samplesShown:v}),t)}))})})}var x=this.getStatusCaption();return Object(ee.jsxs)("div",{className:"container-fluid",children:[Object(ee.jsx)("div",{children:Object(ee.jsx)(Ge,{selectedChr:r,onChrSelected:this.handleChrSelected,chrOptions:y,onAddSample:this.handleAddSampleClick,onAssignCluster:this.handleAssignCluster,tableData:b,onClusterRowsChange:this.onClusterRowsChange,onClusterColorChange:this.onClusterColorChange,currentClusterFilters:a.getFilteredClusters(),handleClusterAssignmentInput:this.handleClusterAssignmentInput,value:u,setDisplayMode:this.setDisplayMode,currentDisplayMode:this.state.displayMode,colors:this.state.colors,onSidebarChange:this.onSideBarChange,data:m,onFileChosen:this.handleFileChoosen,chosenFile:this.state.chosenFile,show:this.state.sidebar,onToggleLog:this.toggleLog,onToggleLinear:this.onToggleLinear,onToggleScatter:this.onToggleScatter,showScatter:this.state.showScatterPlot,showLinear:this.state.showLinearPlot,onToggleSync:this.onToggleSync,syncScales:this.state.syncScales,logData:C,onToggleShowCentroids:this.onToggleShowCentroids,showCentroids:this.state.showCentroids,onDriverFileChosen:this.handleDriverFileChosen,onTogglesilhouettes:this.onToggleSilhoutteBarPlot,showSilhouettes:this.state.showSilhouettes,onToggleDirections:this.onToggleDirections,onToggleShowCentroidTable:this.onToggleShowCentroidTable,onTogglePreviousActionLog:this.onTogglePreviousActionLog,onClearClustering:this.onClearClustering,handleDemoFileInput:this.handleDemoFileInput,handleDemoDrivers:this.handleDemoDrivers,setProcessingStatus:this.setProcessingStatus,onTogglePurityPloidy:this.onTogglePurityPloidy,showPurityPloidy:this.state.showPurityPloidyInputs,applyLog:this.state.applyLog,processingStatus:this.state.processingStatus,onExport:this.onExport})}),Object(ee.jsxs)("div",{className:this.state.sidebar?"marginContent":"",children:[x&&Object(ee.jsx)("div",{className:"App-status-pane",children:x}),g,this.state.showDirections&&Object(ee.jsx)("div",{className:"black_overlay"}),this.state.showDirections&&Object(ee.jsxs)("div",{className:"Directions",children:[Object(ee.jsx)("h2",{className:"pop-up-window-header",children:"Directions"}),Object(ee.jsx)("div",{className:"Exit-Popup",onClick:this.onToggleDirections,children:Object(ee.jsx)(Ue.d,{})}),Object(ee.jsx)("h5",{children:" Selection "}),Object(ee.jsx)("li",{children:' Hold down "Command/Control" in Zoom mode to temporarily enter add-to-selection mode '}),Object(ee.jsx)("li",{children:' Hold down "Alt" in Zoom mode to temporarily enter remove-from-selection mode '}),Object(ee.jsx)("li",{children:" To completely clear your selection, click anywhere in the plot while in add-to-selection or remove-from-selection modes "}),Object(ee.jsx)("li",{children:" To stay in add-to-select mode without holding a button, you can click b or click the mouse pointer button next to the sidebar"}),Object(ee.jsx)("li",{children:" To stay in remove-from-select mode without holding a button, you can click e or click the eraser icon next to the sidebar "}),Object(ee.jsx)("h5",{children:" Zoom/Pan Mode "}),Object(ee.jsx)("li",{children:" To enter zoom/pan mode, click the magnifying glass icon next to the sidebar "}),Object(ee.jsx)("li",{children:" In zoom mode, if you hold down shift, it will act as a bounding box zoom "}),Object(ee.jsx)("li",{children:" To pan, just click and drag on the scatter plot or axes "}),Object(ee.jsx)("h5",{children:" Other Key Modifiers "}),Object(ee.jsx)("li",{children:' Click "l" to toggle a log of previous actions '}),Object(ee.jsx)("li",{children:" Click space to toggle the sidebar "}),Object(ee.jsx)("li",{children:' Hold down "?" or "/" button to open direction panel '}),Object(ee.jsx)("li",{children:' Click "c" to toggle a table of the centroids of each cluster for each sample '}),Object(ee.jsx)("li",{children:' Click "s" to toggle a bar plot displaying approximate average silhoutte scores for each cluster '})]}),this.state.showLog&&Object(ee.jsx)("div",{className:"black_overlay"}),this.state.showLog&&Object(ee.jsxs)("div",{className:"Directions",children:[Object(ee.jsx)("h2",{className:"pop-up-window-header",children:" Previous Actions "}),Object(ee.jsx)("div",{className:"Exit-Popup",onClick:function(){return e.setState({showLog:!e.state.showLog})},children:Object(ee.jsx)(Ue.d,{})}),Object(ee.jsx)(Me,{data:C,onClusterColorChange:this.onClusterColorChange,onClusterRowsChange:this.onClusterRowsChange,colName:"Actions (Starting from most recent)"})]}),this.state.showCentroidTable&&Object(ee.jsx)("div",{className:"black_overlay"}),this.state.showCentroidTable&&Object(ee.jsxs)("div",{className:"Directions",children:[Object(ee.jsx)("h2",{className:"pop-up-window-header",children:" Centroid Table "}),Object(ee.jsx)("div",{className:"Exit-Popup",onClick:function(){return e.setState({showCentroidTable:!e.state.showCentroidTable})},children:Object(ee.jsx)(Ue.d,{})}),Object(ee.jsx)(Be,{data:a.getCentroidData(),onClusterColorChange:this.onClusterColorChange,onClusterRowsChange:this.onClusterRowsChange,colors:dt,currentFilters:[""],centroidTable:!0,colOneName:"Cluster",colTwoName:"Sample",colThreeName:"Centroid",cols:[{name:"Cluster",type:"key"},{name:"Sample",type:"sample"},{name:"Centroid",type:"centroid"}]})]}),this.state.showSilhouettes===ht.done&&Object(ee.jsx)("div",{className:"black_overlay"}),this.state.showSilhouettes===ht.done&&Object(ee.jsx)(ot,{silhouetteData:this.state.silhouettes,avgClusterSilhouette:this.state.indexedData.getAvgSilhouette(),clusterDistances:this.state.indexedData.getClusterDistanceMatrix(),clusterTableData:b,colors:dt,onToggleSilhoutteBarPlot:this.onToggleSilhoutteBarPlot})]})]})}}]),a}(s.a.Component);i.a.render(Object(ee.jsx)(ft,{}),document.getElementById("root"))}},[[361,1,2]]]);
//# sourceMappingURL=main.abb86611.chunk.js.map